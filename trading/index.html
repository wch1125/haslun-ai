<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0c0f">
  <title>HASLUN-BOT \\ PILOT'S COCKPIT</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%230a0c0f' width='100' height='100'/%3E%3Ccircle cx='50' cy='50' r='35' fill='none' stroke='%2333ff99' stroke-width='2'/%3E%3Ccircle cx='50' cy='50' r='25' fill='none' stroke='%2333ff99' stroke-width='1' opacity='0.5'/%3E%3Ccircle cx='50' cy='50' r='4' fill='%23ffb347'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Orbitron:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <style>
    :root {
      --bg-void: #050608;
      --bg-deep: #0a0c0f;
      --bg-panel: #0d1117;
      --bg-card: #151b23;
      --bg-input: #1a222c;
      --border: #1e2832;
      --border-glow: #2a3a4a;
      --grid-line: rgba(51, 255, 153, 0.08);
      --text-bright: #f0f8f4;
      --text: #b8d0c8;
      --text-muted: #6a8078;
      --text-dim: #4a5a54;
      --text-soft: #8aa098;
      /* HSL-based phosphor for color profile control */
      --accent-hue: 150;
      --phosphor: hsl(var(--accent-hue), 100%, 60%);
      --phosphor-dim: hsla(var(--accent-hue), 100%, 60%, 0.6);
      --phosphor-glow: hsla(var(--accent-hue), 100%, 60%, 0.15);
      --phosphor-ghost: hsla(var(--accent-hue), 100%, 60%, 0.08);
      --accent-glow: hsla(var(--accent-hue), 100%, 65%, 0.7);
      --amber: #ffb347;
      --amber-dim: rgba(255, 179, 71, 0.6);
      --amber-glow: rgba(255, 179, 71, 0.15);
      --signal-up: hsl(var(--accent-hue), 100%, 60%);
      --signal-down: #ff6b6b;
      --signal-warn: #ffb347;
      --font-display: 'Orbitron', sans-serif;
      --font-body: 'IBM Plex Mono', monospace;
      --font-mono: 'IBM Plex Mono', monospace;
    }
    
    @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100vh); } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(51, 255, 153, 0.1); } 50% { box-shadow: 0 0 30px rgba(51, 255, 153, 0.2); } }
    @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
    @keyframes crt-flicker { 0%, 100% { opacity: 0.12; } 40% { opacity: 0.18; } 60% { opacity: 0.10; } }
    @keyframes hover-ship { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    @keyframes beam-pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @keyframes radar-sweep { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes data-glow { from { box-shadow: 0 0 20px rgba(255, 179, 71, 0.5); } to { box-shadow: none; } }
    
    /* =========================================================================
       COMMAND CENTER MODE
       Authentic 80s/90s mission control - NORAD / NASA / Nostromo aesthetic
       Less widgets, more data density, unified visual language
       ========================================================================= */
    
    /* === LAYOUT: Remove right sidebar entirely === */
    .right-sidebar {
      display: none !important;
    }
    
    /* === LAYOUT: Narrower left sidebar === */
    .sidebar {
      width: 240px !important;
      border-right: 2px solid var(--border) !important;
    }
    
    /* === HIDE: Redundant/cluttery elements === */
    #encounters-console,
    .arcade-hud,
    .portfolio-mood,
    .holo-card,
    .control-panel,
    .dossier-btn,
    .fleet-holo-strip,
    .position-charts-section,
    .ship-profile {
      display: none !important;
    }
    
    /* =========================================================================
       FLEET MANAGEMENT SYSTEM - No Man's Sky Inspired
       Each position = a ship in your fleet
       ========================================================================= */
    
    .fleet-command-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-panel) 100%);
      border-bottom: 2px solid var(--phosphor-dim);
    }
    
    .fleet-command-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .fleet-command-title .icon {
      font-size: 1.5rem;
    }
    
    .fleet-command-title h2 {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--phosphor);
      letter-spacing: 0.15em;
      margin: 0;
    }
    
    .fleet-command-title .subtitle {
      font-size: 0.55rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      margin-top: 0.15rem;
    }
    
    .fleet-stats-mini {
      display: flex;
      gap: 1.5rem;
    }
    
    .fleet-stat-mini {
      text-align: right;
    }
    
    .fleet-stat-mini .value {
      font-family: var(--font-display);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    
    .fleet-stat-mini .value.positive { color: var(--signal-up); }
    .fleet-stat-mini .value.negative { color: var(--signal-down); }
    
    .fleet-stat-mini .label {
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    /* Fleet Grid - The main ship display */
    .fleet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-deep);
    }
    
    /* Individual Ship Card */
    .ship-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-panel) 100%);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }
    
    .ship-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--ship-color, var(--phosphor));
      opacity: 0.6;
    }
    
    .ship-card:hover {
      border-color: var(--ship-color, var(--phosphor));
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), 0 0 20px var(--phosphor-ghost);
    }
    
    .ship-card.negative .ship-hull-bar {
      background: var(--signal-down) !important;
    }
    
    .ship-card-inner {
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 0.75rem;
      padding: 0.75rem;
    }
    
    /* Ship Visualization Area */
    .ship-visual {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      padding: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    
    .ship-visual::before {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        linear-gradient(0deg, transparent 49%, var(--phosphor-ghost) 50%, transparent 51%),
        linear-gradient(90deg, transparent 49%, var(--phosphor-ghost) 50%, transparent 51%);
      background-size: 8px 8px;
      opacity: 0.5;
    }
    
    .ship-visual svg {
      width: 80px;
      height: 60px;
      position: relative;
      z-index: 1;
      filter: drop-shadow(0 0 8px var(--ship-color, var(--phosphor)));
      animation: hover-ship 3.25s ease-in-out infinite;
    }

    /* Ship sprite support (per-ticker PNGs) */
    .ship-visual img {
      width: 80px;
      height: 60px;
      position: relative;
      z-index: 1;
      object-fit: contain;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 8px var(--ship-color, var(--phosphor)));
      animation: hover-ship 3.25s ease-in-out infinite;
    }
    
    .ship-visual .ship-class-badge {
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.45rem;
      color: var(--text-dim);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      background: rgba(0, 0, 0, 0.6);
      padding: 0.15rem 0.4rem;
      border-radius: 2px;
    }
    
    /* Ship Info Section */
    .ship-info {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .ship-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }
    
    .ship-name {
      font-family: var(--font-display);
      font-size: 1rem;
      font-weight: 600;
      color: var(--ship-color, var(--phosphor));
      letter-spacing: 0.05em;
    }
    
    .ship-designation {
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-top: 0.1rem;
    }
    
    .ship-status-indicator {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.5rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    
    .ship-status-indicator.operational {
      background: rgba(51, 255, 153, 0.15);
      color: var(--signal-up);
      border: 1px solid rgba(51, 255, 153, 0.3);
    }
    
    .ship-status-indicator.damaged {
      background: rgba(255, 107, 107, 0.15);
      color: var(--signal-down);
      border: 1px solid rgba(255, 107, 107, 0.3);
    }
    
    .ship-status-indicator .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
      box-shadow: 0 0 6px currentColor;
    }
    
    /* Ship Stats Bars */
    .ship-stats {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }
    
    .ship-stat-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .ship-stat-label {
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      width: 40px;
      flex-shrink: 0;
    }
    
    .ship-stat-bar {
      flex: 1;
      height: 6px;
      background: var(--bg-void);
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }
    
    .ship-stat-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
      position: relative;
    }
    
    .ship-stat-fill.hull {
      background: linear-gradient(90deg, var(--signal-up) 0%, var(--phosphor) 100%);
    }
    
    .ship-stat-fill.hull.damaged {
      background: linear-gradient(90deg, var(--signal-down) 0%, var(--signal-warn) 100%);
    }
    
    .ship-stat-fill.cargo {
      background: linear-gradient(90deg, var(--amber) 0%, var(--amber-dim) 100%);
    }
    
    .ship-stat-fill.fuel {
      background: linear-gradient(90deg, #47d4ff 0%, #47d4ff80 100%);
    }
    
    .ship-stat-value {
      font-size: 0.55rem;
      color: var(--text);
      min-width: 50px;
      text-align: right;
      font-family: var(--font-mono);
    }
    
    /* Ship Footer - P&L Display */
    .ship-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid var(--border);
      margin: 0 -0.75rem -0.75rem;
    }
    
    .ship-value {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    
    .ship-pnl {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .ship-pnl-amount {
      font-family: var(--font-display);
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .ship-pnl-amount.positive { color: var(--signal-up); }
    .ship-pnl-amount.negative { color: var(--signal-down); }
    
    .ship-pnl-percent {
      font-size: 0.6rem;
      padding: 0.15rem 0.35rem;
      border-radius: 3px;
    }
    
    .ship-pnl-percent.positive {
      background: rgba(51, 255, 153, 0.15);
      color: var(--signal-up);
    }
    
    .ship-pnl-percent.negative {
      background: rgba(255, 107, 107, 0.15);
      color: var(--signal-down);
    }
    
    /* Fleet Summary Bar */
    .fleet-summary-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1.25rem;
      background: var(--bg-panel);
      border-top: 1px solid var(--border);
    }
    
    .fleet-summary-left {
      display: flex;
      gap: 2rem;
    }
    
    .fleet-summary-stat {
      display: flex;
      flex-direction: column;
    }
    
    .fleet-summary-stat .label {
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    .fleet-summary-stat .value {
      font-family: var(--font-display);
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    
    .fleet-summary-stat .value.positive { color: var(--signal-up); }
    .fleet-summary-stat .value.negative { color: var(--signal-down); }
    
    .fleet-view-toggle {
      display: flex;
      gap: 0.25rem;
    }
    
    .fleet-view-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-dim);
      padding: 0.4rem 0.6rem;
      font-size: 0.6rem;
      font-family: var(--font-mono);
      cursor: pointer;
      transition: all 0.15s;
      border-radius: 4px;
    }
    
    .fleet-view-btn:hover {
      border-color: var(--phosphor-dim);
      color: var(--phosphor);
    }
    
    .fleet-view-btn.active {
      background: var(--phosphor-ghost);
      border-color: var(--phosphor);
      color: var(--phosphor);
    }
    
    /* Legacy table - compact mode */
    .fleet-table-view {
      display: none;
    }
    
    .fleet-table-view.active {
      display: block;
    }
    
    .fleet-grid-view {
      display: block;
    }
    
    .fleet-grid-view.hidden {
      display: none;
    }
    
    /* Mobile Responsiveness for Fleet */
    @media (max-width: 768px) {
      .fleet-grid {
        grid-template-columns: 1fr;
        padding: 0.75rem;
        gap: 0.75rem;
      }
      
      .ship-card-inner {
        grid-template-columns: 80px 1fr;
        gap: 0.5rem;
        padding: 0.5rem;
      }
      
      .ship-visual svg {
        width: 60px;
        height: 45px;
      }
      
      .ship-name {
        font-size: 0.9rem;
      }
      
      .fleet-command-header {
        flex-direction: column;
        gap: 0.75rem;
        align-items: flex-start;
      }
      
      .fleet-stats-mini {
        width: 100%;
        justify-content: space-between;
      }
      
      .fleet-summary-bar {
        flex-direction: column;
        gap: 0.75rem;
        align-items: flex-start;
      }
      
      .fleet-summary-left {
        width: 100%;
        justify-content: space-between;
      }
      
      .fleet-view-toggle {
        width: 100%;
        justify-content: flex-end;
      }
    }
    
    @media (max-width: 480px) {
      .ship-card-inner {
        grid-template-columns: 1fr;
      }
      
      .ship-visual {
        height: 80px;
      }
      
      .ship-visual svg {
        width: 70px;
        height: 50px;
      }
    }
    
    /* === SIDEBAR: Streamlined sections === */
    .sidebar-section {
      padding: 0.75rem 1rem !important;
      border-bottom: 1px solid var(--border) !important;
    }
    
    /* =========================================================================
       TELEMETRY COCKPIT SHELL
       Primary viewport with side consoles - bridge command aesthetic
       ========================================================================= */
    
    .telemetry-shell {
      position: relative;
      margin: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(51, 255, 153, 0.08), transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(255, 179, 71, 0.04), transparent 50%),
        var(--bg-deep);
      border: 1px solid var(--border);
      border-radius: 0;
      display: flex;
      flex-direction: column;
    }
    
    .telemetry-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-panel) 100%);
      border-bottom: 2px solid var(--phosphor-dim);
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    
    .telemetry-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .telemetry-title .mono {
      font-family: var(--font-mono);
      font-size: 0.55rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--phosphor-dim);
    }
    
    .telemetry-callout {
      padding: 0.25rem 0.6rem;
      border-radius: 4px;
      border: 1px solid var(--phosphor-dim);
      font-family: var(--font-display);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      color: var(--phosphor);
      background: var(--phosphor-ghost);
    }
    
    .telemetry-meters {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .meter-chip {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.55rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    .meter-chip .label {
      color: var(--text-dim);
    }
    
    .meter-chip .value {
      color: var(--text-bright);
      font-family: var(--font-display);
      font-weight: 500;
    }
    
    .meter-chip .value.positive { color: var(--signal-up); }
    .meter-chip .value.negative { color: var(--signal-down); }
    .meter-chip .value.warn { color: var(--signal-warn); }
    
    .meter-chip .bar {
      width: 60px;
      height: 4px;
      border-radius: 2px;
      background: var(--bg-void);
      overflow: hidden;
    }
    
    .meter-chip .bar .fill {
      height: 100%;
      background: linear-gradient(90deg, var(--phosphor), var(--phosphor-dim));
      transition: width 0.3s ease;
    }
    
    .meter-chip .bar .fill.danger {
      background: linear-gradient(90deg, var(--signal-down), var(--signal-warn));
    }
    
    /* Telemetry body - main viewport + side console */
    .telemetry-body {
      display: grid;
      grid-template-columns: 1fr 200px;
      gap: 0;
      min-height: 400px;
    }
    
    .telemetry-viewport {
      position: relative;
      display: flex;
      flex-direction: column;
      background: 
        radial-gradient(ellipse at 50% 30%, rgba(51, 255, 153, 0.05), transparent 60%),
        var(--bg-panel);
      border-right: 1px solid var(--border);
    }
    
    /* Grid overlay on viewport */
    .telemetry-overlay-grid {
      pointer-events: none;
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(51, 255, 153, 0.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(51, 255, 153, 0.06) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.5;
      z-index: 1;
    }
    
    /* Crosshair at center */
    .telemetry-crosshair {
      pointer-events: none;
      position: absolute;
      inset: 0;
      z-index: 2;
    }
    
    .telemetry-crosshair::before,
    .telemetry-crosshair::after {
      content: '';
      position: absolute;
      background: var(--phosphor);
      opacity: 0.15;
    }
    
    .telemetry-crosshair::before {
      left: 50%;
      top: 0;
      bottom: 0;
      width: 1px;
      transform: translateX(-50%);
    }
    
    .telemetry-crosshair::after {
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      transform: translateY(-50%);
    }
    
    /* =========================================================================
       TELEMETRY SHIP HUD – pixel mech floating over the main viewport
       ========================================================================= */

    .telemetry-ship-hud {
      position: absolute;
      left: 1.5rem;
      top: 1.2rem;
      width: 190px;
      pointer-events: none;
      z-index: 4;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .telemetry-ship-frame {
      position: relative;
      padding: 0.6rem 0.7rem;
      border-radius: 10px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.25);
      background:
        radial-gradient(circle at 0% 0%, rgba(0, 255, 200, 0.18), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(0, 180, 255, 0.16), transparent 60%),
        linear-gradient(145deg, rgba(0, 0, 0, 0.85), rgba(0, 12, 20, 0.96));
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(0, 255, 200, 0.25);
      backdrop-filter: blur(10px);
    }

    .telemetry-ship-frame::before {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.6);
      pointer-events: none;
    }

    .telemetry-ship-svg {
      width: 100%;
      height: 90px;
      display: block;
      filter:
        drop-shadow(0 0 6px rgba(0, 255, 160, 0.7))
        drop-shadow(0 0 18px rgba(0, 255, 210, 0.45));
    }

    /* small grid behind the mech */
    .telemetry-ship-grid {
      position: absolute;
      inset: 0.4rem 0.5rem;
      opacity: 0.22;
      background-image:
        linear-gradient(to right, rgba(0, 255, 190, 0.25) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0, 255, 190, 0.25) 1px, transparent 1px);
      background-size: 9px 9px;
      border-radius: 7px;
    }

    /* text under the sprite */
    .telemetry-ship-label {
      font-family: var(--font-mono), monospace;
      font-size: 0.72rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #e9fff9;
      text-shadow: 0 0 4px rgba(0, 255, 210, 0.7);
    }

    .telemetry-ship-caption {
      font-family: var(--font-mono), monospace;
      font-size: 0.65rem;
      line-height: 1.4;
      color: rgba(190, 255, 240, 0.85);
      max-width: 220px;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
    }

    /* hide HUD on small screens – keeps mobile clean */
    @media (max-width: 960px) {
      .telemetry-ship-hud {
        display: none;
      }
    }
    
    /* Chart wrapper inside viewport */
    .telemetry-chart-area {
      flex: 1;
      position: relative;
      z-index: 3;
      padding: 0.5rem;
    }
    
    .telemetry-chart-area .price-chart-wrapper {
      height: 280px;
      border: none;
      background: transparent;
    }
    
    .telemetry-chart-area .macd-chart-wrapper {
      height: 100px;
      border: none;
      border-top: 1px solid var(--border);
      background: transparent;
    }
    
    /* Side console */
    .telemetry-side-console {
      display: flex;
      flex-direction: column;
      background: var(--bg-card);
      overflow-y: auto;
    }
    
    .console-section {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    
    .console-title {
      font-family: var(--font-mono);
      font-size: 0.5rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--phosphor-dim);
      margin-bottom: 0.5rem;
    }
    
    .console-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.6rem;
      color: var(--text-muted);
      padding: 0.25rem 0;
    }
    
    .console-row span:last-child {
      font-family: var(--font-display);
      color: var(--text-bright);
      font-weight: 500;
    }
    
    .console-row.positive span:last-child { color: var(--signal-up); }
    .console-row.negative span:last-child { color: var(--signal-down); }
    
    /* Bridge feed / log */
    .console-log {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 120px;
    }
    
    .console-log-lines {
      flex: 1;
      font-family: var(--font-mono);
      font-size: 0.5rem;
      line-height: 1.6;
      color: var(--text-dim);
      overflow-y: auto;
      max-height: 150px;
    }
    
    .console-log-lines .log-entry {
      padding: 0.2rem 0;
      border-bottom: 1px solid var(--border);
    }
    
    .console-log-lines .log-entry .timestamp {
      color: var(--phosphor-dim);
      margin-right: 0.5rem;
    }
    
    .console-log-lines .log-entry.alert {
      color: var(--signal-warn);
    }
    
    .console-log-lines .log-entry.positive {
      color: var(--signal-up);
    }
    
    .console-log-lines .log-entry.negative {
      color: var(--signal-down);
    }
    
    /* Telemetry footer strip */
    .telemetry-footer-strip {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background: var(--bg-panel);
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }
    
    .status-chip {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      border: 1px solid var(--border);
      font-family: var(--font-mono);
      font-size: 0.5rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-dim);
    }
    
    .status-chip .dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--text-dim);
    }
    
    .status-chip.status-ok {
      border-color: var(--phosphor-dim);
      color: var(--phosphor);
    }
    
    .status-chip.status-ok .dot {
      background: var(--phosphor);
      box-shadow: 0 0 6px var(--phosphor);
    }
    
    .status-chip.status-warn {
      border-color: var(--signal-warn);
      color: var(--signal-warn);
    }
    
    .status-chip.status-warn .dot {
      background: var(--signal-warn);
      box-shadow: 0 0 6px var(--signal-warn);
    }
    
    /* Ship visualization in console */
    .console-ship-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      margin-top: 0.5rem;
    }
    
    .console-ship-display svg {
      width: 80px;
      height: 50px;
      filter: drop-shadow(0 0 8px var(--phosphor));
    }
    
    .console-ship-display img.console-ship-img {
      width: 80px;
      height: 50px;
      object-fit: contain;
      filter: drop-shadow(0 0 8px var(--phosphor));
    }
    
    .console-ship-label {
      font-size: 0.45rem;
      color: var(--text-dim);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-top: 0.25rem;
    }
    
    /* Mobile responsive */
    @media (max-width: 900px) {
      .telemetry-body {
        grid-template-columns: 1fr;
      }
      
      .telemetry-side-console {
        display: none;
      }
      
      .telemetry-viewport {
        border-right: none;
      }
    }
    
    @media (max-width: 768px) {
      .telemetry-header {
        padding: 0.5rem 0.75rem;
      }
      
      .telemetry-callout {
        font-size: 0.65rem;
      }
      
      .meter-chip {
        font-size: 0.5rem;
      }
      
      .meter-chip .bar {
        width: 40px;
      }
      
      .telemetry-chart-area .price-chart-wrapper {
        height: 220px;
      }
      
      .telemetry-chart-area .macd-chart-wrapper {
        height: 80px;
      }
      
      .telemetry-footer-strip {
        display: none;
      }
    }
    
    .sidebar-title {
      font-size: 0.55rem !important;
      letter-spacing: 0.15em !important;
      margin-bottom: 0.5rem !important;
      color: var(--text-dim) !important;
    }
    
    /* Stats grid - 2x2 compact */
    .stats-grid {
      grid-template-columns: 1fr 1fr !important;
      gap: 0.5rem !important;
    }
    
    .stat-box {
      padding: 0.5rem !important;
    }
    
    .stat-label {
      font-size: 0.5rem !important;
    }
    
    .stat-value {
      font-size: 0.9rem !important;
    }
    
    /* MACD section - more compact */
    .macd-display {
      gap: 0.25rem !important;
    }
    
    .macd-row {
      padding: 0.25rem 0 !important;
    }
    
    .macd-status {
      display: none !important;
    }
    
    /* Trend section - minimal */
    .trend-metrics {
      display: none !important;
    }
    
    .trend-detail {
      font-size: 0.6rem !important;
      margin-top: 0.25rem !important;
    }
    
    /* Watchlist - the star of the sidebar */
    .sidebar-section:has(.watchlist) {
      flex: 1 !important;
      min-height: 0 !important;
      display: flex !important;
      flex-direction: column !important;
      padding-bottom: 0 !important;
    }
    
    .watchlist {
      flex: 1 !important;
    }
    
    .watchlist-item {
      padding: 0.5rem 0.75rem 0.5rem 0.5rem !important;
    }
    
    .watchlist-ticker {
      font-size: 0.75rem !important;
    }
    
    .watchlist-price {
      font-size: 0.75rem !important;
    }
    
    .watchlist-info-btn {
      display: none !important;
    }
    
    /* Kill switch - bottom of sidebar */
    .kill-switch-section {
      padding: 0.5rem 0.75rem !important;
      border-top: 1px solid var(--border) !important;
      margin-top: auto !important;
    }
    
    .kill-switch-btn {
      font-size: 0.55rem !important;
      padding: 0.4rem !important;
    }
    
    .kill-switch-status {
      font-size: 0.5rem !important;
      margin-top: 0.25rem !important;
    }
    
    /* === HEADER: Tighter === */
    .header {
      padding: 0.35rem 0.75rem !important;
      border-bottom: 2px solid var(--border) !important;
    }
    
    .logo {
      font-size: 0.85rem !important;
    }
    
    .logo-sub {
      display: none !important;
    }
    
    .nav-tab {
      padding: 0.3rem 0.6rem !important;
      font-size: 0.55rem !important;
    }
    
    .demo-badge {
      font-size: 0.5rem !important;
      padding: 0.2rem 0.4rem !important;
    }
    
    /* === MAIN CONTENT: Fleet Holobay simplified === */
    .fleet-holobay {
      margin: 0 !important;
      padding: 0 !important;
      border-radius: 0 !important;
      border: none !important;
      border-bottom: 1px solid var(--border) !important;
      background: transparent !important;
      box-shadow: none !important;
    }
    
    .fleet-holo-main {
      display: flex !important;
      align-items: center !important;
      gap: 1.5rem !important;
      padding: 0.75rem 1rem !important;
      background: var(--bg-panel) !important;
    }
    
    .fleet-holo-stage-wrapper {
      flex: 0 0 140px !important;
    }
    
    .fleet-holo-title {
      display: none !important;
    }
    
    .fleet-holo-stage {
      width: 140px !important;
      height: 90px !important;
    }
    
    .fleet-holo-info {
      flex: 1 !important;
      display: flex !important;
      gap: 2rem !important;
      padding: 0 !important;
    }
    
    .fleet-holo-info .info-left,
    .fleet-holo-info .info-right {
      display: flex !important;
      flex-direction: row !important;
      gap: 1.5rem !important;
      align-items: center !important;
    }
    
    .fleet-holo-info .label {
      font-size: 0.5rem !important;
      margin-bottom: 0 !important;
    }
    
    .fleet-holo-info .value {
      font-size: 0.7rem !important;
    }
    
    .fleet-holo-info .stat {
      min-width: auto !important;
    }
    
    .fleet-holo-info .stat-bar {
      width: 60px !important;
      height: 4px !important;
    }
    
    .fleet-holo-info .stat-text {
      font-size: 0.5rem !important;
    }
    
    /* === METRICS GRID: Horizontal bar === */
    .positions-grid {
      display: flex !important;
      gap: 0 !important;
      border-bottom: 1px solid var(--border) !important;
    }
    
    .metric-card {
      flex: 1 !important;
      padding: 0.6rem 1rem !important;
      border-radius: 0 !important;
      border: none !important;
      border-right: 1px solid var(--border) !important;
      background: var(--bg-panel) !important;
    }
    
    .metric-card:last-child {
      border-right: none !important;
    }
    
    .metric-value {
      font-size: 1rem !important;
    }
    
    .metric-label {
      font-size: 0.5rem !important;
      margin-top: 0.15rem !important;
    }
    
    /* === CARD: Cleaner headers === */
    .card {
      border: none !important;
      border-radius: 0 !important;
      background: transparent !important;
    }
    
    .card-header {
      padding: 0.5rem 1rem !important;
      background: var(--bg-panel) !important;
      border-bottom: 1px solid var(--border) !important;
    }
    
    .card-label {
      font-size: 0.5rem !important;
    }
    
    .card-title {
      font-size: 0.7rem !important;
    }
    
    .card-body {
      padding: 0 !important;
    }
    
    /* === DATA TABLE: Terminal style === */
    .table-wrapper {
      padding: 0 !important;
    }
    
    .data-table {
      font-size: 0.7rem !important;
    }
    
    .data-table th {
      background: var(--bg-deep) !important;
      padding: 0.5rem 0.75rem !important;
      font-size: 0.55rem !important;
      letter-spacing: 0.12em !important;
      border-bottom: 2px solid var(--phosphor-dim) !important;
      position: sticky !important;
      top: 0 !important;
      z-index: 10 !important;
    }
    
    .data-table td {
      padding: 0.4rem 0.75rem !important;
      border-bottom: 1px solid var(--border) !important;
    }
    
    .position-row:hover {
      background: var(--phosphor-ghost) !important;
    }
    
    .ticker-badge {
      font-size: 0.6rem !important;
      padding: 0.2rem 0.4rem !important;
    }
    
    /* === CHART: Maximize space === */
    .chart-header {
      padding: 0.5rem 1rem !important;
      border-bottom: 1px solid var(--border) !important;
    }
    
    .chart-container {
      padding: 0.5rem !important;
    }
    
    .ticker-symbol {
      font-size: 1.1rem !important;
    }
    
    .ticker-price {
      font-size: 0.9rem !important;
    }
    
    .period-btn {
      padding: 0.25rem 0.5rem !important;
      font-size: 0.55rem !important;
    }
    
    /* === STATUS STRIP: Simpler === */
    .status-strip {
      height: 22px !important;
      padding: 0 0.75rem !important;
      font-size: 0.5rem !important;
      gap: 0.75rem !important;
      border-top: 1px solid var(--border) !important;
    }
    
    .status-item {
      gap: 0.25rem !important;
    }
    
    /* Hide some status items */
    .status-item:has(.theme-select),
    .status-item:has(#color-hue-slider) {
      display: none !important;
    }
    
    /* === TERMINAL LOG: Prominent bottom bar === */
    .terminal-log {
      position: fixed !important;
      bottom: 22px !important;
      left: 242px !important;
      right: 0 !important;
      height: 60px !important;
      background: rgba(2, 4, 6, 0.96) !important;
      border: none !important;
      border-top: 1px solid var(--border) !important;
      border-radius: 0 !important;
      padding: 0.4rem 0.75rem !important;
      font-size: 0.55rem !important;
      z-index: 100 !important;
      display: block !important;
    }
    
    /* === CONTENT AREA: Account for terminal === */
    .content {
      padding-bottom: 60px !important;
    }
    
    .positions-content {
      padding: 0 !important;
    }
    
    /* === MOBILE: Hide everything extra === */
    @media (max-width: 900px) {
      .terminal-log {
        display: none !important;
      }
      .content {
        padding-bottom: 0 !important;
      }
      .fleet-holobay {
        display: none !important;
      }
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: var(--font-body);
      background: var(--bg-void);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
      overscroll-behavior: none;
    }
    
    /* Prevent body scroll when modals are open */
    body.modal-open {
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }
    
    /* CRT scanlines */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.15) 2px, rgba(0, 0, 0, 0.15) 4px);
      pointer-events: none;
      z-index: 10000;
      animation: crt-flicker 3.5s infinite alternate;
    }
    
    /* Moving scanline + vignette */
    body::after {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(ellipse at 50% 50%, transparent 0%, transparent 60%, rgba(0,0,0,0.4) 100%);
      pointer-events: none;
      z-index: 9999;
    }
    
    .scan-line {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(180deg, transparent, rgba(51, 255, 153, 0.08), transparent);
      animation: scanline 8s linear infinite;
      pointer-events: none;
      z-index: 10001;
    }
    
    .grid-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: linear-gradient(var(--grid-line) 1px, transparent 1px), linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: -1;
    }
    
    /* LOADING SCREEN */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(ellipse at 50% 30%, rgba(10, 20, 25, 1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 100%, rgba(51, 255, 153, 0.03) 0%, transparent 40%),
        var(--bg-void);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20000;
      transition: opacity 0.8s ease, visibility 0.8s ease;
      overflow: hidden;
    }
    
    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    /* INVADER ARMY BACKDROP */
    .invader-army {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
      opacity: 0.45;
    }

    .invader-row {
      position: absolute;
      display: flex;
      gap: 18px;
      left: 50%;
      transform: translateX(-50%);
    }

    .invader-row .invader-sprite-small {
      width: 28px;
      height: 20px;
      fill: var(--phosphor);
      image-rendering: pixelated;
      shape-rendering: crispEdges;
      filter:
        drop-shadow(0 0 6px var(--accent-glow))
        drop-shadow(0 0 12px hsla(var(--accent-hue), 100%, 60%, 0.4));
    }

    @keyframes invader-army-march {
      0%   { transform: translateX(-50%) translateX(-10vw); }
      50%  { transform: translateX(-50%) translateX(10vw); }
      100% { transform: translateX(-50%) translateX(-10vw); }
    }

    @keyframes invader-drop {
      0%   { transform: translateY(0); }
      20%  { transform: translateY(20px); }
      40%  { transform: translateY(40px); }
      60%  { transform: translateY(60px); }
      80%  { transform: translateY(80px); }
      100% { transform: translateY(100px); }
    }

    .loading-screen.hidden .invader-army {
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    
    .loading-inner {
      position: relative;
      z-index: 1;
    }
    
    .stars {
      position: absolute;
      inset: 0;
      background:
        /* Distant nebula glow */
        radial-gradient(ellipse at 30% 20%, rgba(51, 255, 153, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(255, 179, 71, 0.05) 0%, transparent 40%),
        /* Star layers - varying sizes and colors */
        radial-gradient(1px 1px at 5% 8%, rgba(255, 255, 255, 0.9), transparent),
        radial-gradient(1px 1px at 12% 25%, rgba(51, 255, 153, 0.8), transparent),
        radial-gradient(1.5px 1.5px at 18% 12%, rgba(255, 255, 255, 0.95), transparent),
        radial-gradient(1px 1px at 25% 45%, rgba(255, 255, 255, 0.7), transparent),
        radial-gradient(1px 1px at 32% 18%, rgba(255, 179, 71, 0.6), transparent),
        radial-gradient(1px 1px at 40% 65%, rgba(51, 255, 153, 0.7), transparent),
        radial-gradient(1.5px 1.5px at 48% 35%, rgba(255, 255, 255, 0.85), transparent),
        radial-gradient(1px 1px at 55% 8%, rgba(255, 255, 255, 0.6), transparent),
        radial-gradient(1px 1px at 62% 52%, rgba(51, 255, 153, 0.5), transparent),
        radial-gradient(1px 1px at 70% 22%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1px 1px at 78% 68%, rgba(255, 179, 71, 0.5), transparent),
        radial-gradient(1.5px 1.5px at 85% 15%, rgba(255, 255, 255, 0.9), transparent),
        radial-gradient(1px 1px at 92% 42%, rgba(51, 255, 153, 0.6), transparent),
        radial-gradient(1px 1px at 8% 72%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 22% 88%, rgba(255, 179, 71, 0.4), transparent),
        radial-gradient(1px 1px at 45% 78%, rgba(255, 255, 255, 0.6), transparent),
        radial-gradient(1px 1px at 68% 92%, rgba(51, 255, 153, 0.5), transparent),
        radial-gradient(1px 1px at 88% 85%, rgba(255, 255, 255, 0.4), transparent),
        radial-gradient(1px 1px at 95% 5%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 3% 55%, rgba(51, 255, 153, 0.4), transparent);
      animation: star-drift 20s ease-in-out infinite alternate;
    }
    
    @keyframes star-drift {
      0% { transform: translate3d(0, 0, 0); opacity: 0.85; }
      50% { transform: translate3d(-2px, -1px, 0); opacity: 1; }
      100% { transform: translate3d(1px, 2px, 0); opacity: 0.8; }
    }
    
    .horizon {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 250px;
      background: 
        linear-gradient(to top, 
          rgba(5, 6, 8, 1) 0%,
          rgba(5, 6, 8, 0.95) 20%,
          rgba(51, 255, 153, 0.08) 60%,
          transparent 100%
        );
      pointer-events: none;
    }
    
    /* Subtle ground reflection */
    .horizon::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 3px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(51, 255, 153, 0.3) 30%,
        rgba(51, 255, 153, 0.5) 50%,
        rgba(51, 255, 153, 0.3) 70%,
        transparent 100%
      );
      filter: blur(2px);
    }
    
    .launch-scene {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
    }
    
    /* =========================================================================
       8-BIT PIXEL INVADER — Retro Arcade Aesthetic
       ========================================================================= */
    
    /* Step-based arcade animations */
    @keyframes invader-bob { 
      0%, 100% { transform: translateY(0); } 
      50% { transform: translateY(-8px); } 
    }
    
    @keyframes invader-march {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(12px); }
    }
    
    @keyframes crt-pixel-flicker { 
      0%, 90%, 100% { opacity: 1; } 
      92% { opacity: 0.85; } 
      94% { opacity: 1; }
      96% { opacity: 0.9; }
    }
    
    @keyframes invader-glow {
      0%, 100% { 
        filter: drop-shadow(0 0 8px var(--phosphor)) drop-shadow(0 0 20px rgba(51, 255, 153, 0.4)); 
      }
      50% { 
        filter: drop-shadow(0 0 12px var(--phosphor)) drop-shadow(0 0 30px rgba(51, 255, 153, 0.6)); 
      }
    }
    
    @keyframes march-row {
      0% { transform: translateX(0); }
      50% { transform: translateX(20px); }
      100% { transform: translateX(0); }
    }
    
    @keyframes pixel-beam-pulse {
      0%, 100% { opacity: 0.3; height: 80px; }
      50% { opacity: 0.6; height: 100px; }
    }
    
    /* Main invader container */
    .pixel-invader-scene {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 40px;
    }
    
    /* Background marching invaders row */
    .invader-fleet {
      position: absolute;
      top: -60px;
      display: flex;
      gap: 40px;
      opacity: 0.15;
      animation: march-row 2s steps(2) infinite;
    }
    
    .fleet-invader {
      width: 24px;
      height: 18px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    /* Ship Formation - Wedge (4-3-2-1) */
    .ship-formation {
      position: relative;
      width: 320px;
      height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 2;
    }
    
    .formation-row {
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    
    .formation-ship {
      width: 48px;
      height: 48px;
      object-fit: contain;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 12px var(--phosphor));
      opacity: 0;
      transform: translateY(-40px) scale(0.5);
      animation: ship-form-up 0.6s ease-out forwards;
    }
    
    .formation-ship:nth-child(1) { animation-delay: 0.1s; }
    .formation-ship:nth-child(2) { animation-delay: 0.15s; }
    .formation-ship:nth-child(3) { animation-delay: 0.2s; }
    .formation-ship:nth-child(4) { animation-delay: 0.25s; }
    
    .formation-row:nth-child(1) .formation-ship { animation-delay: 0.4s; }
    .formation-row:nth-child(2) .formation-ship:nth-child(1) { animation-delay: 0.3s; }
    .formation-row:nth-child(2) .formation-ship:nth-child(2) { animation-delay: 0.35s; }
    .formation-row:nth-child(2) .formation-ship:nth-child(3) { animation-delay: 0.4s; }
    .formation-row:nth-child(3) .formation-ship:nth-child(1) { animation-delay: 0.2s; }
    .formation-row:nth-child(3) .formation-ship:nth-child(2) { animation-delay: 0.25s; }
    .formation-row:nth-child(4) .formation-ship { animation-delay: 0.1s; }
    
    @keyframes ship-form-up {
      0% {
        opacity: 0;
        transform: translateY(-40px) scale(0.5);
      }
      60% {
        opacity: 1;
        transform: translateY(5px) scale(1.05);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    /* Subtle hover animation after form-up */
    .formation-ship.formed {
      animation: ship-hover 2.5s ease-in-out infinite;
    }
    
    @keyframes ship-hover {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    
    /* Leader ship (RKLB) gets extra glow */
    .formation-row:last-child .formation-ship {
      width: 56px;
      height: 56px;
      filter: drop-shadow(0 0 16px var(--phosphor)) drop-shadow(0 0 24px rgba(51, 255, 153, 0.5));
    }
    
    /* Mobile responsive for ship formation */
    @media (max-width: 480px) {
      .ship-formation {
        width: 280px;
        height: 170px;
        gap: 6px;
      }
      
      .formation-row {
        gap: 8px;
      }
      
      .formation-ship {
        width: 38px;
        height: 38px;
      }
      
      .formation-row:last-child .formation-ship {
        width: 46px;
        height: 46px;
      }
    }
    
    @media (max-width: 360px) {
      .ship-formation {
        width: 240px;
        height: 150px;
      }
      
      .formation-ship {
        width: 32px;
        height: 32px;
      }
      
      .formation-row:last-child .formation-ship {
        width: 40px;
        height: 40px;
      }
    }
    
    /* Keep legacy pixel-invader for fallback */
    .pixel-invader {
      display: none; /* Hidden - replaced by ship formation */
      width: 96px;
      height: 72px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      animation: 
        invader-bob 1.2s steps(2) infinite,
        crt-pixel-flicker 4s linear infinite,
        invader-glow 2s ease-in-out infinite;
      position: relative;
      z-index: 2;
    }
    
    /* Pixel beam beneath invader */
    .pixel-beam {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 80px;
      background: linear-gradient(180deg, 
        var(--phosphor) 0%, 
        rgba(51, 255, 153, 0.6) 30%,
        rgba(51, 255, 153, 0.2) 70%,
        transparent 100%
      );
      opacity: 0;
      transition: opacity 0.5s ease;
      animation: pixel-beam-pulse 1.5s steps(3) infinite;
    }
    
    .pixel-beam.active {
      opacity: 1;
    }
    
    /* Pixel scan line effect */
    .pixel-beam::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(180deg,
        transparent 0px,
        transparent 4px,
        rgba(0, 0, 0, 0.3) 4px,
        rgba(0, 0, 0, 0.3) 8px
      );
    }
    
    /* Ground reflection */
    .pixel-ground {
      width: 120px;
      height: 4px;
      margin-top: 100px;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(51, 255, 153, 0.3) 30%,
        var(--phosphor-dim) 50%,
        rgba(51, 255, 153, 0.3) 70%,
        transparent 100%
      );
      opacity: 0;
      transition: opacity 0.5s ease;
      filter: blur(2px);
    }
    
    .pixel-ground.active {
      opacity: 1;
    }
    
    /* Legacy support - hidden but keeps JS from breaking */
    .mothership {
      display: none;
      position: relative;
      width: 320px;
      height: 160px;
      margin-bottom: 40px;
      animation: ufo-hover 5s ease-in-out infinite;
      filter: drop-shadow(0 40px 60px rgba(0,0,0,0.9));
    }
    
    .loading-content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 60px;
    }
    
    .loading-brand {
      font-family: var(--font-display);
      font-size: 2.5rem;
      font-weight: 600;
      letter-spacing: 0.3em;
      color: var(--phosphor);
      text-shadow: 
        0 0 30px var(--phosphor-glow), 
        0 0 60px rgba(51, 255, 153, 0.3),
        0 0 100px rgba(51, 255, 153, 0.15);
      margin-bottom: 0.5rem;
      animation: brand-glow 3s ease-in-out infinite;
    }
    
    @keyframes brand-glow {
      0%, 100% { opacity: 0.9; text-shadow: 0 0 30px var(--phosphor-glow), 0 0 60px rgba(51, 255, 153, 0.3); }
      50% { opacity: 1; text-shadow: 0 0 40px var(--phosphor-glow), 0 0 80px rgba(51, 255, 153, 0.4), 0 0 120px rgba(51, 255, 153, 0.2); }
    }
    
    .loading-sub {
      font-size: 0.75rem;
      letter-spacing: 0.4em;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 2.5rem;
      opacity: 0.8;
    }
    
    .countdown {
      font-family: var(--font-display);
      font-size: 4rem;
      font-weight: 700;
      color: var(--amber);
      text-shadow: 
        0 0 30px var(--amber-glow), 
        0 0 60px rgba(255, 179, 71, 0.5),
        0 0 100px rgba(255, 179, 71, 0.25);
      margin-bottom: 1.5rem;
      min-width: 80px;
      text-align: center;
    }
    
    .countdown.go {
      color: var(--phosphor);
      text-shadow: 
        0 0 40px var(--phosphor-glow),
        0 0 80px rgba(51, 255, 153, 0.6);
      animation: countdown-flash 0.4s ease-out 3;
    }
    
    @keyframes countdown-flash {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.15); opacity: 1; }
      100% { transform: scale(1); opacity: 0.9; }
    }
    
    .loading-status {
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      color: var(--text-muted);
      text-transform: uppercase;
      position: relative;
      padding-left: 1rem;
    }
    
    /* Terminal cursor effect */
    .loading-status::before {
      content: '▸';
      position: absolute;
      left: 0;
      color: var(--phosphor);
      animation: cursor-blink 1s step-end infinite;
    }
    
    @keyframes cursor-blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* APP CONTAINER */
    .app {
      display: none;
    }
    
    .app.visible {
      display: block;
    }
    
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      height: 56px;
      background: 
        radial-gradient(ellipse at 0% 0%, rgba(51, 255, 153, 0.15), transparent 50%),
        linear-gradient(180deg, var(--bg-panel) 0%, var(--bg-deep) 100%);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 0 30px rgba(51, 255, 153, 0.05);
      flex-shrink: 0;
    }
    
    .header::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--phosphor-dim), transparent);
    }
    
    .header-left { display: flex; align-items: center; gap: 2rem; }
    .logo { display: flex; align-items: center; gap: 0.75rem; }
    .logo-mark { width: 32px; height: 32px; }
    .logo-mark svg { width: 100%; height: 100%; }
    .logo-text { font-family: var(--font-display); font-size: 0.8rem; font-weight: 600; letter-spacing: 0.2em; color: var(--phosphor); text-shadow: 0 0 20px var(--phosphor-glow); }
    .logo-sub { font-size: 0.5rem; color: var(--text-muted); letter-spacing: 0.15em; margin-top: 2px; font-family: var(--font-body); }
    
    .nav-tabs { display: flex; gap: 0.5rem; }
    .nav-tab {
      padding: 0.6rem 1.1rem;
      background: linear-gradient(to bottom, rgba(51, 255, 153, 0.06), transparent);
      border: 1px solid var(--border);
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 0.7rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .nav-tab:hover { color: var(--text); background: linear-gradient(to bottom, rgba(51, 255, 153, 0.1), transparent); }
    .nav-tab.active { 
      color: var(--phosphor); 
      background: linear-gradient(to bottom, rgba(51, 255, 153, 0.15), var(--phosphor-ghost)); 
      border-color: var(--phosphor-dim);
      text-shadow: 0 0 10px var(--phosphor-glow);
      box-shadow: inset 0 2px 0 var(--phosphor), 0 0 20px rgba(51, 255, 153, 0.15);
    }
    .nav-tab.active::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: var(--bg-deep); }
    
    .header-right { display: flex; align-items: center; gap: 1.5rem; }
    .status-indicator { display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--amber); box-shadow: 0 0 10px var(--amber-glow); animation: pulse-glow 2s ease-in-out infinite; }
    .status-dot.live { background: var(--phosphor); box-shadow: 0 0 10px var(--phosphor-glow); }
    .status-text { font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-muted); }
    .demo-badge { padding: 0.3rem 0.6rem; background: var(--amber); font-size: 0.6rem; font-weight: 600; letter-spacing: 0.15em; color: var(--bg-void); text-transform: uppercase; }
    .time-display { font-size: 0.8rem; color: var(--phosphor); letter-spacing: 0.05em; text-shadow: 0 0 10px var(--phosphor-glow); }
    .time-display .blink { animation: blink 1s step-end infinite; }
    
    .main { display: flex; height: calc(100vh - 56px - 28px); height: calc(100dvh - 56px - 28px); }
    
    .sidebar { width: 280px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
    .sidebar-section { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); }
    .sidebar-title { display: flex; align-items: center; gap: 0.5rem; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-dim); margin-bottom: 0.85rem; }
    .sidebar-title::before { content: '//'; color: var(--phosphor-dim); }
    
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
    .stat-box { 
      padding: 0.75rem; 
      background: 
        radial-gradient(ellipse at 50% -20%, rgba(51, 255, 153, 0.08), transparent 70%),
        var(--bg-card); 
      border: 1px solid var(--border); 
      position: relative; 
      overflow: hidden;
      cursor: help;
    }
    .stat-box::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--phosphor-dim); opacity: 0.5; }
    .stat-box.highlight::before { background: var(--amber); }
    .stat-label { font-size: 0.55rem; color: var(--text-dim); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.35rem; }
    .stat-value { font-size: 1rem; font-weight: 600; color: var(--text-bright); }
    .stat-value.positive { color: var(--signal-up); text-shadow: 0 0 15px var(--phosphor-glow); }
    .stat-value.negative { color: var(--signal-down); }
    
    /* Portfolio Mood Indicator */
    .portfolio-mood {
      margin-top: 0.6rem;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 2px solid var(--phosphor-dim);
      font-size: 0.58rem;
      line-height: 1.4;
    }
    .portfolio-mood.boost { border-left-color: var(--signal-up); }
    .portfolio-mood.climb { border-left-color: var(--phosphor-dim); }
    .portfolio-mood.turbulence { border-left-color: var(--amber); }
    .portfolio-mood.rattle { border-left-color: var(--signal-down); }
    .mood-label {
      display: block;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text);
      margin-bottom: 0.15rem;
    }
    .portfolio-mood.boost .mood-label { color: var(--signal-up); }
    .portfolio-mood.turbulence .mood-label { color: var(--amber); }
    .portfolio-mood.rattle .mood-label { color: var(--signal-down); }
    .mood-copy {
      color: var(--text-muted);
      font-style: italic;
    }
    
    .macd-display { display: flex; flex-direction: column; gap: 0.6rem; }
    .macd-row { display: flex; justify-content: space-between; align-items: center; padding: 0.4rem 0; border-bottom: 1px solid var(--border); }
    .macd-row:last-child { border-bottom: none; }
    .macd-label { font-size: 0.7rem; color: var(--text-muted); letter-spacing: 0.05em; }
    .macd-value { font-size: 0.8rem; font-weight: 500; }
    .macd-value.positive { color: var(--signal-up); }
    .macd-value.negative { color: var(--signal-down); }
    
    /* MACD Status Line */
    .macd-status {
      margin-top: 0.5rem;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 2px solid var(--text-dim);
      font-size: 0.6rem;
      line-height: 1.4;
    }
    .macd-status.bullish { border-left-color: var(--signal-up); }
    .macd-status.bearish { border-left-color: var(--signal-down); }
    .macd-status-label {
      display: block;
      color: var(--text);
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 0.15rem;
    }
    .macd-status.bullish .macd-status-label { color: var(--signal-up); }
    .macd-status.bearish .macd-status-label { color: var(--signal-down); }
    .macd-status-copy {
      color: var(--text-muted);
      font-style: italic;
    }
    
    /* Trend Status Styles */
    .trend-display { display: flex; flex-direction: column; gap: 0.75rem; }
    .trend-status-badge { display: flex; align-items: center; gap: 0.5rem; padding: 0.6rem 0.8rem; background: var(--bg-card); border: 1px solid var(--border); transition: all 0.3s; cursor: help; }
    .trend-status-badge.trend-bull { border-color: rgba(51, 255, 153, 0.5); background: rgba(51, 255, 153, 0.08); }
    .trend-status-badge.trend-bear { border-color: rgba(255, 107, 107, 0.5); background: rgba(255, 107, 107, 0.08); }
    .trend-status-badge.trend-neutral { border-color: rgba(255, 179, 71, 0.5); background: rgba(255, 179, 71, 0.08); }
    .trend-status-badge.trend-volatile { border-color: rgba(179, 136, 255, 0.5); background: rgba(179, 136, 255, 0.08); }
    .trend-icon { font-size: 1rem; transition: color 0.3s; }
    .trend-status-badge.trend-bull .trend-icon { color: var(--signal-up); text-shadow: 0 0 10px var(--signal-up); }
    .trend-status-badge.trend-bear .trend-icon { color: var(--signal-down); text-shadow: 0 0 10px var(--signal-down); }
    .trend-status-badge.trend-neutral .trend-icon { color: var(--amber); text-shadow: 0 0 10px var(--amber); }
    .trend-status-badge.trend-volatile .trend-icon { color: #b388ff; text-shadow: 0 0 10px #b388ff; }
    .trend-label { font-size: 0.7rem; font-weight: 600; letter-spacing: 0.1em; color: var(--text-bright); }
    .trend-detail { font-size: 0.65rem; color: var(--text-muted); line-height: 1.4; padding: 0 0.2rem; }
    .trend-subtitle { color: var(--text); font-weight: 500; display: block; margin-bottom: 0.2rem; }
    .trend-metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.25rem; }
    .trend-metric { display: flex; flex-direction: column; align-items: center; padding: 0.4rem; background: var(--bg-card); border: 1px solid var(--border); }
    .trend-metric-label { font-size: 0.5rem; letter-spacing: 0.08em; color: var(--text-dim); text-transform: uppercase; }
    .trend-metric-value { font-size: 0.7rem; font-weight: 600; color: var(--text); margin-top: 0.15rem; }
    
    /* Volume Badge Styles */
    .volume-badge { padding: 0.2rem 0.5rem; border-radius: 2px; font-size: 0.6rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; border: 1px solid var(--border); color: var(--text-muted); background: var(--bg-card); transition: all 0.3s; margin-left: 0.75rem; }
    .volume-badge.vol-high { border-color: rgba(255, 107, 107, 0.7); color: var(--signal-down); background: rgba(255, 107, 107, 0.12); animation: pulse 2s infinite; }
    .volume-badge.vol-elevated { border-color: rgba(255, 179, 71, 0.7); color: var(--amber); background: rgba(255, 179, 71, 0.1); }
    .volume-badge.vol-normal { border-color: rgba(51, 255, 153, 0.4); color: var(--phosphor-dim); }
    .volume-badge.vol-quiet { border-color: var(--border); color: var(--text-dim); opacity: 0.7; }
    
    /* P&L Simulation Styles */
    .simulation-section { background: linear-gradient(135deg, rgba(255, 179, 71, 0.03) 0%, transparent 50%); }
    .sim-form { display: flex; flex-direction: column; gap: 0.75rem; }
    .sim-field { display: flex; flex-direction: column; gap: 0.25rem; }
    .sim-label { font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); }
    .sim-input { width: 100%; padding: 0.5rem 0.6rem; background: var(--bg-input); border: 1px solid var(--border); color: var(--text); font-family: var(--font-body); font-size: 0.75rem; transition: all 0.15s; }
    .sim-input:focus { outline: none; border-color: var(--amber-dim); box-shadow: 0 0 10px rgba(255, 179, 71, 0.15); }
    .sim-btn { width: 100%; padding: 0.6rem; margin-top: 0.25rem; background: var(--bg-card); border: 1px solid var(--amber-dim); color: var(--amber); font-family: var(--font-body); font-size: 0.65rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
    .sim-btn:hover { background: rgba(255, 179, 71, 0.1); border-color: var(--amber); box-shadow: 0 0 15px rgba(255, 179, 71, 0.2); }
    .sim-btn-icon { font-size: 0.5rem; }
    .sim-result { padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); text-align: center; transition: all 0.3s; }
    .sim-result.positive { border-color: rgba(51, 255, 153, 0.5); background: rgba(51, 255, 153, 0.08); }
    .sim-result.negative { border-color: rgba(255, 107, 107, 0.5); background: rgba(255, 107, 107, 0.08); }
    .sim-result-label { font-size: 0.55rem; letter-spacing: 0.08em; color: var(--text-dim); text-transform: uppercase; }
    .sim-result-value { font-family: var(--font-display); font-size: 1.1rem; font-weight: 600; margin-top: 0.25rem; letter-spacing: 0.05em; }
    .sim-result-value.positive { color: var(--signal-up); text-shadow: 0 0 15px var(--phosphor-glow); }
    .sim-result-value.negative { color: var(--signal-down); }
    .sim-result-pct { font-size: 0.7rem; color: var(--text-muted); margin-top: 0.15rem; }
    .sim-result-meta { font-size: 0.55rem; color: var(--text-dim); margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border); }
    
    .watchlist { flex: 1; overflow-y: auto; }
    .watchlist::-webkit-scrollbar { width: 4px; }
    .watchlist::-webkit-scrollbar-track { background: var(--bg-deep); }
    .watchlist::-webkit-scrollbar-thumb { background: var(--border-glow); }
    
    .watchlist-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1.25rem; cursor: pointer; border-bottom: 1px solid var(--border); transition: all 0.15s; position: relative; }
    .watchlist-item::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: transparent; transition: background 0.15s; }
    .watchlist-item:hover { background: var(--phosphor-ghost); }
    .watchlist-item:hover::before { background: var(--phosphor-dim); }
    .watchlist-item.active { background: var(--phosphor-ghost); }
    .watchlist-item.active::before { background: var(--phosphor); box-shadow: 0 0 10px var(--phosphor-glow); }
    .watchlist-info { display: flex; flex-direction: column; gap: 0.2rem; }
    .watchlist-ticker { font-size: 0.85rem; font-weight: 600; color: var(--text-bright); letter-spacing: 0.05em; }
    .watchlist-meta { font-size: 0.6rem; color: var(--text-dim); letter-spacing: 0.08em; text-transform: uppercase; }
    .watchlist-data { text-align: right; }
    .watchlist-price { font-size: 0.85rem; color: var(--text); }
    .watchlist-change { font-size: 0.7rem; margin-top: 0.15rem; }
    .watchlist-change.positive { color: var(--signal-up); }
    .watchlist-change.negative { color: var(--signal-down); }
    .watchlist-info-btn { 
      position: absolute;
      left: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      padding: 0;
      border: none;
      background: transparent;
      color: var(--text-dim);
      font-size: 0.6rem;
      cursor: pointer;
      opacity: 0;
      transition: all 0.15s;
      z-index: 5;
    }
    .watchlist-item:hover .watchlist-info-btn { opacity: 0.6; }
    .watchlist-info-btn:hover { opacity: 1 !important; color: var(--phosphor); transform: translateY(-50%) scale(1.2); }
    .watchlist-item { padding-left: 1.75rem; }
    
    .content { flex: 1; display: flex; flex-direction: column; min-width: 0; overflow: hidden; overflow-y: auto; -webkit-overflow-scrolling: touch; background: var(--bg-deep); }
    .tab-panel { display: none; flex: 1; flex-direction: column; overflow: hidden; overflow-y: auto; }
    .tab-panel.active { display: flex; }
    
    .chart-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1.25rem; background: var(--bg-panel); border-bottom: 1px solid var(--border); flex-wrap: wrap; gap: 0.75rem; }
    .chart-header-left { display: flex; align-items: center; gap: 1.5rem; }
    .ticker-display { display: flex; align-items: baseline; gap: 1rem; }
    .ticker-symbol { font-family: var(--font-display); font-size: 1.3rem; font-weight: 600; color: var(--phosphor); letter-spacing: 0.1em; text-shadow: 0 0 20px var(--phosphor-glow); }
    .ticker-price { font-size: 1.1rem; color: var(--text-bright); }
    .ticker-change { font-size: 0.85rem; }
    .ticker-change.positive { color: var(--signal-up); }
    .ticker-change.negative { color: var(--signal-down); }
    
    .control-group { display: flex; gap: 0.25rem; }
    .ctrl-btn { padding: 0.45rem 0.7rem; background: transparent; border: 1px solid var(--border); color: var(--text-muted); font-family: var(--font-body); font-size: 0.65rem; letter-spacing: 0.08em; cursor: pointer; transition: all 0.15s; }
    .ctrl-btn:hover { color: var(--text); border-color: var(--border-glow); background: var(--phosphor-ghost); }
    .ctrl-btn.active { color: var(--phosphor); border-color: var(--phosphor-dim); background: var(--phosphor-ghost); }
    .chart-tools { display: flex; gap: 1rem; align-items: center; }
    .tool-divider { width: 1px; height: 20px; background: var(--border); }
    
    .chart-container { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      padding: 1rem; 
      min-height: 0; 
      position: relative;
    }
    .chart-container::before {
      content: '';
      position: absolute;
      inset: 1rem;
      pointer-events: none;
      background:
        radial-gradient(circle at center, transparent 0%, transparent 20%, rgba(51, 255, 153, 0.02) 20.5%, transparent 21%),
        radial-gradient(circle at center, transparent 0%, transparent 40%, rgba(51, 255, 153, 0.02) 40.5%, transparent 41%),
        radial-gradient(circle at center, transparent 0%, transparent 60%, rgba(51, 255, 153, 0.02) 60.5%, transparent 61%),
        radial-gradient(circle at center, transparent 0%, transparent 80%, rgba(51, 255, 153, 0.015) 80.5%, transparent 81%);
      opacity: 0.6;
      z-index: 1;
    }
    .chart-container::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 150%;
      height: 4px;
      background: linear-gradient(90deg, transparent 0%, rgba(51, 255, 153, 0.08) 30%, rgba(255, 179, 71, 0.12) 50%, rgba(51, 255, 153, 0.08) 70%, transparent 100%);
      transform-origin: left center;
      transform: translateX(-33%) translateY(-50%);
      animation: radar-sweep 12s linear infinite;
      pointer-events: none;
      z-index: 2;
      mix-blend-mode: screen;
    }
    .price-chart-wrapper { flex: 3; position: relative; min-height: 200px; background: radial-gradient(ellipse at 50% 50%, rgba(51, 255, 153, 0.04), transparent 70%) var(--bg-panel); border: 1px solid var(--border); padding: 0.5rem; z-index: 3; }
    .macd-chart-wrapper { flex: 1; position: relative; min-height: 100px; background: var(--bg-panel); border: 1px solid var(--border); border-top: none; padding: 0.5rem; z-index: 3; }
    
    .positions-content { flex: 1; overflow-y: auto; padding: 1.25rem; }
    .positions-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .metric-card { 
      background: 
        radial-gradient(ellipse at 50% -30%, rgba(51, 255, 153, 0.1), transparent 70%),
        var(--bg-panel); 
      border: 1px solid var(--border); 
      padding: 1.25rem; 
      position: relative; 
    }
    .metric-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--phosphor), transparent); }
    .metric-value { font-family: var(--font-display); font-size: 1.4rem; font-weight: 600; color: var(--text-bright); margin-bottom: 0.35rem; letter-spacing: 0.05em; }
    .metric-value.positive { color: var(--signal-up); text-shadow: 0 0 20px var(--phosphor-glow); }
    .metric-label { font-size: 0.6rem; color: var(--text-dim); letter-spacing: 0.12em; text-transform: uppercase; }
    
    .card { 
      background: 
        radial-gradient(ellipse at 50% -20%, rgba(51, 255, 153, 0.06), transparent 60%),
        var(--bg-panel); 
      border: 1px solid var(--border); 
      margin-bottom: 1.25rem; 
      box-shadow: 0 0 30px rgba(0,0,0,0.3);
    }
    .card-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); background: var(--bg-card); }
    .card-label { font-size: 0.55rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--phosphor-dim); margin-bottom: 0.25rem; }
    .card-title { font-family: var(--font-display); font-size: 0.9rem; font-weight: 500; color: var(--text-bright); letter-spacing: 0.1em; text-shadow: 0 0 15px rgba(51, 255, 153, 0.2); }
    .card-body { padding: 1.25rem; }
    
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 0.75rem 1rem; font-size: 0.6rem; font-weight: 500; letter-spacing: 0.12em; text-transform: uppercase; color: var(--text-dim); border-bottom: 1px solid var(--border); background: var(--bg-card); }
    .data-table td { padding: 0.85rem 1rem; font-size: 0.8rem; border-bottom: 1px solid var(--border); color: var(--text); }
    .data-table tr:hover { background: var(--phosphor-ghost); }
    
    .ticker-tag { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.3rem 0.6rem; background: var(--bg-input); border: 1px solid var(--border); font-size: 0.75rem; font-weight: 600; color: var(--text-bright); letter-spacing: 0.05em; }
    .ticker-dot { width: 6px; height: 6px; border-radius: 50%; }
    .dossier-btn {
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-size: 0.6rem;
      cursor: pointer;
      padding: 0;
      margin-right: 0.25rem;
      opacity: 0.4;
      transition: all 0.15s;
    }
    .ticker-tag:hover .dossier-btn,
    .position-row:hover .dossier-btn { opacity: 0.8; }
    .dossier-btn:hover { opacity: 1 !important; color: var(--phosphor); transform: scale(1.3); }
    .structure-tag { display: inline-block; padding: 0.25rem 0.5rem; background: var(--bg-input); border: 1px solid var(--border); font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); }
    .pnl-positive { color: var(--signal-up); }
    .pnl-negative { color: var(--signal-down); }
    
    .chart-tabs { display: flex; gap: 0.25rem; margin-bottom: 1.25rem; }
    .chart-tab { padding: 0.5rem 0.85rem; background: transparent; border: 1px solid var(--border); color: var(--text-muted); font-family: var(--font-body); font-size: 0.65rem; letter-spacing: 0.08em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; }
    .chart-tab:hover, .chart-tab.active { color: var(--phosphor); border-color: var(--phosphor-dim); background: var(--phosphor-ghost); box-shadow: 0 4px 15px rgba(51, 255, 153, 0.1); }
    .chart-panel { display: none; }
    .chart-panel.active { display: block; }
    
    .bar-chart { display: flex; flex-direction: column; gap: 0.6rem; }
    .bar-row { display: grid; grid-template-columns: 55px 1fr 70px; align-items: center; gap: 1rem; }
    .bar-ticker { font-size: 0.75rem; font-weight: 600; color: var(--text); letter-spacing: 0.05em; }
    .bar-container { height: 24px; background: var(--bg-input); border: 1px solid var(--border); overflow: hidden; }
    .bar-fill { height: 100%; display: flex; align-items: center; padding-left: 0.6rem; font-size: 0.6rem; font-weight: 600; color: var(--bg-void); background: var(--phosphor); }
    .bar-value { font-size: 0.75rem; text-align: right; color: var(--text); }
    
    .pnl-row { display: grid; grid-template-columns: 55px 1fr 80px; align-items: center; gap: 1rem; margin-bottom: 0.6rem; }
    .pnl-bar-container { height: 22px; display: flex; align-items: center; position: relative; background: var(--bg-input); border: 1px solid var(--border); }
    .pnl-center-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 1px; background: var(--border-glow); }
    .pnl-bar { position: absolute; height: calc(100% - 4px); top: 2px; display: flex; align-items: center; font-size: 0.55rem; font-weight: 600; padding: 0 0.4rem; min-width: fit-content; }
    .pnl-bar.positive { left: 50%; background: var(--signal-up); color: var(--bg-void); }
    .pnl-bar.negative { right: 50%; background: var(--signal-down); color: #fff; justify-content: flex-end; }
    .pnl-amount { font-size: 0.75rem; text-align: right; }
    .pnl-amount.positive { color: var(--signal-up); }
    .pnl-amount.negative { color: var(--signal-down); }
    
    .summary-row { display: flex; justify-content: space-around; padding: 1rem; background: var(--bg-card); border: 1px solid var(--border); margin-top: 1.25rem; }
    .summary-item { text-align: center; }
    .summary-value { font-family: var(--font-display); font-size: 1rem; font-weight: 600; color: var(--text-bright); letter-spacing: 0.05em; }
    .summary-value.positive { color: var(--signal-up); }
    .summary-value.negative { color: var(--signal-down); }
    .summary-label { font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); margin-top: 0.25rem; }
    
    .catalyst-list { display: flex; flex-direction: column; gap: 0.5rem; }
    .catalyst-item { display: flex; align-items: center; gap: 1.25rem; padding: 1rem 1.25rem; background: var(--bg-card); border: 1px solid var(--border); transition: all 0.15s; }
    .catalyst-item:hover { border-color: var(--phosphor-dim); background: var(--phosphor-ghost); }
    .catalyst-date { font-size: 0.75rem; color: var(--text-muted); min-width: 85px; letter-spacing: 0.02em; }
    .catalyst-ticker { font-size: 0.8rem; font-weight: 600; min-width: 55px; letter-spacing: 0.05em; }
    .catalyst-event { flex: 1; font-size: 0.8rem; color: var(--text); }
    .catalyst-impact { padding: 0.3rem 0.6rem; font-size: 0.6rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; border: 1px solid; }
    .catalyst-impact.high { border-color: var(--signal-down); color: var(--signal-down); background: rgba(255, 107, 107, 0.1); }
    .catalyst-impact.medium { border-color: var(--amber); color: var(--amber); background: rgba(255, 179, 71, 0.1); }
    .catalyst-impact.low { border-color: var(--signal-up); color: var(--signal-up); background: var(--phosphor-ghost); }

    /* Enhanced Events Timeline */
    .events-timeline {
      position: relative;
      padding-left: 30px;
    }

    .events-timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--phosphor) 0%, var(--amber) 50%, var(--signal-down) 100%);
      opacity: 0.4;
    }

    .timeline-event {
      position: relative;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .timeline-event::before {
      content: '';
      position: absolute;
      left: -26px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--bg-card);
      border: 2px solid var(--phosphor);
      transition: all 0.2s ease;
    }

    .timeline-event:hover {
      border-color: var(--phosphor-dim);
      background: var(--phosphor-ghost);
      transform: translateX(4px);
    }

    .timeline-event:hover::before {
      background: var(--phosphor);
      box-shadow: 0 0 12px var(--phosphor);
    }

    .timeline-event.high-impact::before {
      border-color: var(--signal-down);
    }
    .timeline-event.high-impact:hover::before {
      background: var(--signal-down);
      box-shadow: 0 0 12px var(--signal-down);
    }

    .timeline-event.medium-impact::before {
      border-color: var(--amber);
    }
    .timeline-event.medium-impact:hover::before {
      background: var(--amber);
      box-shadow: 0 0 12px var(--amber);
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .timeline-ticker {
      font-family: var(--font-display);
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      color: var(--text-bright);
    }

    .timeline-date {
      font-size: 0.65rem;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .timeline-title {
      font-size: 0.8rem;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .timeline-meta {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .timeline-countdown {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--phosphor);
      letter-spacing: 0.1em;
    }

    /* Konami Code Easter Egg - Invader Attack */
    .invader-attack-overlay {
      position: fixed;
      inset: 0;
      z-index: 30000;
      pointer-events: none;
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .invader-attack-overlay.active {
      opacity: 1;
    }

    .attack-invader {
      position: absolute;
      width: 40px;
      height: 32px;
      fill: var(--phosphor);
      filter: drop-shadow(0 0 8px var(--phosphor)) drop-shadow(0 0 16px var(--accent-glow));
      animation: invader-descend 3s ease-in forwards;
    }

    @keyframes invader-descend {
      0% { transform: translateY(-100px); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(calc(100vh + 100px)); opacity: 0; }
    }

    .attack-flash {
      position: fixed;
      inset: 0;
      background: var(--phosphor);
      opacity: 0;
      pointer-events: none;
      z-index: 29999;
    }

    .attack-flash.flash {
      animation: screen-flash 0.15s ease-out;
    }

    @keyframes screen-flash {
      0% { opacity: 0.3; }
      100% { opacity: 0; }
    }

    /* =========================================================================
       ARCADE LOBBY - Game Selection Hub
       ========================================================================= */
    .arcade-lobby {
      padding: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .arcade-lobby-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--phosphor-dim);
    }
    
    .arcade-lobby-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .arcade-lobby-title .arcade-icon {
      font-size: 2.5rem;
      filter: drop-shadow(0 0 10px var(--phosphor));
    }
    
    .arcade-lobby-title h2 {
      font-family: var(--font-display);
      font-size: 1.5rem;
      color: var(--phosphor);
      letter-spacing: 0.15em;
      margin: 0;
      text-shadow: 0 0 20px var(--phosphor-glow);
    }
    
    .arcade-subtitle {
      font-size: 0.6rem;
      color: var(--text-dim);
      letter-spacing: 0.2em;
    }
    
    .arcade-stats-bar {
      display: flex;
      gap: 2rem;
    }
    
    .arcade-stat {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    
    .arcade-stat .label {
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
    }
    
    .arcade-stat .value {
      font-family: var(--font-display);
      font-size: 1.2rem;
      color: var(--amber);
    }
    
    .arcade-games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .arcade-game-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-panel) 100%);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .arcade-game-card:hover {
      border-color: var(--phosphor);
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 30px var(--phosphor-glow);
    }
    
    .arcade-game-card:hover .game-card-overlay {
      opacity: 1;
    }
    
    .arcade-game-card:hover .play-icon {
      transform: scale(1.2);
    }
    
    .game-card-preview {
      position: relative;
      background: var(--bg-void);
      height: 160px;
      overflow: hidden;
    }
    
    .game-card-preview canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .game-card-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .play-icon {
      font-size: 3rem;
      color: var(--phosphor);
      text-shadow: 0 0 20px var(--phosphor);
      transition: transform 0.3s ease;
    }
    
    .game-card-info {
      padding: 1rem;
    }
    
    .game-card-title {
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--phosphor);
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
    }
    
    .game-card-desc {
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }
    
    .game-card-controls {
      display: flex;
      gap: 1rem;
      font-size: 0.6rem;
      color: var(--text-dim);
      font-family: var(--font-mono);
      letter-spacing: 0.05em;
    }
    
    .game-card-controls span {
      background: var(--bg-void);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      border: 1px solid var(--border);
    }
    
    .game-card-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: var(--amber);
      color: var(--bg-void);
      font-size: 0.5rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      letter-spacing: 0.1em;
    }
    
    /* Ship Selection Grid */
    .arcade-ship-select {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }
    
    .ship-select-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    
    .ship-select-title {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--amber);
      letter-spacing: 0.1em;
    }
    
    .ship-select-hint {
      font-size: 0.6rem;
      color: var(--text-dim);
    }
    
    .ship-select-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
    }
    
    .ship-select-item {
      background: var(--bg-panel);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.4rem;
    }
    
    .ship-select-item:hover {
      border-color: var(--phosphor-dim);
      background: var(--bg-input);
    }
    
    .ship-select-item.selected {
      border-color: var(--phosphor);
      background: var(--phosphor-ghost);
      box-shadow: 0 0 15px var(--phosphor-glow);
    }
    
    .ship-select-item img {
      width: 60px;
      height: 45px;
      object-fit: contain;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 5px var(--ship-color, var(--phosphor)));
    }
    
    .ship-select-item .ship-ticker {
      font-family: var(--font-display);
      font-size: 0.65rem;
      color: var(--ship-color, var(--phosphor));
      letter-spacing: 0.1em;
    }
    
    /* Secrets Section */
    .arcade-secrets {
      background: linear-gradient(135deg, rgba(255, 179, 71, 0.05) 0%, transparent 100%);
      border: 1px dashed var(--amber-dim);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }
    
    .secrets-title {
      font-family: var(--font-display);
      font-size: 0.75rem;
      color: var(--amber);
      letter-spacing: 0.15em;
      margin-bottom: 0.25rem;
    }
    
    .secrets-hint {
      font-size: 0.65rem;
      color: var(--text-dim);
      font-style: italic;
    }
    
    /* Arcade tab glow effect */
    .nav-tab.arcade-tab {
      background: linear-gradient(135deg, rgba(255, 179, 71, 0.1) 0%, transparent 100%);
    }
    
    .nav-tab.arcade-tab:hover,
    .nav-tab.arcade-tab.active {
      color: var(--amber);
      border-color: var(--amber);
      text-shadow: 0 0 10px var(--amber-glow);
    }
    
    @media (max-width: 768px) {
      .arcade-lobby-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
      
      .arcade-stats-bar {
        justify-content: center;
      }
      
      .arcade-games-grid {
        grid-template-columns: 1fr;
      }
      
      .ship-select-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      }
    }

    /* =========================================================================
       SIGNAL INVADERS ARCADE GAME
       ========================================================================= */
    .arcade-game-overlay {
      position: fixed;
      inset: 0;
      z-index: 25000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .arcade-game-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .arcade-game-backdrop {
      position: absolute;
      inset: 0;
      background: #050608;
    }

    .arcade-game-container {
      position: relative;
      background: radial-gradient(ellipse at 50% 0%, rgba(51, 255, 153, 0.08), transparent 50%), var(--bg-void);
      border: 2px solid var(--phosphor);
      box-shadow: 
        0 0 40px var(--phosphor-glow),
        inset 0 0 60px rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      max-width: 700px;
      width: 95%;
    }

    .arcade-game-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--phosphor), transparent);
    }

    .arcade-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-mono);
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
      cursor: pointer;
      transition: all 0.15s;
      z-index: 10;
    }

    .arcade-close:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }

    .arcade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .arcade-title {
      font-family: var(--font-display);
      font-size: 1.2rem;
      letter-spacing: 0.15em;
      color: var(--phosphor);
      text-shadow: 0 0 20px var(--phosphor-glow);
    }

    .arcade-stats {
      display: flex;
      gap: 1.5rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      color: var(--text);
    }

    .arcade-stats span {
      display: flex;
      gap: 0.3rem;
    }

    #invaders-canvas {
      display: block;
      width: 100%;
      height: auto;
      background: radial-gradient(ellipse at 50% 50%, #041a22 0%, #01060a 70%);
      border: 1px solid var(--phosphor-dim);
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
      image-rendering: pixelated;
    }

    .arcade-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
      font-family: var(--font-mono);
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      color: var(--text-dim);
    }

    .arcade-message {
      text-align: center;
      margin-top: 0.75rem;
      font-family: var(--font-display);
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      color: var(--amber);
      min-height: 1.2em;
    }

    /* Scanline effect on game canvas */
    #invaders-canvas {
      position: relative;
    }

    .arcade-game-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.1) 2px,
        rgba(0, 0, 0, 0.1) 4px
      );
      pointer-events: none;
      z-index: 5;
    }

    /* Button interaction glow effects */
    .push-btn:active,
    .sim-btn:active,
    .kill-switch-btn:active {
      transform: scale(0.98);
      box-shadow: 0 0 20px var(--phosphor), inset 0 0 10px rgba(255,255,255,0.1);
    }

    .push-btn.primary:active {
      box-shadow: 0 0 25px var(--phosphor), 0 0 50px var(--phosphor-glow);
    }

    /* Interaction ripple effect */
    .ripple-container {
      position: relative;
      overflow: hidden;
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(51, 255, 153, 0.4);
      transform: scale(0);
      animation: ripple-expand 0.6s ease-out;
      pointer-events: none;
    }

    @keyframes ripple-expand {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    
    .right-sidebar { width: 260px; background: var(--bg-panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
    .kill-switch-section { padding: 1.25rem; border-bottom: 1px solid var(--border); }
    .kill-switch-btn { width: 100%; padding: 0.85rem; border: none; font-family: var(--font-body); font-size: 0.75rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; }
    .kill-switch-btn.stop { background: var(--signal-down); color: #fff; }
    .kill-switch-btn.stop:hover { filter: brightness(1.1); }
    .kill-switch-btn.resume { background: var(--signal-up); color: var(--bg-void); }
    .kill-switch-status { text-align: center; font-size: 0.65rem; letter-spacing: 0.08em; color: var(--text-muted); margin-top: 0.6rem; }
    
    /* Ship Profile Card */
    .ship-profile {
      padding: 10px;
      border-radius: 12px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.3);
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.18), #02070c);
    }

    .ship-screen {
      position: relative;
      height: 90px;
      border-radius: 10px;
      overflow: hidden;
      background: #020b10;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.2);
    }

    .ship-grid-bg {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(hsla(var(--accent-hue), 100%, 60%, 0.16) 1px, transparent 1px),
        linear-gradient(90deg, hsla(var(--accent-hue), 100%, 60%, 0.18) 1px, transparent 1px);
      background-size: 10px 10px;
      opacity: .45;
    }

    .ship-screen .ship-svg {
      position: absolute;
      inset: 8px 10px;
      filter:
        drop-shadow(0 0 8px hsla(var(--accent-hue), 100%, 60%, 0.85))
        drop-shadow(0 0 14px hsla(var(--accent-hue), 100%, 65%, 0.6));
    }

    .ship-sweep {
      position: absolute;
      inset: -20%;
      background: conic-gradient(
        from 0deg,
        hsla(var(--accent-hue), 100%, 60%, 0.4),
        transparent 40%
      );
      mix-blend-mode: plus-lighter;
      opacity: .45;
      animation: ship-sweep-spin 4s linear infinite;
    }

    @keyframes ship-sweep-spin {
      to { transform: rotate(360deg); }
    }

    .ship-pulse-ring {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 60px;
      height: 60px;
      margin: -30px 0 0 -30px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.4);
      border-radius: 50%;
      animation: pulse-ring 3s ease-out infinite;
    }

    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 0.8; }
      100% { transform: scale(2); opacity: 0; }
    }

    .ship-caption {
      margin-top: 8px;
      font-family: var(--font-mono);
      font-size: .7rem;
      letter-spacing: .18em;
      color: var(--phosphor);
      text-align: center;
      text-shadow: 0 0 6px var(--phosphor-glow);
    }

    .ship-vitals {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.15);
    }

    .ship-vitals .vital {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ship-vitals .vital-label {
      font-family: var(--font-mono);
      font-size: 0.55rem;
      letter-spacing: 0.12em;
      color: var(--text-dim);
    }

    .ship-vitals .vital-value {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      color: var(--text);
    }

    .ship-vitals .vital-value.positive {
      color: var(--phosphor);
    }

    .ship-vitals .vital-value.negative {
      color: var(--signal-down);
    }
    
    .safety-list { padding: 0.5rem 0; }
    .safety-item { display: flex; justify-content: space-between; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid var(--border); }
    .safety-item:last-child { border-bottom: none; }
    .safety-label { font-size: 0.7rem; color: var(--text-muted); }
    .safety-value { font-size: 0.7rem; }
    .safety-value.ok { color: var(--signal-up); }
    .safety-value.warning { color: var(--amber); }
    
    .activity-feed { flex: 1; overflow-y: auto; padding: 0.75rem; }
    .activity-item { display: flex; gap: 0.85rem; padding: 0.75rem; border-bottom: 1px solid var(--border); transition: background 0.15s; }
    .activity-item:hover { background: var(--phosphor-ghost); }
    .activity-icon { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid var(--border); }
    .activity-icon.trade { border-color: var(--phosphor-dim); color: var(--phosphor); }
    .activity-icon.alert { border-color: var(--amber-dim); color: var(--amber); }
    .activity-icon.invader { border-color: #ff6b6b; color: #ff6b6b; }
    .activity-icon.scenario { border-color: #47d4ff; color: #47d4ff; }
    .activity-icon.bonus { border-color: var(--phosphor); color: var(--phosphor); animation: icon-pulse 1s ease-out; }
    .activity-icon svg { width: 14px; height: 14px; }
    .activity-content { flex: 1; min-width: 0; }
    .activity-title { font-size: 0.75rem; font-weight: 500; color: var(--text); }
    .activity-title.arcade { font-family: var(--font-display); letter-spacing: 0.1em; text-transform: uppercase; }
    .activity-subtitle { font-size: 0.65rem; color: var(--text-muted); margin-top: 0.15rem; }
    .activity-time { font-size: 0.55rem; color: var(--text-dim); letter-spacing: 0.05em; }
    @keyframes icon-pulse { 0% { transform: scale(1.3); opacity: 1; } 100% { transform: scale(1); opacity: 0.9; } }
    
    .watermark { position: fixed; bottom: 2.5rem; left: 1.25rem; display: flex; align-items: center; gap: 0.85rem; padding: 0.6rem 1rem; background: var(--bg-panel); border: 1px solid var(--border); font-size: 0.7rem; color: var(--text-muted); z-index: 50; }
    .watermark a { color: var(--amber); text-decoration: none; letter-spacing: 0.05em; }
    .watermark a:hover { text-shadow: 0 0 10px var(--amber-glow); }
    
    .status-strip { position: fixed; bottom: 0; left: 0; right: 0; height: 28px; background: var(--bg-panel); border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: flex-end; padding: 0 1.5rem; gap: 2rem; z-index: 100; font-size: 0.6rem; letter-spacing: 0.1em; text-transform: uppercase; }
    .status-item { display: flex; align-items: center; gap: 0.5rem; color: var(--text-dim); }
    .status-item .dot { width: 6px; height: 6px; border-radius: 50%; }
    .status-item .dot.green { background: var(--phosphor); box-shadow: 0 0 8px var(--phosphor-glow); }
    .status-item .dot.amber { background: var(--amber); box-shadow: 0 0 8px var(--amber-glow); }
    .status-item .value { color: var(--text-muted); }
    
    .data-updated { animation: data-glow 0.6s ease-out; }
    
    /* ============================================
       SPIELBERGIAN CONTROL PANEL
       ============================================ */
    @keyframes led-blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0.3; } }
    @keyframes led-pulse { 0%, 100% { opacity: 0.5; box-shadow: 0 0 3px currentColor; } 50% { opacity: 1; box-shadow: 0 0 8px currentColor, 0 0 15px currentColor; } }
    @keyframes gauge-sweep { 0% { transform: rotate(-45deg); } 100% { transform: rotate(225deg); } }
    @keyframes scanner-line { 0% { left: 5%; } 100% { left: 85%; } }
    @keyframes data-stream { 0% { background-position: 0 0; } 100% { background-position: 0 20px; } }
    
    .control-panel {
      background: 
        linear-gradient(180deg, rgba(20, 25, 35, 0.95) 0%, rgba(15, 18, 25, 0.98) 100%);
      border: 1px solid var(--border);
      border-top: 2px solid var(--phosphor-dim);
      margin: 0.75rem;
      margin-top: 0;
      padding: 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .control-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--phosphor) 50%, transparent 100%);
      opacity: 0.5;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    
    .panel-title {
      font-family: var(--font-display);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      color: var(--phosphor);
      text-shadow: 0 0 10px var(--phosphor-glow);
    }
    
    .panel-status {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .status-led {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.55rem;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      text-transform: uppercase;
    }
    
    .led {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--phosphor);
      box-shadow: 0 0 6px var(--phosphor), 0 0 12px var(--phosphor-glow);
    }
    
    .led.amber { background: var(--amber); box-shadow: 0 0 6px var(--amber), 0 0 12px var(--amber-glow); animation: led-blink 1s infinite; }
    .led.red { background: #ff4444; box-shadow: 0 0 6px #ff4444; }
    .led.pulse { animation: led-pulse 2s ease-in-out infinite; }
    
    .control-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
    
    /* Control Module Base */
    .control-module {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 0.75rem;
      position: relative;
    }
    
    .control-module::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--phosphor-dim), transparent);
    }
    
    .module-label {
      font-size: 0.5rem;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .module-label .led { width: 4px; height: 4px; }
    
    /* Rotary Knob */
    .knob-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    
    .knob {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: 
        radial-gradient(circle at 30% 30%, #4a5060 0%, #2a2f3d 50%, #1a1d26 100%);
      border: 2px solid #3a4050;
      position: relative;
      cursor: pointer;
      box-shadow: 
        0 4px 8px rgba(0,0,0,0.5),
        inset 0 2px 4px rgba(255,255,255,0.1);
      transition: transform 0.1s;
    }
    
    .knob:hover {
      border-color: var(--phosphor-dim);
      box-shadow: 
        0 4px 8px rgba(0,0,0,0.5),
        0 0 15px var(--phosphor-ghost),
        inset 0 2px 4px rgba(255,255,255,0.1);
    }
    
    .knob::before {
      content: '';
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 12px;
      background: var(--phosphor);
      border-radius: 2px;
      box-shadow: 0 0 6px var(--phosphor);
    }
    
    .knob::after {
      content: '';
      position: absolute;
      inset: 4px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .knob-marks {
      position: absolute;
      inset: -8px;
      border-radius: 50%;
    }
    
    .knob-value {
      font-family: var(--font-display);
      font-size: 0.8rem;
      color: var(--text-bright);
      text-shadow: 0 0 10px var(--phosphor-ghost);
    }
    
    .knob-band-label {
      font-family: var(--font-body);
      font-size: 0.55rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-top: 0.25rem;
      transition: color 0.2s ease;
    }
    
    .knob-band-label.raw { color: var(--signal-down); }
    .knob-band-label.balanced { color: var(--phosphor-dim); }
    .knob-band-label.deep { color: #47d4ff; }
    
    /* Toggle Switch */
    .toggle-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.3rem 0;
    }
    
    .toggle-label {
      font-size: 0.6rem;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }
    
    .toggle-switch {
      width: 36px;
      height: 18px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 9px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .toggle-switch::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 12px;
      height: 12px;
      background: #666;
      border-radius: 50%;
      transition: all 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
    
    .toggle-switch.active {
      background: var(--phosphor-ghost);
      border-color: var(--phosphor-dim);
    }
    
    .toggle-switch.active::before {
      left: 20px;
      background: var(--phosphor);
      box-shadow: 0 0 8px var(--phosphor);
    }
    
    /* Mini Gauge */
    .gauge-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.4rem;
    }
    
    .mini-gauge {
      width: 60px;
      height: 35px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 30px 30px 0 0;
      position: relative;
      overflow: hidden;
    }
    
    .gauge-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(0deg, var(--phosphor) 0%, var(--phosphor-dim) 100%);
      transition: height 0.5s ease;
      opacity: 0.8;
    }
    
    .gauge-needle {
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 2px;
      height: 28px;
      background: #fff;
      transform-origin: bottom center;
      transform: rotate(-45deg);
      transition: transform 0.5s ease;
      box-shadow: 0 0 4px #fff;
    }
    
    .gauge-marks {
      position: absolute;
      inset: 0;
      border-bottom: 1px solid var(--border);
    }
    
    .gauge-value {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text);
    }
    
    /* Slider Control */
    .slider-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .slider-track {
      height: 6px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 3px;
      position: relative;
      cursor: pointer;
    }
    
    .slider-fill {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      background: linear-gradient(90deg, var(--phosphor) 0%, var(--amber) 100%);
      border-radius: 3px;
      transition: width 0.1s;
    }
    
    .slider-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      background: radial-gradient(circle at 30% 30%, #5a6070 0%, #3a4050 100%);
      border: 2px solid var(--phosphor-dim);
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    
    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.08em;
    }
    
    /* Scanner Display */
    .scanner-display {
      height: 40px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    
    .scanner-grid {
      position: absolute;
      inset: 0;
      background: 
        repeating-linear-gradient(0deg, transparent, transparent 9px, rgba(51, 255, 153, 0.1) 9px, rgba(51, 255, 153, 0.1) 10px),
        repeating-linear-gradient(90deg, transparent, transparent 9px, rgba(51, 255, 153, 0.1) 9px, rgba(51, 255, 153, 0.1) 10px);
    }
    
    .scanner-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--phosphor);
      box-shadow: 0 0 10px var(--phosphor), 0 0 20px var(--phosphor);
      animation: scanner-line 2s linear infinite;
    }
    
    .scanner-blips {
      position: absolute;
      inset: 0;
    }
    
    .blip {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--amber);
      border-radius: 50%;
      box-shadow: 0 0 6px var(--amber);
      animation: led-pulse 1.5s ease-in-out infinite;
    }
    
    /* LED Array */
    .led-array {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 4px;
    }
    
    .array-led {
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: #333;
      border: 1px solid #444;
    }
    
    .array-led.on { 
      background: var(--phosphor); 
      box-shadow: 0 0 6px var(--phosphor);
    }
    
    .array-led.amber { 
      background: var(--amber); 
      box-shadow: 0 0 6px var(--amber);
    }
    
    .array-led.red { 
      background: #ff4444; 
      box-shadow: 0 0 6px #ff4444;
    }
    
    /* Numeric Display */
    .numeric-display {
      background: #0a0c0f;
      border: 1px solid var(--border);
      padding: 0.4rem 0.6rem;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.25rem;
    }
    
    .display-digit {
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--phosphor);
      text-shadow: 0 0 8px var(--phosphor);
      letter-spacing: 0.05em;
    }
    
    .display-unit {
      font-size: 0.5rem;
      color: var(--text-dim);
      margin-left: 0.25rem;
    }
    
    /* Push Button */
    .push-btn {
      width: 100%;
      padding: 0.5rem;
      background: linear-gradient(180deg, #4a5060 0%, #2a2f3d 100%);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--font-body);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.1s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .push-btn:hover {
      border-color: var(--phosphor-dim);
      color: var(--phosphor);
    }
    
    .push-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    .push-btn.primary {
      background: linear-gradient(180deg, rgba(51, 255, 153, 0.3) 0%, rgba(51, 255, 153, 0.1) 100%);
      border-color: var(--phosphor-dim);
      color: var(--phosphor);
    }
    
    @media (max-width: 1000px) {
      .control-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 600px) {
      .control-grid { grid-template-columns: 1fr; }
      .control-panel { padding: 0.75rem; }
    }
    
    .dev-console { display: none; position: fixed; top: 70px; left: 50%; transform: translateX(-50%); width: 500px; max-width: 90vw; background: var(--bg-panel); border: 1px solid var(--amber-dim); z-index: 200; box-shadow: 0 0 40px rgba(255, 179, 71, 0.2); }
    .dev-console.visible { display: block; }
    .dev-console-header { padding: 0.75rem 1rem; background: var(--bg-card); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .dev-console-title { font-size: 0.65rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--amber); }
    .dev-console-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1rem; }
    .dev-console-body { padding: 1rem; max-height: 300px; overflow-y: auto; font-size: 0.7rem; line-height: 1.6; }
    .log-entry { padding: 0.4rem 0; border-bottom: 1px solid var(--border); color: var(--text-muted); }
    .log-entry .timestamp { color: var(--text-dim); margin-right: 0.75rem; }
    .log-entry .level { margin-right: 0.5rem; }
    .log-entry .level.info { color: var(--phosphor); }
    .log-entry .level.warn { color: var(--amber); }
    .log-entry .level.error { color: var(--signal-down); }
    
    /* =====================================================================
       ARCADE EXTRAS – HUD, toggles, terminal, toasts, themes
       ===================================================================== */
    
    /* Mini toggle in status bar */
    .toggle-mini {
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      margin-left: 0.35rem;
    }
    .toggle-mini input { display: none; }
    .toggle-mini-track {
      width: 32px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #11161b;
      padding: 1px;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.7);
      display: inline-flex;
      align-items: center;
    }
    .toggle-mini-knob {
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: var(--text-dim);
      transition: transform 0.18s ease, background 0.18s ease;
    }
    .toggle-mini input:checked + .toggle-mini-track .toggle-mini-knob {
      transform: translateX(16px);
      background: var(--phosphor);
    }
    
    /* Theme select in status bar */
    .theme-select {
      background: #0b1016;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 0.65rem;
      padding: 0.1rem 0.35rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .theme-select:hover { border-color: var(--phosphor-dim); }
    
    /* Arcade HUD */
    .arcade-hud {
      position: fixed;
      top: 80px;
      right: 18px;
      width: 220px;
      background: rgba(7, 11, 17, 0.95);
      border-radius: 10px;
      border: 1px solid #1e2832;
      box-shadow: 0 0 20px rgba(51,255,153,0.15);
      padding: 0.65rem 0.75rem;
      font-family: var(--font-body);
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      z-index: 15000;
      backdrop-filter: blur(8px);
    }
    .arcade-hud.hidden { display: none; }
    .arcade-hud .hud-title {
      color: var(--phosphor);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    .arcade-hud ul { list-style: none; margin: 0; padding: 0; }
    .arcade-mission {
      padding: 0.2rem 0;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .arcade-mission::before {
      content: '○';
      color: var(--text-dim);
      font-size: 0.5rem;
    }
    .arcade-mission.completed {
      text-decoration: line-through;
      opacity: 0.55;
    }
    .arcade-mission.completed::before {
      content: '●';
      color: var(--phosphor);
    }
    
    .arcade-launch-btn {
      width: 100%;
      margin-top: 0.6rem;
      padding: 0.5rem;
      background: transparent;
      border: 1px solid var(--phosphor-dim);
      color: var(--phosphor);
      font-family: var(--font-mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .arcade-launch-btn:hover {
      background: var(--phosphor-ghost);
      border-color: var(--phosphor);
      box-shadow: 0 0 15px var(--phosphor-glow);
    }
    
    /* Terminal-style uplink log */
    .terminal-log {
      position: fixed;
      left: 18px;
      bottom: 54px;
      width: 280px;
      height: 130px;
      background: rgba(5, 8, 12, 0.92);
      border-radius: 8px;
      border: 1px solid #182228;
      padding: 0.4rem 0.55rem;
      font-family: var(--font-body);
      font-size: 0.6rem;
      line-height: 1.4;
      color: #76a58e;
      overflow-y: auto;
      z-index: 14000;
      backdrop-filter: blur(6px);
    }
    .terminal-log-line {
      white-space: nowrap;
      padding: 0.1rem 0;
    }
    .terminal-log-line span.time {
      color: #4e6b5f;
      margin-right: 0.35rem;
    }
    
    /* Toast popups */
    .toast-container {
      position: fixed;
      right: 20px;
      bottom: 70px;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      z-index: 16000;
    }
    .toast {
      background: rgba(12, 16, 21, 0.95);
      border-radius: 8px;
      border: 1px solid rgba(51,255,153,0.4);
      padding: 0.5rem 0.75rem;
      font-family: var(--font-body);
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--phosphor);
      box-shadow: 0 0 20px rgba(51,255,153,0.25);
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      backdrop-filter: blur(8px);
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.warn {
      border-color: var(--amber);
      color: var(--amber);
      box-shadow: 0 0 20px rgba(255,179,71,0.2);
    }
    .toast.alert {
      border-color: #ff6666;
      color: #ff8080;
      box-shadow: 0 0 20px rgba(255,102,102,0.2);
    }
    
    /* ABOUT OVERLAY */
    .about-trigger {
      position: fixed;
      bottom: 16px;
      right: 18px;
      z-index: 12000;
      font-family: var(--font-body);
      font-size: 0.65rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(5, 10, 16, 0.92);
      color: var(--text-muted);
      cursor: pointer;
      backdrop-filter: blur(6px);
      transition: all 0.2s ease;
    }
    .about-trigger:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
      box-shadow: 0 0 15px var(--phosphor-glow);
    }

    .about-overlay {
      position: fixed;
      inset: 0;
      z-index: 25000;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.26s ease;
    }
    .about-overlay.visible {
      pointer-events: auto;
      opacity: 1;
    }
    .about-overlay.hidden {
      display: none;
    }

    .about-backdrop {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 0%, rgba(0,0,0,0.3), rgba(0,0,0,0.92));
      backdrop-filter: blur(4px);
    }

    .about-panel {
      position: relative;
      width: min(620px, 92vw);
      max-height: 80vh;
      background: var(--bg-void);
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: 0 0 60px rgba(0,0,0,0.9), 0 0 40px var(--phosphor-glow);
      padding: 1.5rem 1.6rem 1.3rem;
      z-index: 1;
      overflow: hidden;
    }

    .about-panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background-image: linear-gradient(to bottom, rgba(51, 255, 153, 0.06), rgba(51, 255, 153, 0.02));
      mix-blend-mode: soft-light;
      opacity: 0.6;
      pointer-events: none;
    }

    .about-close {
      position: absolute;
      top: 0.9rem;
      right: 1rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.85rem;
      transition: color 0.2s;
    }
    .about-close:hover {
      color: var(--phosphor);
    }

    .about-header {
      position: relative;
      margin-bottom: 0.75rem;
    }

    .about-label {
      font-family: var(--font-body);
      font-size: 0.6rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.35rem;
    }

    .about-title {
      margin: 0;
      font-family: var(--font-display);
      font-size: 1.3rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--phosphor);
      text-shadow: 0 0 20px var(--phosphor-glow);
    }

    .about-body {
      position: relative;
      margin-top: 0.4rem;
      max-height: 60vh;
      overflow-y: auto;
      font-size: 0.82rem;
      line-height: 1.55;
      color: var(--text);
    }

    .about-body p {
      margin: 0.5rem 0;
    }

    .about-body ul {
      margin: 0.4rem 0 0.6rem 1.1rem;
      padding: 0;
    }
    .about-body li {
      margin: 0.25rem 0;
    }
    .about-body strong {
      color: var(--text-bright);
    }

    .about-footnote {
      margin-top: 0.8rem;
      padding-top: 0.6rem;
      border-top: 1px solid var(--border);
      font-size: 0.65rem;
      color: var(--text-dim);
      font-style: italic;
    }
    
    /* =========================================================================
       PIP-BOY TICKER DOSSIER — Retro terminal style popup
       ========================================================================= */
    .pipboy-overlay {
      position: fixed;
      inset: 0;
      z-index: 26000;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .pipboy-overlay.visible {
      pointer-events: auto;
      opacity: 1;
    }
    .pipboy-overlay.hidden {
      display: none;
    }

    .pipboy-backdrop {
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.7), rgba(0,0,0,0.95));
      backdrop-filter: blur(6px);
    }

    .pipboy-container {
      position: relative;
      width: min(800px, 95vw);
      max-height: 85vh;
      background: 
        linear-gradient(180deg, rgba(8, 12, 18, 0.98) 0%, rgba(5, 8, 12, 0.99) 100%);
      border-radius: 12px;
      border: 2px solid var(--phosphor-dim);
      box-shadow: 
        0 0 60px rgba(0,0,0,0.9),
        0 0 40px var(--phosphor-glow),
        inset 0 0 100px rgba(51, 255, 153, 0.03);
      overflow: hidden;
      z-index: 1;
    }

    /* CRT scanlines overlay */
    .pipboy-container::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.15) 2px,
        rgba(0, 0, 0, 0.15) 4px
      );
      pointer-events: none;
      z-index: 100;
    }

    /* Phosphor glow effect */
    .pipboy-container::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 50% 0%, rgba(51, 255, 153, 0.08), transparent 60%);
      pointer-events: none;
      z-index: 99;
    }

    .pipboy-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(51, 255, 153, 0.08), transparent);
    }

    .pipboy-title-block {
      flex: 1;
    }

    .pipboy-codename {
      font-family: var(--font-display);
      font-size: 0.6rem;
      letter-spacing: 0.25em;
      color: var(--text-dim);
      margin-bottom: 0.25rem;
    }

    .pipboy-ticker-name {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      margin: 0;
      text-shadow: 0 0 20px var(--phosphor-glow);
    }

    .pipboy-sector {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
      letter-spacing: 0.08em;
    }

    .pipboy-threat {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.35rem;
    }

    .pipboy-threat-label {
      font-size: 0.55rem;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    .pipboy-threat-level {
      font-family: var(--font-display);
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      padding: 0.3rem 0.6rem;
      border: 1px solid;
      border-radius: 4px;
    }
    .pipboy-threat-level.low { color: var(--phosphor); border-color: var(--phosphor-dim); background: var(--phosphor-ghost); }
    .pipboy-threat-level.moderate { color: var(--amber); border-color: var(--amber-dim); background: rgba(255, 179, 71, 0.1); }
    .pipboy-threat-level.high { color: #ff6b6b; border-color: rgba(255, 107, 107, 0.5); background: rgba(255, 107, 107, 0.1); }
    .pipboy-threat-level.extreme { color: #ff4444; border-color: #ff4444; background: rgba(255, 68, 68, 0.15); animation: pulse 1.5s ease-in-out infinite; }
    .pipboy-threat-level.chaotic { color: #b388ff; border-color: #b388ff; background: rgba(179, 136, 255, 0.1); animation: pulse 1s ease-in-out infinite; }

    .pipboy-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.75rem;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      z-index: 101;
    }
    .pipboy-close:hover {
      color: var(--phosphor);
      border-color: var(--phosphor-dim);
    }

    /* Dial Navigation */
    .pipboy-nav {
      display: flex;
      border-bottom: 1px solid var(--border);
      background: var(--bg-card);
    }

    .pipboy-dial {
      flex: 1;
      padding: 0.65rem 0.5rem;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.15s;
      position: relative;
    }
    .pipboy-dial:last-child { border-right: none; }
    .pipboy-dial:hover {
      color: var(--phosphor);
      background: var(--phosphor-ghost);
    }
    .pipboy-dial.active {
      color: var(--phosphor);
      background: rgba(51, 255, 153, 0.1);
    }
    .pipboy-dial.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--phosphor);
      box-shadow: 0 0 8px var(--phosphor);
    }

    /* Content Panels */
    .pipboy-body {
      padding: 1rem 1.25rem;
      max-height: calc(85vh - 180px);
      overflow-y: auto;
    }

    .pipboy-panel {
      display: none;
    }
    .pipboy-panel.active {
      display: block;
      animation: pipboy-fade 0.2s ease;
    }

    @keyframes pipboy-fade {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pipboy-section {
      margin-bottom: 1.25rem;
    }

    .pipboy-section-title {
      font-family: var(--font-display);
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      color: var(--phosphor);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
      padding-bottom: 0.35rem;
      border-bottom: 1px solid var(--border);
    }

    .pipboy-text {
      font-size: 0.8rem;
      line-height: 1.55;
      color: var(--text);
    }

    .pipboy-lore {
      font-size: 0.75rem;
      line-height: 1.5;
      color: var(--text-muted);
      font-style: italic;
      padding: 0.75rem;
      background: var(--bg-card);
      border-left: 2px solid var(--phosphor-dim);
      margin-top: 0.75rem;
    }

    /* Vitals Grid */
    .pipboy-vitals {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
    }

    .pipboy-vital {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 0.6rem;
      text-align: center;
    }

    .pipboy-vital-value {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--text-bright);
      margin-bottom: 0.25rem;
    }

    .pipboy-vital-label {
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    /* Catalyst List */
    .pipboy-catalyst {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
    }
    .pipboy-catalyst:last-child { border-bottom: none; }

    .pipboy-catalyst-date {
      font-size: 0.7rem;
      color: var(--text-muted);
      min-width: 80px;
    }

    .pipboy-catalyst-event {
      flex: 1;
      font-size: 0.75rem;
      color: var(--text);
    }

    .pipboy-catalyst-impact {
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      padding: 0.2rem 0.5rem;
      border: 1px solid;
      text-transform: uppercase;
    }
    .pipboy-catalyst-impact.high { color: #ff6b6b; border-color: rgba(255, 107, 107, 0.5); }
    .pipboy-catalyst-impact.medium { color: var(--amber); border-color: var(--amber-dim); }
    .pipboy-catalyst-impact.low { color: var(--phosphor); border-color: var(--phosphor-dim); }

    /* Risk List */
    .pipboy-risk {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.4rem 0;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .pipboy-risk::before {
      content: '⚠';
      color: var(--amber);
      font-size: 0.65rem;
    }

    /* Stats Bar */
    .pipboy-stats-bar {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 1.25rem;
      background: var(--bg-card);
      border-top: 1px solid var(--border);
    }

    .pipboy-stat {
      text-align: center;
    }

    .pipboy-stat-value {
      font-family: var(--font-display);
      font-size: 0.9rem;
      color: var(--text-bright);
    }
    .pipboy-stat-value.positive { color: var(--phosphor); }
    .pipboy-stat-value.negative { color: #ff6b6b; }

    .pipboy-stat-label {
      font-size: 0.5rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-top: 0.15rem;
    }

    /* VACUUM TUBES CLUSTER */
    .tube-cluster {
      display: flex;
      gap: 8px;
      padding-bottom: 0.5rem;
    }

    .vacuum-tube {
      position: relative;
      width: 18px;
      height: 40px;
      border-radius: 10px 10px 4px 4px;
      background: linear-gradient(to bottom, #05080c, #020305);
      border: 1px solid #28333f;
      box-shadow: 0 0 8px rgba(0,0,0,0.7);
      overflow: hidden;
    }

    .tube-glass {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 10%, rgba(255,255,255,0.18), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.8;
    }

    .tube-filament {
      position: absolute;
      bottom: 6px;
      left: 50%;
      width: 8px;
      height: 14px;
      transform: translateX(-50%);
      background: radial-gradient(circle at 50% 30%, #ffb347, rgba(255,179,71,0.15));
      border-radius: 999px;
      box-shadow:
        0 0 6px rgba(255,179,71,0.8),
        0 0 18px rgba(255,179,71,0.6);
      animation: tube-flicker 1.4s infinite steps(2, end);
    }

    @keyframes tube-flicker {
      0% { opacity: 0.9; }
      50% { opacity: 1; }
      100% { opacity: 0.85; }
    }

    .tube-cluster.overload .tube-filament {
      animation: tube-overload 0.12s infinite steps(2, end);
      box-shadow:
        0 0 10px rgba(255,255,200,1),
        0 0 28px rgba(255,179,71,0.9);
    }

    @keyframes tube-overload {
      0% { opacity: 0.7; transform: translateX(-50%) scaleY(0.9); }
      50% { opacity: 1;   transform: translateX(-50%) scaleY(1.1); }
      100%{ opacity: 0.6; transform: translateX(-50%) scaleY(0.9); }
    }

    /* HOLOGRAPHIC SHIP PANEL */
    .holo-card {
      margin-top: 0.75rem;
    }

    .holo-body {
      position: relative;
      height: 110px;
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.16), #05080c);
      border-radius: 10px;
      overflow: hidden;
    }

    .holo-ship {
      width: 100%;
      height: 100%;
    }

    .holo-line {
      stroke: var(--phosphor);
      stroke-width: 1.4;
      fill: transparent;
      stroke-linejoin: round;
      opacity: 0.85;
      filter: drop-shadow(0 0 6px var(--accent-glow));
    }

    .holo-scan-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--phosphor), transparent);
      opacity: 0.8;
      animation: holo-scan 2.4s linear infinite;
    }

    @keyframes holo-scan {
      0% { top: 0%; }
      100% { top: 100%; }
    }

    /* Radar sweep overlay for ship panel */
    .holo-radar-sweep {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 150%;
      height: 150%;
      transform: translate(-50%, -50%);
      background: conic-gradient(
        from 0deg,
        transparent 0deg,
        transparent 350deg,
        hsla(var(--accent-hue), 100%, 60%, 0.15) 355deg,
        hsla(var(--accent-hue), 100%, 60%, 0.4) 360deg
      );
      border-radius: 50%;
      animation: holo-radar-spin 4s linear infinite;
      pointer-events: none;
      opacity: 0.7;
      mix-blend-mode: screen;
    }

    @keyframes holo-radar-spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .holo-grid-overlay {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(0deg, hsla(var(--accent-hue), 100%, 60%, 0.04) 1px, transparent 1px),
        linear-gradient(90deg, hsla(var(--accent-hue), 100%, 60%, 0.04) 1px, transparent 1px);
      background-size: 10px 10px;
      pointer-events: none;
    }

    .holo-body::before {
      content: '';
      position: absolute;
      inset: 0;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.2);
      border-radius: 10px;
      pointer-events: none;
    }

    /* Enhanced target lock animation for active tickers */
    .holo-target-lock {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 40px;
      height: 40px;
      border: 1px solid var(--phosphor);
      transform: translate(-50%, -50%);
      opacity: 0.5;
      animation: target-lock-pulse 2s ease-in-out infinite;
    }

    .holo-target-lock::before,
    .holo-target-lock::after {
      content: '';
      position: absolute;
      background: var(--phosphor);
    }

    .holo-target-lock::before {
      width: 8px;
      height: 1px;
      top: 50%;
      left: -4px;
      transform: translateY(-50%);
      box-shadow: 36px 0 0 var(--phosphor);
    }

    .holo-target-lock::after {
      width: 1px;
      height: 8px;
      left: 50%;
      top: -4px;
      transform: translateX(-50%);
      box-shadow: 0 36px 0 var(--phosphor);
    }

    @keyframes target-lock-pulse {
      0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
    }

    /* =========================================================================
       CLOSE ENCOUNTERS SIGNAL BOARD
       ========================================================================= */
    #encounters-console {
      margin-top: 1rem;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.15);
      background: radial-gradient(circle at center, hsla(var(--accent-hue), 100%, 60%, 0.05), transparent 70%);
    }

    .console-title {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.25em;
      color: var(--phosphor);
      text-align: center;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .encounters-board {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .board-row {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .enc-light {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      background: hsla(var(--accent-hue), 100%, 60%, 0.12);
      box-shadow: 0 0 4px hsla(var(--accent-hue), 100%, 60%, 0.4);
      transition: background 0.12s, transform 0.12s, box-shadow 0.12s;
    }

    .enc-light.active {
      background: var(--phosphor);
      transform: scale(1.5);
      box-shadow:
        0 0 8px var(--phosphor),
        0 0 16px var(--accent-glow),
        inset 0 0 4px hsla(var(--accent-hue), 80%, 85%, 0.8);
    }

    .signal-status {
      margin-top: 12px;
      text-align: center;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      letter-spacing: 0.25em;
      color: var(--phosphor);
      text-transform: uppercase;
    }

    .signal-status.noise {
      color: #ff6b6b;
    }

    .signal-status.locked {
      color: var(--phosphor);
      text-shadow: 0 0 10px var(--accent-glow);
      animation: status-pulse 0.8s ease-in-out infinite;
    }

    @keyframes status-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* =========================================================================
       CARGO BAY MANIFEST
       ========================================================================= */
    .cargo-bay {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      padding: 12px;
      margin-bottom: 1rem;
      background: radial-gradient(ellipse at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.05), transparent 60%);
      border: 1px solid var(--border);
      border-radius: 10px;
    }

    .cargo-item {
      text-align: center;
      border-radius: 8px;
      padding: 10px 8px;
      background: linear-gradient(180deg, #0a0f14, #050810);
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.15);
      transition: all 0.2s;
    }

    .cargo-item:hover {
      border-color: var(--phosphor-dim);
      transform: translateY(-2px);
    }

    .cargo-icon {
      width: 36px;
      height: 28px;
      margin: 0 auto 6px;
      border: 1px solid var(--phosphor-dim);
      border-radius: 4px;
      background: linear-gradient(180deg, hsla(var(--accent-hue), 100%, 60%, 0.1), transparent);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cargo-icon svg {
      width: 20px;
      height: 16px;
      fill: var(--phosphor);
      opacity: 0.8;
    }

    .cargo-name {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .cargo-ticker {
      font-family: var(--font-display);
      font-size: 0.7rem;
      color: var(--phosphor);
      margin-bottom: 4px;
    }

    .cargo-health {
      font-family: var(--font-mono);
      font-size: 0.55rem;
      letter-spacing: 0.12em;
      padding: 2px 6px;
      border-radius: 3px;
      background: hsla(var(--accent-hue), 100%, 60%, 0.1);
      color: var(--phosphor);
      display: inline-block;
    }

    .cargo-item.damaged {
      border-color: rgba(255, 107, 107, 0.4);
    }

    .cargo-item.damaged .cargo-icon {
      border-color: rgba(255, 107, 107, 0.5);
    }

    .cargo-item.damaged .cargo-icon svg {
      fill: #ff6b6b;
    }

    .cargo-item.damaged .cargo-health {
      background: rgba(255, 107, 107, 0.15);
      color: #ff6b6b;
    }

    .cargo-item.optimal {
      border-color: hsla(var(--accent-hue), 100%, 60%, 0.4);
      box-shadow: 0 0 15px hsla(var(--accent-hue), 100%, 60%, 0.1);
    }

    .cargo-item.optimal .cargo-health {
      background: hsla(var(--accent-hue), 100%, 60%, 0.2);
    }

    /* =========================================================================
       FLEET HOLOBAY
       ========================================================================= */

    /* Pro ship wireframe styling - primary/secondary/tertiary layers */
    .ship-primary,
    .ship-secondary,
    .ship-tertiary {
      fill: none;
    }

    .ship-primary {
      stroke: #b6ffe7;
      stroke-width: 1.8;
      stroke-linejoin: round;
      stroke-linecap: round;
    }

    .ship-secondary {
      stroke: #7cf7cd;
      stroke-width: 1.1;
      stroke-linejoin: round;
      stroke-linecap: round;
      stroke-dasharray: 2 3;
    }

    .ship-tertiary {
      stroke: #4ff0c0;
      stroke-width: 0.9;
      stroke-linejoin: round;
      stroke-linecap: round;
      stroke-dasharray: 1.5 2.5;
      opacity: .85;
    }

    /* Legacy support for .ship-line */
    .ship-line {
      fill: none;
      stroke: var(--phosphor);
      stroke-width: 1.6;
      stroke-linejoin: round;
      stroke-linecap: round;
    }

    /* Generic glow wrapper where the SVG lives */
    .ship-svg,
    .fleet-ship-svg {
      filter:
        drop-shadow(0 0 6px rgba(0,255,160,.7))
        drop-shadow(0 0 16px rgba(0,255,200,.5));
    }

    /* Hero ship styling - stronger glow + pulse */
    .hero-ship .ship-primary,
    .hero-ship .ship-secondary,
    .hero-ship .ship-tertiary {
      filter: drop-shadow(0 0 8px rgba(0,255,190,.9));
    }

    .hero-ship .ship-secondary {
      animation: hero-pulse 1.6s ease-in-out infinite;
    }

    @keyframes hero-pulse {
      0%   { stroke-opacity: .4; }
      50%  { stroke-opacity: 1; }
      100% { stroke-opacity: .4; }
    }

    /* Winning ships get engine pulse animation */
    .ship-winning .ship-secondary {
      animation: engine-pulse 1.4s ease-in-out infinite;
    }

    @keyframes engine-pulse {
      0%   { stroke-opacity: .4; }
      50%  { stroke-opacity: 1; }
      100% { stroke-opacity: .4; }
    }

    /* Losing ships look more dim/dead */
    .ship-losing .ship-primary {
      stroke: #ff9f9f;
      stroke-opacity: 0.7;
    }

    .ship-losing .ship-secondary {
      stroke: #ff7070;
      stroke-opacity: 0.5;
      animation: none;
    }

    /* =========================================================================
       PIXEL SHIP RENDERING (HD Sprite / SNES Mecha HUD Style)
       ========================================================================= */
    
    /* OUTER HULL – darker neon */
    .pixel-ship-outer {
      fill: #00f2a0;
      stroke: #00ffd0;
      stroke-width: 0.22;
    }

    /* INNER CORE – brighter, "reactor" */
    .pixel-ship-inner {
      fill: #eafffb;
      stroke: #e4fff7;
      stroke-width: 0.18;
    }

    /* HIGHLIGHT / EDGE TRIM – very light accent */
    .pixel-ship-highlight {
      fill: #bfffee;
      stroke: #f5fffd;
      stroke-width: 0.12;
    }

    /* global glow wrapper (keep on SVG container) */
    .pixel-ship-glow {
      filter:
        drop-shadow(0 0 7px rgba(0,255,190,.9))
        drop-shadow(0 0 18px rgba(0,255,220,.6));
    }

    /* hero ships: breathing mech aura */
    .hero-ship {
      animation: pixel-hero-pulse 1.9s ease-in-out infinite;
    }

    @keyframes pixel-hero-pulse {
      0%   { opacity: .82; filter: drop-shadow(0 0 6px rgba(0,255,220,.7)); }
      50%  { opacity: 1;   filter: drop-shadow(0 0 12px rgba(0,255,240,1)); }
      100% { opacity: .82; filter: drop-shadow(0 0 6px rgba(0,255,220,.7)); }
    }

    /* holobay idle "hover" – mech hologram rock */
    .fleet-ship-svg {
      animation: mech-holo-rock 7s ease-in-out infinite alternate;
      transform-origin: 50% 55%;
    }

    @keyframes mech-holo-rock {
      0%   { transform: perspective(700px) rotateX(17deg) rotateY(-5deg); }
      50%  { transform: perspective(700px) rotateX(19deg) rotateY( 4deg); }
      100% { transform: perspective(700px) rotateX(17deg) rotateY(-2deg); }
    }

    /* damaged ships for big losers */
    .ship-damaged {
      position: relative;
    }

    .ship-damaged::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(255,80,80,.45), transparent 65%);
      mix-blend-mode: screen;
      pointer-events: none;
      opacity: 0;
      animation: mech-damage 1.5s infinite;
    }

    @keyframes mech-damage {
      0%,35%,100% { opacity: 0; }
      40%         { opacity: .95; }
      48%         { opacity: .25; }
      58%         { opacity: .6;  }
    }

    /* Pixel ship winning state - bright pulse */
    .pixel-ship-winning .pixel-ship-outer,
    .pixel-ship-winning .pixel-ship-inner,
    .pixel-ship-winning .pixel-ship-highlight {
      animation: pixel-win-pulse 1.2s ease-in-out infinite;
    }

    @keyframes pixel-win-pulse {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    /* Pixel ship losing state - red tint */
    .pixel-ship-losing .pixel-ship-outer {
      fill: #ff8080;
      stroke: #ff5050;
    }
    .pixel-ship-losing .pixel-ship-inner {
      fill: #ffcccc;
      stroke: #ffaaaa;
    }
    .pixel-ship-losing .pixel-ship-highlight {
      fill: #ffb0b0;
      stroke: #ff9090;
    }

    .fleet-holobay {
      margin-bottom: 20px;
      padding: 16px 18px;
      border-radius: 18px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.18);
      background:
        radial-gradient(circle at 0% 0%, hsla(var(--accent-hue), 100%, 60%, 0.08), transparent 60%),
        radial-gradient(circle at 100% 100%, hsla(200, 100%, 60%, 0.08), transparent 60%),
        #02070c;
      box-shadow: 0 0 30px rgba(0,0,0,.9);
    }

    .fleet-holo-main {
      display: grid;
      grid-template-columns: minmax(260px, 1.1fr) minmax(260px, 1fr);
      gap: 18px;
      align-items: stretch;
    }

    .fleet-holo-title {
      font-family: var(--font-mono);
      font-size: .8rem;
      letter-spacing: .25em;
      color: var(--phosphor);
      margin-bottom: 8px;
      text-shadow: 0 0 8px var(--phosphor-glow);
    }

    /* Hologram stage */
    .fleet-holo-stage {
      position: relative;
      height: 220px;
      border-radius: 16px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.35);
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.2), #000915);
      overflow: hidden;
      transform: perspective(900px) rotateX(14deg);
      transform-origin: center bottom;
      box-shadow:
        0 0 40px hsla(var(--accent-hue), 100%, 60%, 0.35),
        inset 0 0 40px rgba(0,0,0,.9);
      animation: stage-border-pulse 3s ease-in-out infinite;
    }

    @keyframes stage-border-pulse {
      0%, 100% { 
        border-color: hsla(var(--accent-hue), 100%, 60%, 0.35);
        box-shadow: 0 0 40px hsla(var(--accent-hue), 100%, 60%, 0.35), inset 0 0 40px rgba(0,0,0,.9);
      }
      50% { 
        border-color: hsla(var(--accent-hue), 100%, 60%, 0.55);
        box-shadow: 0 0 60px hsla(var(--accent-hue), 100%, 60%, 0.5), inset 0 0 40px rgba(0,0,0,.9);
      }
    }

    .fleet-holo-grid {
      position: absolute;
      inset: 40% -10% -15%;
      background-image: linear-gradient(hsla(var(--accent-hue), 100%, 60%, 0.16) 1px, transparent 1px),
                        linear-gradient(90deg, hsla(var(--accent-hue), 100%, 60%, 0.18) 1px, transparent 1px);
      background-size: 24px 12px;
      opacity: .75;
      transform: perspective(900px) rotateX(60deg);
      transform-origin: top center;
      filter: blur(.2px);
      animation: grid-scroll 20s linear infinite;
    }

    @keyframes grid-scroll {
      from { background-position: 0 0; }
      to { background-position: 0 240px; }
    }

    .fleet-ship-svg {
      position: absolute;
      inset: 10px 16px 72px;
      margin: auto;
      filter:
        drop-shadow(0 0 10px hsla(var(--accent-hue), 100%, 60%, 0.8))
        drop-shadow(0 0 26px hsla(var(--accent-hue), 100%, 65%, 0.5));
      animation: holo-drift 9s ease-in-out infinite alternate;
      transform-origin: 50% 55%;
    }

    /* Soft idle motion for the big holo ship */
    @keyframes holo-drift {
      0%   { transform: perspective(900px) rotateX(16deg) rotateY(-6deg); }
      50%  { transform: perspective(900px) rotateX(18deg) rotateY(5deg); }
      100% { transform: perspective(900px) rotateX(16deg) rotateY(-3deg); }
    }

    /* Legacy ship-line support in fleet svg */
    .fleet-ship-svg .ship-line {
      fill: none;
      stroke: var(--phosphor);
      stroke-width: 1.5;
      stroke-linejoin: round;
      stroke-linecap: round;
    }

    .fleet-scanlines {
      position: absolute;
      inset: 0;
      background-image: linear-gradient(
        rgba(0,0,0,0.2) 1px,
        transparent 1px
      );
      background-size: 100% 3px;
      mix-blend-mode: soft-light;
      opacity: .6;
      pointer-events: none;
    }

    .fleet-holo-stars {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(1px 1px at 10% 15%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 25% 45%, hsla(var(--accent-hue), 100%, 70%, 0.6), transparent),
        radial-gradient(1.5px 1.5px at 40% 20%, rgba(255,255,255,0.9), transparent),
        radial-gradient(1px 1px at 55% 70%, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 70% 35%, hsla(var(--accent-hue), 100%, 70%, 0.5), transparent),
        radial-gradient(1px 1px at 85% 60%, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 15% 80%, rgba(255,255,255,0.4), transparent),
        radial-gradient(1.5px 1.5px at 65% 10%, hsla(var(--accent-hue), 100%, 70%, 0.7), transparent),
        radial-gradient(1px 1px at 90% 85%, rgba(255,255,255,0.6), transparent);
      opacity: 0.7;
      animation: starfield-drift 60s linear infinite;
    }

    @keyframes starfield-drift {
      from { background-position: 0 0; }
      to { background-position: 100px 50px; }
    }

    .fleet-holo-glow {
      position: absolute;
      inset: 0;
      background: radial-gradient(
        ellipse at 50% 40%,
        hsla(var(--accent-hue), 100%, 60%, 0.15),
        transparent 60%
      );
      pointer-events: none;
      animation: holo-glow-pulse 4s ease-in-out infinite;
    }

    @keyframes holo-glow-pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    /* Info panel */
    .fleet-holo-info {
      display: flex;
      gap: 22px;
      padding-top: 10px;
    }

    .fleet-holo-info .label {
      font-family: var(--font-mono);
      font-size: .68rem;
      letter-spacing: .22em;
      color: var(--phosphor-dim);
      margin-top: 4px;
    }

    .fleet-holo-info .value {
      font-family: var(--font-mono);
      font-size: .85rem;
      letter-spacing: .15em;
      color: var(--text-bright);
      margin-bottom: 4px;
    }

    .info-left, .info-right {
      flex: 1;
    }

    .info-right .stat {
      margin-bottom: 10px;
    }

    .info-right .stat span {
      font-family: var(--font-mono);
      font-size: .68rem;
      letter-spacing: .22em;
      color: var(--phosphor-dim);
    }

    .info-right .bar {
      margin-top: 3px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: hsla(var(--accent-hue), 100%, 60%, 0.18);
      overflow: hidden;
    }

    .info-right .bar div {
      height: 100%;
      width: 20%;
      background: linear-gradient(90deg, var(--phosphor-dim), var(--phosphor));
      box-shadow: 0 0 10px hsla(var(--accent-hue), 100%, 60%, 0.6);
      transition: width .4s ease, background .2s ease;
    }

    .stat-text {
      font-family: var(--font-mono);
      font-size: .7rem;
      margin-top: 2px;
      color: var(--text-muted);
    }

    /* risk colors */
    .fleet-danger {
      background: linear-gradient(90deg, #ff5c5c, #ffb69f) !important;
      box-shadow: 0 0 10px rgba(255,90,90,.7) !important;
    }

    /* bottom strip */
    .fleet-holo-strip {
      margin-top: 16px;
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
      scrollbar-width: thin;
      scrollbar-color: var(--phosphor-dim) transparent;
    }

    .fleet-holo-strip::-webkit-scrollbar {
      height: 4px;
    }

    .fleet-holo-strip::-webkit-scrollbar-track {
      background: transparent;
    }

    .fleet-holo-strip::-webkit-scrollbar-thumb {
      background: var(--phosphor-dim);
      border-radius: 4px;
    }

    .fleet-thumb {
      min-width: 140px;
      max-width: 180px;
      border-radius: 10px;
      padding: 8px 9px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.2);
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.2), #02090c);
      cursor: pointer;
      transition: .15s ease;
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 4px 8px;
      flex-shrink: 0;
    }

    .fleet-thumb .ticker {
      grid-column: 1 / span 2;
      font-family: var(--font-mono);
      font-size: .8rem;
      letter-spacing: .18em;
      color: var(--text-bright);
    }

    .fleet-thumb .tag {
      font-family: var(--font-mono);
      font-size: .6rem;
      color: var(--phosphor-dim);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .fleet-thumb .pnl {
      text-align: right;
      font-family: var(--font-mono);
      font-size: .7rem;
    }

    .fleet-thumb.loss .pnl {
      color: var(--signal-down);
    }
    .fleet-thumb.gain .pnl {
      color: var(--signal-up);
    }

    .fleet-thumb.active {
      border-color: var(--phosphor);
      box-shadow: 0 0 16px hsla(var(--accent-hue), 100%, 60%, 0.5);
      transform: translateY(-2px);
    }

    .fleet-thumb:hover:not(.active) {
      border-color: var(--phosphor-dim);
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.3), #02090c);
    }

    /* Hero ship thumbnails get special treatment */
    .fleet-thumb.hero {
      border-color: hsla(var(--accent-hue), 100%, 70%, 0.4);
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 70%, 0.25), #02090c);
    }

    .fleet-thumb.hero .ticker {
      color: #b6ffe7;
      text-shadow: 0 0 6px hsla(var(--accent-hue), 100%, 60%, 0.6);
    }

    .fleet-thumb.hero.active {
      border-color: #b6ffe7;
      box-shadow: 0 0 20px hsla(var(--accent-hue), 100%, 70%, 0.6);
    }

    @media (max-width: 768px) {
      .fleet-holo-main {
        grid-template-columns: 1fr;
      }

      .fleet-holo-stage {
        height: 180px;
      }

      .fleet-holo-info {
        flex-direction: column;
        gap: 12px;
      }
    }

    /* =========================================================================
       TRAJECTORY NAVIGATOR (Derivatives)
       ========================================================================= */
    .trajectory-section {
      margin-bottom: 1rem;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: radial-gradient(ellipse at 50% 100%, hsla(var(--accent-hue), 100%, 60%, 0.05), transparent 50%);
    }

    .trajectory-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .trajectory-title {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .trajectory-legend {
      display: flex;
      gap: 12px;
      font-size: 0.6rem;
      color: var(--text-dim);
    }

    .trajectory-legend span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .trajectory-legend .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .trajectory-legend .dot.bullish { background: var(--phosphor); }
    .trajectory-legend .dot.neutral { background: var(--amber); }
    .trajectory-legend .dot.bearish { background: #ff6b6b; }

    #trajectory-canvas {
      width: 100%;
      height: 140px;
      background: radial-gradient(ellipse at 50% 50%, #020509, #000);
      border-radius: 8px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.2);
    }

    .trajectory-readout {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
    }

    .trajectory-stat {
      text-align: center;
    }

    .trajectory-stat-value {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--phosphor);
    }

    .trajectory-stat-label {
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-top: 2px;
    }

    /* =========================================================================
       AMBIENT PANEL FLICKER
       ========================================================================= */
    @keyframes panel-flicker {
      0%, 100% { opacity: 1; }
      92% { opacity: 1; }
      93% { opacity: 0.8; }
      94% { opacity: 1; }
      96% { opacity: 0.9; }
      97% { opacity: 1; }
    }

    .card-header,
    .panel-header {
      animation: panel-flicker 8s linear infinite;
    }

    /* =========================================================================
       AMBIENT PARTICLES (subtle background life)
       ========================================================================= */
    .ambient-particles {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--phosphor);
      border-radius: 50%;
      opacity: 0.3;
      animation: float-up 15s linear infinite;
    }

    @keyframes float-up {
      0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 0.3;
      }
      90% {
        opacity: 0.3;
      }
      100% {
        transform: translateY(-10vh) translateX(20px);
        opacity: 0;
      }
    }

    /* COLOR PROFILE CONTROL */
    .color-profile-control {
      margin-top: 0.4rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 0.5rem 0;
      border-top: 1px solid var(--border);
    }

    .color-label {
      margin-bottom: 0.35rem;
    }

    .color-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    #color-hue-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg,
        hsl(90,100%,60%),
        hsl(140,100%,60%),
        hsl(190,100%,60%),
        hsl(220,100%,60%)
      );
      outline: none;
    }
    #color-hue-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #0b0f14;
      border: 2px solid var(--phosphor);
      box-shadow: 0 0 8px var(--accent-glow);
      cursor: pointer;
    }
    #color-hue-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #0b0f14;
      border: 2px solid var(--phosphor);
      box-shadow: 0 0 8px var(--accent-glow);
      cursor: pointer;
    }

    .color-preview {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid var(--border);
      box-shadow: 0 0 12px var(--accent-glow);
      background: var(--phosphor);
    }

    .color-preset-row {
      margin-top: 0.3rem;
      display: flex;
      gap: 0.25rem;
    }
    .color-preset-row button {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #050a10;
      color: var(--text-soft);
      font-family: var(--font-mono);
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.2rem 0.3rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .color-preset-row button:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }
    .color-preset-row button.active {
      border-color: var(--phosphor);
      color: var(--phosphor);
      background: hsla(var(--accent-hue), 100%, 60%, 0.1);
    }

    /* Mobile responsive */
    @media (max-width: 600px) {
      .pipboy-vitals { grid-template-columns: repeat(2, 1fr); }
      .pipboy-dial { font-size: 0.5rem; padding: 0.5rem 0.25rem; }
      .pipboy-ticker-name { font-size: 1.1rem; }
    }
    
    @media (max-width: 1200px) { .right-sidebar { display: none; } }
    @media (max-width: 900px) { .sidebar { width: 240px; } .positions-grid { grid-template-columns: repeat(2, 1fr); } .arcade-hud { display: none; } }
    @media (max-width: 768px) { 
      .sidebar { display: none; } 
      .positions-grid { grid-template-columns: 1fr 1fr; } 
      .nav-tab { padding: 0.4rem 0.6rem; font-size: 0.6rem; } 
      .terminal-log { display: none !important; }
      .fleet-holobay { display: none; }
      .fleet-holo-main { grid-template-columns: 1fr !important; }
    }

    /* =========================================================================
       COMPREHENSIVE MOBILE OPTIMIZATIONS
       ========================================================================= */
    
    /* Tablet breakpoint */
    @media (max-width: 1024px) {
      .control-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }
      
      .chart-header {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .timeframe-btns {
        order: 3;
        width: 100%;
        justify-content: flex-start;
      }
    }
    
    /* Mobile breakpoint */
    @media (max-width: 768px) {
      /* Header adjustments */
      .header {
        padding: 0.5rem 0.75rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .logo {
        font-size: 0.85rem;
      }
      
      .nav-tabs {
        order: 3;
        width: 100%;
        justify-content: space-between;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        padding-bottom: 0.25rem;
      }
      
      .nav-tabs::-webkit-scrollbar {
        display: none;
      }
      
      .nav-tab {
        flex-shrink: 0;
        padding: 0.5rem 0.75rem;
        font-size: 0.65rem;
      }
      
      /* Main layout fix for mobile */
      .main {
        height: calc(100vh - 56px - 28px);
        height: calc(100dvh - 56px - 28px);
        flex-direction: column;
      }
      
      /* Main content */
      .main-content {
        padding: 0.5rem;
      }
      
      .content {
        padding: 0;
      }
      
      /* Charts */
      .chart-container {
        flex-direction: column;
      }
      
      .price-chart-wrapper {
        min-height: 250px;
      }
      
      .macd-chart-wrapper {
        min-height: 120px;
      }
      
      .chart-header {
        padding: 0.75rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .chart-header-left {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .ticker-display {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .ticker-symbol {
        font-size: 1.5rem;
      }
      
      .ticker-price {
        font-size: 1.1rem;
      }
      
      .chart-tools {
        width: 100%;
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      
      /* Control panel */
      .control-panel {
        margin: 0.5rem;
        padding: 0.75rem;
      }
      
      .control-grid {
        grid-template-columns: 1fr 1fr;
        gap: 0.6rem;
      }
      
      .control-module {
        padding: 0.6rem;
      }
      
      .knob {
        width: 50px;
        height: 50px;
      }
      
      .push-btn {
        padding: 0.75rem;
        font-size: 0.7rem;
        min-height: 44px; /* Touch-friendly */
      }
      
      /* Positions grid */
      .positions-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }
      
      .metric-card {
        padding: 1rem;
      }
      
      .metric-value {
        font-size: 1.2rem;
      }
      
      /* Data tables */
      .data-table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        max-width: 100%;
      }
      
      .data-table th,
      .data-table td {
        padding: 0.6rem 0.5rem;
        font-size: 0.7rem;
        white-space: nowrap;
      }
      
      /* Table wrapper for scroll */
      .data-table-wrapper,
      .card-body {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        max-width: 100%;
      }
      
      /* Make scroll bar visible on mobile for table */
      .data-table::-webkit-scrollbar {
        height: 4px;
      }
      
      .data-table::-webkit-scrollbar-track {
        background: var(--bg-panel);
      }
      
      .data-table::-webkit-scrollbar-thumb {
        background: var(--phosphor-dim);
        border-radius: 2px;
      }
      
      /* Cargo bay */
      #cargo-bay {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .cargo-item {
        min-width: 100px;
        padding: 0.6rem;
      }
      
      .cargo-ticker {
        font-size: 0.7rem;
      }
      
      /* Status strip */
      .status-strip {
        padding: 0 0.75rem;
        gap: 0.5rem;
        font-size: 0.5rem;
        overflow-x: auto;
        justify-content: flex-start;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      
      .status-strip::-webkit-scrollbar {
        display: none;
      }
      
      .status-item {
        flex-shrink: 0;
      }
      
      /* Hide less important status items on mobile */
      .status-strip .status-item:nth-child(2) {
        display: none;
      }
      
      #color-hue-slider {
        display: none;
      }
      
      /* Watermark */
      .watermark {
        left: 0.5rem;
        padding: 0.4rem 0.6rem;
        font-size: 0.6rem;
      }
      
      /* Hide non-essential on mobile */
      .scan-line,
      .holo-radar-sweep,
      .ambient-particles {
        display: none;
      }
      
      /* Encounters board */
      #encounters-console {
        padding: 10px;
      }
      
      .enc-light {
        width: 12px;
        height: 12px;
      }
    }
    
    /* Small mobile */
    @media (max-width: 480px) {
      .header {
        padding: 0.4rem 0.5rem;
      }
      
      .logo {
        font-size: 0.75rem;
      }
      
      .logo-sub {
        display: none;
      }
      
      .nav-tab {
        padding: 0.4rem 0.5rem;
        font-size: 0.55rem;
      }
      
      /* Chart header mobile fixes */
      .chart-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
      }
      
      .chart-header-left {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        width: 100%;
      }
      
      .ticker-display {
        flex-wrap: wrap;
        gap: 0.5rem;
        width: 100%;
      }
      
      .ticker-symbol {
        font-size: 1.2rem;
      }
      
      .ticker-price {
        font-size: 1rem;
      }
      
      .ticker-change {
        font-size: 0.85rem;
      }
      
      .volume-badge {
        font-size: 0.6rem;
        padding: 0.15rem 0.35rem;
      }
      
      .chart-tools {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      
      .control-group {
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      
      .ctrl-btn {
        padding: 0.35rem 0.5rem;
        font-size: 0.6rem;
      }
      
      .control-grid {
        grid-template-columns: 1fr;
      }
      
      .control-module {
        padding: 0.5rem;
      }
      
      .knob {
        width: 44px;
        height: 44px;
      }
      
      .positions-content {
        padding: 0.75rem;
      }
      
      .metric-value {
        font-size: 1rem;
      }
      
      .metric-label {
        font-size: 0.5rem;
      }
      
      /* Timeline events */
      .timeline-event {
        padding: 0.75rem;
      }
      
      .timeline-ticker {
        font-size: 0.75rem;
      }
      
      .timeline-title {
        font-size: 0.7rem;
      }
      
      /* Bar charts */
      .bar-row {
        grid-template-columns: 45px 1fr 55px;
        gap: 0.5rem;
      }
      
      .bar-ticker {
        font-size: 0.65rem;
      }
      
      /* Fix header stats on mobile */
      .header-right {
        flex-wrap: wrap;
        gap: 0.35rem;
      }
      
      .demo-badge {
        font-size: 0.5rem;
        padding: 0.2rem 0.35rem;
      }
      
      .status-indicator {
        font-size: 0.55rem;
      }
      
      .time-display {
        font-size: 0.8rem;
      }
      
      /* Mobile navigation path simulator fix */
      .path-chart-container {
        min-height: 120px;
      }
    }
    
    /* =========================================================================
       SIGNAL INVADERS MOBILE OPTIMIZATIONS
       ========================================================================= */
    @media (max-width: 768px) {
      .arcade-game-container {
        padding: 1rem;
        width: 98%;
        max-height: 95vh;
        overflow-y: auto;
      }
      
      .arcade-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .arcade-title {
        font-size: 1rem;
      }
      
      .arcade-stats {
        gap: 1rem;
        font-size: 0.65rem;
        flex-wrap: wrap;
      }
      
      #invaders-canvas {
        max-height: 300px;
      }
      
      .arcade-controls {
        display: none; /* Hide keyboard instructions on mobile */
      }
      
      /* Touch controls for mobile */
      .mobile-touch-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 0.75rem;
        gap: 0.5rem;
      }
      
      .touch-btn {
        flex: 1;
        max-width: 100px;
        height: 50px;
        background: var(--phosphor-ghost);
        border: 1px solid var(--phosphor-dim);
        color: var(--phosphor);
        font-family: var(--font-display);
        font-size: 1.2rem;
        border-radius: 8px;
        cursor: pointer;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .touch-btn:active {
        background: var(--phosphor);
        color: var(--bg-void);
      }
      
      .touch-btn.fire {
        flex: 2;
        max-width: 150px;
        background: rgba(255, 107, 107, 0.15);
        border-color: #ff6b6b;
        color: #ff6b6b;
      }
      
      .touch-btn.fire:active {
        background: #ff6b6b;
        color: #fff;
      }
    }
    
    @media (max-width: 480px) {
      .arcade-game-container {
        padding: 0.75rem;
      }
      
      .arcade-title {
        font-size: 0.85rem;
      }
      
      .arcade-stats {
        font-size: 0.55rem;
      }
      
      #invaders-canvas {
        max-height: 250px;
      }
      
      .touch-btn {
        height: 44px;
        font-size: 1rem;
      }
    }
    
    /* Show touch controls only on touch devices */
    .mobile-touch-controls {
      display: none;
    }
    
    @media (hover: none) and (pointer: coarse) {
      .mobile-touch-controls {
        display: flex;
      }
      
      .arcade-controls {
        display: none;
      }
    }
    
    /* =========================================================================
       OVERLAY MOBILE OPTIMIZATIONS
       ========================================================================= */
    @media (max-width: 768px) {
      /* Pip-boy dossier */
      .pipboy-container {
        width: 98%;
        max-height: 90vh;
        margin: 1rem auto;
      }
      
      .pipboy-header {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .pipboy-ticker-name {
        font-size: 1.3rem;
      }
      
      .pipboy-nav {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 0.25rem;
        gap: 0.25rem;
      }
      
      .pipboy-dial {
        flex-shrink: 0;
        padding: 0.4rem 0.5rem;
        font-size: 0.55rem;
      }
      
      .pipboy-body {
        max-height: 50vh;
      }
      
      /* About overlay */
      .about-panel {
        width: 95%;
        max-height: 85vh;
        padding: 1.25rem;
      }
      
      .about-title {
        font-size: 1.1rem;
      }
      
      .about-body {
        font-size: 0.8rem;
      }
    }
    
    /* =========================================================================
       TOUCH-FRIENDLY INTERACTIONS
       ========================================================================= */
    @media (hover: none) and (pointer: coarse) {
      /* Larger touch targets */
      .watchlist-item {
        padding: 0.85rem 0.75rem;
        min-height: 60px;
      }
      
      .cargo-item {
        min-height: 70px;
      }
      
      .timeline-event {
        padding: 1rem;
      }
      
      .push-btn,
      .sim-btn,
      .kill-switch-btn {
        min-height: 48px;
        touch-action: manipulation;
      }
      
      .nav-tab {
        min-height: 44px;
        display: flex;
        align-items: center;
        touch-action: manipulation;
      }
      
      /* Remove hover effects that don't work on touch */
      .watchlist-item:hover,
      .cargo-item:hover,
      .timeline-event:hover,
      .catalyst-item:hover {
        transform: none;
      }
      
      /* Active states instead */
      .watchlist-item:active,
      .cargo-item:active,
      .timeline-event:active {
        background: var(--phosphor-ghost);
        border-color: var(--phosphor-dim);
      }
      
      /* Ensure watchlist info button is visible on touch */
      .watchlist-info-btn {
        opacity: 0.5;
      }
      
      /* Make toggle switches easier to tap */
      .toggle-mini {
        min-width: 44px;
        min-height: 24px;
      }
      
      /* Ensure scroll containers work smoothly */
      .tab-panel,
      .mobile-drawer-content,
      #cargo-bay {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }
    }
    
    /* Prevent zoom on input focus (iOS) */
    @media (max-width: 768px) {
      input[type="text"],
      input[type="number"],
      input[type="date"],
      select {
        font-size: 16px;
      }
    }
    
    /* Safe area insets for notched devices */
    @supports (padding: max(0px)) {
      .header {
        padding-left: max(0.75rem, env(safe-area-inset-left));
        padding-right: max(0.75rem, env(safe-area-inset-right));
        padding-top: env(safe-area-inset-top);
      }
      
      .status-strip {
        padding-bottom: max(0px, env(safe-area-inset-bottom));
        height: calc(28px + env(safe-area-inset-bottom, 0px));
      }
      
      .main {
        height: calc(100vh - 56px - 28px - env(safe-area-inset-bottom, 0px) - env(safe-area-inset-top, 0px));
        height: calc(100dvh - 56px - 28px - env(safe-area-inset-bottom, 0px));
      }
      
      .watermark {
        bottom: calc(2.5rem + env(safe-area-inset-bottom, 0px));
        left: max(1.25rem, env(safe-area-inset-left));
      }
      
      .mobile-drawer {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
      
      .mobile-bottom-nav {
        padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
      }
    }

    /* =========================================================================
       MOBILE BOTTOM NAVIGATION BAR
       Thumb-friendly tab switching - the command center's portable bridge
       ========================================================================= */
    .mobile-bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 64px;
      background: linear-gradient(180deg, var(--bg-panel) 0%, var(--bg-deep) 100%);
      border-top: 1px solid var(--border);
      z-index: 15000;
      padding: 0 0.25rem;
    }
    
    .mobile-bottom-nav::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--phosphor-dim) 50%, transparent 100%);
    }
    
    .mobile-nav-items {
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 100%;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .mobile-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.2rem;
      padding: 0.4rem 0.75rem;
      border: none;
      background: transparent;
      color: var(--text-dim);
      font-family: var(--font-mono);
      font-size: 0.5rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 60px;
      border-radius: 8px;
      -webkit-tap-highlight-color: transparent;
    }
    
    .mobile-nav-item .nav-icon {
      font-size: 1.3rem;
      line-height: 1;
      transition: transform 0.2s ease;
    }
    
    .mobile-nav-item.active {
      color: var(--phosphor);
      background: var(--phosphor-ghost);
    }
    
    .mobile-nav-item.active .nav-icon {
      transform: scale(1.1);
      filter: drop-shadow(0 0 6px var(--phosphor));
    }
    
    .mobile-nav-item:active {
      transform: scale(0.95);
      background: var(--phosphor-ghost);
    }
    
    @media (max-width: 768px) {
      .mobile-bottom-nav {
        display: block;
      }
      
      /* Hide header nav tabs on mobile */
      .nav-tabs {
        display: none !important;
      }
      
      /* Adjust main content for bottom nav */
      .main {
        height: calc(100vh - 56px - 64px) !important;
        height: calc(100dvh - 56px - 64px) !important;
      }
      
      /* Hide desktop status strip on mobile */
      .status-strip {
        display: none !important;
      }
    }
    
    /* =========================================================================
       MOBILE TICKER CAROUSEL
       Quick stock selection with horizontal scroll
       ========================================================================= */
    .mobile-ticker-carousel {
      display: none;
      padding: 0.5rem;
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .mobile-ticker-carousel::-webkit-scrollbar {
      display: none;
    }
    
    .ticker-carousel-inner {
      display: flex;
      gap: 0.5rem;
      padding: 0 0.25rem;
    }
    
    .carousel-ticker {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      min-width: 72px;
      cursor: pointer;
      transition: all 0.15s ease;
      -webkit-tap-highlight-color: transparent;
    }
    
    .carousel-ticker.active {
      border-color: var(--phosphor);
      background: var(--phosphor-ghost);
    }
    
    .carousel-ticker:active {
      transform: scale(0.95);
    }
    
    .carousel-ticker-symbol {
      font-family: var(--font-display);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-bright);
      letter-spacing: 0.05em;
    }
    
    .carousel-ticker-price {
      font-size: 0.6rem;
      color: var(--text-muted);
      margin-top: 0.15rem;
    }
    
    .carousel-ticker-change {
      font-size: 0.55rem;
      font-weight: 500;
      margin-top: 0.1rem;
    }
    
    .carousel-ticker-change.positive { color: var(--signal-up); }
    .carousel-ticker-change.negative { color: var(--signal-down); }
    
    @media (max-width: 768px) {
      .mobile-ticker-carousel {
        display: block;
      }
    }
    
    /* =========================================================================
       FLOATING ACTION BUTTON (FAB)
       Quick access to audio and settings
       ========================================================================= */
    .mobile-fab {
      display: none;
      position: fixed;
      bottom: 80px;
      right: 1rem;
      z-index: 14000;
    }
    
    .fab-main {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-panel) 100%);
      border: 1px solid var(--border);
      color: var(--phosphor);
      font-size: 1.4rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 20px var(--phosphor-ghost);
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    
    .fab-main:active {
      transform: scale(0.92);
    }
    
    .fab-main.open {
      transform: rotate(45deg);
      background: var(--phosphor-ghost);
    }
    
    .fab-menu {
      position: absolute;
      bottom: 60px;
      right: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: all 0.2s ease;
    }
    
    .fab-menu.open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .fab-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 24px;
      color: var(--text);
      font-family: var(--font-mono);
      font-size: 0.65rem;
      letter-spacing: 0.05em;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .fab-item:active {
      transform: scale(0.95);
      background: var(--phosphor-ghost);
    }
    
    .fab-item .fab-icon {
      font-size: 1.1rem;
    }
    
    .fab-item.active {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }
    
    @media (max-width: 768px) {
      .mobile-fab {
        display: block;
      }
    }
    
    @supports (padding: max(0px)) {
      @media (max-width: 768px) {
        .mobile-fab {
          bottom: calc(80px + env(safe-area-inset-bottom, 0px));
          right: max(1rem, env(safe-area-inset-right));
        }
      }
    }
    
    /* =========================================================================
       MOBILE QUICK STATS BAR
       Replaces status strip with portfolio-focused info
       ========================================================================= */
    .mobile-quick-stats {
      display: none;
      position: fixed;
      bottom: 64px;
      left: 0;
      right: 0;
      height: 36px;
      background: var(--bg-deep);
      border-top: 1px solid var(--border);
      z-index: 14500;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .mobile-quick-stats::-webkit-scrollbar {
      display: none;
    }
    
    .quick-stats-inner {
      display: flex;
      align-items: center;
      height: 100%;
      gap: 1rem;
      padding: 0 0.75rem;
      min-width: max-content;
    }
    
    .quick-stat {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.55rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      white-space: nowrap;
    }
    
    .quick-stat-label {
      color: var(--text-dim);
    }
    
    .quick-stat-value {
      color: var(--text);
      font-family: var(--font-display);
      font-weight: 500;
    }
    
    .quick-stat-value.positive { color: var(--signal-up); }
    .quick-stat-value.negative { color: var(--signal-down); }
    
    .quick-stat-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--signal-up);
      box-shadow: 0 0 6px var(--signal-up);
    }
    
    .quick-stat-dot.amber {
      background: var(--signal-warn);
      box-shadow: 0 0 6px var(--signal-warn);
    }
    
    @media (max-width: 768px) {
      .mobile-quick-stats {
        display: block;
      }
      
      /* Adjust main and bottom nav for quick stats */
      .main {
        height: calc(100vh - 56px - 64px - 36px) !important;
        height: calc(100dvh - 56px - 64px - 36px) !important;
      }
      
      .mobile-fab {
        bottom: calc(100px + 36px);
      }
    }
    
    @supports (padding: max(0px)) {
      @media (max-width: 768px) {
        .mobile-quick-stats {
          bottom: calc(64px + env(safe-area-inset-bottom, 0px));
        }
        
        .mobile-fab {
          bottom: calc(116px + env(safe-area-inset-bottom, 0px));
        }
        
        .main {
          height: calc(100dvh - 56px - 64px - 36px - env(safe-area-inset-bottom, 0px)) !important;
        }
      }
    }
    
    /* =========================================================================
       MOBILE DRAWER ENHANCEMENTS
       Better organization and visual hierarchy
       ========================================================================= */
    @media (max-width: 768px) {
      .mobile-drawer {
        width: 300px;
        max-width: 88vw;
      }
      
      .mobile-drawer-header {
        background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-panel) 100%);
        padding: 1.25rem 1rem;
        border-bottom: 2px solid var(--phosphor-dim);
      }
      
      .mobile-drawer-title {
        font-size: 1rem;
      }
      
      .mobile-drawer-close {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: var(--bg-input);
        border: 1px solid var(--border);
      }
      
      .mobile-drawer-content {
        padding: 0;
      }
      
      .mobile-drawer .sidebar-section {
        padding: 1rem !important;
        border-bottom: 1px solid var(--border);
      }
      
      .mobile-drawer .sidebar-title {
        font-size: 0.6rem !important;
        color: var(--phosphor-dim) !important;
        margin-bottom: 0.75rem !important;
      }
      
      .mobile-drawer .push-btn {
        min-height: 52px;
        font-size: 0.75rem;
        border-radius: 8px;
      }
      
      .mobile-drawer .stats-grid {
        gap: 0.75rem !important;
      }
      
      .mobile-drawer .stat-box {
        padding: 0.75rem !important;
        border-radius: 8px;
      }
      
      .mobile-drawer .stat-value {
        font-size: 1.1rem !important;
      }
    }
    
    /* =========================================================================
       IMPROVED MOBILE CHART DISPLAY
       Better use of limited screen real estate
       ========================================================================= */
    @media (max-width: 768px) {
      .chart-header {
        padding: 0.75rem !important;
        gap: 0.75rem !important;
      }
      
      .ticker-display {
        width: 100%;
        justify-content: space-between;
      }
      
      .ticker-symbol {
        font-size: 1.4rem !important;
      }
      
      .ticker-price {
        font-size: 1.1rem !important;
      }
      
      .ticker-change {
        font-size: 0.9rem !important;
      }
      
      /* Period buttons as pills */
      .chart-tools {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 0.25rem;
      }
      
      .control-group {
        flex-shrink: 0;
      }
      
      .period-btn {
        min-height: 36px;
        padding: 0.4rem 0.6rem !important;
        border-radius: 18px;
      }
      
      .price-chart-wrapper {
        min-height: 280px !important;
      }
    }
    
    @media (max-width: 480px) {
      .price-chart-wrapper {
        min-height: 240px !important;
      }
      
      .ticker-symbol {
        font-size: 1.2rem !important;
      }
    }
    
    /* =========================================================================
       MOBILE POSITIONS GRID
       Swipeable cards with better touch targets
       ========================================================================= */
    @media (max-width: 768px) {
      .positions-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.5rem !important;
        padding: 0.5rem !important;
      }
      
      .metric-card {
        padding: 0.75rem !important;
        border-radius: 10px !important;
        border: 1px solid var(--border) !important;
        background: var(--bg-card) !important;
      }
      
      .metric-value {
        font-size: 1.1rem !important;
      }
      
      .metric-label {
        font-size: 0.55rem !important;
      }
    }
    
    /* =========================================================================
       PULL TO REFRESH INDICATOR (Visual only)
       ========================================================================= */
    .pull-indicator {
      display: none;
      position: fixed;
      top: 56px;
      left: 50%;
      transform: translateX(-50%) translateY(-100%);
      padding: 0.5rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 0.6rem;
      color: var(--text-muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      z-index: 13000;
      transition: transform 0.2s ease;
    }
    
    .pull-indicator.visible {
      transform: translateX(-50%) translateY(0.5rem);
    }
    
    @media (max-width: 768px) {
      .pull-indicator {
        display: block;
      }
    }
    
    /* =========================================================================
       GESTURE HINTS
       Subtle visual cues for swipe interactions
       ========================================================================= */
    .swipe-hint {
      display: none;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 40px;
      background: var(--phosphor-ghost);
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .swipe-hint.left { left: 4px; }
    .swipe-hint.right { right: 4px; }
    
    .swipe-hint.visible {
      opacity: 1;
      animation: swipe-pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes swipe-pulse {
      0%, 100% { opacity: 0.3; transform: translateY(-50%) scaleY(1); }
      50% { opacity: 0.7; transform: translateY(-50%) scaleY(1.2); }
    }
    
    @media (max-width: 768px) {
      .swipe-hint {
        display: block;
      }
    }

    /* =========================================================================
       MOBILE MENU BUTTON
       ========================================================================= */
    .mobile-menu-btn {
      display: none;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 0.4rem 0.6rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .mobile-menu-btn:hover,
    .mobile-menu-btn:active {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }
    
    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: flex;
        align-items: center;
        gap: 0.3rem;
      }
    }
    
    /* Mobile sidebar drawer */
    .mobile-drawer {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 280px;
      max-width: 85vw;
      background: var(--bg-panel);
      border-right: 1px solid var(--border);
      z-index: 20000;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .mobile-drawer.open {
      transform: translateX(0);
    }
    
    .mobile-drawer-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 19999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .mobile-drawer-backdrop.open {
      opacity: 1;
      visibility: visible;
    }
    
    .mobile-drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    .mobile-drawer-title {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--phosphor);
      letter-spacing: 0.1em;
    }
    
    .mobile-drawer-close {
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0.25rem;
    }
    
    .mobile-drawer-content {
      padding: 0.5rem;
    }
    
    /* Loading screen mobile */
    @media (max-width: 768px) {
      .loading-inner {
        transform: scale(0.8);
      }
      
      .loading-title {
        font-size: 1.5rem !important;
      }
      
      .loading-subtitle {
        font-size: 0.7rem !important;
      }
      
      .invader-army {
        opacity: 0.25;
      }
      
      .invader-row .invader-sprite-small {
        width: 20px;
        height: 14px;
      }
    }
    
    @media (max-width: 480px) {
      .loading-inner {
        transform: scale(0.65);
      }
    }

    /* =========================================================================
       ADMIN CONSOLE OVERLAY (Snoop Trap)
       ========================================================================= */
    .admin-overlay {
      position: fixed;
      inset: 0;
      z-index: 26000;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.25s ease;
    }

    .admin-overlay.visible {
      pointer-events: auto;
      opacity: 1;
    }

    .admin-overlay.hidden {
      display: none;
    }

    .admin-backdrop {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 10% 0%, rgba(51, 255, 153, 0.15), transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(255, 179, 71, 0.12), transparent 55%),
        rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(12px);
    }

    .admin-backdrop::before,
    .admin-backdrop::after {
      content: '';
      position: absolute;
      width: 400px;
      height: 400px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(51, 255, 153, 0.12), transparent 60%);
      opacity: 0.3;
      pointer-events: none;
    }

    .admin-backdrop::before {
      top: -100px;
      left: -80px;
    }

    .admin-backdrop::after {
      bottom: -100px;
      right: -80px;
      background: radial-gradient(circle, rgba(255, 179, 71, 0.1), transparent 60%);
    }

    .admin-window {
      position: relative;
      z-index: 1;
      max-width: 600px;
      width: 92vw;
    }

    .admin-frame {
      position: relative;
      background: var(--bg-void);
      border-radius: 12px;
      border: 2px solid var(--phosphor);
      box-shadow:
        0 0 30px var(--phosphor-glow),
        0 0 60px rgba(0, 0, 0, 0.8),
        inset 0 0 40px rgba(0, 0, 0, 0.5);
      padding: 1rem;
      overflow: hidden;
    }

    .admin-frame::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--phosphor), transparent);
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
      color: var(--phosphor-dim);
    }

    .admin-title {
      color: var(--text-bright);
      font-family: var(--font-display);
      font-size: 0.85rem;
    }

    .admin-screen {
      position: relative;
      background: #020a08;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid var(--phosphor-dim);
      min-height: 180px;
    }

    .admin-screen::after {
      content: '';
      position: absolute;
      inset: 0;
      background-image: linear-gradient(rgba(0, 0, 0, 0.12) 1px, transparent 1px);
      background-size: 100% 3px;
      pointer-events: none;
      border-radius: 8px;
    }

    .admin-line {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--phosphor-dim);
      margin-bottom: 0.25rem;
      letter-spacing: 0.08em;
    }

    .admin-divider {
      margin: 0.75rem 0;
      border-top: 1px solid var(--phosphor-ghost);
    }

    .admin-text {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      line-height: 1.6;
      color: var(--phosphor);
      text-shadow: 0 0 8px var(--phosphor-glow);
      margin-bottom: 0.75rem;
    }

    .admin-text .error {
      color: #ff6b6b;
    }

    .admin-text .warning {
      color: var(--amber);
    }

    .admin-login-grid {
      display: grid;
      grid-template-columns: 80px 1fr;
      gap: 0.5rem 0.75rem;
      align-items: center;
      margin-top: 1rem;
    }

    .admin-label {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      color: var(--text-muted);
    }

    .admin-input {
      background: #030f0a;
      border: 1px solid var(--phosphor-dim);
      color: var(--phosphor);
      font-family: var(--font-mono);
      font-size: 0.8rem;
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      outline: none;
      width: 100%;
    }

    .admin-input:focus {
      border-color: var(--phosphor);
      box-shadow: 0 0 10px var(--phosphor-glow);
    }

    .admin-input::placeholder {
      color: var(--text-dim);
    }

    .admin-btn {
      grid-column: 2;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      border: 1px solid var(--phosphor);
      background: var(--phosphor-ghost);
      color: var(--phosphor);
      cursor: pointer;
      transition: all 0.15s;
      margin-top: 0.5rem;
    }

    .admin-btn:hover {
      background: var(--phosphor);
      color: var(--bg-void);
    }

    .admin-footnote {
      margin-top: 1rem;
      font-family: var(--font-mono);
      font-size: 0.6rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
    }

    .admin-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1rem;
      padding: 0.25rem;
      transition: color 0.15s;
      z-index: 10;
    }

    .admin-close:hover {
      color: var(--phosphor);
    }

    .admin-window.shake {
      animation: admin-shake 0.3s ease;
    }

    @keyframes admin-shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    /* Dummy control styling */
    .dummy-control {
      position: relative;
      cursor: pointer;
    }

    .dummy-control::after {
      content: '🔒';
      position: absolute;
      top: 2px;
      right: 4px;
      font-size: 0.5rem;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .dummy-control:hover::after {
      opacity: 0.5;
    }

    /* =========================================================================
       CHART LANDING GAME
       ========================================================================= */
    .landing-game-overlay {
      position: fixed;
      inset: 0;
      z-index: 24000;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #050608;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .landing-game-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .landing-game-container {
      position: relative;
      max-width: 900px;
      width: 95%;
    }

    .landing-game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .landing-game-title {
      font-family: var(--font-display);
      font-size: 1rem;
      letter-spacing: 0.15em;
      color: var(--phosphor);
    }

    .landing-game-stats {
      display: flex;
      gap: 1.5rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text);
    }

    #landing-canvas {
      width: 100%;
      height: 400px;
      background: radial-gradient(ellipse at 50% 100%, #041a22 0%, #01060a 70%);
      border: 1px solid var(--phosphor-dim);
      border-radius: 8px;
    }

    .landing-controls {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 0.75rem;
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
    }

    .landing-message {
      text-align: center;
      margin-top: 0.5rem;
      font-family: var(--font-display);
      font-size: 1rem;
      letter-spacing: 0.1em;
      min-height: 1.5em;
    }

    .landing-message.success {
      color: var(--phosphor);
      text-shadow: 0 0 15px var(--phosphor-glow);
    }

    .landing-message.failure {
      color: #ff6b6b;
    }

    .landing-close {
      position: absolute;
      top: -2rem;
      right: 0;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-mono);
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .landing-close:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }

    /* Mobile touch controls for landing game */
    .landing-touch-controls {
      display: none;
      justify-content: center;
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    @media (hover: none) and (pointer: coarse) {
      .landing-touch-controls {
        display: flex;
      }
      .landing-controls {
        display: none;
      }
    }

    .landing-touch-btn {
      width: 70px;
      height: 50px;
      background: var(--phosphor-ghost);
      border: 1px solid var(--phosphor-dim);
      color: var(--phosphor);
      font-family: var(--font-display);
      font-size: 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
    }

    .landing-touch-btn.thrust {
      width: 120px;
      background: rgba(255, 179, 71, 0.15);
      border-color: var(--amber);
      color: var(--amber);
    }

    .landing-touch-btn:active {
      transform: scale(0.95);
    }

    @media (max-width: 768px) {
      #landing-canvas {
        height: 280px;
      }
      
      .landing-game-title {
        font-size: 0.85rem;
      }
    }

    /* Screen glitch effect for snoop trap */
    @keyframes screen-glitch {
      0% { transform: translate(0); filter: hue-rotate(0deg); }
      20% { transform: translate(-2px, 1px); filter: hue-rotate(90deg); }
      40% { transform: translate(2px, -1px); filter: hue-rotate(180deg); }
      60% { transform: translate(-1px, 2px); filter: hue-rotate(270deg); }
      80% { transform: translate(1px, -2px); filter: hue-rotate(360deg); }
      100% { transform: translate(0); filter: hue-rotate(0deg); }
    }

    .screen-glitch {
      animation: screen-glitch 0.2s ease;
    }

    .screen-glitch * {
      animation: screen-glitch 0.15s ease reverse;
    }
  </style>
</head>
<body>
  <!-- HOLO FLEET LIBRARY :: refined ship wireframes -->
  <svg id="ship-library" width="0" height="0" style="position:absolute;visibility:hidden;">
    <defs>
      <!-- ═══════════════════════════════════════════════════════════════════
           HERO SHIPS (special, detailed designs)
           ═══════════════════════════════════════════════════════════════════ -->

      <!-- HERO: FLAGSHIP SPEAR (high-tier orbital - RKLB) -->
      <symbol id="ship-flagship" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- spear hull -->
          <polygon points="60,8 88,20 108,40 88,60 60,72 32,60 12,40 32,20" />
          <!-- inner hull -->
          <polygon points="60,14 82,24 98,40 82,56 60,66 38,56 22,40 38,24" />
          <!-- central spine -->
          <line x1="60" y1="8" x2="60" y2="72" />
          <!-- cross braces -->
          <line x1="34" y1="40" x2="86" y2="40" />
          <line x1="42" y1="28" x2="78" y2="52" />
          <line x1="78" y1="28" x2="42" y2="52" />
        </g>
        <g class="ship-secondary">
          <!-- bridge ring -->
          <circle cx="60" cy="28" r="8" />
          <circle cx="60" cy="28" r="3" />
          <!-- engine fins -->
          <polyline points="32,60 26,68 32,72" />
          <polyline points="88,60 94,68 88,72" />
          <!-- side cannons -->
          <polyline points="32,32 20,28 16,24" />
          <polyline points="88,32 100,28 104,24" />
        </g>
        <g class="ship-tertiary">
          <!-- vent lines -->
          <line x1="52" y1="46" x2="68" y2="46" />
          <line x1="52" y1="49" x2="68" y2="49" />
          <!-- subtle paneling -->
          <polyline points="48,20 60,16 72,20" />
        </g>
      </symbol>

      <!-- HERO: DREADNOUGHT MECH (heavy / meme / boss ship - GME) -->
      <symbol id="ship-dreadnought" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- central body -->
          <rect x="30" y="22" width="60" height="36" rx="6" />
          <!-- shoulders -->
          <rect x="18" y="26" width="16" height="28" rx="4" />
          <rect x="86" y="26" width="16" height="28" rx="4" />
          <!-- lower struts -->
          <polyline points="34,58 30,70 40,70" />
          <polyline points="86,58 90,70 80,70" />
          <!-- head / tower -->
          <polygon points="52,18 68,18 72,24 48,24" />
        </g>
        <g class="ship-secondary">
          <!-- eyes / sensors -->
          <circle cx="50" cy="32" r="3" />
          <circle cx="70" cy="32" r="3" />
          <line x1="54" y1="32" x2="66" y2="32" />
          <!-- chest plate -->
          <polygon points="46,38 74,38 70,46 50,46" />
          <!-- arm cannons -->
          <polyline points="18,32 10,30 6,26" />
          <polyline points="104,32 112,30 116,26" />
          <!-- side thrusters -->
          <circle cx="26" cy="50" r="4" />
          <circle cx="94" cy="50" r="4" />
        </g>
        <g class="ship-tertiary">
          <!-- grill lines -->
          <line x1="54" y1="48" x2="66" y2="48" />
          <line x1="54" y1="51" x2="66" y2="51" />
          <!-- knee panels -->
          <rect x="36" y="54" width="8" height="6" />
          <rect x="76" y="54" width="8" height="6" />
        </g>
      </symbol>

      <!-- ═══════════════════════════════════════════════════════════════════
           STANDARD FLEET (refined designs)
           ═══════════════════════════════════════════════════════════════════ -->

      <!-- ORBITAL FRIGATE (ASTS, IRDM, etc.) -->
      <symbol id="ship-frigate" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- outer hull -->
          <polygon points="10,40 26,22 52,14 68,14 94,22 110,40 94,58 68,66 52,66 26,58" />
          <!-- inner hull -->
          <polygon points="26,40 40,26 60,22 80,26 94,40 80,54 60,58 40,54" />
          <!-- spine -->
          <line x1="60" y1="14" x2="60" y2="66" />
          <!-- cross frame -->
          <line x1="32" y1="40" x2="88" y2="40" />
        </g>
        <g class="ship-secondary">
          <!-- engine cluster -->
          <circle cx="24" cy="46" r="4" />
          <circle cx="96" cy="46" r="4" />
          <!-- nose sensor -->
          <circle cx="60" cy="32" r="5" />
          <circle cx="60" cy="32" r="2" />
        </g>
      </symbol>

      <!-- LUNAR LANDER / SURFACE CRAFT (LUNR) -->
      <symbol id="ship-lander" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- main pod -->
          <polygon points="38,20 82,20 96,40 82,60 38,60 24,40" />
          <!-- cockpit dome -->
          <path d="M46,24 Q60,10 74,24 Z" />
          <!-- landing ring -->
          <rect x="32" y="60" width="56" height="4" rx="2" />
          <!-- struts -->
          <line x1="32" y1="60" x2="24" y2="70" />
          <line x1="88" y1="60" x2="96" y2="70" />
        </g>
        <g class="ship-secondary">
          <!-- windows -->
          <rect x="46" y="28" width="8" height="6" rx="1" />
          <rect x="66" y="28" width="8" height="6" rx="1" />
          <!-- legs -->
          <line x1="38" y1="60" x2="34" y2="72" />
          <line x1="82" y1="60" x2="86" y2="72" />
        </g>
      </symbol>

      <!-- EVTOL CARRIER / LIFT DECK (JOBY, ACHR, EVEX) -->
      <symbol id="ship-evtol" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- deck -->
          <rect x="26" y="30" width="68" height="20" rx="8" />
          <!-- central fuselage -->
          <rect x="48" y="24" width="24" height="32" rx="6" />
          <!-- nose -->
          <polygon points="60,18 70,24 50,24" />
        </g>
        <g class="ship-secondary">
          <!-- rotors -->
          <circle cx="26" cy="26" r="7" />
          <circle cx="94" cy="26" r="7" />
          <circle cx="26" cy="54" r="7" />
          <circle cx="94" cy="54" r="7" />
          <line x1="26" y1="19" x2="26" y2="33" />
          <line x1="94" y1="19" x2="94" y2="33" />
          <line x1="26" y1="47" x2="26" y2="61" />
          <line x1="94" y1="47" x2="94" y2="61" />
        </g>
      </symbol>

      <!-- CARGO HAULER / INDUSTRIAL (CACI, HON, MP, LOAR) -->
      <symbol id="ship-cargo" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- long hull -->
          <polygon points="12,44 30,26 96,26 108,36 108,52 96,62 30,62" />
          <!-- bow -->
          <polygon points="12,44 22,36 22,52" />
          <!-- spine -->
          <line x1="30" y1="44" x2="96" y2="44" />
        </g>
        <g class="ship-secondary">
          <!-- cargo containers -->
          <rect x="34" y="30" width="12" height="14" />
          <rect x="48" y="30" width="12" height="14" />
          <rect x="62" y="30" width="12" height="14" />
          <rect x="76" y="30" width="12" height="14" />
          <!-- engine pods -->
          <circle cx="36" cy="58" r="3" />
          <circle cx="90" cy="58" r="3" />
        </g>
      </symbol>

      <!-- MEME PROBE / UNKNOWN OBJECT (chaotic sectors) -->
      <symbol id="ship-meme" viewBox="0 0 120 80">
        <g class="ship-primary">
          <!-- saucer -->
          <ellipse cx="60" cy="40" rx="30" ry="14" />
          <ellipse cx="60" cy="34" rx="18" ry="8" />
        </g>
        <g class="ship-secondary">
          <!-- lights -->
          <circle cx="44" cy="40" r="3" />
          <circle cx="60" cy="40" r="3" />
          <circle cx="76" cy="40" r="3" />
          <!-- beams -->
          <polyline points="45,47 40,56 38,64" />
          <polyline points="75,47 80,56 82,64" />
          <!-- weird antenna -->
          <line x1="60" y1="26" x2="60" y2="20" />
          <circle cx="60" cy="18" r="2" />
        </g>
      </symbol>

      <!-- RECON DRONE / EARTH OBS (BKSY, PL) -->
      <symbol id="ship-recon" viewBox="0 0 120 80">
        <g class="ship-primary">
          <ellipse cx="60" cy="40" rx="28" ry="18" />
          <circle cx="60" cy="40" r="10" />
        </g>
        <g class="ship-secondary">
          <circle cx="60" cy="40" r="4" />
          <line x1="32" y1="40" x2="18" y2="28" />
          <line x1="88" y1="40" x2="102" y2="28" />
          <line x1="32" y1="40" x2="18" y2="52" />
          <line x1="88" y1="40" x2="102" y2="52" />
        </g>
      </symbol>

      <!-- PATROL CORVETTE / DEFENSE (KTOS, RDW) -->
      <symbol id="ship-patrol" viewBox="0 0 120 80">
        <g class="ship-primary">
          <polygon points="15,40 35,22 85,22 105,40 85,58 35,58" />
          <line x1="35" y1="22" x2="35" y2="58" />
          <line x1="85" y1="22" x2="85" y2="58" />
          <polygon points="50,30 70,30 74,40 70,50 50,50 46,40" />
        </g>
        <g class="ship-secondary">
          <line x1="15" y1="40" x2="5" y2="40" />
          <line x1="105" y1="40" x2="115" y2="40" />
          <circle cx="60" cy="40" r="4" />
        </g>
      </symbol>

      <!-- COMM RELAY / SATELLITE (ASTS backup, IRDM) -->
      <symbol id="ship-relay" viewBox="0 0 120 80">
        <g class="ship-primary">
          <rect x="45" y="28" width="30" height="24" rx="3" />
          <line x1="10" y1="40" x2="45" y2="40" />
          <line x1="75" y1="40" x2="110" y2="40" />
          <rect x="5" y="30" width="14" height="20" rx="2" />
          <rect x="101" y="30" width="14" height="20" rx="2" />
        </g>
        <g class="ship-secondary">
          <circle cx="60" cy="40" r="5" />
          <line x1="60" y1="52" x2="60" y2="68" />
          <polygon points="52,68 60,60 68,68 60,76" />
        </g>
      </symbol>

      <!-- ═══════════════════════════════════════════════════════════════════
           UNIVERSE EXPANSION FLEET (8 new ships with lore)
           ═══════════════════════════════════════════════════════════════════ -->

      <!-- HERO FLAGSHIP — ORBITAL ARCHON (command/prestige) -->
      <symbol id="ship-archon" viewBox="0 0 120 80">
        <g class="ship-primary">
          <polygon points="60,6 96,22 110,40 96,58 60,74 24,58 10,40 24,22"/>
          <polygon points="60,16 88,28 100,40 88,52 60,64 32,52 20,40 32,28"/>
          <line x1="60" y1="6" x2="60" y2="74"/>
          <line x1="30" y1="40" x2="90" y2="40"/>
        </g>
        <g class="ship-secondary">
          <circle cx="60" cy="24" r="9"/>
          <circle cx="60" cy="24" r="4"/>
          <polyline points="24,58 18,68 26,72"/>
          <polyline points="96,58 102,68 94,72"/>
          <polyline points="32,30 16,24 10,18"/>
          <polyline points="88,30 104,24 110,18"/>
        </g>
        <g class="ship-tertiary">
          <line x1="50" y1="48" x2="70" y2="48"/>
          <line x1="50" y1="51" x2="70" y2="51"/>
          <polyline points="46,20 60,14 74,20"/>
        </g>
      </symbol>

      <!-- HERO DREADNOUGHT — IRON TYRANT (heavy/tank) -->
      <symbol id="ship-tyrant" viewBox="0 0 120 80">
        <g class="ship-primary">
          <rect x="26" y="22" width="68" height="38" rx="6"/>
          <rect x="14" y="26" width="18" height="30" rx="4"/>
          <rect x="88" y="26" width="18" height="30" rx="4"/>
          <polygon points="48,18 72,18 78,24 42,24"/>
          <polyline points="30,60 24,70 36,72"/>
          <polyline points="90,60 96,70 84,72"/>
        </g>
        <g class="ship-secondary">
          <circle cx="50" cy="34" r="3"/>
          <circle cx="70" cy="34" r="3"/>
          <polygon points="46,40 74,40 72,48 48,48"/>
          <polyline points="14,34 6,30 2,24"/>
          <polyline points="106,34 114,30 118,24"/>
          <circle cx="26" cy="50" r="4"/>
          <circle cx="94" cy="50" r="4"/>
        </g>
        <g class="ship-tertiary">
          <line x1="54" y1="50" x2="66" y2="50"/>
          <rect x="38" y="54" width="8" height="6"/>
          <rect x="74" y="54" width="8" height="6"/>
        </g>
      </symbol>

      <!-- EXPERIMENTAL — PHANTOM NODE (weird science) -->
      <symbol id="ship-phantom" viewBox="0 0 120 80">
        <g class="ship-primary">
          <ellipse cx="60" cy="40" rx="34" ry="22"/>
          <ellipse cx="60" cy="40" rx="22" ry="12"/>
        </g>
        <g class="ship-secondary">
          <circle cx="60" cy="40" r="4"/>
          <polyline points="26,40 16,34 10,28"/>
          <polyline points="94,40 104,34 110,28"/>
        </g>
        <g class="ship-tertiary">
          <line x1="60" y1="18" x2="60" y2="10"/>
          <line x1="60" y1="62" x2="60" y2="70"/>
        </g>
      </symbol>

      <!-- SUPPORT — ATLAS HAULER (logistics) -->
      <symbol id="ship-hauler" viewBox="0 0 120 80">
        <g class="ship-primary">
          <rect x="20" y="28" width="80" height="24" rx="6"/>
        </g>
        <g class="ship-secondary">
          <rect x="24" y="32" width="14" height="16"/>
          <rect x="44" y="32" width="14" height="16"/>
          <rect x="64" y="32" width="14" height="16"/>
          <rect x="84" y="32" width="14" height="16"/>
        </g>
        <g class="ship-tertiary">
          <line x1="20" y1="28" x2="14" y2="18"/>
          <line x1="100" y1="28" x2="106" y2="18"/>
        </g>
      </symbol>

      <!-- RECON — FIREFLY DRONE (surveillance) -->
      <symbol id="ship-drone" viewBox="0 0 120 80">
        <g class="ship-primary">
          <circle cx="60" cy="40" r="10"/>
        </g>
        <g class="ship-secondary">
          <polyline points="50,40 26,32 20,28"/>
          <polyline points="70,40 94,32 100,28"/>
          <line x1="60" y1="30" x2="60" y2="10"/>
        </g>
        <g class="ship-tertiary">
          <circle cx="60" cy="40" r="3"/>
        </g>
      </symbol>

      <!-- CIVILIAN — SOJOURN LANDER (soft landings) -->
      <symbol id="ship-sojourn" viewBox="0 0 120 80">
        <g class="ship-primary">
          <polygon points="60,20 88,40 60,60 32,40"/>
        </g>
        <g class="ship-secondary">
          <line x1="60" y1="60" x2="60" y2="72"/>
          <polyline points="50,60 44,70"/>
          <polyline points="70,60 76,70"/>
        </g>
      </symbol>

      <!-- BLACK OPS — NIGHT PARALLAX (stealth) -->
      <symbol id="ship-parallax" viewBox="0 0 120 80">
        <g class="ship-primary" style="stroke-dasharray:3 4;">
          <polygon points="60,14 96,40 60,66 24,40"/>
        </g>
        <g class="ship-secondary">
          <circle cx="60" cy="40" r="6"/>
        </g>
      </symbol>

      <!-- RELIC — GARDENER FRAME (terraforming) -->
      <symbol id="ship-gardener" viewBox="0 0 120 80">
        <g class="ship-primary">
          <rect x="34" y="24" width="52" height="32" rx="6"/>
        </g>
        <g class="ship-secondary">
          <circle cx="44" cy="40" r="6"/>
          <circle cx="76" cy="40" r="6"/>
        </g>
        <g class="ship-tertiary">
          <line x1="34" y1="24" x2="28" y2="14"/>
          <line x1="86" y1="24" x2="92" y2="14"/>
          <circle cx="28" cy="12" r="2"/>
          <circle cx="92" cy="12" r="2"/>
        </g>
      </symbol>

    </defs>
  </svg>

  <div class="scan-line"></div>
  <div class="grid-bg"></div>
  <div class="ambient-particles" id="ambient-particles"></div>
  
  <!-- LOADING SCREEN -->
  <div class="loading-screen" id="loading-screen">
    <!-- Background marching army -->
    <div class="invader-army" id="invader-army" aria-hidden="true">
      <!-- Rows will be filled via JS -->
    </div>
    
    <div class="stars"></div>
    <div class="horizon"></div>
    
    <div class="loading-inner">
      <div class="launch-scene">
        <!-- Pixel Invader Scene -->
        <div class="pixel-invader-scene">
          <!-- Background fleet -->
          <div class="invader-fleet">
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
          </div>
          
          <!-- Ship Formation - Wedge (4-3-2-1) using PNG sprites -->
          <div class="ship-formation" id="ship-formation">
            <!-- Row 1: 4 ships (back row) -->
            <div class="formation-row">
              <img class="formation-ship" src="assets/ships/BKSY-recon-ship.png" alt="BKSY" title="BKSY - Recon">
              <img class="formation-ship" src="assets/ships/PL-scout-ship.png" alt="PL" title="PL - Scout">
              <img class="formation-ship" src="assets/ships/RDW-Hauler-ship.png" alt="RDW" title="RDW - Hauler">
              <img class="formation-ship" src="assets/ships/EVEX-Transport-Ship.png" alt="EVEX" title="EVEX - Transport">
            </div>
            <!-- Row 2: 3 ships -->
            <div class="formation-row">
              <img class="formation-ship" src="assets/ships/ACHR-eVTOL-ship.png" alt="ACHR" title="ACHR - eVTOL">
              <img class="formation-ship" src="assets/ships/JOBY-eVTOL-light-class-ship.png" alt="JOBY" title="JOBY - Light eVTOL">
              <img class="formation-ship" src="assets/ships/GME-moonshot-ship.png" alt="GME" title="GME - Moonshot">
            </div>
            <!-- Row 3: 2 ships -->
            <div class="formation-row">
              <img class="formation-ship" src="assets/ships/LUNR-lander-ship.png" alt="LUNR" title="LUNR - Lander">
              <img class="formation-ship" src="assets/ships/ASTS-Communications-Relay-Ship.png" alt="ASTS" title="ASTS - Comms">
            </div>
            <!-- Row 4: 1 ship (leader/flagship) -->
            <div class="formation-row">
              <img class="formation-ship" src="assets/ships/RKLB-flagship-ship.png" alt="RKLB" title="RKLB - Flagship">
            </div>
          </div>
          
          <!-- Legacy pixel-invader (hidden, kept for compatibility) -->
          <svg class="pixel-invader" viewBox="0 0 11 8" fill="var(--phosphor)" style="display:none;">
            <rect x="2" y="0" width="1" height="1"/>
            <rect x="8" y="0" width="1" height="1"/>
            <rect x="3" y="1" width="1" height="1"/>
            <rect x="7" y="1" width="1" height="1"/>
            <rect x="2" y="2" width="7" height="1"/>
            <rect x="1" y="3" width="2" height="1"/>
            <rect x="4" y="3" width="3" height="1"/>
            <rect x="8" y="3" width="2" height="1"/>
            <rect x="0" y="4" width="11" height="1"/>
            <rect x="0" y="5" width="1" height="1"/>
            <rect x="2" y="5" width="7" height="1"/>
            <rect x="10" y="5" width="1" height="1"/>
            <rect x="0" y="6" width="1" height="1"/>
            <rect x="2" y="6" width="1" height="1"/>
            <rect x="8" y="6" width="1" height="1"/>
            <rect x="10" y="6" width="1" height="1"/>
            <rect x="3" y="7" width="2" height="1"/>
            <rect x="6" y="7" width="2" height="1"/>
          </svg>
          
          <!-- Pixel beam -->
          <div class="pixel-beam" id="pixel-beam"></div>
          
          <!-- Ground reflection -->
          <div class="pixel-ground" id="pixel-ground"></div>
        </div>
      </div>
      <div class="loading-content">
        <div class="loading-brand">HASLUN-BOT</div>
        <div class="loading-sub">Pilot's Cockpit</div>
        <div class="countdown" id="countdown">3</div>
        <div class="loading-status" id="loading-status">ESTABLISHING UPLINK...</div>
      </div>
    </div>
  </div>
  
  <!-- APP -->
  <div class="app" id="app">
    <header class="header">
      <div class="header-left">
        <div class="logo" onclick="toggleDevConsole()" style="cursor: pointer;" title="Click for systems log">
          <div class="logo-mark">
            <svg viewBox="0 0 32 32" fill="none">
              <circle cx="16" cy="16" r="14" stroke="var(--phosphor)" stroke-width="1.5" opacity="0.4"/>
              <circle cx="16" cy="16" r="10" stroke="var(--phosphor)" stroke-width="1" opacity="0.6"/>
              <circle cx="16" cy="16" r="6" stroke="var(--phosphor)" stroke-width="1.5"/>
              <circle cx="16" cy="16" r="2" fill="var(--amber)"/>
              <line x1="16" y1="2" x2="16" y2="6" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
              <line x1="16" y1="26" x2="16" y2="30" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
              <line x1="2" y1="16" x2="6" y2="16" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
              <line x1="26" y1="16" x2="30" y2="16" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
            </svg>
          </div>
          <div>
            <div class="logo-text">HASLUN-BOT</div>
            <div class="logo-sub">PILOT'S COCKPIT</div>
          </div>
        </div>
        <nav class="nav-tabs">
          <button class="nav-tab active" data-tab="chart" onclick="switchTab('chart')">TELEMETRY</button>
          <button class="nav-tab" data-tab="positions" onclick="switchTab('positions')">HOLDINGS</button>
          <button class="nav-tab" data-tab="options" data-glossary-id="derivatives_tab" onclick="switchTab('options')">DERIVATIVES</button>
          <button class="nav-tab" data-tab="catalysts" onclick="switchTab('catalysts')">EVENTS</button>
          <button class="nav-tab arcade-tab" data-tab="arcade" onclick="switchTab('arcade')">🎮 ARCADE</button>
        </nav>
      </div>
      <div class="header-right">
        <button class="mobile-menu-btn" id="mobile-menu-btn" onclick="toggleMobileDrawer()">
          <span>☰</span> MENU
        </button>
        <span class="demo-badge" data-glossary-id="mode_simulation">SIMULATION</span>
        <div class="status-indicator" data-glossary-id="status_mkt_closed">
          <span class="status-dot"></span>
          <span class="status-text">Market Closed</span>
        </div>
        <span class="time-display" id="time-display">--<span class="blink">:</span>--</span>
      </div>
    </header>
    
    <!-- MOBILE DRAWER -->
    <div class="mobile-drawer-backdrop" id="mobile-drawer-backdrop" onclick="toggleMobileDrawer()"></div>
    <div class="mobile-drawer" id="mobile-drawer">
      <div class="mobile-drawer-header">
        <span class="mobile-drawer-title">NAVIGATION</span>
        <button class="mobile-drawer-close" onclick="toggleMobileDrawer()">✕</button>
      </div>
      <div class="mobile-drawer-content">
        <div class="sidebar-section">
          <div class="sidebar-title">Portfolio Status</div>
          <div class="stats-grid">
            <div class="stat-box highlight"><div class="stat-label">Today P&L</div><div class="stat-value positive">+$1,172</div></div>
            <div class="stat-box"><div class="stat-label">Total P&L</div><div class="stat-value positive">+$34,015</div></div>
          </div>
        </div>
        <div class="sidebar-section" style="padding-bottom: 0.5rem;">
          <div class="sidebar-title">Quick Actions</div>
        </div>
        <div style="padding: 0 0.5rem 0.5rem;">
          <button class="push-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="toggleMobileDrawer(); switchTab('positions');">📊 Holdings</button>
          <button class="push-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="toggleMobileDrawer(); switchTab('options');">📈 Derivatives</button>
          <button class="push-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="toggleMobileDrawer(); switchTab('catalysts');">📅 Events</button>
        </div>
        <div class="sidebar-section" style="padding-bottom: 0.5rem;">
          <div class="sidebar-title">🎮 Arcade</div>
        </div>
        <div style="padding: 0 0.5rem 0.5rem;">
          <button class="push-btn primary" style="width: 100%; margin-bottom: 0.5rem;" onclick="toggleMobileDrawer(); if(window.SignalInvaders) SignalInvaders.start();">👾 Signal Invaders</button>
          <button class="push-btn" style="width: 100%; margin-bottom: 0.5rem;" onclick="toggleMobileDrawer(); if(window.LandingGame) LandingGame.start();">🚀 Terrain Lander</button>
        </div>
        <div class="sidebar-section" style="padding-bottom: 0.5rem;">
          <div class="sidebar-title">Tracking</div>
        </div>
        <div class="watchlist" id="mobile-watchlist" style="max-height: 300px; overflow-y: auto;"></div>
      </div>
    </div>
    
    <main class="main">
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">Portfolio Status</div>
          <div class="stats-grid">
            <div class="stat-box highlight" data-glossary-id="today_pnl"><div class="stat-label">Today P&L</div><div class="stat-value positive">+$1,172</div></div>
            <div class="stat-box" data-glossary-id="total_pnl"><div class="stat-label">Total P&L</div><div class="stat-value positive">+$34,015</div></div>
            <div class="stat-box" data-glossary-id="positions_count"><div class="stat-label">Positions</div><div class="stat-value">10</div></div>
            <div class="stat-box" data-glossary-id="win_rate"><div class="stat-label">Win Rate</div><div class="stat-value positive">90%</div></div>
          </div>
          <div class="portfolio-mood" id="portfolio-mood">
            <span class="mood-label">STEADY CLIMB</span>
            <span class="mood-copy">Green enough to feel smug, not enough to tweet about.</span>
          </div>
        </div>
        <div class="sidebar-section">
          <div class="sidebar-title" data-glossary-id="macd">MACD Signal</div>
          <div class="macd-display">
            <div class="macd-row"><span class="macd-label" data-glossary-id="macd">MACD</span><span class="macd-value positive" id="macd-val">0.3642</span></div>
            <div class="macd-row"><span class="macd-label" data-glossary-id="macd_signal">Signal</span><span class="macd-value" id="signal-val">0.2570</span></div>
            <div class="macd-row"><span class="macd-label" data-glossary-id="macd_histogram">Histogram</span><span class="macd-value positive" id="hist-val">0.1073</span></div>
          </div>
          <div class="macd-status" id="macd-status">
            <span class="macd-status-label">Momentum quiet</span>
            <span class="macd-status-copy">Coasting on inertia.</span>
          </div>
        </div>
        <div class="sidebar-section" id="trend-card">
          <div class="sidebar-title">Trend Status</div>
          <div class="trend-display">
            <div class="trend-status-badge" id="trend-status-badge">
              <span class="trend-icon" id="trend-icon">◈</span>
              <span class="trend-label" id="trend-status-label">ANALYZING...</span>
            </div>
            <div class="trend-detail" id="trend-status-detail">Awaiting data...</div>
            <div class="trend-metrics">
              <div class="trend-metric"><span class="trend-metric-label">MA-100</span><span class="trend-metric-value" id="ma100-val">--</span></div>
              <div class="trend-metric"><span class="trend-metric-label">MA-150</span><span class="trend-metric-value" id="ma150-val">--</span></div>
              <div class="trend-metric"><span class="trend-metric-label">MA-200</span><span class="trend-metric-value" id="ma200-val">--</span></div>
            </div>
          </div>
        </div>
        
        <!-- HOLOGRAPHIC SHIP PANEL -->
        <div class="sidebar-section holo-card">
          <div class="sidebar-title">
            <span>// SHIP PROFILE</span>
            <span id="holo-ticker-label" style="font-size: 0.6rem; color: var(--text-muted); margin-left: 0.5rem;">RKLB · ORBITAL</span>
          </div>
          <div class="holo-body">
            <div class="holo-grid-overlay"></div>
            <div class="holo-radar-sweep"></div>
            <svg id="holo-ship-svg" class="holo-ship" viewBox="0 0 100 60" aria-hidden="true">
              <!-- default wireframe -->
              <polyline points="10,30 30,10 70,10 90,30 70,50 30,50 10,30" class="holo-line"/>
              <polyline points="30,10 40,5 60,5 70,10" class="holo-line"/>
              <line x1="25" y1="30" x2="75" y2="30" class="holo-line"/>
              <line x1="40" y1="50" x2="40" y2="55" class="holo-line"/>
              <line x1="60" y1="50" x2="60" y2="55" class="holo-line"/>
            </svg>
            <div class="holo-target-lock"></div>
            <div class="holo-scan-line"></div>
          </div>
        </div>
        <div class="sidebar-section" style="padding-bottom: 0.5rem;"><div class="sidebar-title">Tracking</div></div>
        <div class="watchlist" id="watchlist"></div>
      </aside>
      
      <div class="content">
        <div class="tab-panel active" id="chart-panel">
          <!-- Mobile Ticker Carousel -->
          <div class="mobile-ticker-carousel" id="mobile-ticker-carousel">
            <div class="ticker-carousel-inner" id="ticker-carousel-inner">
              <!-- Dynamically populated -->
            </div>
          </div>
          
          <!-- TELEMETRY COCKPIT SHELL -->
          <div class="telemetry-shell">
            <div class="telemetry-header">
              <div class="telemetry-title">
                <span class="mono">// PRIMARY VIEWPORT</span>
                <span class="telemetry-callout" id="telemetry-ship-name">RKLB · ELECTRON</span>
              </div>
              <div class="telemetry-meters">
                <div class="meter-chip">
                  <span class="label">SIGNAL</span>
                  <span class="value" id="tm-signal">ANALYZING</span>
                </div>
                <div class="meter-chip">
                  <span class="label">HULL</span>
                  <span class="bar"><span class="fill" id="tm-hull-fill" style="width: 75%"></span></span>
                </div>
                <div class="meter-chip">
                  <span class="label">RISK</span>
                  <span class="value" id="tm-risk-vel">--</span>
                </div>
                <div class="meter-chip">
                  <span class="label">UPLINK</span>
                  <span class="value positive" id="tm-uplink">STABLE</span>
                </div>
              </div>
            </div>
            
            <div class="telemetry-body">
              <div class="telemetry-viewport">
                <div class="telemetry-overlay-grid"></div>
                <div class="telemetry-crosshair"></div>
                
                <!-- Pixel mech HUD -->
                <div class="telemetry-ship-hud">
                  <div class="telemetry-ship-frame">
                    <div class="telemetry-ship-grid"></div>
                    <svg
                      id="telemetry-ship-svg"
                      class="telemetry-ship-svg"
                      viewBox="0 0 120 80"
                      aria-hidden="true">
                      <!-- renderPixelShip() will paint into here -->
                    </svg>
                  </div>
                  <div class="telemetry-ship-label" id="telemetry-ship-label">
                    RKLB · FLAGSHIP
                  </div>
                  <div class="telemetry-ship-caption" id="telemetry-ship-caption">
                    Spearhead command ship. Victory follows in its wake.
                  </div>
                </div>
                
                <div class="telemetry-chart-area">
                  <!-- Chart Header with Controls -->
                  <div class="chart-header">
                    <div class="chart-header-left">
                      <div class="ticker-display">
                        <span class="ticker-symbol" id="chart-ticker">RKLB</span>
                        <span class="ticker-price" id="chart-price">$72.43</span>
                        <span class="ticker-change positive" id="chart-change">+2.16%</span>
                        <span class="volume-badge" id="volume-status">LOADING</span>
                      </div>
                      <div class="control-group">
                        <button class="ctrl-btn active" data-tf="1D" onclick="setTimeframe('1D')">1D</button>
                        <button class="ctrl-btn" data-tf="45" onclick="setTimeframe('45')">45M</button>
                      </div>
                    </div>
                    <div class="chart-tools">
                      <button class="ctrl-btn active" id="ma-toggle" onclick="toggleMA()">MA</button>
                      <div class="tool-divider"></div>
                      <div class="control-group">
                        <button class="ctrl-btn" data-range="1W" onclick="setRange('1W')">1W</button>
                        <button class="ctrl-btn" data-range="1M" onclick="setRange('1M')">1M</button>
                        <button class="ctrl-btn active" data-range="3M" onclick="setRange('3M')">3M</button>
                        <button class="ctrl-btn" data-range="6M" onclick="setRange('6M')">6M</button>
                        <button class="ctrl-btn" data-range="1Y" onclick="setRange('1Y')">1Y</button>
                        <button class="ctrl-btn" data-range="ALL" onclick="setRange('ALL')">ALL</button>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Charts -->
                  <div class="price-chart-wrapper"><canvas id="price-chart"></canvas></div>
                  <div class="macd-chart-wrapper"><canvas id="macd-chart"></canvas></div>
                </div>
              </div>
              
              <!-- Side Console -->
              <div class="telemetry-side-console">
                <div class="console-section">
                  <div class="console-title">// ACTIVE VESSEL</div>
                  <div class="console-ship-display" id="console-ship-display">
                    <svg viewBox="0 0 120 80" id="console-ship-svg"></svg>
                    <span class="console-ship-label" id="console-ship-class">FLAGSHIP</span>
                  </div>
                </div>
                
                <div class="console-section">
                  <div class="console-title">// SENSOR BANK</div>
                  <div class="console-row"><span>MA-100</span><span id="tm-ma100">--</span></div>
                  <div class="console-row"><span>MA-150</span><span id="tm-ma150">--</span></div>
                  <div class="console-row"><span>MA-200</span><span id="tm-ma200">--</span></div>
                  <div class="console-row"><span>PRICE</span><span id="tm-price">--</span></div>
                </div>
                
                <div class="console-section">
                  <div class="console-title">// THRUST VECTOR</div>
                  <div class="console-row" id="tm-macd-row"><span>MACD</span><span id="tm-macd">--</span></div>
                  <div class="console-row" id="tm-signal-row"><span>SIGNAL</span><span id="tm-sig">--</span></div>
                  <div class="console-row" id="tm-histo-row"><span>HISTO</span><span id="tm-histo">--</span></div>
                </div>
                
                <div class="console-section console-log">
                  <div class="console-title">// BRIDGE FEED</div>
                  <div class="console-log-lines" id="telemetry-log">
                    <div class="log-entry"><span class="timestamp">[--:--]</span>Awaiting telemetry...</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="telemetry-footer-strip">
              <span class="status-chip status-ok"><span class="dot"></span>SYSTEM NOMINAL</span>
              <span class="status-chip status-ok"><span class="dot"></span>FLEET UPLINK ACTIVE</span>
              <span class="status-chip" id="tm-mode-chip"><span class="dot"></span>MODE · TELEMETRY</span>
              <span class="status-chip" id="tm-range-chip"><span class="dot"></span>RANGE · 3M</span>
            </div>
          </div>
          
          <!-- SPIELBERGIAN CONTROL PANEL -->
          <div class="control-panel">
            <div class="panel-header">
              <div class="tube-cluster" id="tube-cluster">
                <div class="vacuum-tube">
                  <div class="tube-glass"></div>
                  <div class="tube-filament"></div>
                </div>
                <div class="vacuum-tube">
                  <div class="tube-glass"></div>
                  <div class="tube-filament"></div>
                </div>
                <div class="vacuum-tube">
                  <div class="tube-glass"></div>
                  <div class="tube-filament"></div>
                </div>
              </div>
              <div class="panel-title">▸ SIGNAL PROCESSING ARRAY</div>
              <div class="panel-status">
                <div class="status-led"><div class="led pulse"></div> SYNC</div>
                <div class="status-led"><div class="led amber"></div> DATA</div>
                <div class="status-led"><div class="led"></div> LINK</div>
              </div>
            </div>
            
            <div class="control-grid">
              <!-- Smoothing Knob -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_smoothing"><div class="led pulse"></div> Signal Smoothing</div>
                <div class="knob-container">
                  <div class="knob" id="knob-smoothing" data-value="50" onclick="cycleKnob('smoothing')">
                    <div class="knob-marks"></div>
                  </div>
                  <div class="knob-value" id="smoothing-value">50%</div>
                  <div class="knob-band-label" id="smoothing-band-label">BALANCED</div>
                </div>
              </div>
              
              <!-- Forecast Range Knob -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_forecast_range"><div class="led amber"></div> Forecast Range</div>
                <div class="knob-container">
                  <div class="knob" id="knob-forecast" data-value="30" onclick="cycleKnob('forecast')">
                    <div class="knob-marks"></div>
                  </div>
                  <div class="knob-value" id="forecast-value">30 DAYS</div>
                </div>
              </div>
              
              <!-- Risk Profile Gauge -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_risk_exposure"><div class="led"></div> Risk Exposure</div>
                <div class="gauge-container">
                  <div class="mini-gauge">
                    <div class="gauge-fill" id="risk-fill" style="height: 60%;"></div>
                    <div class="gauge-needle" id="risk-needle" style="transform: rotate(65deg);"></div>
                    <div class="gauge-marks"></div>
                  </div>
                  <div class="gauge-value" id="risk-value">MODERATE</div>
                </div>
              </div>
              
              <!-- Volatility Display -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_vol_index"><div class="led pulse amber"></div> Volatility Index</div>
                <div class="numeric-display">
                  <span class="display-digit" id="vol-display">24.7</span>
                  <span class="display-unit">σ</span>
                </div>
                <div class="led-array" style="margin-top: 0.5rem;">
                  <div class="array-led on"></div>
                  <div class="array-led on"></div>
                  <div class="array-led on"></div>
                  <div class="array-led on"></div>
                  <div class="array-led amber"></div>
                  <div class="array-led"></div>
                  <div class="array-led"></div>
                  <div class="array-led"></div>
                </div>
              </div>
              
              <!-- Toggle Switches -->
              <div class="control-module">
                <div class="module-label"><div class="led"></div> Display Filters</div>
                <div class="toggle-container">
                  <div class="toggle-row">
                    <span class="toggle-label" data-glossary-id="sig_display_momentum">Momentum Overlay</span>
                    <div class="toggle-switch active" id="toggle-momentum" onclick="toggleSwitch('momentum')"></div>
                  </div>
                  <div class="toggle-row">
                    <span class="toggle-label" data-glossary-id="sig_display_heatmap">Volume Heatmap</span>
                    <div class="toggle-switch" id="toggle-heatmap" onclick="toggleSwitch('heatmap')"></div>
                  </div>
                  <div class="toggle-row">
                    <span class="toggle-label" data-glossary-id="sig_display_alerts">Alert Markers</span>
                    <div class="toggle-switch active" id="toggle-alerts" onclick="toggleSwitch('alerts')"></div>
                  </div>
                </div>
              </div>
              
              <!-- Sensitivity Slider -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_alert_sensitivity"><div class="led amber"></div> Alert Sensitivity</div>
                <div class="slider-container">
                  <div class="slider-track" id="sensitivity-track" onclick="handleSliderClick(event, 'sensitivity')">
                    <div class="slider-fill" id="sensitivity-fill" style="width: 65%;"></div>
                    <div class="slider-thumb" id="sensitivity-thumb" style="left: 65%;"></div>
                  </div>
                  <div class="slider-labels">
                    <span>LOW</span>
                    <span>MED</span>
                    <span>HIGH</span>
                  </div>
                </div>
              </div>
              
              <!-- Scanner Display -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_market_scanner"><div class="led pulse"></div> Market Scanner</div>
                <div class="scanner-display">
                  <div class="scanner-grid"></div>
                  <div class="scanner-line"></div>
                  <div class="scanner-blips">
                    <div class="blip" style="top: 25%; left: 20%;"></div>
                    <div class="blip" style="top: 60%; left: 45%;"></div>
                    <div class="blip" style="top: 35%; left: 70%;"></div>
                  </div>
                </div>
              </div>
              
              <!-- Action Buttons -->
              <div class="control-module">
                <div class="module-label"><div class="led"></div> Quick Actions</div>
                <div style="display: flex; flex-direction: column; gap: 0.4rem;">
                  <button class="push-btn primary" id="run-analysis-btn" onclick="runAnalysis(event)">▸ RUN ANALYSIS</button>
                  <button class="push-btn" onclick="resetControls()">↺ RESET DEFAULTS</button>
                </div>
              </div>
            </div>
            
            <!-- CLOSE ENCOUNTERS SIGNAL BOARD -->
            <div id="encounters-console">
              <div class="console-title">👽 ENCOUNTERS SIGNAL ARRAY</div>
              <div class="encounters-board">
                <div class="board-row">
                  <div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div>
                </div>
                <div class="board-row">
                  <div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div>
                </div>
                <div class="board-row">
                  <div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div>
                </div>
              </div>
              <div class="signal-status" id="signal-status">LISTENING…</div>
            </div>
          </div>
        </div>
        
        <div class="tab-panel" id="positions-panel">
          <div class="positions-content">
            <!-- Fleet Command Header -->
            <div class="fleet-command-header">
              <div class="fleet-command-title">
                <span class="icon">🚀</span>
                <div>
                  <h2>FLEET COMMAND</h2>
                  <div class="subtitle">ACTIVE VESSEL MANIFEST</div>
                </div>
              </div>
              <div class="fleet-stats-mini">
                <div class="fleet-stat-mini">
                  <div class="value positive" id="fleet-total-pnl">+$1,172</div>
                  <div class="label">Today's P&L</div>
                </div>
                <div class="fleet-stat-mini">
                  <div class="value" id="fleet-total-value">$17,536</div>
                  <div class="label">Fleet Value</div>
                </div>
                <div class="fleet-stat-mini">
                  <div class="value" id="fleet-ship-count">10</div>
                  <div class="label">Active Ships</div>
                </div>
              </div>
            </div>
            
            <!-- Fleet Grid View -->
            <div class="fleet-grid-view" id="fleet-grid-view">
              <div class="fleet-grid" id="fleet-grid">
                <!-- Ships dynamically inserted here -->
              </div>
            </div>
            
            <!-- Legacy Table View (hidden by default) -->
            <div class="fleet-table-view" id="fleet-table-view">
              <table class="data-table"><thead><tr><th>Ticker</th><th>Sector</th><th>Shares</th><th>Entry</th><th>Current</th><th>Value</th><th>P&L</th></tr></thead><tbody id="stock-tbody"></tbody></table>
            </div>
            
            <!-- Fleet Summary Bar -->
            <div class="fleet-summary-bar">
              <div class="fleet-summary-left">
                <div class="fleet-summary-stat">
                  <div class="label">Operational</div>
                  <div class="value positive" id="fleet-operational-count">9</div>
                </div>
                <div class="fleet-summary-stat">
                  <div class="label">Damaged</div>
                  <div class="value negative" id="fleet-damaged-count">1</div>
                </div>
                <div class="fleet-summary-stat">
                  <div class="label">Win Rate</div>
                  <div class="value" id="fleet-win-rate">90%</div>
                </div>
              </div>
              <div class="fleet-view-toggle">
                <button class="fleet-view-btn active" onclick="setFleetView('grid')" title="Fleet View">◫ FLEET</button>
                <button class="fleet-view-btn" onclick="setFleetView('table')" title="Table View">☰ TABLE</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-panel" id="options-panel">
          <div class="positions-content">
            <div class="positions-grid">
              <div class="metric-card" data-glossary-id="portfolio_value"><div class="metric-value">$39,315</div><div class="metric-label">Portfolio Value</div></div>
              <div class="metric-card" data-glossary-id="total_pnl"><div class="metric-value positive">+$34,015</div><div class="metric-label">Total P&L</div></div>
              <div class="metric-card" data-glossary-id="total_delta"><div class="metric-value">23.55</div><div class="metric-label">Total Delta</div></div>
              <div class="metric-card" data-glossary-id="days_to_expiry"><div class="metric-value">12</div><div class="metric-label">Days to Expiry</div></div>
            </div>
            <div class="card">
              <div class="card-header"><div><div class="card-label">// Analytics</div><div class="card-title">Portfolio Insights</div></div></div>
              <div class="card-body">
                <div class="chart-tabs">
                  <button class="chart-tab active" data-chart="sizes" onclick="switchChartTab('sizes')">Position Sizes</button>
                  <button class="chart-tab" data-chart="pnl" onclick="switchChartTab('pnl')">P&L Distribution</button>
                </div>
                <div class="chart-panel active" id="chart-sizes"></div>
                <div class="chart-panel" id="chart-pnl"></div>
              </div>
            </div>
            <div class="card">
              <div class="card-header"><div><div class="card-label">// LEAPs & Spreads</div><div class="card-title">Options Positions</div></div></div>
              <div class="card-body">
                <!-- TRAJECTORY NAVIGATOR -->
                <div class="trajectory-section">
                  <div class="trajectory-header">
                    <div class="trajectory-title">🛰 NAVIGATION PATH SIMULATOR</div>
                    <div class="trajectory-legend">
                      <span><div class="dot bullish"></div> Bullish</span>
                      <span><div class="dot neutral"></div> Neutral</span>
                      <span><div class="dot bearish"></div> Risk</span>
                    </div>
                  </div>
                  <canvas id="trajectory-canvas"></canvas>
                  <div class="trajectory-readout">
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-delta">23.55</div>
                      <div class="trajectory-stat-label">Net Delta</div>
                    </div>
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-theta">-12.40</div>
                      <div class="trajectory-stat-label">Daily Theta</div>
                    </div>
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-risk">MODERATE</div>
                      <div class="trajectory-stat-label">Risk Level</div>
                    </div>
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-horizon">45D</div>
                      <div class="trajectory-stat-label">Horizon</div>
                    </div>
                  </div>
                </div>
                <table class="data-table"><thead><tr><th>Ticker</th><th>Structure</th><th>Strikes</th><th>Entry</th><th>Current</th><th>P&L</th><th>Delta</th></tr></thead><tbody id="options-tbody"></tbody></table>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-panel" id="catalysts-panel">
          <div class="positions-content">
            <div class="card">
              <div class="card-header"><div><div class="card-label">// Upcoming</div><div class="card-title">Market Catalysts</div></div></div>
              <div class="card-body"><div class="catalyst-list" id="catalyst-list"></div></div>
            </div>
          </div>
        </div>
        
        <!-- ARCADE PANEL -->
        <div class="tab-panel" id="arcade-panel">
          <div class="arcade-lobby">
            <div class="arcade-lobby-header">
              <div class="arcade-lobby-title">
                <span class="arcade-icon">🕹️</span>
                <div>
                  <h2>HASLUN ARCADE</h2>
                  <span class="arcade-subtitle">FLEET COMMAND TRAINING SIMULATIONS</span>
                </div>
              </div>
              <div class="arcade-stats-bar">
                <div class="arcade-stat"><span class="label">HIGH SCORE</span><span class="value" id="arcade-high-score">0</span></div>
                <div class="arcade-stat"><span class="label">GAMES PLAYED</span><span class="value" id="arcade-games-played">0</span></div>
              </div>
            </div>
            
            <div class="arcade-games-grid">
              <!-- Signal Invaders Card -->
              <div class="arcade-game-card" onclick="window.SignalInvaders && SignalInvaders.start()">
                <div class="game-card-preview" id="invaders-preview">
                  <canvas id="invaders-preview-canvas" width="280" height="160"></canvas>
                  <div class="game-card-overlay">
                    <span class="play-icon">▶</span>
                  </div>
                </div>
                <div class="game-card-info">
                  <div class="game-card-title">👾 SIGNAL INVADERS</div>
                  <div class="game-card-desc">Defend the array against hostile market signals. Your fleet ships become the enemy waves!</div>
                  <div class="game-card-controls">
                    <span>← → MOVE</span>
                    <span>SPACE FIRE</span>
                  </div>
                </div>
                <div class="game-card-badge">CLASSIC</div>
              </div>
              
              <!-- Terrain Lander Card -->
              <div class="arcade-game-card" onclick="window.LandingGame && LandingGame.start()">
                <div class="game-card-preview" id="lander-preview">
                  <canvas id="lander-preview-canvas" width="280" height="160"></canvas>
                  <div class="game-card-overlay">
                    <span class="play-icon">▶</span>
                  </div>
                </div>
                <div class="game-card-info">
                  <div class="game-card-title">🚀 TERRAIN LANDER</div>
                  <div class="game-card-desc">Navigate treacherous market terrain and land safely on profit zones. Fuel management is critical.</div>
                  <div class="game-card-controls">
                    <span>← → STEER</span>
                    <span>↑ THRUST</span>
                  </div>
                </div>
                <div class="game-card-badge">LUNAR</div>
              </div>
            </div>
            
            <!-- Ship Selection for Games -->
            <div class="arcade-ship-select">
              <div class="ship-select-header">
                <span class="ship-select-title">🚀 SELECT YOUR SHIP</span>
                <span class="ship-select-hint">Choose your vessel for arcade missions</span>
              </div>
              <div class="ship-select-grid" id="arcade-ship-grid">
                <!-- Ships will be populated dynamically -->
              </div>
            </div>
            
            <!-- Cheat Codes Section -->
            <div class="arcade-secrets">
              <div class="secrets-title">🔐 COMMAND CODES</div>
              <div class="secrets-hint">Type secret codes anywhere to unlock special features...</div>
            </div>
          </div>
        </div>
      </div>
      
      <aside class="right-sidebar">
        <!-- SHIP PROFILE CARD -->
        <div class="sidebar-section">
          <div class="sidebar-title">Ship Profile</div>
          <div class="ship-profile">
            <div class="ship-screen">
              <div class="ship-grid-bg"></div>
              <svg class="ship-svg pixel-ship-glow" viewBox="0 0 120 80" id="sidebar-ship-svg">
                <!-- Pixel ship will be rendered here dynamically -->
              </svg>
              <div class="ship-sweep"></div>
              <div class="ship-pulse-ring"></div>
            </div>
            <div class="ship-caption" id="ship-caption">RKLB · FLAGSHIP</div>
            <div class="ship-vitals">
              <div class="vital"><span class="vital-label">STATUS</span><span class="vital-value" id="ship-status">TRACKING</span></div>
              <div class="vital"><span class="vital-label">SIGNAL</span><span class="vital-value positive" id="ship-signal">STRONG</span></div>
            </div>
          </div>
        </div>

        <div class="kill-switch-section">
          <div class="sidebar-title">Emergency Control</div>
          <button class="kill-switch-btn stop" data-glossary-id="abort_all_trades" onclick="toggleKillSwitch()">ABORT ALL TRADES</button>
          <div class="kill-switch-status">System operational</div>
        </div>
        
        <!-- SNOOP TRAP: Fake Trading Controls -->
        <div class="sidebar-section" style="border-bottom: 1px solid var(--border);">
          <div class="sidebar-title">Quick Actions</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <button class="push-btn dummy-control" data-dummy-action="buy" style="background: rgba(51, 255, 153, 0.1); border-color: var(--phosphor);">BUY</button>
            <button class="push-btn dummy-control" data-dummy-action="sell" style="background: rgba(255, 107, 107, 0.1); border-color: #ff6b6b; color: #ff6b6b;">SELL</button>
          </div>
          <button class="push-btn dummy-control" data-dummy-action="leverage" style="width: 100%; margin-top: 0.5rem;">⚡ 10X LEVERAGE</button>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-title">Risk Parameters</div>
          <div class="safety-list">
            <div class="safety-item"><span class="safety-label">Daily Loss Limit</span><span class="safety-value ok">$200 remaining</span></div>
            <div class="safety-item"><span class="safety-label">Trades Remaining</span><span class="safety-value">2 of 5</span></div>
            <div class="safety-item"><span class="safety-label">Market Status</span><span class="safety-value warning">CLOSED</span></div>
          </div>
        </div>
        <div class="sidebar-section simulation-section">
          <div class="sidebar-title">P&L Simulator</div>
          <div class="sim-form">
            <div class="sim-field">
              <label class="sim-label">Entry Date</label>
              <input type="date" id="sim-entry-date" class="sim-input">
            </div>
            <div class="sim-field">
              <label class="sim-label">Capital ($)</label>
              <input type="number" id="sim-capital" class="sim-input" value="10000" min="100" step="100">
            </div>
            <button class="sim-btn" onclick="runPnLSimulation()">
              <span class="sim-btn-icon">▶</span> RUN SIMULATION
            </button>
            <div class="sim-result" id="sim-result">
              <div class="sim-result-label">Select parameters above</div>
            </div>
          </div>
        </div>
        
        <!-- SNOOP TRAP: Fake Admin Access -->
        <div class="sidebar-section" style="border-bottom: 1px solid var(--border);">
          <div class="sidebar-title" style="color: var(--amber);">⚠ Admin Access</div>
          <button class="push-btn dummy-control" data-dummy-action="admin" style="width: 100%; border-color: var(--amber); color: var(--amber);">
            🔐 MISSION CONTROL LOGIN
          </button>
          <button class="push-btn dummy-control" data-dummy-action="withdraw" style="width: 100%; margin-top: 0.5rem;">
            💰 WITHDRAW FUNDS
          </button>
        </div>
        
        <div class="sidebar-section" style="padding-bottom: 0.5rem;"><div class="sidebar-title">Activity Log</div></div>
        <div class="activity-feed" id="activity-feed"></div>
      </aside>
    </main>
    
    <div class="watermark"><span title="Play money. Real feelings.">SIMULATION MODE</span><a href="https://haslun.ai">← haslun.ai</a></div>
    
    <div class="status-strip">
      <div class="status-item" title="Everything is fine, which is statistically suspicious."><span class="dot green"></span><span class="value">SYSTEM NOMINAL</span></div>
      <div class="status-item" title="Someone, somewhere, is still sending numbers."><span class="dot green"></span><span class="value">UPLINK ACTIVE</span></div>
      <div class="status-item" title="The casino lights are off, but the spreadsheets are still awake."><span class="dot amber"></span><span class="value">MKT CLOSED</span></div>
      <div class="status-item"><span class="value" id="uptime">UPTIME: 00:00:00</span></div>
      
      <!-- SFX toggle -->
      <div class="status-item">
        <span class="value">SFX</span>
        <label class="toggle-mini">
          <input id="sfx-toggle" type="checkbox" checked />
          <span class="toggle-mini-track"><span class="toggle-mini-knob"></span></span>
        </label>
      </div>
      
      <!-- BGM toggle (Epic Mecha Music) -->
      <div class="status-item">
        <span class="value" title="Epic Anime Mecha Music">BGM</span>
        <label class="toggle-mini">
          <input id="bgm-toggle" type="checkbox" />
          <span class="toggle-mini-track"><span class="toggle-mini-knob"></span></span>
        </label>
      </div>
      
      <!-- Theme selector -->
      <div class="status-item">
        <select id="theme-select" class="theme-select">
          <option value="Terminal">Terminal</option>
          <option value="Arcade">Arcade</option>
          <option value="NeonNoir">Neon Noir</option>
        </select>
      </div>
      
      <!-- Color Profile Control -->
      <div class="status-item" style="min-width: 180px;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span class="value" style="font-size: 0.6rem;">HUE</span>
          <input id="color-hue-slider" type="range" min="80" max="220" value="150" style="flex: 1; height: 4px;" />
          <div id="color-hue-preview" style="width: 12px; height: 12px; border-radius: 50%; background: hsl(150, 100%, 60%); border: 1px solid var(--border);"></div>
        </div>
      </div>
    </div>
    
    <!-- ============================================================
         MOBILE BOTTOM NAVIGATION
         ============================================================ -->
    <nav class="mobile-bottom-nav" id="mobile-bottom-nav">
      <div class="mobile-nav-items">
        <button class="mobile-nav-item active" data-tab="chart" onclick="switchTabMobile('chart')">
          <span class="nav-icon">📡</span>
          <span>Telemetry</span>
        </button>
        <button class="mobile-nav-item" data-tab="positions" onclick="switchTabMobile('positions')">
          <span class="nav-icon">🚀</span>
          <span>Holdings</span>
        </button>
        <button class="mobile-nav-item" data-tab="arcade" onclick="switchTabMobile('arcade')">
          <span class="nav-icon">🎮</span>
          <span>Arcade</span>
        </button>
        <button class="mobile-nav-item" data-tab="catalysts" onclick="switchTabMobile('catalysts')">
          <span class="nav-icon">📅</span>
          <span>Events</span>
        </button>
        <button class="mobile-nav-item" onclick="toggleMobileDrawer()">
          <span class="nav-icon">⚙️</span>
          <span>More</span>
        </button>
      </div>
    </nav>
    
    <!-- ============================================================
         MOBILE QUICK STATS BAR
         ============================================================ -->
    <div class="mobile-quick-stats" id="mobile-quick-stats">
      <div class="quick-stats-inner">
        <div class="quick-stat">
          <span class="quick-stat-dot"></span>
          <span class="quick-stat-label">SYS</span>
          <span class="quick-stat-value">NOMINAL</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-label">P&L</span>
          <span class="quick-stat-value positive" id="mobile-pnl-value">+$1,172</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-label">POS</span>
          <span class="quick-stat-value" id="mobile-positions-count">10</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-dot amber"></span>
          <span class="quick-stat-label">MKT</span>
          <span class="quick-stat-value">CLOSED</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-label">⏱</span>
          <span class="quick-stat-value" id="mobile-uptime">00:00</span>
        </div>
      </div>
    </div>
    
    <!-- ============================================================
         MOBILE FLOATING ACTION BUTTON
         ============================================================ -->
    <div class="mobile-fab" id="mobile-fab">
      <div class="fab-menu" id="fab-menu">
        <button class="fab-item" id="fab-sfx" onclick="toggleFabSFX()">
          <span class="fab-icon">🔊</span>
          <span>SFX ON</span>
        </button>
        <button class="fab-item" id="fab-bgm" onclick="toggleFabBGM()">
          <span class="fab-icon">🎵</span>
          <span>BGM OFF</span>
        </button>
        <button class="fab-item" onclick="showAboutOverlay()">
          <span class="fab-icon">❓</span>
          <span>ABOUT</span>
        </button>
      </div>
      <button class="fab-main" id="fab-main" onclick="toggleFabMenu()">
        <span>⚡</span>
      </button>
    </div>
    
    <!-- ============================================================
         PULL TO REFRESH INDICATOR
         ============================================================ -->
    <div class="pull-indicator" id="pull-indicator">
      ↓ PULL TO REFRESH DATA
    </div>
    
    <div class="dev-console" id="dev-console">
      <div class="dev-console-header">
        <span class="dev-console-title">// Restricted Systems Log</span>
        <button class="dev-console-close" onclick="toggleDevConsole()">×</button>
      </div>
      <div class="dev-console-body">
        <div class="log-entry"><span class="timestamp">T-00:03:42</span><span class="level info">[INFO]</span> Quantum entanglement link established with LUNR-SAT-07</div>
        <div class="log-entry"><span class="timestamp">T-00:02:18</span><span class="level info">[INFO]</span> MACD crossover detected: RKLB entering bullish phase</div>
        <div class="log-entry"><span class="timestamp">T-00:01:55</span><span class="level warn">[WARN]</span> Unusual volume spike detected in ASTS pre-market</div>
        <div class="log-entry"><span class="timestamp">T-00:01:12</span><span class="level info">[INFO]</span> Portfolio delta exposure within acceptable parameters</div>
        <div class="log-entry"><span class="timestamp">T-00:00:47</span><span class="level info">[INFO]</span> Neutron telemetry nominal, launch window confirmed</div>
        <div class="log-entry"><span class="timestamp">T-00:00:23</span><span class="level warn">[WARN]</span> Gamma exposure elevated on RKLB position</div>
        <div class="log-entry"><span class="timestamp">T-00:00:00</span><span class="level info">[INFO]</span> Mission Control systems initialized</div>
      </div>
    </div>
    
    <!-- ARCADE HUD – mini mission list -->
    <div id="arcade-hud" class="arcade-hud hidden">
      <div class="hud-title">👾 ARCADE MODE</div>
      <ul id="mission-list"></ul>
      <div style="display: flex; flex-direction: column; gap: 0.4rem; margin-top: 0.5rem;">
        <button class="arcade-launch-btn" onclick="window.SignalInvaders && SignalInvaders.start()">
          👾 SIGNAL INVADERS
        </button>
        <button class="arcade-launch-btn" onclick="window.LandingGame && LandingGame.start()">
          🚀 TERRAIN LANDER
        </button>
        <button class="arcade-launch-btn" onclick="window.AdminConsole && AdminConsole.open()" style="border-color: var(--amber); color: var(--amber);">
          🔐 ADMIN CONSOLE
        </button>
      </div>
    </div>
    
    <!-- Tiny uplink terminal -->
    <div id="terminal-log" class="terminal-log"></div>
    
    <!-- Toast container for pop-up notifications -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- KONAMI CODE EASTER EGG - INVADER ATTACK -->
    <div id="invader-attack-overlay" class="invader-attack-overlay"></div>
    <div id="attack-flash" class="attack-flash"></div>
    
    <!-- ADMIN CONSOLE OVERLAY (Snoop Trap) -->
    <div id="admin-overlay" class="admin-overlay hidden">
      <div class="admin-backdrop"></div>
      <div class="admin-window">
        <div class="admin-frame">
          <button class="admin-close" id="admin-close">✕</button>
          <div class="admin-header">
            <span>// ACCESS NODE</span>
            <span class="admin-title">HASLUN MISSION CONTROL</span>
          </div>
          <div class="admin-screen">
            <div class="admin-line">SECURITY SUBSYSTEM v3.1</div>
            <div class="admin-line">CHANNEL: LOCAL COCKPIT</div>
            <div class="admin-line">MODE: STORY ONLY</div>
            <div class="admin-divider"></div>
            <div class="admin-text" id="admin-text">
              Unauthorized console access attempt detected.<br>
              Please authenticate to continue ruining the narrative.
            </div>
            <div class="admin-login-grid" id="admin-login-grid">
              <label class="admin-label">USER:</label>
              <input id="admin-user" class="admin-input" type="text" placeholder="GUEST">
              <label class="admin-label">PASSCODE:</label>
              <input id="admin-pass" class="admin-input" type="password" placeholder="••••••">
              <button id="admin-submit" class="admin-btn">▶ AUTHENTICATE</button>
            </div>
            <div class="admin-footnote">
              TIP: There is no correct password. This is a museum piece.
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- CHART LANDING GAME -->
    <div id="landing-game-overlay" class="landing-game-overlay">
      <div class="landing-game-container">
        <button class="landing-close" id="landing-close">✕ ESC</button>
        <div class="landing-game-header">
          <div class="landing-game-title">🚀 TERRAIN LANDER</div>
          <div class="landing-game-stats">
            <span>FUEL: <span id="landing-fuel">100</span>%</span>
            <span>VELOCITY: <span id="landing-velocity">0.0</span></span>
            <span>ALT: <span id="landing-alt">100</span></span>
          </div>
        </div>
        <canvas id="landing-canvas"></canvas>
        <div class="landing-controls">
          <span>← → STEER</span>
          <span>↑ THRUST</span>
          <span>ESC EXIT</span>
        </div>
        <div class="landing-touch-controls">
          <button class="landing-touch-btn" id="land-touch-left">◀</button>
          <button class="landing-touch-btn thrust" id="land-touch-thrust">▲ THRUST</button>
          <button class="landing-touch-btn" id="land-touch-right">▶</button>
        </div>
        <div class="landing-message" id="landing-message"></div>
      </div>
    </div>
    
    <!-- SIGNAL INVADERS ARCADE GAME -->
    <div id="signal-invaders-overlay" class="arcade-game-overlay hidden">
      <div class="arcade-game-backdrop"></div>
      <div class="arcade-game-container">
        <button class="arcade-close" id="invaders-close-btn">✕ ESC</button>
        <div class="arcade-header">
          <div class="arcade-title">👾 SIGNAL INVADERS</div>
          <div class="arcade-stats">
            <span class="arcade-score">SCORE: <span id="invaders-score">0</span></span>
            <span class="arcade-lives">LIVES: <span id="invaders-lives">♥♥♥</span></span>
            <span class="arcade-wave">WAVE: <span id="invaders-wave">1</span></span>
          </div>
        </div>
        <canvas id="invaders-canvas" width="600" height="400"></canvas>
        <div class="arcade-controls">
          <span>← → MOVE</span>
          <span>SPACE FIRE</span>
          <span>ESC EXIT</span>
        </div>
        <div class="mobile-touch-controls" id="mobile-controls">
          <button class="touch-btn" id="touch-left">◀</button>
          <button class="touch-btn fire" id="touch-fire">FIRE</button>
          <button class="touch-btn" id="touch-right">▶</button>
        </div>
        <div class="arcade-message" id="invaders-message"></div>
      </div>
    </div>
    
    <!-- ABOUT / STORY OVERLAY -->
    <div id="about-overlay" class="about-overlay hidden">
      <div class="about-backdrop"></div>
      <div class="about-panel">
        <button class="about-close" id="about-close-btn">✕</button>

        <div class="about-header">
          <div class="about-label">SIMULATION DOSSIER</div>
          <h2 class="about-title">What is Haslun-Bot Pilot's Cockpit?</h2>
        </div>

        <div class="about-body">
          <p>
            Haslun-Bot Pilot's Cockpit is a <strong>simulated trading deck</strong> for a fictional research fund.
            It's part data room, part arcade cabinet, and part mood board for how we think about risk,
            storytelling, and markets.
          </p>
          <p>
            All of the panels you see — portfolio status, trend diagnostics, scenario sliders, derivatives console —
            are wired to <strong>sandbox data</strong>. Nothing here is a live brokerage account, and nothing on this
            screen is investment advice. It's closer to a flight simulator than an airplane.
          </p>
          <p>
            The idea is simple:
          </p>
          <ul>
            <li>Treat a portfolio like a <strong>spaceship</strong>: engines, shields, navigation, and unknown signals.</li>
            <li>Let visitors <strong>twist the knobs</strong> — smoothing, volatility, forecast range — and watch telemetry respond.</li>
            <li>Use playful language and retro graphics to make quantitative ideas feel <strong>legible and human</strong>.</li>
          </ul>
          <p>
            You're invited to wander: click into positions, stress-test scenarios, and trigger the mission log. Follow curiosity,
            not performance.
          </p>
          <p>
            In short: this is a <strong>toy control room for serious topics</strong> — a place where corporate structure, 
            creative practice, and market structure overlap on one weird, glowing screen.
          </p>
          <p class="about-footnote">
            Note: All values and scenarios here are for illustrative and educational purposes only, not a recommendation to buy or sell any security.
          </p>
        </div>
      </div>
    </div>

    <!-- PIP-BOY TICKER DOSSIER OVERLAY -->
    <div id="pipboy-overlay" class="pipboy-overlay hidden">
      <div class="pipboy-backdrop"></div>
      <div class="pipboy-container">
        <button class="pipboy-close" id="pipboy-close-btn">✕</button>
        
        <div class="pipboy-header">
          <div class="pipboy-title-block">
            <div class="pipboy-codename" id="pipboy-codename">CODENAME: ELECTRON</div>
            <h2 class="pipboy-ticker-name" id="pipboy-ticker-name">RKLB</h2>
            <div class="pipboy-sector" id="pipboy-sector">Space Launch & Satellites</div>
          </div>
          <div class="pipboy-threat">
            <div class="pipboy-threat-label">VOLATILITY THREAT</div>
            <div class="pipboy-threat-level moderate" id="pipboy-threat">MODERATE</div>
          </div>
        </div>

        <nav class="pipboy-nav">
          <button class="pipboy-dial active" data-panel="overview">◈ OVERVIEW</button>
          <button class="pipboy-dial" data-panel="thesis">◉ THESIS</button>
          <button class="pipboy-dial" data-panel="catalysts">▲ CATALYSTS</button>
          <button class="pipboy-dial" data-panel="risks">⚠ RISKS</button>
          <button class="pipboy-dial" data-panel="vitals">◐ VITALS</button>
        </nav>

        <div class="pipboy-body">
          <!-- OVERVIEW PANEL -->
          <div class="pipboy-panel active" id="panel-overview">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Mission Brief</div>
              <p class="pipboy-text" id="pipboy-summary">Loading...</p>
            </div>
            <div class="pipboy-lore" id="pipboy-lore">
              "Loading tactical assessment..."
            </div>
          </div>

          <!-- THESIS PANEL -->
          <div class="pipboy-panel" id="panel-thesis">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Investment Thesis</div>
              <p class="pipboy-text" id="pipboy-thesis">Loading...</p>
            </div>
          </div>

          <!-- CATALYSTS PANEL -->
          <div class="pipboy-panel" id="panel-catalysts">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Upcoming Catalysts</div>
              <div id="pipboy-catalysts-list">
                <!-- Catalysts inserted here -->
              </div>
            </div>
          </div>

          <!-- RISKS PANEL -->
          <div class="pipboy-panel" id="panel-risks">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Risk Factors</div>
              <div id="pipboy-risks-list">
                <!-- Risks inserted here -->
              </div>
            </div>
          </div>

          <!-- VITALS PANEL -->
          <div class="pipboy-panel" id="panel-vitals">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Company Vitals</div>
              <div class="pipboy-vitals" id="pipboy-vitals-grid">
                <!-- Vitals inserted here -->
              </div>
            </div>
          </div>
        </div>

        <div class="pipboy-stats-bar" id="pipboy-stats-bar">
          <!-- Live stats from current data inserted here -->
        </div>
      </div>
    </div>

    <!-- About trigger button -->
    <button class="about-trigger" id="about-trigger-btn">? ABOUT THIS SIMULATION</button>
  </div>

  <script>
    // Loading screen countdown
    function runCountdown() {
      const countdown = document.getElementById('countdown');
      const status = document.getElementById('loading-status');
      const beam = document.getElementById('pixel-beam');
      const ground = document.getElementById('pixel-ground');
      const loadingScreen = document.getElementById('loading-screen');
      const app = document.getElementById('app');
      const formationShips = document.querySelectorAll('.formation-ship');
      
      let count = 3;
      
      const arcadeMessages = [
        'ESTABLISHING UPLINK...',
        'DEFENSIVE GRID ONLINE...',
        'SIGNAL LOCK ACQUIRED...'
      ];
      
      // Transition formation ships to hover animation after form-up completes
      setTimeout(() => {
        formationShips.forEach(ship => {
          ship.classList.add('formed');
        });
      }, 800); // After form-up animations complete
      
      const interval = setInterval(() => {
        count--;
        if (count > 0) {
          countdown.textContent = count;
          status.textContent = arcadeMessages[3 - count - 1] || 'INITIALIZING...';
        } else if (count === 0) {
          countdown.textContent = 'GO';
          countdown.classList.add('go');
          if (beam) beam.classList.add('active');
          if (ground) ground.classList.add('active');
          status.textContent = 'READY — PRESS ANY KEY';
        } else {
          clearInterval(interval);
          loadingScreen.classList.add('hidden');
          app.classList.add('visible');
          init();
        }
      }, 1000);
    }
    
    // Start countdown on load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(runCountdown, 500);
    });
    
    let currentTicker = 'RKLB', currentTimeframe = '1D', currentRange = '3M', showMA = true;
    let priceChart = null, macdChart = null, tickerData = {}, statsData = {};
    
    const tickerColors = {
      'RKLB': '#33ff99', 'LUNR': '#47d4ff', 'ASTS': '#ffb347', 'ACHR': '#ff6b9d',
      'JOBY': '#b388ff', 'GME': '#ff6b6b', 'BKSY': '#47d4ff', 'RDW': '#33ff99',
      'PL': '#b388ff', 'EVEX': '#ff6b9d', 'MP': '#ffb347', 'KTOS': '#47d4ff',
      'IRDM': '#33ff99', 'HON': '#b388ff', 'ATI': '#ffb347', 'CACI': '#47d4ff', 'LOAR': '#ff6b9d',
      'COHR': '#47d4ff', 'GE': '#ff6b6b', 'LHX': '#33ff99', 'RTX': '#ff6b6b'
    };
    
    const tickerThemes = {
      'RKLB': 'SPACE', 'LUNR': 'SPACE', 'ASTS': 'SPACE', 'BKSY': 'SPACE',
      'RDW': 'SPACE', 'PL': 'SPACE', 'IRDM': 'SPACE', 'KTOS': 'DEFENSE',
      'ACHR': 'eVTOL', 'JOBY': 'eVTOL', 'EVEX': 'eVTOL', 'GME': 'MEME',
      'MP': 'MATERIALS', 'HON': 'INDUSTRIAL', 'ATI': 'MATERIALS',
      'CACI': 'DEFENSE', 'LOAR': 'AEROSPACE',
      'COHR': 'OPTICS', 'GE': 'INDUSTRIAL', 'LHX': 'DEFENSE', 'RTX': 'DEFENSE'
    };
    
    const rangeDays = { '1W': 7, '1M': 30, '3M': 90, '6M': 180, '1Y': 365, 'ALL': 9999 };
    
    // =========================================================================
    // TICKER PROFILES — Pip-Boy style dossiers for each position
    // =========================================================================
    const TICKER_PROFILES = {
      RKLB: {
        name: "Rocket Lab USA",
        codename: "ELECTRON",
        sector: "Space Launch & Satellites",
        threat_level: "MODERATE",
        summary: "Small-launch pioneer now building medium-lift Neutron rocket. Vertically integrated: they make the rocket, the satellite bus, and increasingly the payload itself.",
        thesis: "Rocket Lab is betting that owning the entire stack — from launch to spacecraft to ground systems — creates compounding margin advantages as the space economy scales.",
        catalysts: [
          { date: "Q1 2026", event: "Neutron First Flight", impact: "HIGH" },
          { date: "Ongoing", event: "Electron Launch Cadence", impact: "MEDIUM" },
          { date: "2026", event: "Space Systems Revenue Growth", impact: "HIGH" }
        ],
        risks: [
          "Neutron development delays or cost overruns",
          "SpaceX pricing pressure on rideshare market",
          "Customer concentration in government contracts"
        ],
        vitals: {
          founded: 2006,
          hq: "Long Beach, CA",
          employees: "~1,800",
          launches: "50+"
        },
        lore: "In the orbital logistics game, Electron is the reliable shuttle bus — small, frequent, precise. Neutron is the freight train they're building next. If it works, they'll own both lanes of the highway to space."
      },
      LUNR: {
        name: "Intuitive Machines",
        codename: "MOONSHOT",
        sector: "Lunar Services",
        threat_level: "HIGH",
        summary: "Commercial lunar lander company. First private US company to soft-land on the Moon (IM-1, Feb 2024). NASA CLPS contractor building recurring lunar delivery business.",
        thesis: "The Moon is becoming infrastructure. Intuitive Machines is positioning as the FedEx of cislunar space — delivering payloads, building navigation networks, and eventually operating surface systems.",
        catalysts: [
          { date: "Feb 2026", event: "IM-2 Lunar Landing", impact: "HIGH" },
          { date: "2026", event: "Lunar Data Network Contracts", impact: "MEDIUM" },
          { date: "2027", event: "IM-3 Mission", impact: "HIGH" }
        ],
        risks: [
          "Mission failure risk (space is hard)",
          "NASA budget dependency",
          "Long timeline to profitability"
        ],
        vitals: {
          founded: 2013,
          hq: "Houston, TX",
          employees: "~500",
          landings: "1 (IM-1)"
        },
        lore: "They tipped over on landing and still counted it as a win. That's not copium — that's the reality of lunar exploration. Every data point is gold. They're learning faster than anyone else in the West."
      },
      ASTS: {
        name: "AST SpaceMobile",
        codename: "BLUEBIRD",
        sector: "Space-Based Cellular",
        threat_level: "EXTREME",
        summary: "Building the first space-based cellular broadband network. Giant satellites (64m² arrays) connect directly to unmodified smartphones. If it works, it's the biggest addressable market in telecom history.",
        thesis: "5 billion people have phones. 90% of Earth has no cellular coverage. AST is building orbital cell towers to close that gap — no new hardware required on the ground.",
        catalysts: [
          { date: "Q1 2026", event: "Commercial Service Launch", impact: "HIGH" },
          { date: "2026", event: "Block 2 Satellite Deployment", impact: "HIGH" },
          { date: "Ongoing", event: "MNO Partnership Expansion", impact: "MEDIUM" }
        ],
        risks: [
          "Unproven technology at scale",
          "Regulatory complexity across jurisdictions",
          "Capital-intensive deployment phase",
          "Competition from Starlink Direct-to-Cell"
        ],
        vitals: {
          founded: 2017,
          hq: "Midland, TX",
          employees: "~500",
          satellites: "5 (BlueBird test constellation)"
        },
        lore: "The satellites are the size of basketball courts. The engineering is borderline absurd. But if they pull it off, every phone on Earth becomes a satellite phone. That's not a product — that's a paradigm shift."
      },
      ACHR: {
        name: "Archer Aviation",
        codename: "MIDNIGHT",
        sector: "eVTOL / Urban Air Mobility",
        threat_level: "MODERATE",
        summary: "Electric vertical takeoff and landing aircraft for urban air taxi service. Partnership with United Airlines. Manufacturing facility in Georgia.",
        thesis: "Traffic is broken. Archer is betting that electric flight becomes cheap and quiet enough to create a new transportation layer above cities.",
        catalysts: [
          { date: "Q1 2026", event: "FAA Type Certification", impact: "HIGH" },
          { date: "2026", event: "Commercial Launch (UAE)", impact: "HIGH" },
          { date: "2027", event: "US Commercial Operations", impact: "HIGH" }
        ],
        risks: [
          "FAA certification timeline uncertainty",
          "Battery energy density limitations",
          "Infrastructure buildout costs",
          "Public acceptance of urban air traffic"
        ],
        vitals: {
          founded: 2018,
          hq: "San Jose, CA",
          employees: "~900",
          aircraft: "Midnight (4+1 passenger)"
        },
        lore: "The Jetsons promised us flying cars. Archer is delivering electric helicopters that don't sound like helicopters. Close enough."
      },
      JOBY: {
        name: "Joby Aviation",
        codename: "S4",
        sector: "eVTOL / Urban Air Mobility",
        threat_level: "MODERATE",
        summary: "Furthest along in eVTOL certification. Toyota-backed. Building manufacturing at scale. Air taxi service planned for 2025.",
        thesis: "First mover advantage in a winner-take-most market. Joby has more flight hours, more capital, and more regulatory progress than any competitor.",
        catalysts: [
          { date: "2025-2026", event: "FAA Type Certification", impact: "HIGH" },
          { date: "2025", event: "Initial Commercial Ops (Dubai)", impact: "HIGH" },
          { date: "2026", event: "US Market Launch", impact: "HIGH" }
        ],
        risks: [
          "Certification delays",
          "High cash burn pre-revenue",
          "Competitive pressure from Archer, Lilium",
          "Noise and safety perception issues"
        ],
        vitals: {
          founded: 2009,
          hq: "Santa Cruz, CA",
          employees: "~1,500",
          aircraft: "S4 (4+1 passenger)"
        },
        lore: "They've been at this longer than anyone. The Toyota money helps. But the real moat is the million+ miles of flight test data. That's not something you can buy."
      },
      GME: {
        name: "GameStop Corp",
        codename: "DIAMOND HANDS",
        sector: "Retail / Meme",
        threat_level: "CHAOTIC",
        summary: "Video game retailer turned meme stock phenomenon. Now pivoting toward... something. Cash-rich balance sheet. Ryan Cohen steering the ship into uncharted waters.",
        thesis: "This isn't a thesis. This is volatility exposure with a side of cultural commentary. The balance sheet is real; the business model is TBD.",
        catalysts: [
          { date: "Ongoing", event: "Social Media Sentiment Spikes", impact: "HIGH" },
          { date: "Unknown", event: "Strategic Pivot Announcements", impact: "MEDIUM" },
          { date: "Quarterly", event: "Earnings Surprises", impact: "MEDIUM" }
        ],
        risks: [
          "Fundamental business decline in physical games",
          "Meme momentum can reverse violently",
          "No clear path to sustainable growth",
          "Regulatory scrutiny on retail trading"
        ],
        vitals: {
          founded: 1984,
          hq: "Grapevine, TX",
          employees: "~8,000",
          stores: "~4,000"
        },
        lore: "The stock that broke the internet in 2021. Whether it's a movement, a trade, or a cautionary tale depends on your entry price and your exit strategy. We hold it because the volatility is useful. Not financial advice."
      },
      BKSY: {
        name: "BlackSky Technology",
        codename: "SPECTRA",
        sector: "Geospatial Intelligence",
        threat_level: "LOW",
        summary: "Real-time Earth observation satellite constellation. AI-powered analytics platform. Defense and intelligence community customers.",
        thesis: "Imagery is becoming a utility. BlackSky is building the always-on, AI-analyzed feed of what's happening on Earth — updated hourly, not daily.",
        catalysts: [
          { date: "Ongoing", event: "Constellation Expansion", impact: "MEDIUM" },
          { date: "2026", event: "Gen-3 Satellite Deployment", impact: "MEDIUM" },
          { date: "Ongoing", event: "Government Contract Wins", impact: "MEDIUM" }
        ],
        risks: [
          "Competition from Planet, Maxar",
          "Government budget cycles",
          "Small constellation limits revisit rates"
        ],
        vitals: {
          founded: 2014,
          hq: "Herndon, VA",
          employees: "~350",
          satellites: "18"
        },
        lore: "They photograph the same spot on Earth multiple times per day. The value isn't in any single image — it's in the delta. What changed? When? That's intelligence."
      },
      RDW: {
        name: "Redwire Corporation",
        codename: "FORGE",
        sector: "Space Infrastructure",
        threat_level: "LOW",
        summary: "Space infrastructure company. On-orbit manufacturing, solar arrays, sensors. Rolls up smaller space tech companies. Supplies components across the industry.",
        thesis: "Every satellite needs stuff — solar panels, antennas, sensors, structures. Redwire is the Home Depot of space hardware.",
        catalysts: [
          { date: "Ongoing", event: "M&A Integration", impact: "MEDIUM" },
          { date: "2026", event: "In-Space Manufacturing Demos", impact: "MEDIUM" },
          { date: "Ongoing", event: "NASA/DoD Contracts", impact: "MEDIUM" }
        ],
        risks: [
          "Integration risk from acquisitions",
          "Customer concentration",
          "Supply chain dependencies"
        ],
        vitals: {
          founded: 2020,
          hq: "Jacksonville, FL",
          employees: "~700",
          facilities: "20+"
        },
        lore: "While everyone argues about who gets to launch the rockets, Redwire quietly sells picks and shovels to all of them. Boring but effective."
      },
      PL: {
        name: "Planet Labs",
        codename: "DOVE",
        sector: "Earth Observation",
        threat_level: "LOW",
        summary: "Largest Earth observation satellite constellation. Daily imaging of the entire planet. Commercial, government, and NGO customers.",
        thesis: "A daily photo of every spot on Earth creates unprecedented visibility into human activity. Agriculture, supply chains, climate — it's all visible from orbit.",
        catalysts: [
          { date: "Ongoing", event: "Data Services Revenue Growth", impact: "MEDIUM" },
          { date: "2026", event: "Pelican Constellation Launch", impact: "MEDIUM" },
          { date: "Ongoing", event: "Government Contract Expansion", impact: "MEDIUM" }
        ],
        risks: [
          "Path to profitability unclear",
          "Competition from free/low-cost imagery",
          "Data commoditization pressure"
        ],
        vitals: {
          founded: 2010,
          hq: "San Francisco, CA",
          employees: "~800",
          satellites: "200+"
        },
        lore: "They image the entire Earth every single day. Every field, every port, every construction site. The value is in what you can see changing over time."
      },
      EVEX: {
        name: "Eve Holding",
        codename: "VECTOR",
        sector: "eVTOL / Urban Air Mobility",
        threat_level: "MODERATE",
        summary: "Embraer-backed eVTOL company. Leveraging decades of aerospace manufacturing experience. Urban air mobility focus with global ambitions.",
        thesis: "Embraer knows how to build and certify aircraft at scale. Eve inherits that DNA for the electric age.",
        catalysts: [
          { date: "2026", event: "Prototype Flight Testing", impact: "MEDIUM" },
          { date: "2027", event: "Certification Progress", impact: "HIGH" },
          { date: "Ongoing", event: "Pre-order Conversions", impact: "MEDIUM" }
        ],
        risks: [
          "Later to market than Joby/Archer",
          "Brazil HQ complicates US certification",
          "Competitive pressure in crowded market"
        ],
        vitals: {
          founded: 2020,
          hq: "Melbourne, FL / São Paulo",
          employees: "~600",
          aircraft: "eVTOL (4+1 passenger)"
        },
        lore: "The Embraer connection is the whole story. These are the people who built the E-Jets. They know certification, they know manufacturing, they know airlines."
      },
      KTOS: {
        name: "Kratos Defense",
        codename: "VALKYRIE",
        sector: "Defense Technology",
        threat_level: "LOW",
        summary: "Unmanned systems and hypersonic tech. Affordable attritable drones for the DoD. Satellite ground systems. The affordable end of the defense contractor spectrum.",
        thesis: "Future warfare is drone warfare. Kratos builds the cheap, expendable, AI-piloted aircraft that will fly alongside manned fighters.",
        catalysts: [
          { date: "Ongoing", event: "CCA Program Contracts", impact: "HIGH" },
          { date: "2026", event: "Hypersonic Testing", impact: "MEDIUM" },
          { date: "Ongoing", event: "DoD Budget Allocations", impact: "MEDIUM" }
        ],
        risks: [
          "Defense budget politics",
          "Program cancellation risk",
          "Competition from larger primes"
        ],
        vitals: {
          founded: 1994,
          hq: "Colorado Springs, CO",
          employees: "~3,500",
          focus: "Drones, Missiles, Space"
        },
        lore: "While Lockheed builds the $100M jets, Kratos builds the $2M wingmen. In an era of attrition warfare, cheap and many beats expensive and few."
      },
      IRDM: {
        name: "Iridium Communications",
        codename: "CONSTELLATION",
        sector: "Satellite Communications",
        threat_level: "LOW",
        summary: "Global satellite phone and IoT network. 66-satellite constellation provides pole-to-pole coverage. Government, maritime, aviation customers.",
        thesis: "The original satellite phone network, now focused on IoT and specialty markets where Starlink can't compete on coverage or reliability.",
        catalysts: [
          { date: "Ongoing", event: "IoT Revenue Growth", impact: "MEDIUM" },
          { date: "Ongoing", event: "Government Contract Renewals", impact: "MEDIUM" },
          { date: "Long-term", event: "Next-Gen Constellation Planning", impact: "LOW" }
        ],
        risks: [
          "Technology disruption from LEO constellations",
          "Limited growth runway",
          "Commodity pricing pressure"
        ],
        vitals: {
          founded: 2000,
          hq: "McLean, VA",
          employees: "~600",
          satellites: "66 active"
        },
        lore: "They went bankrupt once and came back. The constellation is paid for. The cash flows. It's not sexy, but it's the only network that works everywhere on Earth."
      },
      MP: {
        name: "MP Materials",
        codename: "RARE EARTH",
        sector: "Critical Minerals",
        threat_level: "LOW",
        summary: "Largest rare earth mining and processing company in the Western Hemisphere. Mountain Pass mine in California. Essential materials for EVs, wind turbines, defense systems.",
        thesis: "China controls 60%+ of rare earth processing. MP is the US answer to that dependency. National security meets clean energy transition.",
        catalysts: [
          { date: "Ongoing", event: "Magnetics Facility Ramp", impact: "HIGH" },
          { date: "2026", event: "Downstream Processing Expansion", impact: "MEDIUM" },
          { date: "Ongoing", event: "Auto OEM Supply Deals", impact: "MEDIUM" }
        ],
        risks: [
          "Commodity price volatility",
          "China supply chain disruption",
          "Environmental/permitting challenges"
        ],
        vitals: {
          founded: 2017,
          hq: "Las Vegas, NV",
          employees: "~800",
          facility: "Mountain Pass Mine"
        },
        lore: "Every EV motor, every wind turbine, every F-35 needs rare earths. China has the market cornered. MP is the insurance policy."
      },
      HON: {
        name: "Honeywell International",
        codename: "INDUSTRIAL",
        sector: "Aerospace & Industrial",
        threat_level: "LOW",
        summary: "Diversified industrial conglomerate. Aerospace systems, building technologies, performance materials. The boring backbone of global infrastructure.",
        thesis: "When everyone else is chasing moonshots, sometimes you want the company that makes the avionics, the thermostats, and the jet engines.",
        catalysts: [
          { date: "Ongoing", event: "Aerospace Aftermarket Growth", impact: "MEDIUM" },
          { date: "Ongoing", event: "Energy Transition Products", impact: "MEDIUM" },
          { date: "Quarterly", event: "Earnings & Guidance", impact: "LOW" }
        ],
        risks: [
          "Industrial cyclicality",
          "Conglomerate discount",
          "Spin-off execution risk"
        ],
        vitals: {
          founded: 1906,
          hq: "Charlotte, NC",
          employees: "~95,000",
          segments: "Aerospace, Building Tech, PMT, SPS"
        },
        lore: "Not every position needs to be a moonshot. Sometimes you hold the company that makes parts for everyone else's moonshots."
      },
      ATI: {
        name: "ATI Inc",
        codename: "ALLOY",
        sector: "Specialty Materials",
        threat_level: "LOW",
        summary: "Specialty materials company. Titanium, nickel alloys, specialty steels. Aerospace, defense, energy markets. When you need metal that doesn't melt, bend, or corrode.",
        thesis: "Next-gen aircraft and turbines require exotic alloys. ATI is one of the few Western suppliers who can make them at scale.",
        catalysts: [
          { date: "Ongoing", event: "Aerospace Production Ramp", impact: "MEDIUM" },
          { date: "Ongoing", event: "Defense Spending Tailwinds", impact: "MEDIUM" },
          { date: "Ongoing", event: "Titanium Supply Constraints", impact: "LOW" }
        ],
        risks: [
          "Aerospace cycle sensitivity",
          "Raw material cost volatility",
          "Labor and energy costs"
        ],
        vitals: {
          founded: 1996,
          hq: "Dallas, TX",
          employees: "~6,000",
          materials: "Titanium, Nickel, Steel"
        },
        lore: "The materials science behind every jet engine. Unglamorous, essential, and very hard to replicate."
      },
      CACI: {
        name: "CACI International",
        codename: "INTEL",
        sector: "Defense & Intelligence",
        threat_level: "LOW",
        summary: "Defense and intelligence IT services. Cybersecurity, signals intelligence, mission support. The quiet contractor that does the classified work.",
        thesis: "Government never stops needing IT and intelligence services. CACI has the clearances and the contracts.",
        catalysts: [
          { date: "Ongoing", event: "Contract Wins", impact: "MEDIUM" },
          { date: "Ongoing", event: "M&A Activity", impact: "MEDIUM" },
          { date: "Ongoing", event: "Defense Budget Stability", impact: "LOW" }
        ],
        risks: [
          "Contract recompete risk",
          "Clearance/talent constraints",
          "Budget uncertainty"
        ],
        vitals: {
          founded: 1962,
          hq: "Reston, VA",
          employees: "~23,000",
          clearances: "High"
        },
        lore: "When you need something done in the classified world, CACI picks up the phone. Boring to everyone except the people who need them."
      },
      LOAR: {
        name: "Loar Holdings",
        codename: "COMPONENT",
        sector: "Aerospace Components",
        threat_level: "LOW",
        summary: "Aerospace and defense component manufacturer. Actuators, valves, and precision systems. The small parts that make the big machines work.",
        thesis: "Aerospace OEMs are ramping production. Every aircraft needs thousands of precision components. Loar makes them.",
        catalysts: [
          { date: "Ongoing", event: "Aircraft Production Ramp", impact: "MEDIUM" },
          { date: "Ongoing", event: "Aftermarket Growth", impact: "MEDIUM" },
          { date: "Ongoing", event: "M&A Integration", impact: "LOW" }
        ],
        risks: [
          "Customer concentration",
          "Supply chain disruptions",
          "Integration execution"
        ],
        vitals: {
          founded: 2012,
          hq: "White Plains, NY",
          employees: "~2,500",
          products: "Aerospace Components"
        },
        lore: "Another picks-and-shovels play. While everyone argues about which plane is best, Loar sells parts to all of them."
      }
    };
    
    // =========================================================================
    // HASLUN GLOSSARY — Tooltips, flavor text, and lore system
    // =========================================================================
    const HASLUN_GLOSSARY = {
      // ---------- CORE PORTFOLIO METRICS ----------
      today_pnl: {
        label: "Today's P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Profit or loss generated since the start of the current trading day.",
        flavor: "How much the market liked you today, before feelings reset at the open."
      },
      total_pnl: {
        label: "Total P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Cumulative profit or loss for this simulation since inception.",
        flavor: "Lifetime score since the moment you pressed START on this universe."
      },
      positions_count: {
        label: "Positions",
        category: "metric",
        tooltip: "Number of tickers currently held in the portfolio.",
        flavor: "How many plates you're spinning in zero gravity."
      },
      win_rate: {
        label: "Win Rate",
        category: "metric",
        unit: "%",
        tooltip: "Percentage of closed trades that ended with positive P&L.",
        flavor: "Hit rate. Accuracy stat. Bragging-rights fuel."
      },
      portfolio_value: {
        label: "Portfolio Value",
        category: "metric",
        unit: "USD",
        tooltip: "Current market value of all open positions plus cash.",
        flavor: "What your empire is worth if you slammed the SELL ALL button."
      },
      total_delta: {
        label: "Total Delta",
        category: "metric",
        tooltip: "Sensitivity of the options book to a $1 move in the underlying basket.",
        flavor: "How violently the cockpit shakes when prices nudge."
      },
      days_to_expiry: {
        label: "Days to Expiry",
        category: "metric",
        tooltip: "Time remaining until the primary options cycle expires.",
        flavor: "How long until the clock runs out on this particular boss fight."
      },
      
      // ---------- MACD & MOMENTUM ----------
      macd: {
        label: "MACD",
        category: "metric",
        tooltip: "Moving Average Convergence Divergence: fast EMA minus slow EMA of price.",
        flavor: "Momentum gauge. Shows when rockets are over-fuelled or stalling out."
      },
      macd_signal: {
        label: "Signal",
        category: "metric",
        tooltip: "EMA of the MACD line. Crossovers often signal trend shifts.",
        flavor: "The grown-up in the room telling MACD to calm down (or speed up)."
      },
      macd_histogram: {
        label: "Histogram",
        category: "metric",
        tooltip: "MACD minus Signal. Bars above/below zero show relative momentum.",
        flavor: "The heartbeat monitor for trend strength. Flatline not recommended."
      },
      
      // ---------- TREND STATUS STATES ----------
      trend_analyzing: {
        label: "ANALYZING…",
        category: "state",
        icon: "◌",
        color: "var(--text-muted)",
        tooltip: "System is ingesting data and calculating trend classification.",
        flavor: "Coffee being poured into the machine. Please stand by.",
        subtitle: "Awaiting data…",
        body: "Scanning telemetry feed for recognizable patterns."
      },
      trend_full_thrust: {
        label: "FULL THRUST",
        category: "state",
        icon: "▲",
        color: "var(--phosphor)",
        tooltip: "Price above long-term averages with bullish momentum.",
        flavor: "Engines lit, nose up, telemetry green. Strap in.",
        subtitle: "All systems green.",
        body: "Price above 200-day line with positive momentum. Trend uptrend confirmed until proven otherwise."
      },
      trend_reversal_attempt: {
        label: "REVERSAL ATTEMPT",
        category: "state",
        icon: "◈",
        color: "var(--amber)",
        tooltip: "Price recovering above short/mid MAs but below long-term baseline.",
        flavor: "Ship has stopped crashing. Jury still out on actual flying.",
        subtitle: "Course correction underway.",
        body: "Price has climbed back above the short-term baseline but hasn't cleared the long-term ceiling. Reversal in progress; turbulence expected."
      },
      trend_drifting: {
        label: "DRIFTING",
        category: "state",
        icon: "◇",
        color: "#47d4ff",
        tooltip: "Price oscillating around key averages with weak directional bias.",
        flavor: "Coasting in orbit. Safe, but nothing cinematic.",
        subtitle: "Stable orbit.",
        body: "Price hugging moving averages with low momentum. No clear directional bias; good time for coffee or long emails."
      },
      trend_reentry_risk: {
        label: "REENTRY RISK",
        category: "state",
        icon: "▼",
        color: "#ff6b6b",
        tooltip: "Price below major moving averages with bearish momentum.",
        flavor: "Heat shield glowing. Consider which side of the planet you want to land on.",
        subtitle: "Altitude loss detected.",
        body: "Price below long-term trend with negative momentum. Downside pressure present; check heat shield and position sizing."
      },
      trend_nebula: {
        label: "NEBULOUS",
        category: "state",
        icon: "※",
        color: "#b388ff",
        tooltip: "High volatility and conflicting signals; no clear trend.",
        flavor: "In a cosmic dust cloud. Instruments insist everything is 'fine'.",
        subtitle: "Signal degraded.",
        body: "Choppy, sideways, mean-reverting mess. Indicators argue with each other; system recommends humility."
      },
      
      // ---------- SIGNAL PROCESSING ARRAY ----------
      sig_smoothing: {
        label: "Signal Smoothing",
        category: "control",
        tooltip: "Adjusts how much short-term noise is filtered from price and MACD.",
        flavor: "Turn right to make charts look wise and slow. Turn left for chaos TV."
      },
      sig_forecast_range: {
        label: "Forecast Range",
        category: "control",
        tooltip: "How far into the future the simulation projects price paths.",
        flavor: "How many days ahead you want to pretend you can see."
      },
      sig_risk_exposure: {
        label: "Risk Exposure",
        category: "control",
        tooltip: "Scenario profile from defensive to aggressive. Scales drift and leverage in simulations.",
        flavor: "How spicy you want the universe to feel right now."
      },
      sig_vol_index: {
        label: "Volatility Index",
        category: "metric",
        tooltip: "Synthetic volatility score derived from recent price swings.",
        flavor: "How much the market is wiggling while you try to act composed."
      },
      sig_display_momentum: {
        label: "Momentum Overlay",
        category: "control",
        tooltip: "Toggle MACD / trend overlays on the main chart.",
        flavor: "Draws the invisible wind the rockets are flying through."
      },
      sig_display_heatmap: {
        label: "Volume Heatmap",
        category: "control",
        tooltip: "Show volume intensity as background shading on the chart.",
        flavor: "Where the crowd actually showed up versus where they just talked big."
      },
      sig_display_alerts: {
        label: "Alert Markers",
        category: "control",
        tooltip: "Display crossover events and custom triggers as icons on the chart.",
        flavor: "Little neon post-its on the timeline saying 'something weird happened here'."
      },
      sig_alert_sensitivity: {
        label: "Alert Sensitivity",
        category: "control",
        tooltip: "Controls how easily the system raises visual alerts.",
        flavor: "Slide right to let the system panic for you. Slide left if you enjoy surprises."
      },
      sig_market_scanner: {
        label: "Market Scanner",
        category: "metric",
        tooltip: "Compressed view of recent signals across the watchlist.",
        flavor: "Radar sweep. Blips mean 'look here', not 'buy here'. Probably."
      },
      
      // ---------- CORE PORTFOLIO METRICS ----------
      today_pnl: {
        label: "Today's P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Profit or loss generated since the start of the current trading day.",
        flavor: "How much the market liked you today, before feelings reset at the open."
      },
      total_pnl: {
        label: "Total P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Cumulative profit or loss for this simulation since inception.",
        flavor: "Lifetime score since the moment you pressed START on this universe."
      },
      positions_count: {
        label: "Positions",
        category: "metric",
        tooltip: "Number of tickers currently held in the portfolio.",
        flavor: "How many plates you're spinning in zero gravity."
      },
      win_rate: {
        label: "Win Rate",
        category: "metric",
        unit: "%",
        tooltip: "Percentage of closed trades that ended with positive P&L.",
        flavor: "Hit rate. Accuracy stat. Bragging-rights fuel."
      },
      portfolio_value: {
        label: "Portfolio Value",
        category: "metric",
        unit: "USD",
        tooltip: "Current market value of all open positions plus cash.",
        flavor: "What your empire is worth if you slammed the SELL ALL button."
      },
      total_delta: {
        label: "Total Delta",
        category: "metric",
        tooltip: "Sensitivity of the options book to a $1 move in the underlying basket.",
        flavor: "How violently the cockpit shakes when prices nudge."
      },
      days_to_expiry: {
        label: "Days to Expiry",
        category: "metric",
        tooltip: "Time remaining until the primary options cycle expires.",
        flavor: "How long until the clock runs out on this particular boss fight."
      },
      
      // ---------- MACD & MOMENTUM ----------
      macd: {
        label: "MACD",
        category: "metric",
        tooltip: "Moving Average Convergence Divergence: fast EMA minus slow EMA of price.",
        flavor: "Momentum gauge. Shows when rockets are over-fuelled or stalling out."
      },
      macd_signal: {
        label: "Signal",
        category: "metric",
        tooltip: "EMA of the MACD line. Crossovers often signal trend shifts.",
        flavor: "The grown-up in the room telling MACD to calm down (or speed up)."
      },
      macd_histogram: {
        label: "Histogram",
        category: "metric",
        tooltip: "MACD minus Signal. Bars above/below zero show relative momentum.",
        flavor: "The heartbeat monitor for trend strength. Flatline not recommended."
      },
      
      // ---------- DERIVATIVES / OPTIONS ----------
      strat_naked_leap: {
        label: "Naked LEAP",
        category: "strategy",
        tooltip: "Long-dated call with no offsetting hedge.",
        flavor: "Maximum optimism. Minimum adult supervision."
      },
      strat_bull_spread: {
        label: "Bull Spread",
        category: "strategy",
        tooltip: "Call spread benefitting from moderate price appreciation.",
        flavor: "Not trying to reach Mars. Just happy to clear the atmosphere."
      },
      strat_bear_spread: {
        label: "Bear Spread",
        category: "strategy",
        tooltip: "Put or call spread positioned for a controlled downside move.",
        flavor: "You don't need a crash, just a dignified stumble."
      },
      derivatives_tab: {
        label: "Derivatives",
        category: "navigation",
        tooltip: "Options and structured positions with defined risk profiles.",
        flavor: "Levers, pulleys, and very opinionated probability curves."
      },
      greek_delta: {
        label: "Delta",
        category: "metric",
        tooltip: "First derivative of option price with respect to underlying price.",
        flavor: "How loudly this option screams when the stock twitches."
      },
      greek_theta: {
        label: "Theta",
        category: "metric",
        tooltip: "Daily time decay of the option's value.",
        flavor: "Rent you pay for living in the future."
      },
      greek_gamma: {
        label: "Gamma",
        category: "metric",
        tooltip: "Rate of change of delta as the underlying moves.",
        flavor: "How quickly a calm trade turns dramatic when price gets ideas."
      },
      greek_vega: {
        label: "Vega",
        category: "metric",
        tooltip: "Sensitivity of option price to changes in volatility.",
        flavor: "Mood swing multiplier. When volatility sulks, these feel it first."
      },
      
      // ---------- GLOBAL STATES ----------
      mode_simulation: {
        label: "Simulation Mode",
        category: "state",
        tooltip: "All data and trades are running in sandbox mode.",
        flavor: "Play money. Real feelings."
      },
      status_uplink_active: {
        label: "Uplink Active",
        category: "state",
        tooltip: "Connection to data stream is healthy.",
        flavor: "Someone, somewhere, is still sending numbers."
      },
      status_system_nominal: {
        label: "System Nominal",
        category: "state",
        tooltip: "No major errors or warnings detected.",
        flavor: "Everything is fine, which is statistically suspicious."
      },
      status_mkt_closed: {
        label: "Market Closed",
        category: "state",
        tooltip: "Exchange session has ended; prices are static.",
        flavor: "The casino lights are off, but the spreadsheets are still awake."
      },
      abort_all_trades: {
        label: "Abort All Trades",
        category: "control",
        tooltip: "Emergency liquidation of all open positions.",
        flavor: "Emergency exit. Does not apply to your feelings."
      }
    };
    
    // Portfolio mood states based on daily P&L percentage
    const PORTFOLIO_MOODS = {
      thruster_boost: { threshold: 2, label: "THRUSTER BOOST", color: "var(--phosphor)", copy: "Portfolio making energetic upward noises." },
      steady_climb: { threshold: 0, label: "STEADY CLIMB", color: "var(--phosphor-dim)", copy: "Green enough to feel smug, not enough to tweet about." },
      minor_turbulence: { threshold: -1, label: "MINOR TURBULENCE", color: "var(--amber)", copy: "Seatbelts on, beverage carts still operational." },
      hull_rattle: { threshold: -999, label: "HULL RATTLE", color: "#ff6b6b", copy: "Today's lesson: gravity always wins eventually." }
    };
    
    // MACD status messages
    const MACD_STATES = {
      bullish_cross: { label: "Bullish crossover", copy: "Engines pushing above baseline." },
      bearish_cross: { label: "Bearish crossover", copy: "Thrust vector pointing down." },
      weak_signal: { label: "Momentum quiet", copy: "Coasting on inertia." },
      divergence: { label: "Divergence watch", copy: "Price and momentum disagree." }
    };
    
    // Glossary helper functions
    function getGlossary(id) {
      return HASLUN_GLOSSARY[id] || null;
    }
    
    function getTooltip(id) {
      const entry = HASLUN_GLOSSARY[id];
      return entry ? entry.tooltip : '';
    }
    
    function getFlavor(id) {
      const entry = HASLUN_GLOSSARY[id];
      return entry ? entry.flavor : '';
    }
    
    // Get trend state based on price, MACD data, and volatility
    function getTrendState(price, ma100, ma150, ma200, macdVal, volScore) {
      if (!price || !ma200) return HASLUN_GLOSSARY.trend_analyzing;
      
      const aboveMa100 = price > ma100;
      const aboveMa150 = price > ma150;
      const aboveMa200 = price > ma200;
      const macdPositive = macdVal > 0;
      const nearMa100 = Math.abs(price - ma100) / price < 0.015;
      const volHigh = (volScore || 0) > 30;
      
      // FULL THRUST: Above all MAs with positive momentum and calm vol
      if (aboveMa200 && aboveMa150 && macdPositive && !volHigh) {
        return HASLUN_GLOSSARY.trend_full_thrust;
      }
      
      // REVERSAL ATTEMPT: Above short-term but below long-term, calm vol
      if (aboveMa100 && !aboveMa200 && macdPositive && !volHigh) {
        return HASLUN_GLOSSARY.trend_reversal_attempt;
      }
      
      // DRIFTING: Near MAs with weak momentum and tame vol
      if (nearMa100 && Math.abs(macdVal) < 0.1 && !volHigh) {
        return HASLUN_GLOSSARY.trend_drifting;
      }
      
      // REENTRY RISK: Below long-term with negative momentum
      if (!aboveMa200 && !macdPositive && !volHigh) {
        return HASLUN_GLOSSARY.trend_reentry_risk;
      }
      
      // NEBULOUS: High volatility OR mixed signals
      return HASLUN_GLOSSARY.trend_nebula;
    }
    
    // Get MACD status
    function getMacdStatus(macd, signal, hist) {
      if (Math.abs(hist) < 0.05) return MACD_STATES.weak_signal;
      if (macd > signal && hist > 0) return MACD_STATES.bullish_cross;
      if (macd < signal && hist < 0) return MACD_STATES.bearish_cross;
      return MACD_STATES.weak_signal;
    }
    
    // Get portfolio mood
    function getPortfolioMood(dailyPnlPercent) {
      if (dailyPnlPercent >= 2) return PORTFOLIO_MOODS.thruster_boost;
      if (dailyPnlPercent >= 0) return PORTFOLIO_MOODS.steady_climb;
      if (dailyPnlPercent >= -1) return PORTFOLIO_MOODS.minor_turbulence;
      return PORTFOLIO_MOODS.hull_rattle;
    }
    
    // Update portfolio mood display dynamically
    function updatePortfolioMood(dailyPnlPercent) {
      const mood = getPortfolioMood(dailyPnlPercent);
      const moodEl = document.getElementById('portfolio-mood');
      if (!moodEl) return;
      
      const labelEl = moodEl.querySelector('.mood-label');
      const copyEl = moodEl.querySelector('.mood-copy');
      
      if (labelEl) labelEl.textContent = mood.label;
      if (copyEl) copyEl.textContent = mood.copy;
      
      // Update mood class
      moodEl.className = 'portfolio-mood';
      if (dailyPnlPercent >= 2) moodEl.classList.add('boost');
      else if (dailyPnlPercent >= 0) moodEl.classList.add('climb');
      else if (dailyPnlPercent >= -1) moodEl.classList.add('turbulence');
      else moodEl.classList.add('rattle');
    }
    
    // Attach glossary tooltips to all elements with data-glossary-id
    function attachGlossaryTooltips() {
      document.querySelectorAll('[data-glossary-id]').forEach(el => {
        const id = el.getAttribute('data-glossary-id');
        const entry = HASLUN_GLOSSARY[id];
        if (!entry) return;
        
        // Build tooltip with both serious and flavor text
        const tooltip = entry.tooltip + (entry.flavor ? '\n\n"' + entry.flavor + '"' : '');
        el.setAttribute('title', tooltip);
        el.style.cursor = 'help';
      });
    }
    
    // Scenario Engine: Update smoothing band label
    function updateSmoothingBandLabel(value) {
      const el = document.getElementById('smoothing-band-label');
      if (!el) return;
      let text = 'BALANCED';
      if (value < 30) text = 'RAW FEED';
      else if (value > 70) text = 'DEEP FILTER';
      el.textContent = text;
    }
    
    // Scenario Engine: Update forecast display
    function updateForecastDisplay(days) {
      const el = document.getElementById('forecast-value');
      if (el) el.textContent = days + ' DAYS';
      logTerminal('forecast range → ' + days + ' days');
    }
    
    // Scenario Engine: Update risk profile
    function updateRiskProfile(level) {
      const fill = document.getElementById('risk-fill');
      const needle = document.getElementById('risk-needle');
      const value = document.getElementById('risk-value');
      
      const profiles = {
        conservative: { height: 30, angle: 25, label: 'CONSERVATIVE' },
        moderate: { height: 50, angle: 65, label: 'MODERATE' },
        aggressive: { height: 75, angle: 105, label: 'AGGRESSIVE' },
        maximum: { height: 95, angle: 145, label: 'MAXIMUM' }
      };
      
      const profile = profiles[level] || profiles.moderate;
      if (fill) fill.style.height = profile.height + '%';
      if (needle) needle.style.transform = 'rotate(' + profile.angle + 'deg)';
      if (value) value.textContent = profile.label;
      
      logTerminal('risk exposure → ' + profile.label.toLowerCase());
    }
    
    // Get current price series for a ticker based on timeframe
    function getCurrentSeriesForTicker(data) {
      if (!data) return [];
      return currentTimeframe === '1D' ? data.daily : data.intraday;
    }
    
    // Calculate volatility score from price data (returns 0-40 scaled value)
    function calculateVolatility(data) {
      if (!data || data.length < 10) return 0;
      const returns = [];
      for (let i = 1; i < data.length; i++) {
        const prev = data[i-1].c;
        const curr = data[i].c;
        if (!prev || !curr) continue;
        const ret = (curr - prev) / prev;
        returns.push(ret);
      }
      if (returns.length < 5) return 0;
      const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
      const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
      const stdev = Math.sqrt(variance);
      // Scale roughly into a 0-40 range for LED bar (annualized %)
      const scaled = stdev * Math.sqrt(252) * 100;
      return Math.max(0, Math.min(40, scaled));
    }
    
    // Get volatility score for a specific ticker
    function getVolScoreForTicker(ticker) {
      const data = tickerData[ticker];
      const series = getCurrentSeriesForTicker(data);
      return calculateVolatility(series);
    }
    
    // Update volatility display
    function updateVolatilityDisplay(vol) {
      const display = document.getElementById('vol-display');
      if (display) display.textContent = vol.toFixed(1);
      
      // Update LED array based on volatility
      const leds = document.querySelectorAll('.led-array .array-led');
      const numLit = Math.min(8, Math.floor(vol / 10));
      leds.forEach((led, i) => {
        led.className = 'array-led';
        if (i < numLit) {
          if (i >= 6) led.classList.add('red');
          else if (i >= 4) led.classList.add('amber');
          else led.classList.add('on');
        }
      });
    }
    
    const DEMO_STOCK_POSITIONS = [
      { ticker: 'RKLB', shares: 75, entry_price: 68.45, current_price: 72.80 },
      { ticker: 'ASTS', shares: 50, entry_price: 78.20, current_price: 83.47 },
      { ticker: 'LUNR', shares: 100, entry_price: 15.20, current_price: 17.88 },
      { ticker: 'BKSY', shares: 200, entry_price: 3.85, current_price: 4.20 },
      { ticker: 'RDW', shares: 80, entry_price: 13.60, current_price: 15.00 },
      { ticker: 'PL', shares: 150, entry_price: 3.72, current_price: 4.00 },
      { ticker: 'ACHR', shares: 100, entry_price: 7.85, current_price: 8.13 },
      { ticker: 'JOBY', shares: 60, entry_price: 13.20, current_price: 14.36 },
      { ticker: 'EVEX', shares: 250, entry_price: 3.10, current_price: 2.80 },
      { ticker: 'GME', shares: 40, entry_price: 25.80, current_price: 27.50 }
    ];
    
    const DEMO_OPTIONS = [
      { ticker: 'RKLB', structure: 'Naked LEAP', strikes: '$5', entry: 1.85, current: 68.50, delta: 0.95, contracts: 3 },
      { ticker: 'ASTS', structure: 'Bull Spread', strikes: '$5/$15', entry: 2.40, current: 9.85, delta: 0.48, contracts: 4 },
      { ticker: 'LUNR', structure: 'Naked LEAP', strikes: '$5', entry: 1.20, current: 13.50, delta: 0.92, contracts: 5 },
      { ticker: 'BKSY', structure: 'Bull Spread', strikes: '$2/$5', entry: 0.95, current: 2.80, delta: 0.55, contracts: 5 },
      { ticker: 'RDW', structure: 'Bull Spread', strikes: '$4/$8', entry: 1.40, current: 3.90, delta: 0.62, contracts: 3 },
      { ticker: 'PL', structure: 'Bull Spread', strikes: '$2/$4', entry: 0.55, current: 1.85, delta: 0.58, contracts: 5 },
      { ticker: 'ACHR', structure: 'Naked LEAP', strikes: '$5', entry: 1.65, current: 4.20, delta: 0.72, contracts: 3 },
      { ticker: 'JOBY', structure: 'Bull Spread', strikes: '$5/$10', entry: 1.80, current: 5.40, delta: 0.65, contracts: 3 },
      { ticker: 'EVEX', structure: 'Bull Spread', strikes: '$3/$6', entry: 0.85, current: 0.35, delta: 0.28, contracts: 4 },
      { ticker: 'GME', structure: 'Bull Spread', strikes: '$12/$20', entry: 3.20, current: 7.80, delta: 0.72, contracts: 2 }
    ];
    
    const DEMO_CATALYSTS = [
      { date: '2026-01-16', ticker: 'ALL', event: 'January Options Expiration', impact: 'HIGH' },
      { date: '2026-01-21', ticker: 'RKLB', event: 'Q4 Earnings Report', impact: 'HIGH' },
      { date: '2026-01-28', ticker: 'ASTS', event: 'Q4 Earnings Report', impact: 'HIGH' },
      { date: '2026-02-10', ticker: 'LUNR', event: 'Q4 Earnings Report', impact: 'MEDIUM' },
      { date: '2026-02-15', ticker: 'LUNR', event: 'IM-2 Lunar Landing Mission', impact: 'HIGH' },
      { date: '2026-Q1', ticker: 'ACHR', event: 'FAA Type Certification Expected', impact: 'HIGH' },
      { date: '2026-Q1', ticker: 'JOBY', event: 'FAA Type Certification Expected', impact: 'HIGH' },
      { date: '2026-Q2', ticker: 'ASTS', event: 'BlueBird Commercial Service Launch', impact: 'HIGH' },
      { date: '2026-Q2', ticker: 'RKLB', event: 'Neutron Rocket First Flight', impact: 'HIGH' }
    ];
    
    const DEMO_ACTIVITY = [
      { type: 'trade', title: 'BUY LUNR', subtitle: '100 shares @ $15.20', time: '09:45' },
      { type: 'alert', title: 'MACD Crossover', subtitle: 'LUNR bullish signal', time: '09:44' },
      { type: 'trade', title: 'BUY ASTS', subtitle: '50 shares @ $78.20', time: 'PREV' },
      { type: 'trade', title: 'BUY RKLB', subtitle: '75 shares @ $68.45', time: 'PREV' },
      { type: 'alert', title: 'MACD Crossover', subtitle: 'ASTS bullish signal', time: 'JAN02' }
    ];
    
    // Arcade-style SVG icons
    const invaderSvg = '<svg viewBox="0 0 11 8" fill="currentColor"><rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/><rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/><rect x="2" y="2" width="7" height="1"/><rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/><rect x="0" y="4" width="11" height="1"/><rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/></svg>';
    const scenarioSvg = '<svg viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="7" cy="7" r="5"/><path d="M7 4v3l2 2"/></svg>';
    const bonusSvg = '<svg viewBox="0 0 14 14" fill="currentColor"><path d="M7 1l1.5 4.5H13l-3.5 3 1.5 4.5L7 10l-4 3 1.5-4.5L1 5.5h4.5z"/></svg>';
    
    // Mission log helper for scenario engine
    function pushMissionLog(entry) {
      const feed = document.getElementById('activity-feed');
      if (!feed) return;
      
      const icons = { trade: tradeSvg, alert: alertSvg, invader: invaderSvg, scenario: scenarioSvg, bonus: bonusSvg };
      const time = entry.time || new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const item = document.createElement('div');
      item.className = 'activity-item';
      item.innerHTML = 
        '<div class="activity-icon ' + (entry.type || 'alert') + '">' + (icons[entry.type] || alertSvg) + '</div>' +
        '<div class="activity-content"><div class="activity-title' + (entry.arcade ? ' arcade' : '') + '">' + entry.title + '</div>' +
        '<div class="activity-subtitle">' + entry.subtitle + '</div></div>' +
        '<div class="activity-time">' + time + '</div>';
      
      feed.insertBefore(item, feed.firstChild);
      
      // Keep max 25 entries
      while (feed.children.length > 25) {
        feed.removeChild(feed.lastChild);
      }
    }
    
    // =========================================================================
    // FLEET HOLOBAY SYSTEM (Pro Ship Library with Universe Lore)
    // =========================================================================
    
    // Ship lore database - HUD tags and descriptions
    const SHIP_LORE = {
      "#ship-flagship": {
        hud: "COMMAND AUTHORITY ACTIVE",
        lore: "Spearhead command carrier. Captains say it listens before it speaks."
      },
      "#ship-dreadnought": {
        hud: "LEGACY COMBAT MEMORY ENABLED",
        lore: "Heavy war machine. Refuses to die and logs its own kills without permission."
      },
      "#ship-archon": {
        hud: "AUTHORITY PROTOCOL DETECTED",
        lore: "Built to command fleets rather than win battles. Hull plating echoes cathedral geometry."
      },
      "#ship-tyrant": {
        hud: "LEGACY COMBAT MEMORY ENABLED",
        lore: "Technically illegal. Nobody remembers which war it survived."
      },
      "#ship-phantom": {
        hud: "TOPOLOGY ANOMALY — TRACED BUT UNRESOLVED",
        lore: "Appears on scans before it appears on the hull deck. Routes comms from ships that no longer exist."
      },
      "#ship-hauler": {
        hud: "CARGO MANIFEST VERIFIED",
        lore: "The Atlas doesn't have fans. It has people who quietly owe their lives to it."
      },
      "#ship-drone": {
        hud: "PASSIVE CURIOSITY RISING...",
        lore: "Buzzes. Watches. Reports. Occasionally expresses opinions in system logs."
      },
      "#ship-sojourn": {
        hud: "DESCENT TRAJECTORY LOCKED",
        lore: "Landers don't win wars. They bring people home."
      },
      "#ship-parallax": {
        hud: "BLACK CHANNEL AUTHENTICATED",
        lore: "Officially, this class does not exist. If you can see it — it chose to let you."
      },
      "#ship-gardener": {
        hud: "LEGACY ECOLOGICAL ROUTINES ACTIVE",
        lore: "Built for terraforming. Now escorts convoys because nobody funds ecosystems anymore."
      },
      "#ship-frigate": {
        hud: "PATROL SYSTEMS NOMINAL",
        lore: "Reliable, adaptable. The backbone of any fleet."
      },
      "#ship-lander": {
        hud: "SURFACE APPROACH ENABLED",
        lore: "Lunar descent specialist. Hope and precision in equal measure."
      },
      "#ship-evtol": {
        hud: "VTOL SYSTEMS ONLINE",
        lore: "Sky taxi of the future. Vertical freedom."
      },
      "#ship-cargo": {
        hud: "CARGO SECURE",
        lore: "The supply chain doesn't thank you. It just expects you to show up."
      },
      "#ship-meme": {
        hud: "SIGNAL ANOMALY DETECTED",
        lore: "Origin unknown. Trajectory chaotic. Somehow profitable."
      },
      "#ship-recon": {
        hud: "SURVEILLANCE ACTIVE",
        lore: "Eyes in the sky. Watching. Always watching."
      },
      "#ship-patrol": {
        hud: "DEFENSE GRID LINKED",
        lore: "First responder. Last line. No medals, just duty."
      },
      "#ship-relay": {
        hud: "UPLINK ESTABLISHED",
        lore: "Communication backbone. Every message passes through, trusted with all secrets."
      }
    };
    
    // Map tickers/sectors to SVG symbols - returns {symbol, label, isHero, lore}
    function mapTickerToShip(ticker, sector) {
      ticker = (ticker || "").toUpperCase();
      sector = sector || "";

      // HERO mappings - special detailed ships
      if (ticker === "RKLB") return { symbol: "#ship-archon", label: "ORBITAL ARCHON", isHero: true };
      if (ticker === "GME")  return { symbol: "#ship-tyrant", label: "IRON TYRANT", isHero: true };
      if (ticker === "TSLA") return { symbol: "#ship-flagship", label: "FLAGSHIP SPEAR", isHero: true };
      if (ticker === "NVDA") return { symbol: "#ship-dreadnought", label: "DREADNOUGHT MECH", isHero: true };

      // Standard fleet mappings
      if (ticker === "LUNR") return { symbol: "#ship-lander", label: "LUNAR LANDER", isHero: false };
      if (/JOBY|ACHR|EVEX/.test(ticker)) return { symbol: "#ship-evtol", label: "EVTOL CARRIER", isHero: false };
      if (/ASTS/.test(ticker)) return { symbol: "#ship-phantom", label: "PHANTOM NODE", isHero: false };
      if (/IRDM/.test(ticker)) return { symbol: "#ship-relay", label: "COMM RELAY", isHero: false };
      if (/BKSY|PL/.test(ticker)) return { symbol: "#ship-drone", label: "FIREFLY DRONE", isHero: false };
      if (/KTOS|RDW/.test(ticker)) return { symbol: "#ship-patrol", label: "PATROL CORVETTE", isHero: false };
      if (/ATI/.test(ticker)) return { symbol: "#ship-hauler", label: "ATLAS HAULER", isHero: false };
      if (/CACI|HON/.test(ticker)) return { symbol: "#ship-gardener", label: "GARDENER FRAME", isHero: false };
      if (/MP|LOAR/.test(ticker)) return { symbol: "#ship-cargo", label: "CARGO HAULER", isHero: false };

      // Sector-based fallbacks
      if (/EVTOL|VTOL|air mobility/i.test(sector)) return { symbol: "#ship-evtol", label: "EVTOL CARRIER", isHero: false };
      if (/meme|retail|chaotic/i.test(sector)) return { symbol: "#ship-meme", label: "ANOMALOUS PROBE", isHero: false };
      if (/defense|military/i.test(sector)) return { symbol: "#ship-patrol", label: "PATROL CORVETTE", isHero: false };
      if (/industrial|materials|cargo|aerospace|components/i.test(sector)) return { symbol: "#ship-hauler", label: "ATLAS HAULER", isHero: false };
      if (/earth|geo|observation/i.test(sector)) return { symbol: "#ship-drone", label: "FIREFLY DRONE", isHero: false };
      if (/cellular|comms|relay|satellite/i.test(sector)) return { symbol: "#ship-relay", label: "COMM RELAY", isHero: false };
      if (/lunar/i.test(sector)) return { symbol: "#ship-lander", label: "LUNAR LANDER", isHero: false };
      if (/stealth|black|secret/i.test(sector)) return { symbol: "#ship-parallax", label: "NIGHT PARALLAX", isHero: false };
      if (/experimental|biotech|pharma/i.test(sector)) return { symbol: "#ship-phantom", label: "PHANTOM NODE", isHero: false };

      // Default
      return { symbol: "#ship-frigate", label: "ORBITAL FRIGATE", isHero: false };
    }
    
    // Get ship lore for display
    function getShipLore(symbol) {
      return SHIP_LORE[symbol] || { hud: "SYSTEMS NOMINAL", lore: "Standard issue vessel." };
    }
    
    // =========================================================================
    // PIXEL SHIP RENDERING SYSTEM (8-bit Space Invaders style)
    // =========================================================================
    
    // 17 cols x 11 rows – enough detail to feel "sprite-like" / SNES mech HUD
    // Each character: "0" = empty, "1" = outer hull, "2" = inner core, "3" = highlight accent

    const PIXEL_SHIPS = {
      // RKLB: long spear / command cruiser
      flagship: [
        "00000011100000000",
        "00000122210000000",
        "00001122221000000",
        "00011222222100000",
        "00112222222210000",
        "01122222322221000",
        "00112223222210000",
        "00011222222100000",
        "00001122221000000",
        "00000123210000000",
        "00000011100000000"
      ],

      // GME: chunky anime dreadnought / mech chest
      dreadnought: [
        "00000111111000000",
        "00011222222110000",
        "00122222222221000",
        "01122222222221100",
        "11222223222222110",
        "11222222222222110",
        "01122222222221100",
        "00122222222221000",
        "00011222222110000",
        "00000111111000000",
        "00000001000000000"
      ],

      // ASTS: twin-pod probe / sensor array
      probe: [
        "00001100110000000",
        "00012221122200000",
        "00122222222210000",
        "01122222222211000",
        "01222232232221000",
        "01122222222211000",
        "00122222222210000",
        "00012221122200000",
        "00001100110000000",
        "00000100010000000",
        "00000100010000000"
      ],

      // ACHR / EVEX / JOBY carriers – wide flight deck
      carrier: [
        "00000011111000000",
        "00000122222100000",
        "00001222222210000",
        "00012222222221000",
        "00122222222222100",
        "01122223222322110",
        "00122222222222100",
        "00012222222221000",
        "00001222222210000",
        "00000122222100000",
        "00000011111000000"
      ],

      // LUNR: lander / dropship
      lander: [
        "00000011100000000",
        "00000122210000000",
        "00001222221000000",
        "00012222222100000",
        "00122222222210000",
        "01122223222211000",
        "00122222222210000",
        "00012222222100000",
        "00001222221000000",
        "00000123210000000",
        "00000011100000000"
      ],

      // default drone frame – compact but still mech-y
      drone: [
        "00000011100000000",
        "00000122210000000",
        "00001222221000000",
        "00001223221000000",
        "00001222221000000",
        "00000122210000000",
        "00000122210000000",
        "00000011100000000",
        "00000001000000000",
        "00000001000000000",
        "00000000000000000"
      ],
      
      // Cruiser - defense / patrol ship
      cruiser: [
        "00000111110000000",
        "00001222221000000",
        "00012222222100000",
        "00122222222210000",
        "01122223222211000",
        "01222222222221000",
        "00122222222210000",
        "00012222222100000",
        "00001222221000000",
        "00000111110000000",
        "00000010100000000"
      ],
      
      // Station / relay - comms hub
      station: [
        "00001110111000000",
        "00011221122110000",
        "00012222222100000",
        "00011222221100000",
        "00122223222210000",
        "00011222221100000",
        "00012222222100000",
        "00011221122110000",
        "00001110111000000",
        "00000100010000000",
        "00000100010000000"
      ],
      
      // Hauler - cargo / industrial transport
      hauler: [
        "00000111111000000",
        "00001222222100000",
        "00012222222210000",
        "00122222222221000",
        "00122222222221000",
        "01122223222221100",
        "00122222222221000",
        "00122222222221000",
        "00012222222210000",
        "00001222222100000",
        "00000111111000000"
      ],
      
      // Mini-game specific sprites - smaller for arcade games
      arcade_player: [
        "00000011100000000",
        "00001122211000000",
        "00011222221100000",
        "00112222222110000",
        "01122223222211000",
        "11222222222221100",
        "11222222222221100",
        "01122222222211000",
        "00111111111110000",
        "00010001000100000",
        "00010001000100000"
      ],
      
      arcade_enemy: [
        "00100000000010000",
        "00010000000100000",
        "00111111111110000",
        "01111222221111000",
        "11112222222111100",
        "11112232322111100",
        "11112222222111100",
        "01111111111111000",
        "00011000001100000",
        "00110000000110000",
        "01100000000011000"
      ],
      
      arcade_elite: [
        "00100111110010000",
        "00011222221100000",
        "00111222222111000",
        "01112222222211100",
        "01112223222211100",
        "11122222222221110",
        "01112222222211100",
        "00111222222111000",
        "00011122211100000",
        "00010100010100000",
        "00100100010010000"
      ]
    };
    
    /**
     * Draw a PIXEL_SHIPS pattern on a canvas context.
     * @param {CanvasRenderingContext2D} ctx - Canvas context
     * @param {string} patternKey - Key from PIXEL_SHIPS
     * @param {number} x - Center X position
     * @param {number} y - Center Y position  
     * @param {number} scale - Pixel scale (1 = 1px per cell)
     * @param {string} baseColor - Base color in hex (e.g., '#33ff99')
     * @param {object} opts - Options: { glow: boolean, glowBlur: number }
     */
    function drawPixelShipOnCanvas(ctx, patternKey, x, y, scale, baseColor, opts = {}) {
      const pattern = PIXEL_SHIPS[patternKey] || PIXEL_SHIPS.drone;
      const rows = pattern.length;
      const cols = pattern[0].length;
      
      // Calculate pixel dimensions
      const cellSize = scale;
      const totalWidth = cols * cellSize;
      const totalHeight = rows * cellSize;
      
      // Calculate top-left corner (centered on x,y)
      const startX = x - totalWidth / 2;
      const startY = y - totalHeight / 2;
      
      // Parse base color to HSL for shading
      const hex = baseColor.replace('#', '');
      const r = parseInt(hex.substr(0, 2), 16) / 255;
      const g = parseInt(hex.substr(2, 2), 16) / 255;
      const b = parseInt(hex.substr(4, 2), 16) / 255;
      
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h = 0, s = 0, l = (max + min) / 2;
      
      if (max !== min) {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }
      const baseHue = Math.round(h * 360);
      const baseSat = Math.round(s * 100);
      
      // Apply glow if requested
      if (opts.glow) {
        ctx.shadowColor = baseColor;
        ctx.shadowBlur = opts.glowBlur || 6;
      }
      
      // Draw each pixel
      for (let row = 0; row < rows; row++) {
        const rowData = pattern[row];
        for (let col = 0; col < cols; col++) {
          const digit = rowData[col];
          if (digit === '0') continue;
          
          let fill;
          if (digit === '1') {
            fill = `hsl(${baseHue}, ${Math.max(20, baseSat - 20)}%, 20%)`; // Dark edge
          } else if (digit === '2') {
            fill = `hsl(${baseHue}, ${baseSat}%, 40%)`; // Mid tone
          } else {
            fill = `hsl(${baseHue}, ${Math.min(100, baseSat + 20)}%, 60%)`; // Cockpit highlight
          }
          
          ctx.fillStyle = fill;
          ctx.fillRect(
            startX + col * cellSize,
            startY + row * cellSize,
            cellSize,
            cellSize
          );
        }
      }
      
      // Reset shadow
      if (opts.glow) {
        ctx.shadowBlur = 0;
      }
    }
    
    // Pixel ship lore for HUD display
    const PIXEL_SHIP_LORE = {
      flagship: { label: "FLAGSHIP", hud: "COMMAND AUTHORITY ACTIVE", lore: "Spearhead command ship. Victory follows in its wake." },
      dreadnought: { label: "DREADNOUGHT", hud: "HEAVY ARMOR ENGAGED", lore: "Refuses to die. Logs its own kills without permission." },
      lander: { label: "LANDER", hud: "DESCENT LOCKED", lore: "Landers don't win wars. They bring people home." },
      carrier: { label: "CARRIER", hud: "FLIGHT OPS READY", lore: "Sky taxi of the future. Vertical freedom." },
      drone: { label: "DRONE", hud: "PASSIVE SCAN ACTIVE", lore: "Buzzes. Watches. Reports. Occasionally has opinions." },
      cruiser: { label: "CRUISER", hud: "PATROL SYSTEMS ONLINE", lore: "First responder. Last line. No medals, just duty." },
      station: { label: "STATION", hud: "UPLINK ESTABLISHED", lore: "Every message passes through. Trusted with all secrets." },
      probe: { label: "PROBE", hud: "ANOMALY DETECTED", lore: "Origin unknown. Trajectory chaotic. Somehow profitable." },
      hauler: { label: "HAULER", hud: "CARGO MANIFEST VERIFIED", lore: "Doesn't have fans. Has people who owe their lives to it." }
    };
    
    /**
     * Render HD mech sprite into an SVG.
     * patternKey in PIXEL_SHIPS.
     * opts: { hero: bool, pnlPercent: number }
     */
    function renderPixelShip(svgEl, patternKey, opts = {}) {
      if (!svgEl) return;

      const pattern = PIXEL_SHIPS[patternKey] || PIXEL_SHIPS.flagship;
      const hero    = !!opts.hero;
      const pnl     = (typeof opts.pnlPercent === "number") ? opts.pnlPercent : null;

      // wipe previous content
      while (svgEl.firstChild) svgEl.removeChild(svgEl.firstChild);

      const rows = pattern.length;
      const cols = pattern[0].length;

      const cell  = 2.9; // smaller cells = more "resolution"
      const width = cols * cell;
      const height = rows * cell;

      const viewW = 120;
      const viewH = 80;
      const offsetX = (viewW - width) / 2;
      const offsetY = (viewH - height) / 2;

      const ns = "http://www.w3.org/2000/svg";
      const g = document.createElementNS(ns, "g");
      svgEl.appendChild(g);

      for (let r = 0; r < rows; r++) {
        const row = pattern[r];
        for (let c = 0; c < cols; c++) {
          const ch = row[c];
          if (ch === "0") continue;

          const x = offsetX + c * cell;
          const y = offsetY + r * cell;

          const rect = document.createElementNS(ns, "rect");
          rect.setAttribute("x", x);
          rect.setAttribute("y", y);
          rect.setAttribute("width", cell);
          rect.setAttribute("height", cell);
          rect.setAttribute("rx", 0.6);
          rect.setAttribute("ry", 0.6);

          let cls;
          if (ch === "1") cls = "pixel-ship-outer";
          else if (ch === "2") cls = "pixel-ship-inner";
          else if (ch === "3") cls = "pixel-ship-highlight";
          else continue;

          rect.setAttribute("class", cls);
          g.appendChild(rect);
        }
      }

      // Add pixel-mode class for animations
      svgEl.classList.add("pixel-mode", "pixel-ship-glow");

      // hero / damage states on the container
      if (hero) svgEl.classList.add("hero-ship");
      else      svgEl.classList.remove("hero-ship");
      
      // Damage overlay on big losers / winning state
      svgEl.classList.remove("ship-damaged", "pixel-ship-winning", "pixel-ship-losing");
      if (pnl !== null) {
        if (pnl < -5) {
          svgEl.classList.add("ship-damaged", "pixel-ship-losing");
        } else if (pnl >= 5) {
          svgEl.classList.add("pixel-ship-winning");
        }
      }
    }
    
    // Maps ticker/sector into { pattern, hero, label }
    function mapTickerToPixelShip(ticker, sector, pnlPercent) {
      ticker = (ticker || "").toUpperCase();
      sector = sector || "";

      // Heroes
      if (ticker === "RKLB") return { pattern: "flagship", hero: true };
      if (ticker === "GME")  return { pattern: "dreadnought", hero: true };
      if (ticker === "TSLA") return { pattern: "flagship", hero: true };
      if (ticker === "NVDA") return { pattern: "dreadnought", hero: true };

      // Specific tickers
      if (ticker === "LUNR") return { pattern: "lander", hero: false };
      if (/JOBY|ACHR|EVEX/.test(ticker)) return { pattern: "carrier", hero: false };
      if (/ASTS/.test(ticker)) return { pattern: "probe", hero: false };
      if (/IRDM/.test(ticker)) return { pattern: "station", hero: false };
      if (/BKSY|PL/.test(ticker)) return { pattern: "drone", hero: false };
      if (/KTOS|RDW/.test(ticker)) return { pattern: "cruiser", hero: false };
      if (/ATI|MP|LOAR/.test(ticker)) return { pattern: "hauler", hero: false };
      if (/CACI|HON/.test(ticker)) return { pattern: "cruiser", hero: false };

      // By sector
      if (/VTOL|EVTOL|AVIATION/i.test(sector))
        return { pattern: "carrier", hero: false };

      if (/SPACE|LAUNCH|SAT|ORBITAL/i.test(sector))
        return { pattern: "flagship", hero: false };

      if (/INDUSTRIAL|MATERIALS|CARGO/i.test(sector))
        return { pattern: "hauler", hero: false };

      if (/DEFENSE|MILITARY/i.test(sector))
        return { pattern: "cruiser", hero: false };

      if (/COMMS|RELAY|CELLULAR/i.test(sector))
        return { pattern: "station", hero: false };

      if (/MEME|RETAIL|CHAOTIC/i.test(sector))
        return { pattern: "probe", hero: false };

      if (/LUNAR|SURFACE/i.test(sector))
        return { pattern: "lander", hero: false };

      if (/SURVEILLANCE|RECON|EARTH/i.test(sector))
        return { pattern: "drone", hero: false };

      // Default
      return { pattern: "lander", hero: false };
    }
    
    // Get pixel ship lore
    function getPixelShipLore(patternKey) {
      return PIXEL_SHIP_LORE[patternKey] || PIXEL_SHIP_LORE.lander;
    }
    
    // Apply ship to an SVG element with use element
    function applyShipToSvg(svgEl, useEl, mapping, pnlNum) {
      if (!svgEl || !useEl) return;
      
      useEl.setAttribute("href", mapping.symbol);
      useEl.setAttribute("xlink:href", mapping.symbol); // Legacy browser support

      // Toggle hero-ship class
      if (mapping.isHero) {
        svgEl.classList.add("hero-ship");
      } else {
        svgEl.classList.remove("hero-ship");
      }
      
      // Toggle winning/losing state for engine pulse animation
      svgEl.classList.remove("ship-winning", "ship-losing");
      if (pnlNum !== undefined) {
        if (pnlNum >= 0) {
          svgEl.classList.add("ship-winning");
        } else {
          svgEl.classList.add("ship-losing");
        }
      }
    }
    
    // Update sidebar ship profile - now using pixel ships!
    function updateSidebarShip(ticker, sector, pnlNum) {
      const svgEl = document.querySelector(".ship-profile .ship-svg");
      const caption = document.getElementById("ship-caption");
      const statusEl = document.getElementById("ship-status");
      const signalEl = document.getElementById("ship-signal");
      
      if (!svgEl) return;

      // Use pixel ship rendering
      const meta = mapTickerToPixelShip(ticker, sector, pnlNum);
      const lore = getPixelShipLore(meta.pattern);
      
      renderPixelShip(svgEl, meta.pattern, { 
        hero: meta.hero, 
        pnlPercent: pnlNum 
      });
      
      if (caption) {
        const label = meta.hero ? lore.label + " ★" : lore.label;
        caption.textContent = `${ticker.toUpperCase()} · ${label}`;
      }
      
      // Update status based on P&L
      if (statusEl && signalEl) {
        if (pnlNum >= 5) {
          statusEl.textContent = "OPTIMAL";
          statusEl.className = "vital-value positive";
          signalEl.textContent = "STRONG";
          signalEl.className = "vital-value positive";
        } else if (pnlNum >= 0) {
          statusEl.textContent = "NOMINAL";
          statusEl.className = "vital-value";
          signalEl.textContent = "STABLE";
          signalEl.className = "vital-value positive";
        } else if (pnlNum >= -5) {
          statusEl.textContent = "STRESSED";
          statusEl.className = "vital-value";
          signalEl.textContent = "WEAK";
          signalEl.className = "vital-value";
        } else {
          statusEl.textContent = "CRITICAL";
          statusEl.className = "vital-value negative";
          signalEl.textContent = "FADING";
          signalEl.className = "vital-value negative";
        }
      }
    }
    
    // Telemetry HUD ship – uses the same pixel mech system
    function updateTelemetryShipSprite(ticker) {
      const svgEl      = document.getElementById("telemetry-ship-svg");
      const labelEl    = document.getElementById("telemetry-ship-label");
      const captionEl  = document.getElementById("telemetry-ship-caption");
      const headerName = document.getElementById("telemetry-ship-name"); // existing title text

      if (!svgEl) return;

      const upper = (ticker || "").toUpperCase();

      // Pull sector + returns from existing data sources
      const profile = (window.TICKER_PROFILES && TICKER_PROFILES[upper]) || {};
      const sector  = profile.sector || profile.theme || "Unknown";

      const stats = (window.statsData && statsData[upper]) || {};
      // Prefer "total" return; fall back to 1Y / 3M if needed
      const pnl =
        (typeof stats.return_total === "number" ? stats.return_total :
        typeof stats.return_1y    === "number" ? stats.return_1y    :
        typeof stats.return_3m    === "number" ? stats.return_3m    :
        0);

      // Map into a sprite pattern
      const meta = mapTickerToPixelShip(upper, sector, pnl);
      renderPixelShip(svgEl, meta.pattern, {
        hero: meta.hero,
        pnlPercent: pnl
      });

      const lore = getPixelShipLore(meta.pattern);
      const shipName = `${upper} · ${lore.label}`;

      if (labelEl)   labelEl.textContent   = shipName;
      if (captionEl) captionEl.textContent = lore.lore;
      if (headerName) headerName.textContent = shipName; // keeps header in sync
    }
    
    function initFleetHolobay() {
      const strip = document.getElementById("fleet-holo-strip");
      const svg = document.getElementById("fleet-ship-svg");
      const nameEl = document.getElementById("fleet-ship-name");
      const classEl = document.getElementById("fleet-ship-class");
      const sectorEl = document.getElementById("fleet-ship-sector");
      const hullBar = document.getElementById("fleet-hull-bar");
      const hullText = document.getElementById("fleet-hull-text");
      const cargoBar = document.getElementById("fleet-cargo-bar");
      const cargoText = document.getElementById("fleet-cargo-text");
      const velBar = document.getElementById("fleet-vel-bar");
      const velText = document.getElementById("fleet-vel-text");

      if (!strip || !svg) return;
      
      // No more <use> element needed - we render pixels directly!
      
      function pnlToHealth(pnl) {
        const raw = Math.max(-50, Math.min(150, pnl));
        return Math.round(((raw + 50) / 200) * 100);
      }

      function healthLabel(h) {
        if (h >= 85) return "OPTIMAL";
        if (h >= 65) return "NOMINAL";
        if (h >= 45) return "STRESSED";
        return "CRITICAL";
      }
      
      // Render ship using pixel ship system
      function renderFleetShipPixel(ticker, sector, pnlNum) {
        const meta = mapTickerToPixelShip(ticker, sector, pnlNum);
        renderPixelShip(svg, meta.pattern, { 
          hero: meta.hero, 
          pnlPercent: pnlNum 
        });
        return meta;
      }

      const fleet = [];

      // Build fleet from DEMO_STOCK_POSITIONS with TICKER_PROFILES data
      if (typeof DEMO_STOCK_POSITIONS !== 'undefined') {
        DEMO_STOCK_POSITIONS.forEach(pos => {
          const profile = TICKER_PROFILES[pos.ticker] || {};
          const value = pos.shares * pos.current_price;
          const pnlNum = ((pos.current_price - pos.entry_price) / pos.entry_price) * 100;
          const pnlText = (pnlNum >= 0 ? '+' : '') + pnlNum.toFixed(1) + '%';
          const sector = profile.sector || 'Unknown';
          const meta = mapTickerToPixelShip(pos.ticker, sector, pnlNum);
          const lore = getPixelShipLore(meta.pattern);

          fleet.push({
            ticker: pos.ticker,
            sector: sector,
            value: value,
            pnlText: pnlText,
            pnlNum: pnlNum,
            shipClass: lore.label,
            codename: profile.codename || pos.ticker,
            isHero: meta.hero,
            pattern: meta.pattern
          });
        });
      }

      if (!fleet.length) return;

      // Create thumbnails
      fleet.forEach(ship => {
        const thumb = document.createElement("div");
        thumb.className = "fleet-thumb " + (ship.pnlNum >= 0 ? "gain" : "loss");
        if (ship.isHero) thumb.classList.add("hero");
        thumb.dataset.ticker = ship.ticker;

        thumb.innerHTML = `
          <div class="ticker">${ship.ticker}</div>
          <div class="tag">${ship.shipClass}</div>
          <div class="pnl">${ship.pnlText}</div>
        `;

        thumb.addEventListener("click", () => {
          selectShip(ship.ticker);
        });

        strip.appendChild(thumb);
      });

      function selectShip(ticker) {
        const ship = fleet.find(s => s.ticker === ticker);
        if (!ship) return;

        // Render pixel ship in holobay
        renderFleetShipPixel(ship.ticker, ship.sector, ship.pnlNum);
        
        // Update sidebar ship profile too
        updateSidebarShip(ship.ticker, ship.sector, ship.pnlNum);
        
        // Get lore for display
        const lore = getPixelShipLore(ship.pattern);

        nameEl.textContent = `${ship.ticker} · ${ship.codename}`;
        classEl.textContent = ship.shipClass + (ship.isHero ? ' ★' : '');
        sectorEl.textContent = lore.hud; // Show HUD tag instead of sector

        const health = pnlToHealth(ship.pnlNum);
        hullBar.style.width = `${Math.max(5, health)}%`;
        hullText.textContent = healthLabel(health);

        const cargoRatio = ship.value / fleet.reduce((s,x)=>s+x.value,0);
        const cargoPct = Math.round(cargoRatio * 100);
        cargoBar.style.width = `${Math.max(5, cargoPct)}%`;
        cargoText.textContent = `${cargoPct}% of fleet cargo`;

        const vel = Math.min(100, Math.abs(ship.pnlNum) * 2.5);
        velBar.style.width = `${Math.max(5, vel)}%`;
        velText.textContent = `${vel.toFixed(0)} · risk velocity`;

        if (health < 45) {
          hullBar.classList.add("fleet-danger");
        } else {
          hullBar.classList.remove("fleet-danger");
        }

        strip.querySelectorAll(".fleet-thumb").forEach(t => {
          t.classList.toggle("active", t.dataset.ticker === ticker);
        });

        // Also trigger main chart update if the function exists
        if (typeof loadTicker === 'function') {
          loadTicker(ticker);
        }
      }

      // Initial selection = biggest position
      const primary = fleet.slice().sort((a,b)=>b.value-a.value)[0];
      if (primary) selectShip(primary.ticker);
    }
    
    async function init() {
      updateTime();
      setInterval(updateTime, 1000);
      try {
        const res = await fetch('data/stats.json');
        const data = await res.json();
        statsData = data.stats;
        buildWatchlist(data.tickers);
      } catch (e) {
        buildWatchlist(['RKLB', 'LUNR', 'ASTS', 'ACHR', 'JOBY', 'BKSY', 'RDW', 'PL', 'EVEX', 'GME']);
      }
      await loadTicker(currentTicker);
      renderStockPositions();
      renderOptionsPositions();
      renderCatalysts();
      renderActivity();
      renderPositionCharts();
      
      // Initialize Fleet HoloBay
      initFleetHolobay();
      
      // Initialize glossary tooltips
      attachGlossaryTooltips();
      
      // Calculate and update portfolio mood based on demo data
      const totalDailyPnl = DEMO_STOCK_POSITIONS.reduce((sum, pos) => {
        const dailyChange = (pos.current_price - pos.entry_price) / pos.entry_price * 100;
        return sum + dailyChange;
      }, 0) / DEMO_STOCK_POSITIONS.length;
      updatePortfolioMood(totalDailyPnl);
      
      // Initialize volatility display using data-driven score
      const vol = getVolScoreForTicker(currentTicker);
      if (vol > 0) {
        updateVolatilityDisplay(vol);
      }
      
      // Mission log startup message
      setTimeout(() => {
        pushMissionLog({ 
          type: 'scenario', 
          title: 'UPLINK ESTABLISHED', 
          subtitle: 'Mission Control systems online · defensive grid active',
          arcade: true
        });
      }, 500);
    }
    
    function updateTime() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('time-display').innerHTML = h + '<span class="blink">:</span>' + m;
    }
    
    function buildWatchlist(tickers) {
      const watchlistHTML = tickers.map(t => {
        const stats = statsData[t] || {};
        const change = stats.return_1d || 0;
        const theme = tickerThemes[t] || '';
        const color = tickerColors[t] || '#33ff99';
        return '<div class="watchlist-item ' + (t === currentTicker ? 'active' : '') + '" onclick="selectTicker(\'' + t + '\'); if(window.innerWidth <= 768) toggleMobileDrawer();">' +
          '<div class="watchlist-info"><div class="watchlist-ticker" style="color: ' + color + '">' + t + '</div>' +
          '<div class="watchlist-meta">' + theme + '</div></div>' +
          '<div class="watchlist-data"><div class="watchlist-price">$' + (stats.current || 0).toFixed(2) + '</div>' +
          '<div class="watchlist-change ' + (change >= 0 ? 'positive' : 'negative') + '">' + (change >= 0 ? '+' : '') + change.toFixed(2) + '%</div></div></div>';
      }).join('');
      
      document.getElementById('watchlist').innerHTML = watchlistHTML;
      
      // Also populate mobile watchlist
      const mobileWatchlist = document.getElementById('mobile-watchlist');
      if (mobileWatchlist) {
        mobileWatchlist.innerHTML = watchlistHTML;
      }
      
      // Also populate mobile ticker carousel
      populateMobileTickerCarousel();
    }
    
    // Mobile drawer toggle
    let scrollPosition = 0;
    function toggleMobileDrawer() {
      const drawer = document.getElementById('mobile-drawer');
      const backdrop = document.getElementById('mobile-drawer-backdrop');
      if (drawer && backdrop) {
        const isOpening = !drawer.classList.contains('open');
        drawer.classList.toggle('open');
        backdrop.classList.toggle('open');
        
        if (isOpening) {
          // Save scroll position and lock body
          scrollPosition = window.pageYOffset;
          document.body.classList.add('modal-open');
          document.body.style.top = `-${scrollPosition}px`;
        } else {
          // Restore scroll position
          document.body.classList.remove('modal-open');
          document.body.style.top = '';
          window.scrollTo(0, scrollPosition);
        }
      }
    }
    
    async function loadTicker(ticker) {
      if (!tickerData[ticker]) {
        try { tickerData[ticker] = await (await fetch('data/' + ticker.toLowerCase() + '.json')).json(); } catch (e) { return; }
      }
      currentTicker = ticker;
      updateTickerDisplay();
      updateCharts();
      updateMACDDisplay();
      
      // Call new status functions
      const data = tickerData[ticker];
      if (data) {
        updateTrendStatus(data);
        updateVolumeStatus(data);
        resetSimulation();
        
        // Update volatility display for new ticker
        const vol = getVolScoreForTicker(ticker);
        if (vol > 0) {
          updateVolatilityDisplay(vol);
        }
      }
      
      // Update sidebar ship profile
      const profile = TICKER_PROFILES[ticker] || {};
      const sector = profile.sector || 'Unknown';
      const pos = DEMO_STOCK_POSITIONS.find(p => p.ticker === ticker);
      const pnlNum = pos ? ((pos.current_price - pos.entry_price) / pos.entry_price) * 100 : 0;
      if (typeof updateSidebarShip === 'function') {
        updateSidebarShip(ticker, sector, pnlNum);
      }
      
      // Update telemetry HUD ship sprite
      if (typeof updateTelemetryShipSprite === 'function') {
        updateTelemetryShipSprite(ticker);
      }
      
      document.querySelectorAll('.watchlist-item').forEach(el => {
        const tickerEl = el.querySelector('.watchlist-ticker');
        el.classList.toggle('active', tickerEl && tickerEl.textContent === ticker);
      });
    }
    
    function selectTicker(ticker) { loadTicker(ticker); }
    
    // P&L Simulation
    function resetSimulation() {
      const resultEl = document.getElementById('sim-result');
      resultEl.className = 'sim-result';
      resultEl.innerHTML = '<div class="sim-result-label">Select parameters above</div>';
    }
    
    function runPnLSimulation() {
      const data = tickerData[currentTicker];
      if (!data || !data.daily || !data.daily.length) {
        showSimError('No historical data available');
        return;
      }
      
      const dateInput = document.getElementById('sim-entry-date').value;
      const capital = parseFloat(document.getElementById('sim-capital').value) || 0;
      
      if (!dateInput) {
        showSimError('Please select an entry date');
        return;
      }
      
      if (capital < 100) {
        showSimError('Minimum capital: $100');
        return;
      }
      
      const daily = data.daily;
      const entryTs = new Date(dateInput).getTime();
      const dataStartTs = daily[0].t;
      const dataEndTs = daily[daily.length - 1].t;
      
      if (entryTs < dataStartTs) {
        showSimError('Date before available data range');
        return;
      }
      
      // Find entry candle (first candle on or after entry date)
      const entryCandle = daily.find(p => p.t >= entryTs);
      if (!entryCandle) {
        showSimError('No data for selected date');
        return;
      }
      
      const lastCandle = daily[daily.length - 1];
      const entryPrice = entryCandle.c;
      const lastPrice = lastCandle.c;
      
      const shares = Math.floor(capital / entryPrice);
      const actualInvested = shares * entryPrice;
      const currentValue = shares * lastPrice;
      const pnl = currentValue - actualInvested;
      const returnPct = ((lastPrice - entryPrice) / entryPrice) * 100;
      
      const entryDate = new Date(entryCandle.t).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const holdDays = Math.floor((lastCandle.t - entryCandle.t) / 86400000);
      
      const resultEl = document.getElementById('sim-result');
      const isPositive = pnl >= 0;
      
      resultEl.className = 'sim-result ' + (isPositive ? 'positive' : 'negative');
      resultEl.innerHTML = 
        '<div class="sim-result-label">Simulated P&L</div>' +
        '<div class="sim-result-value ' + (isPositive ? 'positive' : 'negative') + '">' +
          (isPositive ? '+' : '−') + '$' + Math.abs(pnl).toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}) +
        '</div>' +
        '<div class="sim-result-pct">' + (isPositive ? '+' : '') + returnPct.toFixed(1) + '% return</div>' +
        '<div class="sim-result-meta">' +
          shares + ' shares @ $' + entryPrice.toFixed(2) + ' → $' + lastPrice.toFixed(2) + '<br>' +
          'Entry: ' + entryDate + ' • ' + holdDays + ' days held' +
        '</div>';
    }
    
    function showSimError(msg) {
      const resultEl = document.getElementById('sim-result');
      resultEl.className = 'sim-result';
      resultEl.innerHTML = '<div class="sim-result-label" style="color: var(--signal-down);">' + msg + '</div>';
    }
    
    function updateTickerDisplay() {
      const stats = statsData[currentTicker] || {};
      const change = stats.return_1d || 0;
      const color = tickerColors[currentTicker] || '#33ff99';
      const tickerEl = document.getElementById('chart-ticker');
      tickerEl.textContent = currentTicker;
      tickerEl.style.color = color;
      tickerEl.style.textShadow = '0 0 20px ' + color + '40';
      document.getElementById('chart-price').textContent = '$' + (stats.current || 0).toFixed(2);
      const el = document.getElementById('chart-change');
      el.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
      el.className = 'ticker-change ' + (change >= 0 ? 'positive' : 'negative');
    }
    
    function updateMACDDisplay() {
      const data = tickerData[currentTicker];
      if (!data) return;
      const source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || !source.length) return;
      const latest = source[source.length - 1];
      
      const macdVal = latest.macd || 0;
      const signalVal = latest.signal || 0;
      const histVal = latest.hist || 0;
      
      if (latest.macd !== undefined) {
        const el = document.getElementById('macd-val');
        el.textContent = latest.macd.toFixed(4);
        el.className = 'macd-value ' + (latest.macd >= 0 ? 'positive' : 'negative');
      }
      if (latest.signal !== undefined) document.getElementById('signal-val').textContent = latest.signal.toFixed(4);
      if (latest.hist !== undefined) {
        const el = document.getElementById('hist-val');
        el.textContent = latest.hist.toFixed(4);
        el.className = 'macd-value ' + (latest.hist >= 0 ? 'positive' : 'negative');
      }
      
      // Update MACD status using glossary
      const macdStatus = getMacdStatus(macdVal, signalVal, histVal);
      const statusEl = document.getElementById('macd-status');
      if (statusEl) {
        const labelEl = statusEl.querySelector('.macd-status-label');
        const copyEl = statusEl.querySelector('.macd-status-copy');
        if (labelEl) labelEl.textContent = macdStatus.label;
        if (copyEl) copyEl.textContent = macdStatus.copy;
        
        // Color based on state
        statusEl.className = 'macd-status';
        if (macdStatus === MACD_STATES.bullish_cross) statusEl.classList.add('bullish');
        else if (macdStatus === MACD_STATES.bearish_cross) statusEl.classList.add('bearish');
      }
    }
    
    function updateTrendStatus(data) {
      const source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || !source.length) return;
      
      // Find the last candle with MA data
      let last = null;
      for (let i = source.length - 1; i >= 0; i--) {
        if (source[i].g100 !== undefined || source[i].g200 !== undefined) {
          last = source[i];
          break;
        }
      }
      
      if (!last) {
        document.getElementById('trend-status-label').textContent = 'NO MA DATA';
        document.getElementById('trend-status-detail').textContent = 'Moving average data unavailable for this range.';
        document.getElementById('trend-status-badge').className = 'trend-status-badge';
        return;
      }
      
      const price = last.c;
      const g100 = last.g100;
      const g150 = last.g150;
      const g200 = last.g200;
      const macdVal = last.macd || 0;
      
      // Compute volatility score for current ticker
      const volScore = getVolScoreForTicker(currentTicker);
      
      const badgeEl = document.getElementById('trend-status-badge');
      const labelEl = document.getElementById('trend-status-label');
      const detailEl = document.getElementById('trend-status-detail');
      const iconEl = document.getElementById('trend-icon');
      
      // Update MA metric values
      document.getElementById('ma100-val').textContent = g100 ? '$' + g100.toFixed(2) : '--';
      document.getElementById('ma150-val').textContent = g150 ? '$' + g150.toFixed(2) : '--';
      document.getElementById('ma200-val').textContent = g200 ? '$' + g200.toFixed(2) : '--';
      
      // Use glossary-based trend state calculation with volatility
      const trendState = getTrendState(price, g100, g150, g200, macdVal, volScore);
      
      // Determine CSS mode class
      let mode = 'neutral';
      if (trendState === HASLUN_GLOSSARY.trend_full_thrust) mode = 'bull';
      else if (trendState === HASLUN_GLOSSARY.trend_reentry_risk) mode = 'bear';
      else if (trendState === HASLUN_GLOSSARY.trend_nebula) mode = 'volatile';
      else if (trendState === HASLUN_GLOSSARY.trend_reversal_attempt) mode = 'neutral';
      else if (trendState === HASLUN_GLOSSARY.trend_drifting) mode = 'neutral';
      
      // Update UI with glossary content
      labelEl.textContent = trendState.label;
      iconEl.textContent = trendState.icon || '◈';
      
      // Build detail text with price context
      const priceContext = `Price $${price.toFixed(2)}`;
      detailEl.innerHTML = `<span class="trend-subtitle">${trendState.subtitle}</span> ${priceContext}. ${trendState.body.split('.')[0]}.`;
      
      badgeEl.className = 'trend-status-badge trend-' + mode;
      badgeEl.title = trendState.flavor; // Add flavor as hover tooltip
      
      // Apply dynamic border color from glossary
      if (trendState.color) {
        badgeEl.style.borderColor = trendState.color;
      }
    }
    
    function updateVolumeStatus(data) {
      const source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || source.length < 10) {
        document.getElementById('volume-status').textContent = '--';
        document.getElementById('volume-status').className = 'volume-badge';
        return;
      }
      
      // Get last 50 candles for average calculation
      const recent = source.slice(-50);
      const vols = recent.map(p => p.v).filter(v => v && v > 0);
      
      if (vols.length < 5) {
        document.getElementById('volume-status').textContent = 'N/A';
        return;
      }
      
      const avg = vols.reduce((a, b) => a + b, 0) / vols.length;
      const current = vols[vols.length - 1];
      const ratio = current / avg;
      
      const el = document.getElementById('volume-status');
      let label, cls;
      
      if (ratio >= 2) {
        label = 'VOL: HIGH (' + ratio.toFixed(1) + '×)';
        cls = 'vol-high';
      } else if (ratio >= 1.25) {
        label = 'VOL: ELEVATED';
        cls = 'vol-elevated';
      } else if (ratio <= 0.5) {
        label = 'VOL: QUIET';
        cls = 'vol-quiet';
      } else {
        label = 'VOL: NORMAL';
        cls = 'vol-normal';
      }
      
      el.textContent = label;
      el.className = 'volume-badge ' + cls;
    }
    
    function setTimeframe(tf) {
      currentTimeframe = tf;
      document.querySelectorAll('.ctrl-btn[data-tf]').forEach(btn => btn.classList.toggle('active', btn.dataset.tf === tf));
      updateCharts();
      updateMACDDisplay();
      // Also update trend and volume for new timeframe
      const data = tickerData[currentTicker];
      if (data) {
        updateTrendStatus(data);
        updateVolumeStatus(data);
      }
    }
    
    function setRange(range) {
      currentRange = range;
      document.querySelectorAll('.ctrl-btn[data-range]').forEach(btn => btn.classList.toggle('active', btn.dataset.range === range));
      updateCharts();
    }
    
    function toggleMA() {
      showMA = !showMA;
      document.getElementById('ma-toggle').classList.toggle('active', showMA);
      updateCharts();
    }
    
    function updateCharts() {
      const data = tickerData[currentTicker];
      if (!data) return;
      let source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || !source.length) return;
      const cutoff = Date.now() - (rangeDays[currentRange] * 86400000);
      source = source.filter(d => d.t > cutoff);
      
      if (!source.length) return;
      
      const labels = source.map(d => new Date(d.t));
      const closes = source.map(d => d.c);
      const color = tickerColors[currentTicker] || '#33ff99';
      
      // Calculate proper Y-axis bounds with padding
      const minPrice = Math.min(...closes);
      const maxPrice = Math.max(...closes);
      const priceRange = maxPrice - minPrice;
      const padding = priceRange * 0.08 || maxPrice * 0.02; // 8% padding, or 2% if flat
      
      // For short timeframes, use tighter bounds to show movement
      const isShortRange = ['1W', '1M'].includes(currentRange);
      const yPadding = isShortRange ? padding * 0.5 : padding;
      
      if (priceChart) priceChart.destroy();
      const datasets = [{ 
        label: currentTicker, 
        data: closes, 
        borderColor: color, 
        backgroundColor: color + '15', 
        borderWidth: 2, 
        fill: true, 
        tension: 0.1, 
        pointRadius: 0, 
        pointHoverRadius: 4 
      }];
      
      if (showMA) {
        if (source.some(d => d.g100)) datasets.push({ label: 'MA 100', data: source.map(d => d.g100), borderColor: '#ffb347', borderWidth: 1, fill: false, tension: 0.1, pointRadius: 0 });
        if (source.some(d => d.g150)) datasets.push({ label: 'MA 150', data: source.map(d => d.g150), borderColor: '#b388ff', borderWidth: 1, fill: false, tension: 0.1, pointRadius: 0 });
        if (source.some(d => d.g200)) datasets.push({ label: 'MA 200', data: source.map(d => d.g200), borderColor: '#47d4ff', borderWidth: 1, fill: false, tension: 0.1, pointRadius: 0 });
      }
      
      priceChart = new Chart(document.getElementById('price-chart'), {
        type: 'line', 
        data: { labels, datasets },
        options: {
          responsive: true, 
          maintainAspectRatio: false, 
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { display: showMA, position: 'top', labels: { boxWidth: 12, font: { size: 10, family: "'IBM Plex Mono', monospace" }, color: '#5a7068' } },
            tooltip: { backgroundColor: 'rgba(10, 12, 15, 0.95)', titleColor: '#e8f4f0', bodyColor: '#a8c0b8', borderColor: '#1e2832', borderWidth: 1, titleFont: { family: "'IBM Plex Mono', monospace" }, bodyFont: { family: "'IBM Plex Mono', monospace" }, callbacks: { label: i => i.dataset.label + ': $' + i.parsed.y.toFixed(2) } }
          },
          scales: {
            x: { 
              type: 'time', 
              grid: { color: 'rgba(51, 255, 153, 0.05)' }, 
              ticks: { color: '#3a4a44', font: { family: "'IBM Plex Mono', monospace", size: 10 }, maxTicksLimit: 8 } 
            },
            y: { 
              position: 'right', 
              min: minPrice - yPadding,
              max: maxPrice + yPadding,
              grid: { color: 'rgba(51, 255, 153, 0.05)' }, 
              ticks: { color: '#5a7068', font: { family: "'IBM Plex Mono', monospace", size: 10 }, callback: v => '$' + v.toFixed(2) } 
            }
          }
        }
      });
      
      if (macdChart) macdChart.destroy();
      const macdData = source.map(d => d.macd), signalData = source.map(d => d.signal), histData = source.map(d => d.hist);
      macdChart = new Chart(document.getElementById('macd-chart'), {
        type: 'bar', data: { labels, datasets: [
          { label: 'Histogram', data: histData, type: 'bar', order: 2, backgroundColor: histData.map(v => v >= 0 ? 'rgba(51, 255, 153, 0.5)' : 'rgba(255, 107, 107, 0.5)'), borderColor: histData.map(v => v >= 0 ? '#33ff99' : '#ff6b6b'), borderWidth: 1 },
          { label: 'MACD', data: macdData, type: 'line', order: 1, borderColor: '#47d4ff', borderWidth: 1.5, fill: false, tension: 0.1, pointRadius: 0 },
          { label: 'Signal', data: signalData, type: 'line', order: 0, borderColor: '#ffb347', borderWidth: 1.5, fill: false, tension: 0.1, pointRadius: 0 }
        ]},
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { type: 'time', display: false }, y: { position: 'right', grid: { color: 'rgba(51, 255, 153, 0.05)' }, ticks: { color: '#5a7068', font: { family: "'IBM Plex Mono', monospace", size: 9 } } } } }
      });
      
      // Update telemetry side console
      updateTelemetryConsole(source, closes);
    }
    
    // Update the telemetry side console with current data
    function updateTelemetryConsole(source, closes) {
      if (!source || !source.length) return;
      
      const latest = source[source.length - 1];
      const first = source[0];
      const color = tickerColors[currentTicker] || '#33ff99';
      const profile = TICKER_PROFILES[currentTicker] || {};
      const shipInfo = SHIP_NAMES[currentTicker] || { name: currentTicker, designation: 'UNK-XXX' };
      
      // Calculate metrics
      const currentPrice = latest.c;
      const priceChange = ((currentPrice - first.c) / first.c * 100);
      const hullHealth = Math.max(10, Math.min(100, 50 + priceChange * 2));
      const riskVelocity = Math.min(100, Math.abs(priceChange) * 2.5).toFixed(0);
      
      // Update header callout
      const callout = document.getElementById('telemetry-ship-name');
      if (callout) callout.textContent = `${currentTicker} · ${shipInfo.name}`;
      
      // Update hull bar
      const hullFill = document.getElementById('tm-hull-fill');
      if (hullFill) {
        hullFill.style.width = `${hullHealth}%`;
        hullFill.className = 'fill' + (hullHealth < 40 ? ' danger' : '');
      }
      
      // Update risk velocity
      const riskEl = document.getElementById('tm-risk-vel');
      if (riskEl) {
        riskEl.textContent = riskVelocity;
        riskEl.className = 'value' + (parseInt(riskVelocity) > 50 ? ' warn' : '');
      }
      
      // Update signal status based on MACD
      const signalEl = document.getElementById('tm-signal');
      if (signalEl && latest.macd !== undefined) {
        const macd = latest.macd || 0;
        const sig = latest.signal || 0;
        const hist = latest.hist || 0;
        
        if (macd > sig && hist > 0) {
          signalEl.textContent = 'BULLISH';
          signalEl.className = 'value positive';
        } else if (macd < sig && hist < 0) {
          signalEl.textContent = 'BEARISH';
          signalEl.className = 'value negative';
        } else if (Math.abs(hist) < 0.05) {
          signalEl.textContent = 'DRIFTING';
          signalEl.className = 'value';
        } else {
          signalEl.textContent = 'MIXED';
          signalEl.className = 'value warn';
        }
      }
      
      // Update sensor bank (MAs)
      const ma100El = document.getElementById('tm-ma100');
      const ma150El = document.getElementById('tm-ma150');
      const ma200El = document.getElementById('tm-ma200');
      const priceEl = document.getElementById('tm-price');
      
      if (ma100El) ma100El.textContent = latest.g100 ? '$' + latest.g100.toFixed(2) : '--';
      if (ma150El) ma150El.textContent = latest.g150 ? '$' + latest.g150.toFixed(2) : '--';
      if (ma200El) ma200El.textContent = latest.g200 ? '$' + latest.g200.toFixed(2) : '--';
      if (priceEl) priceEl.textContent = '$' + currentPrice.toFixed(2);
      
      // Update thrust vector (MACD)
      const macdEl = document.getElementById('tm-macd');
      const sigEl = document.getElementById('tm-sig');
      const histoEl = document.getElementById('tm-histo');
      const macdRow = document.getElementById('tm-macd-row');
      const sigRow = document.getElementById('tm-signal-row');
      const histoRow = document.getElementById('tm-histo-row');
      
      if (latest.macd !== undefined) {
        if (macdEl) macdEl.textContent = latest.macd.toFixed(4);
        if (sigEl) sigEl.textContent = latest.signal.toFixed(4);
        if (histoEl) histoEl.textContent = latest.hist.toFixed(4);
        
        if (macdRow) macdRow.className = 'console-row ' + (latest.macd >= 0 ? 'positive' : 'negative');
        if (histoRow) histoRow.className = 'console-row ' + (latest.hist >= 0 ? 'positive' : 'negative');
      }
      
      // Update range chip
      const rangeChip = document.getElementById('tm-range-chip');
      if (rangeChip) rangeChip.innerHTML = `<span class="dot"></span>RANGE · ${currentRange}`;
      
      // Render ship in console
      renderConsoleShip(currentTicker, priceChange);
      
      // Add bridge feed entry
      addBridgeFeedEntry(currentTicker, latest, priceChange);
    }
    
    // Render the pixel ship in the side console
    function renderConsoleShip(ticker, pnlPercent) {
      const container = document.getElementById('console-ship-display');
      const labelEl = document.getElementById('console-ship-class');
      if (!container) return;
      
      const sector = tickerThemes[ticker] || 'UNKNOWN';
      const meta = mapTickerToPixelShip(ticker, sector, pnlPercent);
      const lore = PIXEL_SHIP_LORE[meta.pattern] || PIXEL_SHIP_LORE.drone;
      const color = tickerColors[ticker] || '#33ff99';
      
      // Use PNG sprite (custom or fallback)
      const spritePath = SHIP_SPRITES[ticker] || DEFAULT_SHIP_SPRITE;
      
      // Use PNG sprite
      let img = container.querySelector('img.console-ship-img');
      let svg = container.querySelector('svg#console-ship-svg');
      
      if (!img) {
        img = document.createElement('img');
        img.className = 'console-ship-img';
        img.style.cssText = 'width: 80px; height: 50px; object-fit: contain; filter: drop-shadow(0 0 8px var(--phosphor));';
        container.insertBefore(img, container.firstChild);
      }
      
      img.src = spritePath;
      img.alt = `${ticker} vessel`;
      img.style.display = 'block';
      
      if (svg) svg.style.display = 'none';
      
      if (labelEl) labelEl.textContent = lore.label;
    }
    
    // Add entry to bridge feed
    function addBridgeFeedEntry(ticker, latest, priceChange) {
      const logEl = document.getElementById('telemetry-log');
      if (!logEl) return;
      
      const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
      
      // Generate status text based on data
      let statusText = '';
      let entryClass = '';
      
      const macd = latest.macd || 0;
      const sig = latest.signal || 0;
      const hist = latest.hist || 0;
      
      if (macd > sig && hist > 0.05) {
        statusText = `${ticker} thrust vector aligned · bullish crossover`;
        entryClass = 'positive';
      } else if (macd < sig && hist < -0.05) {
        statusText = `${ticker} warning · bearish divergence detected`;
        entryClass = 'negative';
      } else if (Math.abs(priceChange) > 5) {
        statusText = `${ticker} high velocity movement · ${priceChange > 0 ? 'climbing' : 'descending'}`;
        entryClass = priceChange > 0 ? 'positive' : 'negative';
      } else if (Math.abs(hist) < 0.02) {
        statusText = `${ticker} signal drifting · no clear vector`;
        entryClass = '';
      } else {
        statusText = `${ticker} telemetry nominal · monitoring`;
        entryClass = '';
      }
      
      // Create new entry
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + entryClass;
      entry.innerHTML = `<span class="timestamp">[${timestamp}]</span>${statusText}`;
      
      // Add to top of log
      logEl.insertBefore(entry, logEl.firstChild);
      
      // Keep only last 8 entries
      while (logEl.children.length > 8) {
        logEl.removeChild(logEl.lastChild);
      }
    }
    
    function switchTab(tabName) {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === tabName + '-panel'));
      
      // Refresh arcade previews when switching to arcade tab
      if (tabName === 'arcade' && window.SpriteCache && SpriteCache.loaded) {
        setTimeout(() => SpriteCache.renderGamePreviews(), 100);
      }
    }
    
    // =========================================================================
    // MOBILE UI FUNCTIONS
    // =========================================================================
    
    function switchTabMobile(tabName) {
      // Update mobile bottom nav
      document.querySelectorAll('.mobile-nav-item').forEach(t => {
        t.classList.toggle('active', t.dataset.tab === tabName);
      });
      // Update desktop nav tabs (keep in sync)
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      // Update panels
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === tabName + '-panel'));
      // Play sound
      if (window.SoundFX) SoundFX.play('click');
    }
    
    function toggleFabMenu() {
      const fabMain = document.getElementById('fab-main');
      const fabMenu = document.getElementById('fab-menu');
      if (fabMain && fabMenu) {
        fabMain.classList.toggle('open');
        fabMenu.classList.toggle('open');
        if (window.SoundFX) SoundFX.play('click');
      }
    }
    
    function toggleFabSFX() {
      const sfxToggle = document.getElementById('sfx-toggle');
      const fabSfx = document.getElementById('fab-sfx');
      if (sfxToggle) {
        sfxToggle.checked = !sfxToggle.checked;
        sfxToggle.dispatchEvent(new Event('change'));
        if (fabSfx) {
          fabSfx.innerHTML = '<span class="fab-icon">🔊</span><span>SFX ' + (sfxToggle.checked ? 'ON' : 'OFF') + '</span>';
          fabSfx.classList.toggle('active', sfxToggle.checked);
        }
      }
    }
    
    function toggleFabBGM() {
      const bgmToggle = document.getElementById('bgm-toggle');
      const fabBgm = document.getElementById('fab-bgm');
      if (bgmToggle) {
        bgmToggle.checked = !bgmToggle.checked;
        bgmToggle.dispatchEvent(new Event('change'));
        if (fabBgm) {
          fabBgm.innerHTML = '<span class="fab-icon">🎵</span><span>BGM ' + (bgmToggle.checked ? 'ON' : 'OFF') + '</span>';
          fabBgm.classList.toggle('active', bgmToggle.checked);
        }
      }
    }
    
    function showAboutOverlay() {
      const aboutTrigger = document.getElementById('about-trigger-btn');
      if (aboutTrigger) {
        aboutTrigger.click();
      }
      toggleFabMenu();
    }
    
    function populateMobileTickerCarousel() {
      const carouselInner = document.getElementById('ticker-carousel-inner');
      if (!carouselInner) return;
      
      const tickers = Object.keys(statsData).filter(t => t && statsData[t]);
      if (tickers.length === 0) return;
      
      carouselInner.innerHTML = tickers.map(ticker => {
        const stats = statsData[ticker] || {};
        const price = stats.current || 0;
        const change = stats.return_1d || 0;
        const changeClass = change >= 0 ? 'positive' : 'negative';
        const isActive = ticker === currentTicker;
        const color = tickerColors[ticker] || '#33ff99';
        
        return '<div class="carousel-ticker ' + (isActive ? 'active' : '') + '" data-ticker="' + ticker + '" onclick="selectTickerFromCarousel(\'' + ticker + '\')" style="--ticker-color: ' + color + '">' +
          '<div class="carousel-ticker-symbol" style="color: ' + color + '">' + ticker + '</div>' +
          '<div class="carousel-ticker-price">$' + price.toFixed(2) + '</div>' +
          '<div class="carousel-ticker-change ' + changeClass + '">' + (change >= 0 ? '+' : '') + change.toFixed(1) + '%</div>' +
        '</div>';
      }).join('');
    }
    
    function selectTickerFromCarousel(ticker) {
      selectTicker(ticker);
      // Update carousel active state
      document.querySelectorAll('.carousel-ticker').forEach(t => {
        t.classList.toggle('active', t.dataset.ticker === ticker);
      });
      if (window.SoundFX) SoundFX.play('click');
    }
    
    function updateMobileUptime() {
      const uptimeEl = document.getElementById('mobile-uptime');
      const desktopUptimeEl = document.getElementById('uptime');
      if (uptimeEl && desktopUptimeEl) {
        const uptimeText = desktopUptimeEl.textContent.replace('UPTIME: ', '');
        // Shorten for mobile: "00:12:34" -> "12:34"
        const parts = uptimeText.split(':');
        if (parts.length === 3 && parts[0] === '00') {
          uptimeEl.textContent = parts[1] + ':' + parts[2];
        } else {
          uptimeEl.textContent = uptimeText;
        }
      }
    }
    
    // Initialize mobile-specific features
    function initMobileUI() {
      // Populate ticker carousel after data loads
      setTimeout(populateMobileTickerCarousel, 1500);
      
      // Update mobile uptime periodically
      setInterval(updateMobileUptime, 1000);
      
      // Close FAB menu when clicking outside
      document.addEventListener('click', (e) => {
        const fab = document.getElementById('mobile-fab');
        const fabMain = document.getElementById('fab-main');
        const fabMenu = document.getElementById('fab-menu');
        if (fab && fabMain && fabMenu && fabMenu.classList.contains('open')) {
          if (!fab.contains(e.target)) {
            fabMain.classList.remove('open');
            fabMenu.classList.remove('open');
          }
        }
      });
      
      // Swipe gesture for mobile drawer
      let touchStartX = 0;
      let touchEndX = 0;
      
      document.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      }, { passive: true });
      
      document.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipeGesture();
      }, { passive: true });
      
      function handleSwipeGesture() {
        const swipeDistance = touchEndX - touchStartX;
        const minSwipeDistance = 80;
        const drawer = document.getElementById('mobile-drawer');
        const isDrawerOpen = drawer && drawer.classList.contains('open');
        
        // Swipe right from left edge to open drawer
        if (touchStartX < 30 && swipeDistance > minSwipeDistance && !isDrawerOpen) {
          toggleMobileDrawer();
        }
        // Swipe left to close drawer
        if (isDrawerOpen && swipeDistance < -minSwipeDistance) {
          toggleMobileDrawer();
        }
      }
      
      // Pull to refresh visual (doesn't actually refresh, just visual feedback)
      let pullStartY = 0;
      const pullIndicator = document.getElementById('pull-indicator');
      
      document.addEventListener('touchstart', (e) => {
        if (window.scrollY === 0) {
          pullStartY = e.changedTouches[0].screenY;
        }
      }, { passive: true });
      
      document.addEventListener('touchmove', (e) => {
        if (pullStartY > 0 && window.scrollY === 0) {
          const pullDistance = e.changedTouches[0].screenY - pullStartY;
          if (pullDistance > 60 && pullIndicator) {
            pullIndicator.classList.add('visible');
          }
        }
      }, { passive: true });
      
      document.addEventListener('touchend', () => {
        pullStartY = 0;
        if (pullIndicator) {
          pullIndicator.classList.remove('visible');
        }
      }, { passive: true });
      
      // Sync FAB toggle states on load
      const sfxToggle = document.getElementById('sfx-toggle');
      const fabSfx = document.getElementById('fab-sfx');
      if (sfxToggle && fabSfx) {
        fabSfx.innerHTML = '<span class="fab-icon">🔊</span><span>SFX ' + (sfxToggle.checked ? 'ON' : 'OFF') + '</span>';
        fabSfx.classList.toggle('active', sfxToggle.checked);
      }
    }
    
    // Call initMobileUI when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileUI);
    } else {
      initMobileUI();
    }
    
    function switchChartTab(chartName) {
      document.querySelectorAll('.chart-tab').forEach(t => t.classList.toggle('active', t.dataset.chart === chartName));
      document.querySelectorAll('.chart-panel').forEach(p => p.classList.toggle('active', p.id === 'chart-' + chartName));
    }
    
    function renderStockPositions() {
      // Keep the legacy table rendering for table view
      const tbody = document.getElementById('stock-tbody');
      if (tbody) {
        tbody.innerHTML = DEMO_STOCK_POSITIONS.map(pos => {
          const value = pos.shares * pos.current_price;
          const pnl = (pos.current_price - pos.entry_price) * pos.shares;
          const pnlPct = ((pos.current_price - pos.entry_price) / pos.entry_price * 100);
          const color = tickerColors[pos.ticker] || '#33ff99';
          const hasDossier = TICKER_PROFILES[pos.ticker] ? true : false;
          const dossierBtn = hasDossier ? '<button class="dossier-btn" onclick="openTickerDossier(\'' + pos.ticker + '\')">◉</button>' : '';
          return '<tr class="position-row" data-ticker="' + pos.ticker + '">' +
            '<td><span class="ticker-tag">' + dossierBtn + '<span class="ticker-dot" style="background: ' + color + '"></span>' + pos.ticker + '</span></td>' +
            '<td style="color: var(--text-dim); font-size: 0.65rem; letter-spacing: 0.05em;">' + (tickerThemes[pos.ticker] || '') + '</td>' +
            '<td>' + pos.shares + '</td><td>$' + pos.entry_price.toFixed(2) + '</td><td>$' + pos.current_price.toFixed(2) + '</td>' +
            '<td>$' + value.toLocaleString() + '</td>' +
            '<td class="' + (pnl >= 0 ? 'pnl-positive' : 'pnl-negative') + '">' + (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(0) + ' (' + (pnlPct >= 0 ? '+' : '') + pnlPct.toFixed(1) + '%)</td></tr>';
        }).join('');
      }
      
      // Render the fleet grid
      renderFleetGrid();
    }
    
    // Ship name generation based on ticker
    const SHIP_NAMES = {
      RKLB: { name: "ELECTRON", designation: "FSC-001" },
      LUNR: { name: "ODYSSEY", designation: "LNR-002" },
      ASTS: { name: "BLUEBIRD", designation: "COM-003" },
      ACHR: { name: "MIDNIGHT", designation: "AAM-004" },
      JOBY: { name: "SKYWARD", designation: "EVT-005" },
      BKSY: { name: "BLACKSKY", designation: "RCN-006" },
      RDW: { name: "REDWIRE", designation: "INF-007" },
      PL: { name: "PLANET", designation: "SAT-008" },
      EVEX: { name: "HORIZON", designation: "AAM-009" },
      GME: { name: "DIAMOND", designation: "MEM-010" },
      MP: { name: "MAGNETO", designation: "MAT-011" },
      KTOS: { name: "KRATOS", designation: "DEF-012" },
      IRDM: { name: "IRIDIUM", designation: "COM-013" },
      HON: { name: "HONEYBEE", designation: "IND-014" },
      ATI: { name: "TITANIUM", designation: "MAT-015" },
      CACI: { name: "SENTINEL", designation: "DEF-016" },
      LOAR: { name: "PHOENIX", designation: "AER-017" },
      COHR: { name: "PRISM", designation: "OPT-018" },
      GE: { name: "SPECTRE", designation: "IND-019" },
      LHX: { name: "HELIX", designation: "AAM-020" },
      RTX: { name: "RAYTHEON", designation: "DEF-021" }
    };

    // Per-ticker ship sprites (PNG). If a ticker isn't listed here, we fall back to the procedural SVG.
    const SHIP_SPRITES = {
      ACHR: 'assets/ships/ACHR-eVTOL-ship.png',
      ASTS: 'assets/ships/ASTS-Communications-Relay-Ship.png',
      BKSY: 'assets/ships/BKSY-recon-ship.png',
      COHR: 'assets/ships/COHR-Glass-Reflector-ship.png',
      EVEX: 'assets/ships/EVEX-Transport-Ship.png',
      GE: 'assets/ships/GE-Stealth-Bomber-ship.png',
      GME: 'assets/ships/GME-moonshot-ship.png',
      JOBY: 'assets/ships/JOBY-eVTOL-light-class-ship.png',
      KTOS: 'assets/ships/KTOS-Fighter-Ship.png',
      LHX: 'assets/ships/LHX-Drone-ship.png',
      LUNR: 'assets/ships/LUNR-lander-ship.png',
      PL: 'assets/ships/PL-scout-ship.png',
      RDW: 'assets/ships/RDW-Hauler-ship.png',
      RKLB: 'assets/ships/RKLB-flagship-ship.png',
      RTX: 'assets/ships/RTX-Officer-Class-Ship.png'
    };
    
    // Default fallback sprite for tickers without custom ships
    const DEFAULT_SHIP_SPRITE = 'assets/ships/Unclaimed-Drone-ship.png';
    
    // =========================================================================
    // SPRITE CACHE SYSTEM - Preload PNG sprites for canvas games
    // =========================================================================
    const SpriteCache = {
      images: {},
      loaded: false,
      selectedPlayerShip: 'RKLB',
      
      // Preload all ship sprites
      preload() {
        const allSprites = { ...SHIP_SPRITES, DEFAULT: DEFAULT_SHIP_SPRITE };
        const promises = Object.entries(allSprites).map(([key, src]) => {
          return new Promise((resolve) => {
            const img = new Image();
            img.onload = () => {
              this.images[key] = img;
              resolve();
            };
            img.onerror = () => resolve(); // Continue even if one fails
            img.src = src;
          });
        });
        
        Promise.all(promises).then(() => {
          this.loaded = true;
          console.log('[SpriteCache] All ship sprites loaded');
          this.renderArcadeShipGrid();
          this.renderGamePreviews();
        });
      },
      
      // Get a sprite image (returns Image object or null)
      get(ticker) {
        return this.images[ticker] || this.images['DEFAULT'] || null;
      },
      
      // Get random fleet ship (for enemies)
      getRandomFleetShip() {
        const tickers = Object.keys(SHIP_SPRITES);
        const randomTicker = tickers[Math.floor(Math.random() * tickers.length)];
        return { ticker: randomTicker, image: this.get(randomTicker) };
      },
      
      // Draw sprite on canvas with options
      drawOnCanvas(ctx, ticker, x, y, scale = 1, options = {}) {
        const img = this.get(ticker);
        if (!img) return false;
        
        const width = (options.width || 60) * scale;
        const height = (options.height || 45) * scale;
        
        ctx.save();
        
        // Glow effect
        if (options.glow) {
          ctx.shadowColor = options.glowColor || tickerColors[ticker] || '#33ff99';
          ctx.shadowBlur = options.glowBlur || 10;
        }
        
        // Flip if specified (for enemies facing down)
        if (options.flipY) {
          ctx.translate(x, y);
          ctx.scale(1, -1);
          ctx.drawImage(img, -width / 2, -height / 2, width, height);
        } else {
          ctx.drawImage(img, x - width / 2, y - height / 2, width, height);
        }
        
        ctx.restore();
        return true;
      },
      
      // Render the arcade ship selection grid
      renderArcadeShipGrid() {
        const grid = document.getElementById('arcade-ship-grid');
        if (!grid) return;
        
        const tickers = Object.keys(SHIP_SPRITES);
        grid.innerHTML = tickers.map(ticker => {
          const color = tickerColors[ticker] || '#33ff99';
          const isSelected = ticker === this.selectedPlayerShip;
          return `
            <div class="ship-select-item ${isSelected ? 'selected' : ''}" 
                 style="--ship-color: ${color}"
                 onclick="SpriteCache.selectShip('${ticker}')"
                 data-ticker="${ticker}">
              <img src="${SHIP_SPRITES[ticker]}" alt="${ticker}">
              <span class="ship-ticker">${ticker}</span>
            </div>
          `;
        }).join('');
      },
      
      // Select a ship for the player
      selectShip(ticker) {
        this.selectedPlayerShip = ticker;
        // Update UI
        document.querySelectorAll('.ship-select-item').forEach(el => {
          el.classList.toggle('selected', el.dataset.ticker === ticker);
        });
        // Play sound
        if (window.MechSFX) MechSFX.click();
        // Toast
        if (typeof showToast === 'function') {
          const shipName = SHIP_NAMES[ticker]?.name || ticker;
          showToast(`${shipName} selected as your ship`, 'info');
        }
      },
      
      // Render game preview canvases
      renderGamePreviews() {
        this.renderInvadersPreview();
        this.renderLanderPreview();
      },
      
      renderInvadersPreview() {
        const canvas = document.getElementById('invaders-preview-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        
        // Dark background
        ctx.fillStyle = '#050608';
        ctx.fillRect(0, 0, 280, 160);
        
        // Stars
        ctx.fillStyle = 'rgba(51, 255, 153, 0.3)';
        for (let i = 0; i < 30; i++) {
          ctx.fillRect(Math.random() * 280, Math.random() * 160, 1, 1);
        }
        
        // Draw some enemy ships
        const enemyTickers = ['GE', 'KTOS', 'RTX', 'COHR'];
        enemyTickers.forEach((ticker, i) => {
          const x = 50 + (i % 4) * 55;
          const y = 30 + Math.floor(i / 4) * 40;
          this.drawOnCanvas(ctx, ticker, x, y, 0.6, { flipY: true, glow: true, glowBlur: 4 });
        });
        
        // Draw player ship at bottom
        this.drawOnCanvas(ctx, this.selectedPlayerShip, 140, 130, 0.7, { glow: true, glowBlur: 6 });
        
        // Draw some bullets
        ctx.fillStyle = '#33ff99';
        ctx.shadowColor = '#33ff99';
        ctx.shadowBlur = 4;
        ctx.fillRect(138, 100, 4, 10);
        ctx.fillRect(138, 70, 4, 10);
        ctx.shadowBlur = 0;
      },
      
      renderLanderPreview() {
        const canvas = document.getElementById('lander-preview-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        
        // Dark background
        ctx.fillStyle = '#050608';
        ctx.fillRect(0, 0, 280, 160);
        
        // Stars
        ctx.fillStyle = 'rgba(51, 255, 153, 0.2)';
        for (let i = 0; i < 20; i++) {
          ctx.fillRect(Math.random() * 280, Math.random() * 100, 1, 1);
        }
        
        // Draw terrain
        ctx.strokeStyle = '#33ff99';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, 140);
        ctx.lineTo(40, 130);
        ctx.lineTo(80, 145);
        ctx.lineTo(120, 120);
        ctx.lineTo(140, 120); // Landing zone
        ctx.lineTo(160, 120);
        ctx.lineTo(200, 140);
        ctx.lineTo(240, 125);
        ctx.lineTo(280, 135);
        ctx.stroke();
        
        // Landing zone highlight
        ctx.strokeStyle = '#ffb347';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(120, 120);
        ctx.lineTo(160, 120);
        ctx.stroke();
        
        // Draw lander ship
        this.drawOnCanvas(ctx, 'LUNR', 140, 60, 0.7, { glow: true, glowBlur: 8 });
        
        // Thrust flame
        ctx.fillStyle = '#ffb347';
        ctx.shadowColor = '#ffb347';
        ctx.shadowBlur = 8;
        ctx.fillRect(136, 80, 8, 12);
        ctx.shadowBlur = 0;
      }
    };
    
    // Initialize sprite cache on load
    SpriteCache.preload();
    
    function renderFleetGrid() {
      const fleetGrid = document.getElementById('fleet-grid');
      if (!fleetGrid) return;
      
      // Calculate totals
      let totalValue = 0;
      let totalPnl = 0;
      let operational = 0;
      let damaged = 0;
      const maxShares = Math.max(...DEMO_STOCK_POSITIONS.map(p => p.shares));
      const totalShares = DEMO_STOCK_POSITIONS.reduce((s, p) => s + p.shares, 0);
      
      // Build ship cards
      const shipCards = DEMO_STOCK_POSITIONS.map(pos => {
        const value = pos.shares * pos.current_price;
        const pnl = (pos.current_price - pos.entry_price) * pos.shares;
        const pnlPct = ((pos.current_price - pos.entry_price) / pos.entry_price * 100);
        const color = tickerColors[pos.ticker] || '#33ff99';
        const profile = TICKER_PROFILES[pos.ticker] || {};
        const shipInfo = SHIP_NAMES[pos.ticker] || { name: pos.ticker, designation: 'UNK-XXX' };
        const sector = tickerThemes[pos.ticker] || 'UNKNOWN';
        
        totalValue += value;
        totalPnl += pnl;
        
        // Map to ship type
        const shipMeta = mapTickerToPixelShip(pos.ticker, sector, pnlPct);
        const shipLore = PIXEL_SHIP_LORE[shipMeta.pattern] || PIXEL_SHIP_LORE.drone;
        
        // Calculate stats for bars
        const hullHealth = Math.max(10, Math.min(100, 50 + pnlPct * 2)); // P&L affects hull
        const cargoPercent = Math.round((pos.shares / totalShares) * 100);
        const fuelPercent = Math.max(10, Math.min(100, Math.random() * 40 + 60)); // Random fuel level
        
        const isOperational = pnlPct >= 0;
        if (isOperational) operational++;
        else damaged++;
        
        // Sprite if available; otherwise use fallback sprite (all ships now have sprites)
        const spritePath = SHIP_SPRITES[pos.ticker] || DEFAULT_SHIP_SPRITE;
        const shipVisualMarkup = `<img src="${spritePath}" alt="${pos.ticker} ship" loading="lazy" decoding="async">`;
        
        return `
          <div class="ship-card ${isOperational ? '' : 'negative'}" style="--ship-color: ${color}" onclick="selectTicker('${pos.ticker}'); switchTab('chart');">
            <div class="ship-card-inner">
              <div class="ship-visual">
                ${shipVisualMarkup}
                <span class="ship-class-badge">${shipLore.label}</span>
              </div>
              <div class="ship-info">
                <div class="ship-header">
                  <div>
                    <div class="ship-name">${pos.ticker}</div>
                    <div class="ship-designation">${shipInfo.name} · ${shipInfo.designation}</div>
                  </div>
                  <div class="ship-status-indicator ${isOperational ? 'operational' : 'damaged'}">
                    <span class="dot"></span>
                    ${isOperational ? 'OPERATIONAL' : 'DAMAGED'}
                  </div>
                </div>
                <div class="ship-stats">
                  <div class="ship-stat-row">
                    <span class="ship-stat-label">HULL</span>
                    <div class="ship-stat-bar">
                      <div class="ship-stat-fill hull ${isOperational ? '' : 'damaged'}" style="width: ${hullHealth}%"></div>
                    </div>
                    <span class="ship-stat-value">${hullHealth.toFixed(0)}%</span>
                  </div>
                  <div class="ship-stat-row">
                    <span class="ship-stat-label">CARGO</span>
                    <div class="ship-stat-bar">
                      <div class="ship-stat-fill cargo" style="width: ${cargoPercent}%"></div>
                    </div>
                    <span class="ship-stat-value">${pos.shares} units</span>
                  </div>
                  <div class="ship-stat-row">
                    <span class="ship-stat-label">FUEL</span>
                    <div class="ship-stat-bar">
                      <div class="ship-stat-fill fuel" style="width: ${fuelPercent}%"></div>
                    </div>
                    <span class="ship-stat-value">${fuelPercent.toFixed(0)}%</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="ship-footer">
              <div class="ship-value">$${value.toLocaleString()}</div>
              <div class="ship-pnl">
                <span class="ship-pnl-amount ${pnl >= 0 ? 'positive' : 'negative'}">${pnl >= 0 ? '+' : ''}$${Math.abs(pnl).toFixed(0)}</span>
                <span class="ship-pnl-percent ${pnlPct >= 0 ? 'positive' : 'negative'}">${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(1)}%</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      fleetGrid.innerHTML = shipCards;
      
      // Update summary stats
      const todayPnl = document.getElementById('fleet-total-pnl');
      const fleetValue = document.getElementById('fleet-total-value');
      const shipCount = document.getElementById('fleet-ship-count');
      const opCount = document.getElementById('fleet-operational-count');
      const dmgCount = document.getElementById('fleet-damaged-count');
      const winRate = document.getElementById('fleet-win-rate');
      
      if (todayPnl) {
        todayPnl.textContent = (totalPnl >= 0 ? '+' : '') + '$' + Math.abs(totalPnl).toLocaleString(undefined, {maximumFractionDigits: 0});
        todayPnl.className = 'value ' + (totalPnl >= 0 ? 'positive' : 'negative');
      }
      if (fleetValue) fleetValue.textContent = '$' + totalValue.toLocaleString(undefined, {maximumFractionDigits: 0});
      if (shipCount) shipCount.textContent = DEMO_STOCK_POSITIONS.length;
      if (opCount) opCount.textContent = operational;
      if (dmgCount) dmgCount.textContent = damaged;
      if (winRate) winRate.textContent = Math.round((operational / DEMO_STOCK_POSITIONS.length) * 100) + '%';
    }
    
    // Generate SVG string for a pixel ship
    function generateShipSvgString(patternKey, color, pnlPercent) {
      const pattern = PIXEL_SHIPS[patternKey] || PIXEL_SHIPS.drone;
      const rows = pattern.length;
      const cols = pattern[0].length;
      
      const cell = 2.9;
      const width = cols * cell;
      const height = rows * cell;
      
      const viewW = 120;
      const viewH = 80;
      const offsetX = (viewW - width) / 2;
      const offsetY = (viewH - height) / 2;
      
      // Parse color to get HSL values
      const baseHue = getHueFromColor(color);
      
      let svgContent = '';
      
      for (let r = 0; r < rows; r++) {
        const row = pattern[r];
        for (let c = 0; c < cols; c++) {
          const digit = row[c];
          if (digit === '0') continue;
          
          let fill;
          if (digit === '1') {
            fill = `hsl(${baseHue}, 40%, 25%)`; // Dark edge
          } else if (digit === '2') {
            fill = `hsl(${baseHue}, 60%, 45%)`; // Mid tone
          } else {
            fill = `hsl(${baseHue}, 80%, 65%)`; // Cockpit highlight
          }
          
          const x = offsetX + c * cell;
          const y = offsetY + r * cell;
          
          svgContent += `<rect x="${x}" y="${y}" width="${cell}" height="${cell}" fill="${fill}" />`;
        }
      }
      
      return svgContent;
    }
    
    // Extract hue from hex color
    function getHueFromColor(hexColor) {
      const hex = hexColor.replace('#', '');
      const r = parseInt(hex.substr(0, 2), 16) / 255;
      const g = parseInt(hex.substr(2, 2), 16) / 255;
      const b = parseInt(hex.substr(4, 2), 16) / 255;
      
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h = 0;
      
      if (max !== min) {
        const d = max - min;
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }
      
      return Math.round(h * 360);
    }
    
    // Toggle between fleet grid view and table view
    function setFleetView(view) {
      const gridView = document.getElementById('fleet-grid-view');
      const tableView = document.getElementById('fleet-table-view');
      const btns = document.querySelectorAll('.fleet-view-btn');
      
      if (view === 'grid') {
        if (gridView) gridView.classList.remove('hidden');
        if (tableView) tableView.classList.remove('active');
      } else {
        if (gridView) gridView.classList.add('hidden');
        if (tableView) tableView.classList.add('active');
      }
      
      btns.forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase().includes(view));
      });
      
      if (window.SoundFX) SoundFX.play('click');
    }
    
    function renderOptionsPositions() {
      document.getElementById('options-tbody').innerHTML = DEMO_OPTIONS.map(pos => {
        const pnl = (pos.current - pos.entry) * pos.contracts * 100;
        const pnlPct = ((pos.current - pos.entry) / pos.entry * 100);
        const color = tickerColors[pos.ticker] || '#33ff99';
        const hasDossier = TICKER_PROFILES[pos.ticker] ? true : false;
        const dossierBtn = hasDossier ? '<button class="dossier-btn" onclick="openTickerDossier(\'' + pos.ticker + '\')">◉</button>' : '';
        return '<tr class="position-row" data-ticker="' + pos.ticker + '">' +
          '<td><span class="ticker-tag">' + dossierBtn + '<span class="ticker-dot" style="background: ' + color + '"></span>' + pos.ticker + '</span></td>' +
          '<td><span class="structure-tag">' + pos.structure + '</span></td><td>' + pos.strikes + '</td>' +
          '<td>$' + pos.entry.toFixed(2) + '</td><td>$' + pos.current.toFixed(2) + '</td>' +
          '<td class="' + (pnl >= 0 ? 'pnl-positive' : 'pnl-negative') + '">' + (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(0) + ' (' + (pnlPct >= 0 ? '+' : '') + pnlPct.toFixed(0) + '%)</td>' +
          '<td>' + pos.delta.toFixed(2) + '</td></tr>';
      }).join('');
    }
    
    function renderPositionCharts() {
      const positions = DEMO_OPTIONS.map(pos => ({ ticker: pos.ticker, value: pos.current * pos.contracts * 100, color: tickerColors[pos.ticker] || '#33ff99' })).sort((a, b) => b.value - a.value);
      const maxValue = Math.max(...positions.map(p => p.value));
      const totalValue = positions.reduce((s, x) => s + x.value, 0);
      document.getElementById('chart-sizes').innerHTML = '<div class="bar-chart">' + positions.map(p =>
        '<div class="bar-row"><span class="bar-ticker" style="color: ' + p.color + '">' + p.ticker + '</span>' +
        '<div class="bar-container"><div class="bar-fill" style="width: ' + (p.value/maxValue*100) + '%; background: ' + p.color + '">' + Math.round(p.value/totalValue*100) + '%</div></div>' +
        '<span class="bar-value">$' + p.value.toLocaleString() + '</span></div>'
      ).join('') + '</div>';
      
      const pnlData = DEMO_OPTIONS.map(pos => ({ ticker: pos.ticker, pnl: (pos.current - pos.entry) * pos.contracts * 100, pct: ((pos.current - pos.entry) / pos.entry * 100), color: tickerColors[pos.ticker] || '#33ff99' })).sort((a, b) => b.pnl - a.pnl);
      const maxPnl = Math.max(...pnlData.map(p => Math.abs(p.pnl)));
      let winners = 0, losers = 0, totalPnl = 0;
      pnlData.forEach(p => { if (p.pnl >= 0) winners++; else losers++; totalPnl += p.pnl; });
      document.getElementById('chart-pnl').innerHTML = '<div class="bar-chart">' + pnlData.map(p =>
        '<div class="pnl-row"><span class="bar-ticker" style="color: ' + p.color + '">' + p.ticker + '</span>' +
        '<div class="pnl-bar-container"><div class="pnl-center-line"></div>' +
        '<div class="pnl-bar ' + (p.pnl >= 0 ? 'positive' : 'negative') + '" style="width: ' + (Math.abs(p.pnl)/maxPnl*50) + '%">' + (p.pnl >= 0 ? '+' : '') + p.pct.toFixed(0) + '%</div></div>' +
        '<span class="pnl-amount ' + (p.pnl >= 0 ? 'positive' : 'negative') + '">' + (p.pnl >= 0 ? '+' : '') + '$' + Math.abs(p.pnl).toLocaleString() + '</span></div>'
      ).join('') + '</div>' +
      '<div class="summary-row"><div class="summary-item"><div class="summary-value positive">' + winners + '</div><div class="summary-label">Winners</div></div>' +
      '<div class="summary-item"><div class="summary-value positive">+$' + totalPnl.toLocaleString() + '</div><div class="summary-label">Total P&L</div></div>' +
      '<div class="summary-item"><div class="summary-value negative">' + losers + '</div><div class="summary-label">Losers</div></div></div>';
    }
    
    function renderCatalysts() {
      document.getElementById('catalyst-list').innerHTML = DEMO_CATALYSTS.map(cat => {
        const color = tickerColors[cat.ticker] || '#5a7068';
        return '<div class="catalyst-item"><span class="catalyst-date">' + cat.date + '</span>' +
          '<span class="catalyst-ticker" style="color: ' + color + '">' + cat.ticker + '</span>' +
          '<span class="catalyst-event">' + cat.event + '</span>' +
          '<span class="catalyst-impact ' + cat.impact.toLowerCase() + '">' + cat.impact + '</span></div>';
      }).join('');
    }
    
    function renderActivity() {
      const tradeSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>';
      const alertSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';
      document.getElementById('activity-feed').innerHTML = DEMO_ACTIVITY.map(act =>
        '<div class="activity-item"><div class="activity-icon ' + act.type + '">' + (act.type === 'trade' ? tradeSvg : alertSvg) + '</div>' +
        '<div class="activity-content"><div class="activity-title">' + act.title + '</div><div class="activity-subtitle">' + act.subtitle + '</div></div>' +
        '<div class="activity-time">' + act.time + '</div></div>'
      ).join('');
    }
    
    function toggleKillSwitch() {
      const btn = document.querySelector('.kill-switch-btn');
      const status = document.querySelector('.kill-switch-status');
      if (btn.classList.contains('stop')) {
        btn.classList.replace('stop', 'resume');
        btn.textContent = 'RESUME OPERATIONS';
        status.textContent = 'Trading halted';
      } else {
        btn.classList.replace('resume', 'stop');
        btn.textContent = 'ABORT ALL TRADES';
        status.textContent = 'System operational';
      }
    }
    
    function toggleDevConsole() {
      const console = document.getElementById('dev-console');
      console.classList.toggle('visible');
    }
    
    // ============================================
    // CONTROL PANEL INTERACTIVITY
    // ============================================
    
    const controlState = {
      smoothing: 50,
      forecast: 30,
      sensitivity: 65,
      momentum: true,
      heatmap: false,
      alerts: true,
      risk: 60
    };
    
    // Knob rotation values
    const knobSettings = {
      smoothing: { values: [0, 25, 50, 75, 100], labels: ['0%', '25%', '50%', '75%', '100%'], current: 2 },
      forecast: { values: [7, 14, 30, 60, 90], labels: ['7 DAYS', '14 DAYS', '30 DAYS', '60 DAYS', '90 DAYS'], current: 2 }
    };
    
    function cycleKnob(knobId) {
      const settings = knobSettings[knobId];
      settings.current = (settings.current + 1) % settings.values.length;
      
      const knob = document.getElementById('knob-' + knobId);
      const valueEl = document.getElementById(knobId + '-value');
      
      // Rotate knob (each step is ~60 degrees)
      const rotation = (settings.current - 2) * 60;
      knob.style.transform = 'rotate(' + rotation + 'deg)';
      
      // Update value display
      valueEl.textContent = settings.labels[settings.current];
      controlState[knobId] = settings.values[settings.current];
      
      // Visual feedback
      knob.style.boxShadow = '0 4px 8px rgba(0,0,0,0.5), 0 0 20px var(--phosphor-glow), inset 0 2px 4px rgba(255,255,255,0.1)';
      setTimeout(() => {
        knob.style.boxShadow = '';
      }, 200);
      
      // Update band label for smoothing knob
      if (knobId === 'smoothing') {
        updateSmoothingBandLabel(settings.values[settings.current]);
      }
      
      // Update forecast display for forecast knob
      if (knobId === 'forecast') {
        updateForecastDisplay(settings.values[settings.current]);
      }
      
      // Trigger chart update effect
      flashUpdate();
      logControlChange(knobId.toUpperCase() + ' set to ' + settings.labels[settings.current]);
    }
    
    function toggleSwitch(switchId) {
      const toggle = document.getElementById('toggle-' + switchId);
      const isActive = toggle.classList.toggle('active');
      controlState[switchId] = isActive;
      
      // Visual feedback in log
      logControlChange(switchId.toUpperCase() + ' ' + (isActive ? 'ENABLED' : 'DISABLED'));
      
      // Apply effects based on switch
      if (switchId === 'momentum' && priceChart) {
        // Toggle MA visibility
        showMA = isActive;
        document.getElementById('ma-toggle').classList.toggle('active', isActive);
        updateCharts();
      }
      
      flashUpdate();
    }
    
    function handleSliderClick(event, sliderId) {
      const track = document.getElementById(sliderId + '-track');
      const fill = document.getElementById(sliderId + '-fill');
      const thumb = document.getElementById(sliderId + '-thumb');
      
      const rect = track.getBoundingClientRect();
      const percent = Math.max(0, Math.min(100, ((event.clientX - rect.left) / rect.width) * 100));
      
      fill.style.width = percent + '%';
      thumb.style.left = percent + '%';
      controlState[sliderId] = Math.round(percent);
      
      // Update risk gauge based on sensitivity
      updateRiskGauge(percent);
      logControlChange('SENSITIVITY adjusted to ' + Math.round(percent) + '%');
      flashUpdate();
    }
    
    function updateRiskGauge(sensitivity) {
      // Risk inversely correlates with sensitivity (more sensitive = catches more risk)
      const riskLevel = 100 - (sensitivity * 0.4);
      const needle = document.getElementById('risk-needle');
      const fill = document.getElementById('risk-fill');
      const value = document.getElementById('risk-value');
      
      // Needle rotation: -45deg (low) to 225deg (high)
      const rotation = -45 + (riskLevel / 100 * 180);
      needle.style.transform = 'rotate(' + rotation + 'deg)';
      fill.style.height = riskLevel + '%';
      
      if (riskLevel < 33) {
        value.textContent = 'LOW';
        fill.style.background = 'var(--phosphor)';
      } else if (riskLevel < 66) {
        value.textContent = 'MODERATE';
        fill.style.background = 'linear-gradient(0deg, var(--amber) 0%, var(--phosphor) 100%)';
      } else {
        value.textContent = 'HIGH';
        fill.style.background = 'linear-gradient(0deg, #ff4444 0%, var(--amber) 100%)';
      }
      
      controlState.risk = riskLevel;
    }
    
    function runAnalysis(e) {
      const btn = e && e.currentTarget ? e.currentTarget : document.getElementById('run-analysis-btn');
      btn.textContent = '◌ ANALYZING...';
      btn.disabled = true;
      
      // Animate LED array
      const leds = document.querySelectorAll('.led-array .array-led');
      let ledIndex = 0;
      const ledInterval = setInterval(() => {
        leds.forEach((led, i) => {
          led.classList.remove('on', 'amber');
          if (i <= ledIndex) led.classList.add('on');
        });
        ledIndex++;
        if (ledIndex > leds.length) {
          clearInterval(ledInterval);
          
          // Compute data-driven volatility score
          const volScore = getVolScoreForTicker(currentTicker) || (15 + Math.random() * 20);
          const newVol = volScore.toFixed(1);
          document.getElementById('vol-display').textContent = newVol;
          
          // Update LED array based on volatility (0-40 mapped to 0-8 LEDs)
          const volLevel = Math.ceil((volScore / 40) * leds.length);
          leds.forEach((led, i) => {
            led.classList.remove('on', 'amber', 'red');
            if (i < volLevel) {
              if (i < 4) led.classList.add('on');
              else if (i < 6) led.classList.add('amber');
              else led.classList.add('red');
            }
          });
          
          btn.textContent = '▸ RUN ANALYSIS';
          btn.disabled = false;
          
          logControlChange('ANALYSIS COMPLETE — Vol: ' + newVol + 'σ');
        }
      }, 100);
      
      flashUpdate();
    }
    
    function resetControls() {
      // Reset knobs
      knobSettings.smoothing.current = 2;
      knobSettings.forecast.current = 2;
      document.getElementById('knob-smoothing').style.transform = 'rotate(0deg)';
      document.getElementById('knob-forecast').style.transform = 'rotate(0deg)';
      document.getElementById('smoothing-value').textContent = '50%';
      document.getElementById('forecast-value').textContent = '30 DAYS';
      
      // Reset toggles
      document.getElementById('toggle-momentum').classList.add('active');
      document.getElementById('toggle-heatmap').classList.remove('active');
      document.getElementById('toggle-alerts').classList.add('active');
      
      // Reset slider
      document.getElementById('sensitivity-fill').style.width = '65%';
      document.getElementById('sensitivity-thumb').style.left = '65%';
      
      // Reset gauge
      updateRiskGauge(65);
      
      // Reset state
      Object.assign(controlState, {
        smoothing: 50,
        forecast: 30,
        sensitivity: 65,
        momentum: true,
        heatmap: false,
        alerts: true
      });
      
      logControlChange('ALL CONTROLS RESET TO DEFAULTS');
      flashUpdate();
    }
    
    function flashUpdate() {
      // Flash the panel header to show update
      const header = document.querySelector('.panel-header');
      if (header) {
        header.style.background = 'rgba(51, 255, 153, 0.1)';
        setTimeout(() => {
          header.style.background = '';
        }, 150);
      }
    }
    
    function logControlChange(message) {
      // Add to activity feed
      const feed = document.getElementById('activity-feed');
      if (!feed) return;
      
      const now = new Date();
      const time = String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
      
      const alertSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
      
      const item = document.createElement('div');
      item.className = 'activity-item';
      item.innerHTML = '<div class="activity-icon alert">' + alertSvg + '</div>' +
        '<div class="activity-content"><div class="activity-title">Control Update</div><div class="activity-subtitle">' + message + '</div></div>' +
        '<div class="activity-time">' + time + '</div>';
      
      feed.insertBefore(item, feed.firstChild);
      
      // Keep only last 10 items
      while (feed.children.length > 10) {
        feed.removeChild(feed.lastChild);
      }
    }
    
    // Animate scanner blips periodically
    setInterval(() => {
      const blips = document.querySelectorAll('.scanner-blips .blip');
      blips.forEach(blip => {
        blip.style.top = (10 + Math.random() * 70) + '%';
        blip.style.left = (10 + Math.random() * 70) + '%';
      });
    }, 3000);
    
    let startTime = null;
    function updateUptime() {
      if (!startTime) startTime = Date.now();
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const h = String(Math.floor(elapsed / 3600)).padStart(2, '0');
      const m = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
      const s = String(elapsed % 60).padStart(2, '0');
      const el = document.getElementById('uptime');
      if (el) el.textContent = 'UPTIME: ' + h + ':' + m + ':' + s;
    }
    setInterval(updateUptime, 1000);
    
    // =========================================================================
    // ARCADE EXTRAS MODULE – HUD, SFX, themes, terminal, toasts, Konami code
    // =========================================================================
    (function() {
      // Config
      const ARCADE_MISSIONS = [
        { id:'tabs',      text:'Explore 3 panels', done:false },
        { id:'analysis',  text:'Run analysis once', done:false },
        { id:'simulation', text:'Run P&L simulation', done:false },
        { id:'find_invader', text:'Find the hidden invader', done:false },
        { id:'arcade_score', text:'Score 500+ in Signal Invaders', done:false },
        { id:'terrain_lander', text:'Soft land on the terrain', done:false },
        { id:'snoop_master', text:'Trigger 5 access denials', done:false }
      ];
      
      const THEMES = {
        Terminal: { '--phosphor': '#33ff99', '--amber': '#ffb347' },
        Arcade:   { '--phosphor': '#7cff00', '--amber': '#ffd93d' },
        NeonNoir: { '--phosphor': '#7afcff', '--amber': '#ff6fd8' }
      };
      
      // State
      let sfxEnabled = true;
      let tabsVisited = new Set();
      const root = document.documentElement;
      
      // Audio context (lazy init)
      let audioCtx = null;
      function getAudioContext() {
        if (!audioCtx) {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          audioCtx = AudioCtx ? new AudioCtx() : null;
        }
        return audioCtx;
      }
      
      // 90s Anime Mech Beat Sound System
      // Inspired by Gundam, Evangelion, Macross soundtracks
      const MechSFX = {
        // Bass-heavy synth hit (like mech footsteps)
        bassHit(freq = 60, duration = 0.15) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc = ctx.createOscillator();
          const osc2 = ctx.createOscillator();
          const gain = ctx.createGain();
          const filter = ctx.createBiquadFilter();
          
          // Two detuned oscillators for thickness
          osc.type = 'sawtooth';
          osc.frequency.value = freq;
          osc2.type = 'square';
          osc2.frequency.value = freq * 0.5;
          osc2.detune.value = -10;
          
          // Low pass filter for that analog warmth
          filter.type = 'lowpass';
          filter.frequency.value = 800;
          filter.Q.value = 2;
          // Filter sweep
          filter.frequency.setValueAtTime(800, ctx.currentTime);
          filter.frequency.exponentialRampToValueAtTime(200, ctx.currentTime + duration);
          
          // Punchy envelope
          gain.gain.setValueAtTime(0.18, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          osc.connect(filter);
          osc2.connect(filter);
          filter.connect(gain);
          gain.connect(ctx.destination);
          
          osc.start();
          osc2.start();
          osc.stop(ctx.currentTime + duration);
          osc2.stop(ctx.currentTime + duration);
        },
        
        // Synth stab (like UI confirmations in mech cockpits)
        synthStab(freq = 440, duration = 0.08) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc = ctx.createOscillator();
          const osc2 = ctx.createOscillator();
          const gain = ctx.createGain();
          const filter = ctx.createBiquadFilter();
          
          osc.type = 'square';
          osc.frequency.value = freq;
          osc2.type = 'sawtooth';
          osc2.frequency.value = freq * 1.01; // Slight detune
          
          filter.type = 'bandpass';
          filter.frequency.value = freq * 2;
          filter.Q.value = 1;
          
          gain.gain.setValueAtTime(0.12, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          osc.connect(filter);
          osc2.connect(filter);
          filter.connect(gain);
          gain.connect(ctx.destination);
          
          osc.start();
          osc2.start();
          osc.stop(ctx.currentTime + duration);
          osc2.stop(ctx.currentTime + duration);
        },
        
        // Alarm/alert sound (descending synth sweep)
        alert(startFreq = 800, endFreq = 200, duration = 0.25) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          const distortion = ctx.createWaveShaper();
          
          // Create distortion curve for grit
          const curve = new Float32Array(256);
          for (let i = 0; i < 256; i++) {
            const x = (i / 128) - 1;
            curve[i] = Math.tanh(x * 2);
          }
          distortion.curve = curve;
          
          osc.type = 'sawtooth';
          osc.frequency.setValueAtTime(startFreq, ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(endFreq, ctx.currentTime + duration);
          
          gain.gain.setValueAtTime(0.1, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          osc.connect(distortion);
          distortion.connect(gain);
          gain.connect(ctx.destination);
          
          osc.start();
          osc.stop(ctx.currentTime + duration);
        },
        
        // Power up sound (rising sweep with harmonics)
        powerUp(duration = 0.3) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc = ctx.createOscillator();
          const osc2 = ctx.createOscillator();
          const gain = ctx.createGain();
          const filter = ctx.createBiquadFilter();
          
          osc.type = 'sawtooth';
          osc.frequency.setValueAtTime(80, ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(600, ctx.currentTime + duration);
          
          osc2.type = 'square';
          osc2.frequency.setValueAtTime(160, ctx.currentTime);
          osc2.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + duration);
          
          filter.type = 'lowpass';
          filter.frequency.setValueAtTime(200, ctx.currentTime);
          filter.frequency.exponentialRampToValueAtTime(3000, ctx.currentTime + duration);
          filter.Q.value = 4;
          
          gain.gain.setValueAtTime(0.15, ctx.currentTime);
          gain.gain.setValueAtTime(0.15, ctx.currentTime + duration * 0.7);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          osc.connect(filter);
          osc2.connect(filter);
          filter.connect(gain);
          gain.connect(ctx.destination);
          
          osc.start();
          osc2.start();
          osc.stop(ctx.currentTime + duration);
          osc2.stop(ctx.currentTime + duration);
        },
        
        // Weapon fire sound
        weaponFire(duration = 0.12) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          // Noise generator for "pew" texture
          const bufferSize = ctx.sampleRate * duration;
          const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
          const data = buffer.getChannelData(0);
          for (let i = 0; i < bufferSize; i++) {
            data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.1));
          }
          
          const noise = ctx.createBufferSource();
          noise.buffer = buffer;
          
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          const filter = ctx.createBiquadFilter();
          
          osc.type = 'square';
          osc.frequency.setValueAtTime(1200, ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + duration);
          
          filter.type = 'bandpass';
          filter.frequency.value = 800;
          filter.Q.value = 2;
          
          gain.gain.setValueAtTime(0.15, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          noise.connect(filter);
          osc.connect(filter);
          filter.connect(gain);
          gain.connect(ctx.destination);
          
          noise.start();
          osc.start();
          osc.stop(ctx.currentTime + duration);
        },
        
        // Explosion/impact sound
        impact(duration = 0.35) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          // Deep bass thump
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          
          osc.type = 'sine';
          osc.frequency.setValueAtTime(150, ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(30, ctx.currentTime + duration);
          
          gain.gain.setValueAtTime(0.25, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          osc.connect(gain);
          gain.connect(ctx.destination);
          
          osc.start();
          osc.stop(ctx.currentTime + duration);
          
          // Noise burst on top
          const bufferSize = ctx.sampleRate * 0.1;
          const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
          const data = buffer.getChannelData(0);
          for (let i = 0; i < bufferSize; i++) {
            data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.15));
          }
          
          const noise = ctx.createBufferSource();
          noise.buffer = buffer;
          const noiseGain = ctx.createGain();
          const noiseFilter = ctx.createBiquadFilter();
          
          noiseFilter.type = 'lowpass';
          noiseFilter.frequency.value = 500;
          
          noiseGain.gain.setValueAtTime(0.12, ctx.currentTime);
          noiseGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
          
          noise.connect(noiseFilter);
          noiseFilter.connect(noiseGain);
          noiseGain.connect(ctx.destination);
          
          noise.start();
        },
        
        // Selection/tick sound
        tick(freq = 880, duration = 0.04) {
          const ctx = getAudioContext();
          if (!ctx) return;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          
          osc.type = 'triangle';
          osc.frequency.value = freq;
          
          gain.gain.setValueAtTime(0.08, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
          
          osc.connect(gain);
          gain.connect(ctx.destination);
          
          osc.start();
          osc.stop(ctx.currentTime + duration);
        },
        
        // Success fanfare (two-tone up)
        success() {
          this.synthStab(523, 0.08);
          setTimeout(() => this.synthStab(659, 0.12), 80);
        },
        
        // Error/warning tone
        error() {
          this.alert(400, 200, 0.15);
        }
      };
      
      // =========================================================================
      // EPIC ANIME MECHA BACKGROUND MUSIC SYSTEM
      // Procedurally generated synth music inspired by Gundam, Evangelion, Macross
      // =========================================================================
      const MechaBGM = {
        ctx: null,
        masterGain: null,
        isPlaying: false,
        currentTrack: null,
        volume: 0.12, // Default volume (subtle background)
        
        init() {
          if (this.ctx) return;
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          if (!AudioCtx) return;
          this.ctx = new AudioCtx();
          this.masterGain = this.ctx.createGain();
          this.masterGain.gain.value = this.volume;
          this.masterGain.connect(this.ctx.destination);
        },
        
        setVolume(v) {
          this.volume = Math.max(0, Math.min(1, v));
          if (this.masterGain) {
            this.masterGain.gain.setTargetAtTime(this.volume, this.ctx.currentTime, 0.1);
          }
        },
        
        // Epic synth pad drone
        createPad(freq, duration) {
          const osc1 = this.ctx.createOscillator();
          const osc2 = this.ctx.createOscillator();
          const osc3 = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          const filter = this.ctx.createBiquadFilter();
          
          osc1.type = 'sawtooth';
          osc1.frequency.value = freq;
          osc2.type = 'sawtooth';
          osc2.frequency.value = freq * 1.005;
          osc3.type = 'square';
          osc3.frequency.value = freq * 0.5;
          
          filter.type = 'lowpass';
          filter.frequency.value = freq * 2;
          filter.Q.value = 1;
          
          const now = this.ctx.currentTime;
          gain.gain.setValueAtTime(0, now);
          gain.gain.linearRampToValueAtTime(0.06, now + 0.5);
          gain.gain.setValueAtTime(0.06, now + duration - 0.5);
          gain.gain.linearRampToValueAtTime(0, now + duration);
          
          osc1.connect(filter);
          osc2.connect(filter);
          osc3.connect(filter);
          filter.connect(gain);
          gain.connect(this.masterGain);
          
          osc1.start(now);
          osc2.start(now);
          osc3.start(now);
          osc1.stop(now + duration);
          osc2.stop(now + duration);
          osc3.stop(now + duration);
        },
        
        // Rhythmic bass pulse
        createBass(freq, pattern, loopDuration) {
          const now = this.ctx.currentTime;
          const eighthNote = loopDuration / 8;
          
          pattern.forEach((hit, i) => {
            if (!hit) return;
            const startTime = now + (i * eighthNote);
            
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(freq, startTime);
            osc.frequency.exponentialRampToValueAtTime(freq * 0.8, startTime + 0.15);
            
            gain.gain.setValueAtTime(0.1, startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 0.2);
            
            osc.connect(gain);
            gain.connect(this.masterGain);
            
            osc.start(startTime);
            osc.stop(startTime + 0.25);
          });
        },
        
        // Epic arpeggio sequence
        createArp(baseFreq, loopDuration) {
          const now = this.ctx.currentTime;
          const sixteenthNote = loopDuration / 16;
          const intervals = [1, 1.2, 1.5, 2, 2.4, 3, 4, 3, 2.4, 2, 1.5, 1.2, 1, 1.5, 2, 1.5];
          
          for (let i = 0; i < 16; i++) {
            if (Math.random() > 0.65) continue;
            
            const startTime = now + (i * sixteenthNote);
            const freq = baseFreq * intervals[i % intervals.length];
            
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            const filter = this.ctx.createBiquadFilter();
            
            osc.type = 'square';
            osc.frequency.value = freq;
            
            filter.type = 'bandpass';
            filter.frequency.value = freq * 2;
            filter.Q.value = 2;
            
            gain.gain.setValueAtTime(0.03, startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + sixteenthNote * 0.8);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(this.masterGain);
            
            osc.start(startTime);
            osc.stop(startTime + sixteenthNote);
          }
        },
        
        // Main loop
        playLoop() {
          if (!this.ctx) this.init();
          if (!this.ctx) return;
          
          if (this.ctx.state === 'suspended') {
            this.ctx.resume();
          }
          
          const bpm = 110;
          const barDuration = (60 / bpm) * 4;
          const loopDuration = barDuration * 2;
          
          const chords = [
            { root: 110 },   // A minor
            { root: 146.83 }, // D
            { root: 130.81 }, // C
            { root: 98 },     // G
          ];
          
          const playSegment = (segmentIndex) => {
            if (!this.isPlaying) return;
            
            const chord = chords[segmentIndex % chords.length];
            
            this.createPad(chord.root, loopDuration);
            this.createPad(chord.root * 1.5, loopDuration);
            this.createBass(chord.root * 0.5, [1,0,1,0,0,1,0,0], loopDuration);
            this.createArp(chord.root * 2, loopDuration);
            
            setTimeout(() => playSegment(segmentIndex + 1), loopDuration * 1000);
          };
          
          this.isPlaying = true;
          playSegment(0);
          
          if (typeof logTerminal === 'function') {
            logTerminal('BGM SYSTEM · MECHA SORTIE · playing');
          }
        },
        
        stop() {
          this.isPlaying = false;
          if (this.masterGain) {
            this.masterGain.gain.setTargetAtTime(0, this.ctx.currentTime, 0.3);
          }
          if (typeof logTerminal === 'function') {
            logTerminal('BGM SYSTEM · standby');
          }
        },
        
        toggle() {
          if (this.isPlaying) {
            this.stop();
          } else {
            if (this.masterGain) {
              this.masterGain.gain.setTargetAtTime(this.volume, this.ctx.currentTime, 0.1);
            }
            this.playLoop();
          }
          return this.isPlaying;
        }
      };
      
      window.MechaBGM = MechaBGM;
      
      // Silent beep by default - no more annoying sounds!
      window.beep = function(freq = 520, duration = 0.08) {
        // Silent - beeping disabled per user request
        // Epic mecha music only!
      };
      
      // Expose MechSFX globally for direct use
      window.MechSFX = MechSFX;
      
      // Toast notifications
      window.showToast = function(message, level = 'info') {
        const container = document.getElementById('toast-container');
        if (!container) return;
        const div = document.createElement('div');
        div.className = 'toast' + (level !== 'info' ? ' ' + level : '');
        div.textContent = message;
        container.appendChild(div);
        requestAnimationFrame(() => div.classList.add('show'));
        setTimeout(() => {
          div.classList.remove('show');
          setTimeout(() => div.remove(), 300);
        }, 2300);
      };
      
      // Terminal log
      window.logTerminal = function(msg) {
        const el = document.getElementById('terminal-log');
        if (!el) return;
        const line = document.createElement('div');
        line.className = 'terminal-log-line';
        const now = new Date();
        const hh = String(now.getHours()).padStart(2,'0');
        const mm = String(now.getMinutes()).padStart(2,'0');
        const ss = String(now.getSeconds()).padStart(2,'0');
        line.innerHTML = '<span class="time">['+hh+':'+mm+':'+ss+']</span> ' + msg;
        el.appendChild(line);
        el.scrollTop = el.scrollHeight;
        // Keep max 50 lines
        while (el.children.length > 50) el.removeChild(el.firstChild);
      };
      
      // Periodic uplink messages
      const uplinkMessages = [
        'uplink stable · packet OK',
        'telemetry sync · nominal',
        'signal lock · holding',
        'data stream · active',
        'quantum link · stable'
      ];
      setInterval(() => {
        const msg = uplinkMessages[Math.floor(Math.random() * uplinkMessages.length)];
        logTerminal(msg);
      }, 7000);
      
      // Missions HUD
      function renderMissions() {
        const hud = document.getElementById('arcade-hud');
        const list = document.getElementById('mission-list');
        if (!hud || !list) return;
        hud.classList.remove('hidden');
        list.innerHTML = ARCADE_MISSIONS.map(m =>
          '<li class="arcade-mission'+(m.done?' completed':'')+'">'+m.text+'</li>'
        ).join('');
      }
      
      window.completeMission = function(id) {
        const mission = ARCADE_MISSIONS.find(m => m.id === id);
        if (!mission || mission.done) return;
        mission.done = true;
        renderMissions();
        showToast('Mission complete: ' + mission.text);
        logTerminal('mission complete · ' + mission.id);
        beep(800, 0.12);
        
        // Check if all missions complete
        if (ARCADE_MISSIONS.every(m => m.done)) {
          setTimeout(() => {
            showToast('🏆 ALL MISSIONS COMPLETE!', 'alert');
            beep(1000, 0.15);
          }, 500);
        }
      };
      
      // Theme switching
      function initThemeSelect() {
        const select = document.getElementById('theme-select');
        if (!select) return;
        select.addEventListener('change', () => {
          const theme = THEMES[select.value];
          if (!theme) return;
          Object.entries(theme).forEach(([k,v]) => root.style.setProperty(k, v));
          logTerminal('theme applied · ' + select.value);
          beep(600, 0.07);
        });
      }
      
      // SFX toggle
      function initSfxToggle() {
        const toggle = document.getElementById('sfx-toggle');
        if (!toggle) return;
        sfxEnabled = toggle.checked;
        toggle.addEventListener('change', () => {
          sfxEnabled = toggle.checked;
          logTerminal('sfx ' + (sfxEnabled ? 'enabled' : 'muted'));
        });
      }
      
      // BGM toggle (Epic Anime Mecha Music)
      function initBgmToggle() {
        const toggle = document.getElementById('bgm-toggle');
        if (!toggle) return;
        toggle.addEventListener('change', () => {
          if (toggle.checked) {
            MechaBGM.playLoop();
            showToast('♫ MECHA SORTIE - BGM Active', 'info');
          } else {
            MechaBGM.stop();
            showToast('BGM Stopped', 'info');
          }
        });
      }
      
      // Tab visit tracking
      function initTabTracking() {
        const tabs = document.querySelectorAll('.nav-tab');
        tabs.forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.getAttribute('data-tab') || btn.textContent.trim();
            tabsVisited.add(id);
            if (tabsVisited.size >= 3) completeMission('tabs');
            beep(500, 0.05);
          });
        });
      }
      
      // Wrap runPnLSimulation for mission tracking
      const originalSimulation = window.runPnLSimulation;
      if (typeof originalSimulation === 'function') {
        window.runPnLSimulation = function() {
          completeMission('simulation');
          logTerminal('P&L simulation executed');
          beep(520, 0.08);
          return originalSimulation.apply(this, arguments);
        };
      }
      
      // Wrap runAnalysis if it exists
      const originalRunAnalysis = window.runAnalysis;
      if (typeof originalRunAnalysis === 'function') {
        window.runAnalysis = function() {
          completeMission('analysis');
          logTerminal('scenario analysis · control panel executed');
          showToast('Analysis fired');
          beep(520, 0.08);
          return originalRunAnalysis.apply(this, arguments);
        };
      }
      
      // Konami code -> activate pixel beam easter egg
      const KONAMI = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
      let konamiIndex = 0;
      
      window.addEventListener('keydown', (e) => {
        const key = e.key.length === 1 ? e.key.toLowerCase() : e.key;
        const target = KONAMI[konamiIndex].toLowerCase();
        if (key === target) {
          konamiIndex++;
          if (konamiIndex === KONAMI.length) {
            konamiIndex = 0;
            // Activate the pixel beam
            const beam = document.getElementById('pixel-beam');
            const ground = document.getElementById('pixel-ground');
            if (beam) beam.classList.add('active');
            if (ground) ground.classList.add('active');
            completeMission('secret');
            showToast('👾 INVADER DEFENSE GRID UNLOCKED', 'alert');
            logTerminal('konami code accepted · easter egg revealed');
            beep(900, 0.15);
          }
        } else {
          konamiIndex = 0;
        }
      });
      
      // Initialize on DOM ready
      function initArcade() {
        initThemeSelect();
        initSfxToggle();
        initBgmToggle();
        initTabTracking();
        renderMissions();
        initAboutOverlay();
        initPipboyDossier();
        logTerminal('arcade module initialized');
        logTerminal('system ready · awaiting input');
      }
      
      // =========================================================================
      // PIP-BOY TICKER DOSSIER CONTROLLER
      // =========================================================================
      function initPipboyDossier() {
        const overlay = document.getElementById('pipboy-overlay');
        const closeBtn = document.getElementById('pipboy-close-btn');
        const dials = document.querySelectorAll('.pipboy-dial');
        
        if (!overlay || !closeBtn) return;
        
        let currentDossierTicker = null;
        
        // Open dossier for a specific ticker
        window.openTickerDossier = function(ticker) {
          const profile = TICKER_PROFILES[ticker];
          if (!profile) {
            logTerminal('ERROR: No dossier found for ' + ticker);
            return;
          }
          
          currentDossierTicker = ticker;
          const color = tickerColors[ticker] || 'var(--phosphor)';
          
          // Update header
          document.getElementById('pipboy-codename').textContent = 'CODENAME: ' + profile.codename;
          const tickerNameEl = document.getElementById('pipboy-ticker-name');
          tickerNameEl.textContent = ticker + ' — ' + profile.name;
          tickerNameEl.style.color = color;
          document.getElementById('pipboy-sector').textContent = profile.sector;
          
          // Update threat level
          const threatEl = document.getElementById('pipboy-threat');
          const threatClass = profile.threat_level.toLowerCase().replace(' ', '');
          threatEl.textContent = profile.threat_level;
          threatEl.className = 'pipboy-threat-level ' + threatClass;
          
          // Update overview panel
          document.getElementById('pipboy-summary').textContent = profile.summary;
          document.getElementById('pipboy-lore').textContent = '"' + profile.lore + '"';
          
          // Update thesis panel
          document.getElementById('pipboy-thesis').textContent = profile.thesis;
          
          // Update catalysts panel
          const catalystsEl = document.getElementById('pipboy-catalysts-list');
          catalystsEl.innerHTML = profile.catalysts.map(cat => `
            <div class="pipboy-catalyst">
              <div class="pipboy-catalyst-date">${cat.date}</div>
              <div class="pipboy-catalyst-event">${cat.event}</div>
              <div class="pipboy-catalyst-impact ${cat.impact.toLowerCase()}">${cat.impact}</div>
            </div>
          `).join('');
          
          // Update risks panel
          const risksEl = document.getElementById('pipboy-risks-list');
          risksEl.innerHTML = profile.risks.map(risk => `
            <div class="pipboy-risk">${risk}</div>
          `).join('');
          
          // Update vitals panel
          const vitalsEl = document.getElementById('pipboy-vitals-grid');
          vitalsEl.innerHTML = Object.entries(profile.vitals).map(([key, val]) => `
            <div class="pipboy-vital">
              <div class="pipboy-vital-value">${val}</div>
              <div class="pipboy-vital-label">${key.replace(/_/g, ' ')}</div>
            </div>
          `).join('');
          
          // Update stats bar with live data if available
          updatePipboyStats(ticker);
          
          // Reset to overview panel
          dials.forEach(d => d.classList.remove('active'));
          dials[0].classList.add('active');
          document.querySelectorAll('.pipboy-panel').forEach(p => p.classList.remove('active'));
          document.getElementById('panel-overview').classList.add('active');
          
          // Show overlay
          overlay.classList.remove('hidden');
          requestAnimationFrame(() => {
            overlay.classList.add('visible');
          });
          
          logTerminal('DOSSIER ACCESSED: ' + ticker + ' [' + profile.codename + ']');
          beep(523, 0.06);
          setTimeout(() => beep(659, 0.06), 80);
        };
        
        // Update live stats in the stats bar
        function updatePipboyStats(ticker) {
          const statsBar = document.getElementById('pipboy-stats-bar');
          const data = tickerData[ticker];
          
          if (!data) {
            statsBar.innerHTML = `
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Price</div>
              </div>
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Change</div>
              </div>
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Volume</div>
              </div>
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Volatility</div>
              </div>
            `;
            return;
          }
          
          const series = data.daily || data.intraday || [];
          const last = series[series.length - 1] || {};
          const prev = series[series.length - 2] || {};
          
          const price = last.c || 0;
          const change = prev.c ? ((last.c - prev.c) / prev.c * 100) : 0;
          const volume = last.v || 0;
          const vol = getVolScoreForTicker(ticker) || 0;
          
          const changeClass = change >= 0 ? 'positive' : 'negative';
          const changeSign = change >= 0 ? '+' : '';
          
          statsBar.innerHTML = `
            <div class="pipboy-stat">
              <div class="pipboy-stat-value">$${price.toFixed(2)}</div>
              <div class="pipboy-stat-label">Price</div>
            </div>
            <div class="pipboy-stat">
              <div class="pipboy-stat-value ${changeClass}">${changeSign}${change.toFixed(2)}%</div>
              <div class="pipboy-stat-label">Change</div>
            </div>
            <div class="pipboy-stat">
              <div class="pipboy-stat-value">${formatVolume(volume)}</div>
              <div class="pipboy-stat-label">Volume</div>
            </div>
            <div class="pipboy-stat">
              <div class="pipboy-stat-value">${vol.toFixed(1)}σ</div>
              <div class="pipboy-stat-label">Volatility</div>
            </div>
          `;
        }
        
        function formatVolume(v) {
          if (v >= 1e9) return (v / 1e9).toFixed(1) + 'B';
          if (v >= 1e6) return (v / 1e6).toFixed(1) + 'M';
          if (v >= 1e3) return (v / 1e3).toFixed(1) + 'K';
          return v.toString();
        }
        
        // Close dossier
        function closeDossier() {
          overlay.classList.remove('visible');
          setTimeout(() => overlay.classList.add('hidden'), 200);
          beep(330, 0.05);
          logTerminal('dossier closed');
        }
        
        closeBtn.addEventListener('click', closeDossier);
        
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay || e.target.classList.contains('pipboy-backdrop')) {
            closeDossier();
          }
        });
        
        window.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && overlay.classList.contains('visible')) {
            closeDossier();
          }
        });
        
        // Dial navigation
        dials.forEach(dial => {
          dial.addEventListener('click', () => {
            const panel = dial.dataset.panel;
            
            dials.forEach(d => d.classList.remove('active'));
            dial.classList.add('active');
            
            document.querySelectorAll('.pipboy-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('panel-' + panel).classList.add('active');
            
            beep(440, 0.04);
          });
        });
        
        // Keyboard navigation with left/right arrows
        window.addEventListener('keydown', (e) => {
          if (!overlay.classList.contains('visible')) return;
          
          const dialArr = Array.from(dials);
          const activeIdx = dialArr.findIndex(d => d.classList.contains('active'));
          
          if (e.key === 'ArrowRight' && activeIdx < dialArr.length - 1) {
            dialArr[activeIdx + 1].click();
          } else if (e.key === 'ArrowLeft' && activeIdx > 0) {
            dialArr[activeIdx - 1].click();
          }
        });
        
        // Wire up watchlist items to open dossier on double-click or info button
        document.querySelectorAll('.watchlist-item').forEach(item => {
          const tickerEl = item.querySelector('.watchlist-ticker');
          if (!tickerEl) return;
          
          const ticker = tickerEl.textContent.trim();
          
          // Add info button
          const infoBtn = document.createElement('button');
          infoBtn.className = 'watchlist-info-btn';
          infoBtn.innerHTML = '◉';
          infoBtn.title = 'Open Dossier';
          infoBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            openTickerDossier(ticker);
          });
          
          // Insert before the ticker name or at the start
          const wrapper = item.querySelector('.watchlist-info') || item;
          wrapper.style.position = 'relative';
          item.insertBefore(infoBtn, item.firstChild);
        });
        
        logTerminal('pip-boy dossier system initialized');
      }
      
      // About Overlay Controller
      function initAboutOverlay() {
        const overlay = document.getElementById('about-overlay');
        const trigger = document.getElementById('about-trigger-btn');
        const closeBtn = document.getElementById('about-close-btn');

        if (!overlay || !trigger || !closeBtn) return;

        function openAbout() {
          overlay.classList.remove('hidden');
          requestAnimationFrame(() => {
            overlay.classList.add('visible');
          });
          logTerminal('about overlay opened · simulation dossier viewed');
          beep(440, 0.08);
        }

        function closeAbout() {
          overlay.classList.remove('visible');
          setTimeout(() => overlay.classList.add('hidden'), 260);
          beep(330, 0.06);
        }

        trigger.addEventListener('click', openAbout);
        closeBtn.addEventListener('click', closeAbout);

        overlay.addEventListener('click', (e) => {
          if (e.target === overlay || e.target.classList.contains('about-backdrop')) {
            closeAbout();
          }
        });

        window.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && overlay.classList.contains('visible')) {
            closeAbout();
          }
        });
      }
      
      // =========================================================================
      // INVADER ARMY INITIALIZATION
      // =========================================================================
      function initInvaderArmy() {
        const army = document.getElementById('invader-army');
        if (!army) return;

        const spriteSvg = `
          <svg class="invader-sprite-small" viewBox="0 0 11 8">
            <rect x="3" y="0" width="1" height="1" />
            <rect x="7" y="0" width="1" height="1" />
            <rect x="2" y="1" width="1" height="1" />
            <rect x="3" y="1" width="1" height="1" />
            <rect x="4" y="1" width="1" height="1" />
            <rect x="6" y="1" width="1" height="1" />
            <rect x="7" y="1" width="1" height="1" />
            <rect x="8" y="1" width="1" height="1" />
            <rect x="1" y="2" width="1" height="1" />
            <rect x="2" y="2" width="1" height="1" />
            <rect x="3" y="2" width="1" height="1" />
            <rect x="4" y="2" width="1" height="1" />
            <rect x="5" y="2" width="1" height="1" />
            <rect x="6" y="2" width="1" height="1" />
            <rect x="7" y="2" width="1" height="1" />
            <rect x="8" y="2" width="1" height="1" />
            <rect x="9" y="2" width="1" height="1" />
            <rect x="0" y="3" width="1" height="1" />
            <rect x="2" y="3" width="1" height="1" />
            <rect x="3" y="3" width="1" height="1" />
            <rect x="4" y="3" width="1" height="1" />
            <rect x="5" y="3" width="1" height="1" />
            <rect x="6" y="3" width="1" height="1" />
            <rect x="7" y="3" width="1" height="1" />
            <rect x="8" y="3" width="1" height="1" />
            <rect x="10" y="3" width="1" height="1" />
            <rect x="0" y="4" width="1" height="1" />
            <rect x="3" y="4" width="1" height="1" />
            <rect x="7" y="4" width="1" height="1" />
            <rect x="10" y="4" width="1" height="1" />
            <rect x="1" y="5" width="1" height="1" />
            <rect x="2" y="5" width="1" height="1" />
            <rect x="3" y="5" width="1" height="1" />
            <rect x="7" y="5" width="1" height="1" />
            <rect x="8" y="5" width="1" height="1" />
            <rect x="9" y="5" width="1" height="1" />
            <rect x="4" y="6" width="1" height="1" />
            <rect x="5" y="6" width="1" height="1" />
            <rect x="6" y="6" width="1" height="1" />
            <rect x="2" y="7" width="1" height="1" />
            <rect x="3" y="7" width="1" height="1" />
            <rect x="7" y="7" width="1" height="1" />
            <rect x="8" y="7" width="1" height="1" />
          </svg>
        `;

        const rows = 5;
        const invadersPerRow = 10;
        const topOffset = 80;
        const rowSpacing = 45;

        for (let r = 0; r < rows; r++) {
          const row = document.createElement('div');
          row.className = 'invader-row';
          row.style.top = (topOffset + r * rowSpacing) + 'px';

          const marchDuration = 8 + r * 1.2;
          const marchDelay = r * 0.4;
          row.style.animation = `invader-army-march ${marchDuration}s linear ${marchDelay}s infinite alternate`;

          row.innerHTML = new Array(invadersPerRow).fill(spriteSvg).join('');
          army.appendChild(row);
        }
      }

      // =========================================================================
      // COLOR PROFILE CONTROL (Pip-Boy Style)
      // =========================================================================
      function initColorProfileControl() {
        const slider = document.getElementById('color-hue-slider');
        const preview = document.getElementById('color-hue-preview');
        if (!slider || !preview) return;

        const root = document.documentElement;

        function setHue(h) {
          root.style.setProperty('--accent-hue', h);
          preview.style.background = `hsl(${h},100%,60%)`;
          if (typeof logTerminal === 'function') {
            logTerminal(`color profile set · hue ${h}`);
          }
        }

        slider.addEventListener('input', (e) => {
          setHue(e.target.value);
        });

        // Initialize
        setHue(slider.value);
      }

      // =========================================================================
      // HOLOGRAPHIC SHIP PANEL
      // =========================================================================
      const HOLO_SHIPS = {
        RKLB: {
          label: "RKLB · ORBITAL BUS",
          path: `
            <polyline points="10,30 30,10 70,10 90,30 70,50 30,50 10,30" class="holo-line"/>
            <polyline points="30,10 40,5 60,5 70,10" class="holo-line"/>
            <line x1="25" y1="30" x2="75" y2="30" class="holo-line"/>
            <line x1="40" y1="50" x2="40" y2="55" class="holo-line"/>
            <line x1="60" y1="50" x2="60" y2="55" class="holo-line"/>
          `
        },
        LUNR: {
          label: "LUNR · LUNAR SCOUT",
          path: `
            <polyline points="10,35 25,20 40,25 60,25 75,20 90,35 60,45 40,45 10,35" class="holo-line"/>
            <circle cx="50" cy="23" r="6" class="holo-line"/>
            <line x1="40" y1="45" x2="35" y2="55" class="holo-line"/>
            <line x1="60" y1="45" x2="65" y2="55" class="holo-line"/>
          `
        },
        JOBY: {
          label: "JOBY · EVTOL FRAME",
          path: `
            <polyline points="15,35 30,25 70,25 85,35 70,45 30,45 15,35" class="holo-line"/>
            <circle cx="30" cy="20" r="7" class="holo-line"/>
            <circle cx="70" cy="20" r="7" class="holo-line"/>
            <line x1="30" y1="27" x2="30" y2="35" class="holo-line"/>
            <line x1="70" y1="27" x2="70" y2="35" class="holo-line"/>
          `
        },
        ACHR: {
          label: "ACHR · ARCHER VTOL",
          path: `
            <polyline points="20,30 35,15 65,15 80,30 65,45 35,45 20,30" class="holo-line"/>
            <circle cx="35" cy="18" r="5" class="holo-line"/>
            <circle cx="65" cy="18" r="5" class="holo-line"/>
            <line x1="50" y1="15" x2="50" y2="45" class="holo-line"/>
          `
        },
        ASTS: {
          label: "ASTS · BLUEBIRD SAT",
          path: `
            <rect x="35" y="20" width="30" height="20" rx="2" class="holo-line"/>
            <line x1="20" y1="30" x2="35" y2="30" class="holo-line"/>
            <line x1="65" y1="30" x2="80" y2="30" class="holo-line"/>
            <rect x="10" y="22" width="12" height="16" rx="1" class="holo-line"/>
            <rect x="78" y="22" width="12" height="16" rx="1" class="holo-line"/>
          `
        },
        BKSY: {
          label: "BKSY · BLACKSKY SAT",
          path: `
            <circle cx="50" cy="30" r="12" class="holo-line"/>
            <line x1="15" y1="30" x2="38" y2="30" class="holo-line"/>
            <line x1="62" y1="30" x2="85" y2="30" class="holo-line"/>
            <rect x="8" y="24" width="10" height="12" rx="1" class="holo-line"/>
            <rect x="82" y="24" width="10" height="12" rx="1" class="holo-line"/>
          `
        },
        GME: {
          label: "GME · POWER CORE",
          path: `
            <polygon points="50,10 70,25 70,40 50,55 30,40 30,25" class="holo-line"/>
            <line x1="50" y1="10" x2="50" y2="55" class="holo-line"/>
            <line x1="30" y1="25" x2="70" y2="25" class="holo-line"/>
            <line x1="30" y1="40" x2="70" y2="40" class="holo-line"/>
          `
        },
        ATI: {
          label: "ATI · FORGE MATRIX",
          path: `
            <rect x="20" y="15" width="60" height="30" rx="3" class="holo-line"/>
            <line x1="20" y1="25" x2="80" y2="25" class="holo-line"/>
            <line x1="20" y1="35" x2="80" y2="35" class="holo-line"/>
            <circle cx="35" cy="30" r="4" class="holo-line"/>
            <circle cx="65" cy="30" r="4" class="holo-line"/>
            <line x1="50" y1="45" x2="50" y2="55" class="holo-line"/>
          `
        },
        CACI: {
          label: "CACI · INTEL NODE",
          path: `
            <polygon points="50,8 80,20 80,40 50,52 20,40 20,20" class="holo-line"/>
            <circle cx="50" cy="30" r="8" class="holo-line"/>
            <line x1="50" y1="22" x2="50" y2="8" class="holo-line"/>
            <line x1="58" y1="30" x2="80" y2="30" class="holo-line"/>
            <line x1="42" y1="30" x2="20" y2="30" class="holo-line"/>
          `
        },
        EVEX: {
          label: "EVEX · DRONE SWARM",
          path: `
            <circle cx="50" cy="30" r="6" class="holo-line"/>
            <circle cx="30" cy="20" r="4" class="holo-line"/>
            <circle cx="70" cy="20" r="4" class="holo-line"/>
            <circle cx="30" cy="40" r="4" class="holo-line"/>
            <circle cx="70" cy="40" r="4" class="holo-line"/>
            <line x1="36" y1="24" x2="44" y2="28" class="holo-line"/>
            <line x1="64" y1="24" x2="56" y2="28" class="holo-line"/>
            <line x1="36" y1="36" x2="44" y2="32" class="holo-line"/>
            <line x1="64" y1="36" x2="56" y2="32" class="holo-line"/>
          `
        },
        HON: {
          label: "HON · AEGIS CRUISER",
          path: `
            <polyline points="15,30 25,15 75,15 85,30 75,45 25,45 15,30" class="holo-line"/>
            <rect x="35" y="20" width="30" height="20" rx="2" class="holo-line"/>
            <line x1="15" y1="30" x2="35" y2="30" class="holo-line"/>
            <line x1="65" y1="30" x2="85" y2="30" class="holo-line"/>
            <circle cx="50" cy="30" r="5" class="holo-line"/>
          `
        },
        IRDM: {
          label: "IRDM · COMM ARRAY",
          path: `
            <circle cx="50" cy="30" r="15" class="holo-line"/>
            <circle cx="50" cy="30" r="8" class="holo-line"/>
            <circle cx="50" cy="30" r="2" class="holo-line"/>
            <line x1="50" y1="10" x2="50" y2="5" class="holo-line"/>
            <line x1="35" y1="20" x2="28" y2="13" class="holo-line"/>
            <line x1="65" y1="20" x2="72" y2="13" class="holo-line"/>
          `
        },
        KTOS: {
          label: "KTOS · STRIKE DRONE",
          path: `
            <polyline points="10,30 40,15 50,20 60,15 90,30 60,45 50,40 40,45 10,30" class="holo-line"/>
            <circle cx="50" cy="30" r="5" class="holo-line"/>
            <line x1="50" y1="25" x2="50" y2="15" class="holo-line"/>
            <line x1="10" y1="30" x2="25" y2="30" class="holo-line"/>
            <line x1="75" y1="30" x2="90" y2="30" class="holo-line"/>
          `
        },
        LOAR: {
          label: "LOAR · CARGO HAULER",
          path: `
            <rect x="20" y="18" width="60" height="24" rx="4" class="holo-line"/>
            <line x1="35" y1="18" x2="35" y2="42" class="holo-line"/>
            <line x1="50" y1="18" x2="50" y2="42" class="holo-line"/>
            <line x1="65" y1="18" x2="65" y2="42" class="holo-line"/>
            <circle cx="30" cy="50" r="4" class="holo-line"/>
            <circle cx="70" cy="50" r="4" class="holo-line"/>
          `
        },
        MP: {
          label: "MP · RARE ELEMENT",
          path: `
            <polygon points="50,5 65,15 65,35 50,45 35,35 35,15" class="holo-line"/>
            <polygon points="50,15 58,20 58,30 50,35 42,30 42,20" class="holo-line"/>
            <line x1="35" y1="25" x2="20" y2="25" class="holo-line"/>
            <line x1="65" y1="25" x2="80" y2="25" class="holo-line"/>
            <line x1="50" y1="45" x2="50" y2="55" class="holo-line"/>
          `
        },
        RDW: {
          label: "RDW · RECON SAT",
          path: `
            <ellipse cx="50" cy="30" rx="20" ry="12" class="holo-line"/>
            <line x1="30" y1="30" x2="15" y2="20" class="holo-line"/>
            <line x1="70" y1="30" x2="85" y2="20" class="holo-line"/>
            <rect x="12" y="15" width="8" height="12" rx="1" class="holo-line"/>
            <rect x="80" y="15" width="8" height="12" rx="1" class="holo-line"/>
            <circle cx="50" cy="30" r="4" class="holo-line"/>
          `
        },
        PL: {
          label: "PL · PLANET LABS",
          path: `
            <rect x="30" y="20" width="40" height="20" rx="3" class="holo-line"/>
            <line x1="25" y1="25" x2="10" y2="18" class="holo-line"/>
            <line x1="25" y1="35" x2="10" y2="42" class="holo-line"/>
            <line x1="75" y1="25" x2="90" y2="18" class="holo-line"/>
            <line x1="75" y1="35" x2="90" y2="42" class="holo-line"/>
            <circle cx="50" cy="30" r="6" class="holo-line"/>
          `
        }
      };

      function updateHoloForTicker(ticker) {
        const svg = document.getElementById('holo-ship-svg');
        const labelEl = document.getElementById('holo-ticker-label');
        if (!svg || !labelEl) return;

        const ship = HOLO_SHIPS[ticker] || HOLO_SHIPS['RKLB'];
        labelEl.textContent = ship.label;
        svg.innerHTML = ship.path;

        svg.style.opacity = '0.6';
        requestAnimationFrame(() => {
          svg.style.transition = 'opacity 0.3s ease';
          svg.style.opacity = '1';
        });
      }

      // Hook into ticker selection to update holo ship
      const originalSelectTicker = window.selectTicker;
      if (typeof originalSelectTicker === 'function') {
        window.selectTicker = function(ticker) {
          updateHoloForTicker(ticker);
          return originalSelectTicker.apply(this, arguments);
        };
      }

      // =========================================================================
      // TUBE OVERLOAD ON RUN ANALYSIS
      // =========================================================================
      function initTubeOverload() {
        const originalRunAnalysis = window.runAnalysis;
        if (typeof originalRunAnalysis === 'function') {
          window.runAnalysis = function(e) {
            const tubes = document.getElementById('tube-cluster');
            if (tubes) {
              tubes.classList.add('overload');
              setTimeout(() => tubes.classList.remove('overload'), 900);
            }
            return originalRunAnalysis.apply(this, arguments);
          };
        }
      }

      // =========================================================================
      // CLOSE ENCOUNTERS SIGNAL BOARD
      // =========================================================================
      function initEncountersBoard() {
        const lights = [...document.querySelectorAll('.encounters-board .enc-light')];
        const status = document.getElementById('signal-status');
        if (!lights.length || !status) return;

        let userInteracting = false;
        let interactionTimeout;

        function setStatus(text, mode) {
          status.textContent = text;
          status.className = 'signal-status ' + mode;
        }

        function updateSignalLevel(value) {
          value = Number(value);
          const activeCount = Math.round((value / 100) * lights.length);

          lights.forEach((l, i) => l.classList.toggle('active', i < activeCount));

          if (value < 20) {
            setStatus("STATIC / NOISE", "noise");
          } else if (value < 80) {
            setStatus("LISTENING…", "");
          } else {
            setStatus("⚡ COMMS LOCKED ⚡", "locked");
            if (typeof beep === 'function') beep(660, 0.08);
          }
        }

        // Hook into sliders, knobs, etc.
        document.querySelectorAll('input[type="range"]').forEach(slider => {
          slider.addEventListener('input', () => {
            userInteracting = true;
            clearTimeout(interactionTimeout);
            updateSignalLevel(slider.value);
            interactionTimeout = setTimeout(() => { userInteracting = false; }, 3000);
          });
        });

        // Knob clicks also affect signal
        document.querySelectorAll('.knob').forEach(knob => {
          knob.addEventListener('click', () => {
            userInteracting = true;
            clearTimeout(interactionTimeout);
            const val = parseInt(knob.dataset.value) || 50;
            updateSignalLevel(val);
            interactionTimeout = setTimeout(() => { userInteracting = false; }, 3000);
          });
        });

        // Atmospheric idle animation - alien pulse when not interacting
        setInterval(() => {
          if (userInteracting) return;
          const random = Math.floor(Math.random() * 100);
          updateSignalLevel(random);
        }, 1200);

        logTerminal('encounters signal array online');
      }

      // =========================================================================
      // CARGO BAY HEALTH SYSTEM
      // =========================================================================
      const CARGO_SYSTEMS = {
        'RKLB': { name: 'NAV THRUSTERS', critical: true },
        'LUNR': { name: 'SOLAR ARRAY', critical: true },
        'JOBY': { name: 'EVTOL DECK', critical: false },
        'ASTS': { name: 'COMMS RELAY', critical: true },
        'ACHR': { name: 'LIFT JETS', critical: false },
        'EVEX': { name: 'SUPPORT DRONE', critical: false },
        'BKSY': { name: 'OPTICS BAY', critical: false },
        'GME': { name: 'POWER CORE', critical: true }
      };

      function updateCargoHealth(ticker, pnl) {
        const item = document.querySelector(`.cargo-item[data-ticker="${ticker}"]`);
        if (!item) return;

        const health = item.querySelector('.cargo-health');
        item.classList.remove('damaged', 'optimal');

        if (pnl < -5) {
          item.classList.add('damaged');
          health.textContent = "CRITICAL";
        } else if (pnl < 0) {
          item.classList.add('damaged');
          health.textContent = "FAULT";
        } else if (pnl > 10) {
          item.classList.add('optimal');
          health.textContent = "OPTIMAL+";
        } else if (pnl > 0) {
          item.classList.add('optimal');
          health.textContent = "OPTIMAL";
        } else {
          health.textContent = "NOMINAL";
        }
      }

      function initCargoBay() {
        // Update cargo bay based on demo positions
        if (typeof DEMO_STOCK_POSITIONS !== 'undefined') {
          DEMO_STOCK_POSITIONS.forEach(pos => {
            const pnlPct = ((pos.current_price - pos.entry_price) / pos.entry_price) * 100;
            updateCargoHealth(pos.ticker, pnlPct);
          });
        }
        logTerminal('cargo bay manifest synchronized');
      }

      // =========================================================================
      // TRAJECTORY NAVIGATOR (Derivatives Path Simulator)
      // =========================================================================
      function initTrajectoryCanvas() {
        const canvas = document.getElementById('trajectory-canvas');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        
        // Set actual canvas size
        function resizeCanvas() {
          const rect = canvas.getBoundingClientRect();
          canvas.width = rect.width * window.devicePixelRatio;
          canvas.height = rect.height * window.devicePixelRatio;
          ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Star field with more variety
        const stars = [];
        for (let i = 0; i < 60; i++) {
          stars.push({
            x: Math.random() * 100,
            y: Math.random() * 100,
            size: Math.random() * 1.5 + 0.5,
            alpha: Math.random() * 0.5 + 0.2,
            twinkle: Math.random() * Math.PI * 2,
            twinkleSpeed: Math.random() * 0.02 + 0.01
          });
        }

        let risk = 0.5;
        let horizon = 0.5;
        let phase = 0;

        const hue = () => getComputedStyle(document.documentElement).getPropertyValue('--accent-hue') || 150;

        function drawTrajectory() {
          const w = canvas.getBoundingClientRect().width;
          const h = canvas.getBoundingClientRect().height;
          
          ctx.clearRect(0, 0, w, h);
          
          // Background gradient
          const bg = ctx.createLinearGradient(0, 0, 0, h);
          bg.addColorStop(0, "#020813");
          bg.addColorStop(1, "#000408");
          ctx.fillStyle = bg;
          ctx.fillRect(0, 0, w, h);

          // Draw twinkling stars
          stars.forEach(star => {
            star.twinkle += star.twinkleSpeed;
            const flicker = 0.5 + Math.sin(star.twinkle) * 0.3;
            ctx.beginPath();
            ctx.arc(star.x / 100 * w, star.y / 100 * h, star.size, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(140, 255, 210, ${star.alpha * flicker})`;
            ctx.fill();
          });

          // Grid lines
          ctx.strokeStyle = `hsla(${hue()}, 100%, 60%, 0.12)`;
          ctx.lineWidth = 0.4;
          for (let x = 0; x < w; x += 40) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, h);
            ctx.stroke();
          }
          for (let y = 0; y < h; y += 30) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(w, y);
            ctx.stroke();
          }

          // Key positions
          const baseY = h * 0.75;
          const apexX = w * 0.08;
          const apexY = h * 0.25;
          const spread = 30 + risk * 60;
          const horizonStretch = 40 + horizon * 90;
          const riskBend = risk * 70;

          // "Safe corridor" cone
          ctx.beginPath();
          ctx.moveTo(apexX, baseY);
          ctx.lineTo(w - spread, apexY - 12);
          ctx.lineTo(w - spread, apexY + 24);
          ctx.closePath();

          const coneGrad = ctx.createLinearGradient(apexX, baseY, w, apexY);
          coneGrad.addColorStop(0, `hsla(${hue()}, 100%, 60%, 0.15)`);
          coneGrad.addColorStop(1, `hsla(${hue()}, 100%, 60%, 0)`);
          ctx.fillStyle = coneGrad;
          ctx.fill();

          // Ghost "alternative" path (dashed)
          ctx.beginPath();
          ctx.lineWidth = 1;
          ctx.moveTo(apexX, baseY);
          ctx.bezierCurveTo(
            w * 0.35, baseY - riskBend * 0.3,
            w * 0.65, baseY - riskBend * 0.1,
            w - horizonStretch * 0.7, apexY + 20
          );
          ctx.setLineDash([6, 6]);
          ctx.strokeStyle = `hsla(${hue()}, 100%, 65%, 0.35)`;
          ctx.stroke();
          ctx.setLineDash([]);

          // Main trajectory line
          ctx.beginPath();
          ctx.lineWidth = 2.5;
          ctx.moveTo(apexX, baseY);
          
          // Bezier curve with animated wobble
          const wobble = Math.sin(phase * 0.03) * 8;
          ctx.bezierCurveTo(
            w * 0.35, baseY - riskBend + wobble,
            w * 0.65, baseY - riskBend * 0.6 - wobble * 0.5,
            w - horizonStretch, apexY + 10
          );

          // Color by risk
          let pathColor;
          if (risk > 0.7) {
            pathColor = "#ff6b6b";
          } else if (risk < 0.35) {
            pathColor = `hsl(${hue()}, 100%, 60%)`;
          } else {
            pathColor = "#ffb347";
          }
          
          ctx.strokeStyle = pathColor;
          ctx.shadowColor = pathColor;
          ctx.shadowBlur = 10;
          ctx.stroke();
          ctx.shadowBlur = 0;

          // Waypoints
          function drawWaypoint(x, y, label, isActive) {
            // Outer ring
            ctx.beginPath();
            ctx.arc(x, y, isActive ? 8 : 5, 0, Math.PI * 2);
            ctx.strokeStyle = `hsla(${hue()}, 100%, 60%, 0.6)`;
            ctx.lineWidth = 1;
            ctx.stroke();
            
            // Inner dot
            ctx.beginPath();
            ctx.arc(x, y, isActive ? 4 : 3, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${hue()}, 100%, 60%)`;
            ctx.shadowColor = `hsl(${hue()}, 100%, 60%)`;
            ctx.shadowBlur = isActive ? 12 : 6;
            ctx.fill();
            ctx.shadowBlur = 0;

            // Label
            ctx.font = "10px 'IBM Plex Mono', monospace";
            ctx.fillStyle = `hsla(${hue()}, 100%, 75%, 0.9)`;
            ctx.fillText(label, x + 10, y - 6);
          }

          drawWaypoint(apexX, baseY, "NOW", true);
          drawWaypoint(w - horizonStretch, apexY + 10, "EXPIRY", false);

          // Ship marker moving along path
          const t = Math.min(1, Math.max(0, horizon * 0.8 + 0.1));
          const shipX = apexX + (w - horizonStretch - apexX) * t;
          const shipY = baseY - riskBend * t + Math.sin(phase * 0.05) * 3;

          ctx.save();
          ctx.translate(shipX, shipY);
          ctx.rotate(-0.3); // Slight angle
          
          // Ship triangle
          ctx.beginPath();
          ctx.moveTo(0, -6);
          ctx.lineTo(-5, 6);
          ctx.lineTo(5, 6);
          ctx.closePath();
          ctx.fillStyle = `hsl(${hue()}, 100%, 75%)`;
          ctx.shadowColor = `hsl(${hue()}, 100%, 60%)`;
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.shadowBlur = 0;
          
          // Engine glow
          ctx.beginPath();
          ctx.moveTo(-3, 6);
          ctx.lineTo(0, 10 + Math.random() * 4);
          ctx.lineTo(3, 6);
          ctx.closePath();
          ctx.fillStyle = risk > 0.5 ? "#ffb347" : `hsl(${hue()}, 100%, 60%)`;
          ctx.fill();
          
          ctx.restore();

          // Status text
          const statusEl = document.getElementById("traj-risk");
          if (statusEl) {
            if (risk > 0.7) {
              statusEl.textContent = "HIGH";
              statusEl.style.color = "#ff6b6b";
            } else if (risk < 0.35) {
              statusEl.textContent = "LOW";
              statusEl.style.color = `hsl(${hue()}, 100%, 60%)`;
            } else {
              statusEl.textContent = "MODERATE";
              statusEl.style.color = "#ffb347";
            }
          }

          phase += 1;
        }

        // Animate
        function animate() {
          drawTrajectory();
          requestAnimationFrame(animate);
        }
        animate();

        // Hook into controls
        document.querySelectorAll('input[type="range"]').forEach(slider => {
          slider.addEventListener('input', () => {
            risk = slider.value / 100;
          });
        });

        document.querySelectorAll('.knob').forEach(knob => {
          knob.addEventListener('click', () => {
            const val = parseInt(knob.dataset.value) || 45;
            horizon = val / 100;
          });
        });

        logTerminal('trajectory navigator online — cinematic mode enabled');
      }

      // =========================================================================
      // LORE ENGINE - Random In-World Events
      // =========================================================================
      const LORE_EVENTS = [
        "Unknown beacon pinged portside array.",
        "Telemetry drift corrected automatically.",
        "Cargo handlers report minor anomalies.",
        "Charts updated to reflect stellar winds.",
        "Crew reports strange vibrations in deck 3.",
        "AI suggests caution in derivatives bay.",
        "Solar flare activity detected — shields nominal.",
        "Quantum entanglement stable at 99.7%.",
        "Navigation computer recalibrating...",
        "Distant signal classified as potential artificial.",
        "Life support cycling — all systems green.",
        "Hull integrity scan complete. No breaches.",
        "Spectral analysis of nearby object complete.",
        "FTL drive cooling cycle initiated.",
        "Crew morale index: NOMINAL.",
        "Market anomaly detected in sector 7-G.",
        "Thermal signature identified — classifying...",
        "Backup power reserves at 94%.",
        "Long-range sensors detect movement.",
        "Docking bay pressure equalized.",
        "Encrypted transmission received. Decoding...",
        "Asteroid field mapped. Course adjusted.",
        "Bio-scanner reports all crew accounted for.",
        "Reactor output stable at 87%.",
        "External cameras detect debris field ahead."
      ];

      function initLoreEngine() {
        setInterval(() => {
          const event = LORE_EVENTS[Math.floor(Math.random() * LORE_EVENTS.length)];
          if (typeof logTerminal === 'function') {
            logTerminal(event);
          }
        }, 18000); // Every 18 seconds

        // Initial lore message
        setTimeout(() => {
          logTerminal('Lore engine initialized. Monitoring all frequencies.');
        }, 2000);
      }

      // =========================================================================
      // AMBIENT PARTICLES
      // =========================================================================
      function initAmbientParticles() {
        const container = document.getElementById('ambient-particles');
        if (!container) return;

        const particleCount = 15;
        
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 15 + 's';
          particle.style.animationDuration = (12 + Math.random() * 8) + 's';
          container.appendChild(particle);
        }
      }

      // =========================================================================
      // KONAMI CODE EASTER EGG - INVADER ATTACK
      // =========================================================================
      function initKonamiCode() {
        const KONAMI = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;
        let konamiUnlocked = false;

        document.addEventListener('keydown', (e) => {
          const key = e.key.length === 1 ? e.key.toLowerCase() : e.key;
          
          if (key === KONAMI[konamiIndex]) {
            konamiIndex++;
            
            if (konamiIndex === KONAMI.length) {
              konamiIndex = 0;
              if (!konamiUnlocked) {
                triggerInvaderAttack();
                konamiUnlocked = true;
                setTimeout(() => { konamiUnlocked = false; }, 10000);
              }
            }
          } else {
            konamiIndex = 0;
          }
        });
      }

      function triggerInvaderAttack() {
        const overlay = document.getElementById('invader-attack-overlay');
        const flash = document.getElementById('attack-flash');
        if (!overlay) return;

        // Play mech impact sounds
        if (window.MechSFX) {
          MechSFX.impact(0.4);
          setTimeout(() => MechSFX.alert(400, 150, 0.3), 150);
        }

        // Screen flash
        flash.classList.add('flash');
        setTimeout(() => flash.classList.remove('flash'), 150);

        // Toast notification
        if (typeof showToast === 'function') {
          showToast('🛸 INVADER ATTACK DETECTED!', 'alert');
        }

        // Log to terminal
        if (typeof logTerminal === 'function') {
          logTerminal('⚠ ALERT: Hostile formation detected! Shields up!');
        }

        // Create invader wave
        overlay.classList.add('active');
        overlay.innerHTML = '';

        const invaderCount = 15;
        const invaderSVG = `<svg viewBox="0 0 11 8" class="attack-invader">
          <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
          <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
          <rect x="2" y="2" width="7" height="1"/>
          <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
          <rect x="0" y="4" width="11" height="1"/>
          <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
          <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
          <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
        </svg>`;

        for (let i = 0; i < invaderCount; i++) {
          const wrapper = document.createElement('div');
          wrapper.innerHTML = invaderSVG;
          const invader = wrapper.firstChild;
          invader.style.left = (5 + Math.random() * 90) + '%';
          invader.style.animationDelay = (Math.random() * 2) + 's';
          invader.style.animationDuration = (2 + Math.random() * 2) + 's';
          overlay.appendChild(invader);
        }

        // Clear after animation
        setTimeout(() => {
          overlay.classList.remove('active');
          overlay.innerHTML = '';
          if (typeof logTerminal === 'function') {
            logTerminal('Invader threat neutralized. Shields nominal.');
          }
        }, 5000);

        // Complete arcade mission if available
        if (typeof completeMission === 'function') {
          completeMission('find_invader');
        }
      }

      // =========================================================================
      // SIGNAL INVADERS - PLAYABLE ARCADE GAME
      // =========================================================================
      const SignalInvaders = {
        canvas: null,
        ctx: null,
        active: false,
        animationId: null,
        
        // Game state
        score: 0,
        lives: 3,
        wave: 1,
        gameOver: false,
        paused: false,
        
        // Player
        player: { x: 270, y: 360, width: 26, height: 16, speed: 5 },
        
        // Game objects
        bullets: [],
        enemies: [],
        enemyBullets: [],
        particles: [],
        stars: [],
        
        // Timing
        lastEnemyShot: 0,
        enemyDirection: 1,
        enemyDropAmount: 0,
        
        // Keys
        keys: {},
        
        init() {
          this.canvas = document.getElementById('invaders-canvas');
          if (!this.canvas) return;
          this.ctx = this.canvas.getContext('2d');
          
          // Generate starfield
          this.stars = [];
          for (let i = 0; i < 50; i++) {
            this.stars.push({
              x: Math.random() * 600,
              y: Math.random() * 400,
              size: Math.random() * 1.5 + 0.5,
              alpha: Math.random() * 0.5 + 0.2
            });
          }
          
          // Event listeners
          this.handleKeyDown = (e) => {
            if (!this.active) return;
            this.keys[e.key] = true;
            if (e.key === ' ' && !this.gameOver) {
              e.preventDefault();
              this.shoot();
            }
            if (e.key === 'Escape') {
              this.close();
            }
          };
          
          this.handleKeyUp = (e) => {
            this.keys[e.key] = false;
          };
          
          document.addEventListener('keydown', this.handleKeyDown);
          document.addEventListener('keyup', this.handleKeyUp);
          
          // Close button
          const closeBtn = document.getElementById('invaders-close-btn');
          if (closeBtn) {
            closeBtn.onclick = () => this.close();
          }
          
          // Mobile touch controls
          const touchLeft = document.getElementById('touch-left');
          const touchRight = document.getElementById('touch-right');
          const touchFire = document.getElementById('touch-fire');
          
          if (touchLeft) {
            touchLeft.addEventListener('touchstart', (e) => {
              e.preventDefault();
              this.keys['ArrowLeft'] = true;
            });
            touchLeft.addEventListener('touchend', () => {
              this.keys['ArrowLeft'] = false;
            });
            touchLeft.addEventListener('touchcancel', () => {
              this.keys['ArrowLeft'] = false;
            });
          }
          
          if (touchRight) {
            touchRight.addEventListener('touchstart', (e) => {
              e.preventDefault();
              this.keys['ArrowRight'] = true;
            });
            touchRight.addEventListener('touchend', () => {
              this.keys['ArrowRight'] = false;
            });
            touchRight.addEventListener('touchcancel', () => {
              this.keys['ArrowRight'] = false;
            });
          }
          
          if (touchFire) {
            touchFire.addEventListener('touchstart', (e) => {
              e.preventDefault();
              if (!this.gameOver && this.active) {
                this.shoot();
              }
            });
          }
          
          // Prevent scrolling while playing on mobile
          this.canvas.addEventListener('touchmove', (e) => {
            if (this.active) e.preventDefault();
          }, { passive: false });
        },
        
        start() {
          if (!this.canvas) this.init();
          
          // Reset game state
          this.score = 0;
          this.lives = 3;
          this.wave = 1;
          this.gameOver = false;
          this.player.x = 270;
          this.bullets = [];
          this.enemies = [];
          this.enemyBullets = [];
          this.particles = [];
          this.enemyDirection = 1;
          
          this.spawnWave();
          this.updateUI();
          
          // Show overlay
          const overlay = document.getElementById('signal-invaders-overlay');
          if (overlay) {
            overlay.classList.remove('hidden');
            overlay.classList.add('active');
          }
          
          this.active = true;
          this.gameLoop();
          
          if (typeof logTerminal === 'function') {
            logTerminal('SIGNAL INVADERS initialized. Defend the array!');
          }
          if (window.MechSFX) {
            MechSFX.powerUp(0.3);
          }
        },
        
        close() {
          this.active = false;
          if (this.animationId) {
            cancelAnimationFrame(this.animationId);
          }
          
          const overlay = document.getElementById('signal-invaders-overlay');
          if (overlay) {
            overlay.classList.remove('active');
            setTimeout(() => overlay.classList.add('hidden'), 300);
          }
          
          // Log final score
          if (typeof logTerminal === 'function') {
            logTerminal(`SIGNAL INVADERS ended. Final score: ${this.score}`);
          }
        },
        
        spawnWave() {
          this.enemies = [];
          const rows = Math.min(4 + Math.floor(this.wave / 2), 6);
          const cols = Math.min(8 + this.wave, 10);
          
          // Get available fleet tickers for enemies
          const fleetTickers = Object.keys(SHIP_SPRITES);
          
          for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
              // Assign a random fleet ship to each enemy
              const ticker = fleetTickers[Math.floor(Math.random() * fleetTickers.length)];
              const isElite = row < 2;
              
              this.enemies.push({
                x: 60 + col * 52,
                y: 40 + row * 36,
                width: 32,
                height: 24,
                type: isElite ? 'elite' : 'normal',
                ticker: ticker,
                color: tickerColors[ticker] || '#33ff99',
                points: isElite ? 30 : 10
              });
            }
          }
          
          document.getElementById('invaders-message').textContent = `WAVE ${this.wave} - HOSTILE FLEET INCOMING!`;
          setTimeout(() => {
            document.getElementById('invaders-message').textContent = '';
          }, 2000);
        },
        
        shoot() {
          if (this.bullets.length < 3) { // Max 3 bullets at once
            this.bullets.push({
              x: this.player.x + this.player.width / 2 - 2,
              y: this.player.y - 8,
              width: 4,
              height: 8
            });
            if (window.MechSFX) {
              MechSFX.weaponFire(0.1);
            }
          }
        },
        
        updateUI() {
          document.getElementById('invaders-score').textContent = this.score;
          document.getElementById('invaders-lives').textContent = '♥'.repeat(Math.max(0, this.lives));
          document.getElementById('invaders-wave').textContent = this.wave;
        },
        
        gameLoop() {
          if (!this.active) return;
          
          this.update();
          this.render();
          
          this.animationId = requestAnimationFrame(() => this.gameLoop());
        },
        
        update() {
          if (this.gameOver) return;
          
          // Player movement
          if (this.keys['ArrowLeft'] || this.keys['a']) {
            this.player.x = Math.max(10, this.player.x - this.player.speed);
          }
          if (this.keys['ArrowRight'] || this.keys['d']) {
            this.player.x = Math.min(600 - this.player.width - 10, this.player.x + this.player.speed);
          }
          
          // Update bullets
          this.bullets = this.bullets.filter(b => {
            b.y -= 7;
            return b.y > -10;
          });
          
          // Update enemy bullets
          this.enemyBullets = this.enemyBullets.filter(b => {
            b.y += 4;
            return b.y < 420;
          });
          
          // Move enemies
          let hitEdge = false;
          this.enemies.forEach(e => {
            e.x += this.enemyDirection * (1 + this.wave * 0.3);
            if (e.x < 10 || e.x > 600 - e.width - 10) hitEdge = true;
          });
          
          if (hitEdge) {
            this.enemyDirection *= -1;
            this.enemies.forEach(e => e.y += 12);
          }
          
          // Enemy shooting
          if (Date.now() - this.lastEnemyShot > Math.max(500, 2000 - this.wave * 200)) {
            const shooters = this.enemies.filter(e => 
              !this.enemies.some(other => other.x === e.x && other.y > e.y)
            );
            if (shooters.length > 0) {
              const shooter = shooters[Math.floor(Math.random() * shooters.length)];
              this.enemyBullets.push({
                x: shooter.x + shooter.width / 2 - 2,
                y: shooter.y + shooter.height,
                width: 4,
                height: 6
              });
              this.lastEnemyShot = Date.now();
            }
          }
          
          // Collision: bullets vs enemies
          this.bullets.forEach((bullet, bi) => {
            this.enemies.forEach((enemy, ei) => {
              if (this.collides(bullet, enemy)) {
                // Create particles using enemy's fleet color
                for (let i = 0; i < 10; i++) {
                  this.particles.push({
                    x: enemy.x + enemy.width / 2,
                    y: enemy.y + enemy.height / 2,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 35,
                    color: enemy.color || '#33ff99'
                  });
                }
                
                this.bullets.splice(bi, 1);
                this.enemies.splice(ei, 1);
                this.score += enemy.points || (enemy.type === 'elite' ? 30 : 10);
                this.updateUI();
                
                // Show ticker when destroyed
                if (typeof showToast === 'function' && Math.random() > 0.7) {
                  showToast(`${enemy.ticker} neutralized!`, 'info');
                }
                
                if (window.MechSFX) {
                  MechSFX.bassHit(80, 0.15);
                }
              }
            });
          });
          
          // Collision: enemy bullets vs player
          this.enemyBullets.forEach((bullet, bi) => {
            if (this.collides(bullet, this.player)) {
              this.enemyBullets.splice(bi, 1);
              this.lives--;
              this.updateUI();
              
              // Player hit particles
              for (let i = 0; i < 12; i++) {
                this.particles.push({
                  x: this.player.x + this.player.width / 2,
                  y: this.player.y + this.player.height / 2,
                  vx: (Math.random() - 0.5) * 8,
                  vy: (Math.random() - 0.5) * 8,
                  life: 40,
                  color: '#ff6b6b'
                });
              }
              
              if (window.MechSFX) {
                MechSFX.impact(0.25);
              }
              
              if (this.lives <= 0) {
                this.endGame();
              }
            }
          });
          
          // Enemy reaches bottom
          if (this.enemies.some(e => e.y > 340)) {
            this.endGame();
          }
          
          // Wave cleared
          if (this.enemies.length === 0) {
            this.wave++;
            this.spawnWave();
            this.updateUI();
            if (window.MechSFX) {
              MechSFX.success();
            }
          }
          
          // Update particles
          this.particles = this.particles.filter(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
            return p.life > 0;
          });
        },
        
        collides(a, b) {
          return a.x < b.x + b.width &&
                 a.x + a.width > b.x &&
                 a.y < b.y + b.height &&
                 a.y + a.height > b.y;
        },
        
        endGame() {
          this.gameOver = true;
          document.getElementById('invaders-message').textContent = `GAME OVER - SCORE: ${this.score}`;
          
          if (typeof showToast === 'function') {
            showToast(`Signal Invaders: ${this.score} points!`, 'info');
          }
          
          // Complete arcade mission for high score
          if (this.score >= 500 && typeof completeMission === 'function') {
            completeMission('arcade_score');
          }
          
          // Restart after delay
          setTimeout(() => {
            if (this.active) {
              this.start();
            }
          }, 3000);
        },
        
        render() {
          const ctx = this.ctx;
          ctx.clearRect(0, 0, 600, 400);
          
          // Draw starfield
          this.stars.forEach(star => {
            ctx.fillStyle = `rgba(51, 255, 153, ${star.alpha})`;
            ctx.fillRect(star.x, star.y, star.size, star.size);
          });
          
          // Draw player ship using selected sprite
          const playerTicker = SpriteCache.selectedPlayerShip || 'RKLB';
          const playerColor = tickerColors[playerTicker] || '#33ff99';
          SpriteCache.drawOnCanvas(
            ctx,
            playerTicker,
            this.player.x + this.player.width / 2,
            this.player.y + this.player.height / 2,
            1.0,
            { glow: true, glowBlur: 10, glowColor: playerColor, width: 50, height: 38 }
          );
          
          // Draw bullets with player color
          ctx.fillStyle = playerColor;
          ctx.shadowColor = playerColor;
          ctx.shadowBlur = 6;
          this.bullets.forEach(b => {
            ctx.fillRect(b.x, b.y, b.width, b.height);
          });
          ctx.shadowBlur = 0;
          
          // Draw enemies using their assigned fleet sprites (flipped to face down)
          this.enemies.forEach(e => {
            const glowIntensity = e.type === 'elite' ? 8 : 4;
            SpriteCache.drawOnCanvas(
              ctx,
              e.ticker,
              e.x + e.width / 2,
              e.y + e.height / 2,
              0.65,
              { 
                glow: true, 
                glowBlur: glowIntensity, 
                glowColor: e.color,
                flipY: true,
                width: 50,
                height: 38
              }
            );
            
            // Elite indicator ring
            if (e.type === 'elite') {
              ctx.strokeStyle = '#ffb347';
              ctx.lineWidth = 1;
              ctx.globalAlpha = 0.5;
              ctx.beginPath();
              ctx.arc(e.x + e.width / 2, e.y + e.height / 2, 18, 0, Math.PI * 2);
              ctx.stroke();
              ctx.globalAlpha = 1;
            }
          });
          
          // Draw enemy bullets
          ctx.fillStyle = '#ff6b6b';
          ctx.shadowColor = '#ff6b6b';
          ctx.shadowBlur = 4;
          this.enemyBullets.forEach(b => {
            ctx.fillRect(b.x, b.y, b.width, b.height);
          });
          ctx.shadowBlur = 0;
          
          // Draw particles
          this.particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life / 40;
            ctx.fillRect(p.x, p.y, 3, 3);
          });
          ctx.globalAlpha = 1;
          
          // Game over overlay
          if (this.gameOver) {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, 600, 400);
            ctx.fillStyle = '#ff6b6b';
            ctx.font = '24px Orbitron';
            ctx.textAlign = 'center';
            ctx.fillText('SIGNAL LOST', 300, 180);
            ctx.fillStyle = '#33ff99';
            ctx.font = '16px "IBM Plex Mono"';
            ctx.fillText(`Final Score: ${this.score}`, 300, 220);
            ctx.fillStyle = '#888';
            ctx.font = '12px "IBM Plex Mono"';
            ctx.fillText('Restarting...', 300, 260);
          }
        }
      };

      // Cheat code listener for multiple codes
      let cheatBuffer = '';
      document.addEventListener('keydown', (e) => {
        if (e.key.length === 1) {
          cheatBuffer += e.key.toUpperCase();
          cheatBuffer = cheatBuffer.slice(-12);
          
          if (cheatBuffer.includes('INVADER')) {
            cheatBuffer = '';
            SignalInvaders.start();
          }
          
          if (cheatBuffer.includes('LAND')) {
            cheatBuffer = '';
            LandingGame.start();
          }
          
          if (cheatBuffer.includes('ADMIN')) {
            cheatBuffer = '';
            AdminConsole.open();
          }
        }
      });

      // =========================================================================
      // ADMIN CONSOLE - Snoop Trap System
      // =========================================================================
      const AdminConsole = {
        overlay: null,
        attempts: 0,
        snoopCounts: {},
        
        RESPONSES: [
          "ACCESS DENIED: This cockpit runs on story mode only.",
          "AUTH CORE: Incorrect. Impressively committed, but still incorrect.",
          "SYSTEM: We cross-checked that password against seven parallel universes. No luck.",
          "NOTE: If this actually logged in, several lawyers would materialize instantly.",
          "SECURITY: At this point we're evaluating *you*, not the password.",
          "FOURTH WALL: There is no version of reality where guessing this works.",
          "CONCLUSION: The only winning move is to appreciate the UI and move on.",
          "SYSTEM: We admire your persistence. It changes nothing.",
          "AUTH: Even the raccoons running this server are impressed. Still no.",
          "FINAL: This field has rejected credentials from 47 dimensions. Yours included."
        ],
        
        SNOOP_MESSAGES: {
          buy: [
            "TRADE BLOCKED: This cockpit runs on vibes, not orders.",
            "SYSTEM: You don't actually think this connects to a broker, right?",
            "RISK ENGINE: Nice enthusiasm. Still can't buy anything here.",
            "ALERT: Excessive button pressing detected. Consider a demo account."
          ],
          sell: [
            "LIQUIDATION ERROR: Emotional damage cannot be realized as gains.",
            "SYSTEM: Nothing to sell. This is a diorama, not a brokerage.",
            "RISK ENGINE: Imagine if this worked. SEC shows up, everyone cries.",
            "NOTE: The 'SELL' button is legally ornamental."
          ],
          withdraw: [
            "WITHDRAWAL FAILED: Funds are imaginary. The attachment is real.",
            "BANK: We regret to inform you this ATM dispenses only vibes.",
            "SYSTEM: Request forwarded to the Department of Wishful Thinking."
          ],
          leverage: [
            "MARGIN CALL: You can't lever up on pretend positions.",
            "RISK CORE: The only thing getting leveraged here is your curiosity.",
            "SYSTEM: 10x leverage on zero is still zero. Math is brutal."
          ],
          override: [
            "OVERRIDE REJECTED: You are Mission Guest, not Mission Control.",
            "SYSTEM: Override codes are stored in a vault made of pure fiction.",
            "AUTH: The override button is connected to a very convincing LED."
          ],
          default: [
            "INPUT IGNORED: This section is for narrative purposes only.",
            "SYSTEM: You've discovered a prop. Congratulations, stagehand.",
            "FOURTH WALL: Hi, yes, I can see you clicking that."
          ]
        },
        
        init() {
          this.overlay = document.getElementById('admin-overlay');
          if (!this.overlay) return;
          
          const closeBtn = document.getElementById('admin-close');
          const submitBtn = document.getElementById('admin-submit');
          const passInput = document.getElementById('admin-pass');
          const userInput = document.getElementById('admin-user');
          
          if (closeBtn) closeBtn.onclick = () => this.close();
          if (submitBtn) submitBtn.onclick = () => this.attemptLogin();
          if (passInput) passInput.onkeydown = (e) => { if (e.key === 'Enter') this.attemptLogin(); };
          if (userInput) userInput.onkeydown = (e) => { if (e.key === 'Enter') passInput.focus(); };
          
          this.overlay.onclick = (e) => {
            if (e.target === this.overlay || e.target.classList.contains('admin-backdrop')) {
              this.close();
            }
          };
          
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && this.overlay.classList.contains('visible')) {
              this.close();
            }
          });
          
          // Hook dummy controls
          this.initSnoopTraps();
        },
        
        initSnoopTraps() {
          document.querySelectorAll('.dummy-control').forEach(el => {
            el.addEventListener('click', (e) => {
              e.preventDefault();
              const action = el.dataset.dummyAction || 'default';
              
              if (action === 'admin' || action === 'override') {
                this.open();
              } else {
                this.showSnoopMessage(action);
              }
            });
          });
        },
        
        showSnoopMessage(action) {
          const messages = this.SNOOP_MESSAGES[action] || this.SNOOP_MESSAGES.default;
          const count = this.snoopCounts[action] || 0;
          this.snoopCounts[action] = count + 1;
          
          const msg = count < messages.length ? messages[count] : messages[Math.floor(Math.random() * messages.length)];
          
          if (typeof showToast === 'function') {
            showToast(msg, 'warn');
          }
          if (typeof logTerminal === 'function') {
            logTerminal('snoop trap • ' + action.toUpperCase());
          }
          if (window.MechSFX) {
            MechSFX.alert(300, 150, 0.15);
          }
          
          // Glitch effect on repeated attempts
          if (count >= 3) {
            document.body.classList.add('screen-glitch');
            setTimeout(() => document.body.classList.remove('screen-glitch'), 200);
          }
        },
        
        open() {
          if (!this.overlay) return;
          this.attempts = 0;
          
          this.overlay.classList.remove('hidden');
          setTimeout(() => this.overlay.classList.add('visible'), 10);
          
          const textEl = document.getElementById('admin-text');
          if (textEl) {
            textEl.innerHTML = 'Unauthorized console access attempt detected.<br>Please authenticate to continue ruining the narrative.';
          }
          
          const userInput = document.getElementById('admin-user');
          const passInput = document.getElementById('admin-pass');
          if (userInput) userInput.value = '';
          if (passInput) passInput.value = '';
          
          setTimeout(() => userInput?.focus(), 100);
          
          if (typeof logTerminal === 'function') {
            logTerminal('security: admin console probe detected');
          }
        },
        
        close() {
          if (!this.overlay) return;
          this.overlay.classList.remove('visible');
          setTimeout(() => this.overlay.classList.add('hidden'), 250);
        },
        
        attemptLogin() {
          const userInput = document.getElementById('admin-user');
          const passInput = document.getElementById('admin-pass');
          const textEl = document.getElementById('admin-text');
          const windowEl = this.overlay.querySelector('.admin-window');
          
          const user = userInput?.value.trim() || 'GUEST';
          const pass = passInput?.value.trim() || '••••••';
          
          const response = this.attempts < this.RESPONSES.length 
            ? this.RESPONSES[this.attempts] 
            : this.RESPONSES[Math.floor(Math.random() * this.RESPONSES.length)];
          
          this.attempts++;
          
          if (textEl) {
            textEl.innerHTML = `
              <span class="warning">USER:</span> ${user}<br>
              <span class="warning">INPUT:</span> "${pass}"<br><br>
              <span class="error">${response}</span>
            `;
          }
          
          // Shake effect
          if (windowEl) {
            windowEl.classList.add('shake');
            setTimeout(() => windowEl.classList.remove('shake'), 300);
          }
          
          if (typeof showToast === 'function') {
            showToast(response, 'alert');
          }
          if (typeof logTerminal === 'function') {
            logTerminal(`auth attempt #${this.attempts} • user=${user}`);
          }
          if (window.MechSFX) {
            MechSFX.error();
          }
          
          // Easter egg at attempt 5
          if (this.attempts === 5 && typeof completeMission === 'function') {
            completeMission('snoop_master');
          }
        }
      };
      
      window.AdminConsole = AdminConsole;

      // =========================================================================
      // TERRAIN LANDER - Chart Landing Mini-Game
      // =========================================================================
      const LandingGame = {
        canvas: null,
        ctx: null,
        active: false,
        animationId: null,
        
        // Ship state
        ship: { x: 100, y: 50, vx: 0, vy: 0, fuel: 100, landed: false, crashed: false },
        
        // Physics
        gravity: 0.02,
        thrust: 0.08,
        maxLandingSpeed: 1.5,
        
        // Terrain (generated from "price data")
        terrain: [],
        stars: [],
        
        // Controls
        keys: {},
        
        init() {
          this.canvas = document.getElementById('landing-canvas');
          if (!this.canvas) return;
          
          this.ctx = this.canvas.getContext('2d');
          this.resizeCanvas();
          
          window.addEventListener('resize', () => this.resizeCanvas());
          
          // Keyboard controls
          document.addEventListener('keydown', (e) => {
            if (!this.active) return;
            this.keys[e.key] = true;
            if (e.key === 'Escape') this.close();
          });
          
          document.addEventListener('keyup', (e) => {
            this.keys[e.key] = false;
          });
          
          // Close button
          const closeBtn = document.getElementById('landing-close');
          if (closeBtn) closeBtn.onclick = () => this.close();
          
          // Touch controls
          this.initTouchControls();
          
          // Generate starfield
          this.generateStars();
        },
        
        initTouchControls() {
          const leftBtn = document.getElementById('land-touch-left');
          const rightBtn = document.getElementById('land-touch-right');
          const thrustBtn = document.getElementById('land-touch-thrust');
          
          if (leftBtn) {
            leftBtn.ontouchstart = (e) => { e.preventDefault(); this.keys['ArrowLeft'] = true; };
            leftBtn.ontouchend = () => { this.keys['ArrowLeft'] = false; };
          }
          if (rightBtn) {
            rightBtn.ontouchstart = (e) => { e.preventDefault(); this.keys['ArrowRight'] = true; };
            rightBtn.ontouchend = () => { this.keys['ArrowRight'] = false; };
          }
          if (thrustBtn) {
            thrustBtn.ontouchstart = (e) => { e.preventDefault(); this.keys['ArrowUp'] = true; };
            thrustBtn.ontouchend = () => { this.keys['ArrowUp'] = false; };
          }
        },
        
        resizeCanvas() {
          if (!this.canvas) return;
          const container = this.canvas.parentElement;
          this.canvas.width = container.clientWidth;
          this.canvas.height = 400;
        },
        
        generateStars() {
          this.stars = [];
          for (let i = 0; i < 80; i++) {
            this.stars.push({
              x: Math.random() * 900,
              y: Math.random() * 400,
              size: Math.random() * 1.5 + 0.5,
              alpha: Math.random() * 0.6 + 0.2,
              twinkle: Math.random() * 0.02
            });
          }
        },
        
        generateTerrain() {
          this.terrain = [];
          const w = this.canvas.width;
          const h = this.canvas.height;
          const segments = 60;
          
          // Generate mountainous terrain with flat landing zones
          let y = h * 0.6;
          for (let i = 0; i <= segments; i++) {
            const x = (i / segments) * w;
            
            // Add some randomness but keep landing zones flat
            const isLandingZone = (i > 15 && i < 20) || (i > 35 && i < 42) || (i > 50 && i < 55);
            
            if (isLandingZone) {
              y = y; // Keep flat
            } else {
              y += (Math.random() - 0.5) * 40;
              y = Math.max(h * 0.4, Math.min(h * 0.85, y));
            }
            
            this.terrain.push({ x, y, isLanding: isLandingZone });
          }
        },
        
        start() {
          if (!this.canvas) this.init();
          
          // Reset ship
          this.ship = {
            x: 80,
            y: 40,
            vx: 0.5,
            vy: 0,
            fuel: 100,
            landed: false,
            crashed: false
          };
          
          this.generateTerrain();
          this.updateUI();
          
          // Show overlay
          const overlay = document.getElementById('landing-game-overlay');
          if (overlay) overlay.classList.add('active');
          
          const msgEl = document.getElementById('landing-message');
          if (msgEl) {
            msgEl.textContent = 'Land gently on flat terrain zones!';
            msgEl.className = 'landing-message';
          }
          
          this.active = true;
          this.gameLoop();
          
          if (typeof logTerminal === 'function') {
            logTerminal('TERRAIN LANDER initialized. Good luck, pilot.');
          }
          if (window.MechSFX) {
            MechSFX.powerUp(0.2);
          }
        },
        
        close() {
          this.active = false;
          if (this.animationId) cancelAnimationFrame(this.animationId);
          
          const overlay = document.getElementById('landing-game-overlay');
          if (overlay) overlay.classList.remove('active');
        },
        
        updateUI() {
          const fuelEl = document.getElementById('landing-fuel');
          const velEl = document.getElementById('landing-velocity');
          const altEl = document.getElementById('landing-alt');
          
          if (fuelEl && this.ship) fuelEl.textContent = Math.round(this.ship.fuel || 0);
          if (velEl && this.ship) velEl.textContent = Math.abs(this.ship.vy || 0).toFixed(1);
          if (altEl && this.ship && this.canvas && this.terrain && this.terrain.length > 0) {
            const groundY = this.getTerrainY(this.ship.x);
            const alt = Math.max(0, Math.round((groundY || 0) - (this.ship.y || 0) - 10));
            altEl.textContent = isNaN(alt) ? '0' : alt;
          } else if (altEl) {
            altEl.textContent = '0';
          }
        },
        
        getTerrainY(x) {
          if (!this.terrain || this.terrain.length < 2 || !this.canvas) return 100;
          
          const w = this.canvas.width || 400;
          if (w === 0) return 100;
          const idx = ((x || 0) / w) * (this.terrain.length - 1);
          const i = Math.floor(idx);
          const t = idx - i;
          
          const p1 = this.terrain[Math.max(0, Math.min(i, this.terrain.length - 1))];
          const p2 = this.terrain[Math.max(0, Math.min(i + 1, this.terrain.length - 1))];
          
          return p1.y + (p2.y - p1.y) * t;
        },
        
        isLandingZone(x) {
          const w = this.canvas.width;
          const idx = Math.floor((x / w) * (this.terrain.length - 1));
          const point = this.terrain[Math.max(0, Math.min(idx, this.terrain.length - 1))];
          return point?.isLanding || false;
        },
        
        gameLoop() {
          if (!this.active) return;
          
          this.update();
          this.render();
          this.updateUI();
          
          this.animationId = requestAnimationFrame(() => this.gameLoop());
        },
        
        update() {
          if (this.ship.landed || this.ship.crashed) return;
          
          const ship = this.ship;
          
          // Apply gravity
          ship.vy += this.gravity;
          
          // Controls
          if (this.keys['ArrowUp'] && ship.fuel > 0) {
            ship.vy -= this.thrust;
            ship.fuel -= 0.3;
          }
          if (this.keys['ArrowLeft']) ship.vx -= 0.03;
          if (this.keys['ArrowRight']) ship.vx += 0.03;
          
          // Apply velocity
          ship.x += ship.vx;
          ship.y += ship.vy;
          
          // Bounds
          ship.x = Math.max(10, Math.min(this.canvas.width - 10, ship.x));
          if (ship.y < 5) {
            ship.y = 5;
            ship.vy = 0;
          }
          
          // Terrain collision
          const groundY = this.getTerrainY(ship.x);
          if (ship.y + 12 >= groundY) {
            const speed = Math.abs(ship.vy);
            const isFlat = this.isLandingZone(ship.x);
            
            if (speed < this.maxLandingSpeed && isFlat) {
              // Successful landing!
              ship.landed = true;
              ship.y = groundY - 12;
              this.onLand(true);
            } else {
              // Crash!
              ship.crashed = true;
              this.onLand(false);
            }
          }
        },
        
        onLand(success) {
          const msgEl = document.getElementById('landing-message');
          
          if (success) {
            if (msgEl) {
              msgEl.textContent = '✓ SOFT LANDING — DATA SECURED';
              msgEl.className = 'landing-message success';
            }
            if (typeof showToast === 'function') {
              showToast('Perfect landing! The terrain is yours.', 'alert');
            }
            if (typeof completeMission === 'function') {
              completeMission('terrain_lander');
            }
            if (window.MechSFX) {
              MechSFX.success();
            }
          } else {
            if (msgEl) {
              msgEl.textContent = '✗ CRASH — VOLATILITY TOO HIGH';
              msgEl.className = 'landing-message failure';
            }
            if (window.MechSFX) {
              MechSFX.impact(0.35);
            }
          }
          
          if (typeof logTerminal === 'function') {
            logTerminal(success ? 'Terrain Lander: successful touchdown!' : 'Terrain Lander: impact detected');
          }
          
          // Restart after delay
          setTimeout(() => {
            if (this.active) this.start();
          }, 2500);
        },
        
        render() {
          const ctx = this.ctx;
          const w = this.canvas.width;
          const h = this.canvas.height;
          
          ctx.clearRect(0, 0, w, h);
          
          // Draw stars with twinkle
          this.stars.forEach(star => {
            star.alpha += star.twinkle;
            if (star.alpha > 0.8 || star.alpha < 0.2) star.twinkle *= -1;
            ctx.fillStyle = `rgba(51, 255, 153, ${star.alpha})`;
            ctx.fillRect(star.x % w, star.y, star.size, star.size);
          });
          
          // Draw terrain
          ctx.beginPath();
          ctx.moveTo(0, h);
          this.terrain.forEach((p, i) => {
            if (i === 0) ctx.lineTo(p.x, p.y);
            else ctx.lineTo(p.x, p.y);
          });
          ctx.lineTo(w, h);
          ctx.closePath();
          
          // Terrain gradient
          const terrainGrad = ctx.createLinearGradient(0, h * 0.5, 0, h);
          terrainGrad.addColorStop(0, 'rgba(51, 255, 153, 0.3)');
          terrainGrad.addColorStop(1, 'rgba(51, 255, 153, 0.1)');
          ctx.fillStyle = terrainGrad;
          ctx.fill();
          
          // Terrain line
          ctx.beginPath();
          this.terrain.forEach((p, i) => {
            if (i === 0) ctx.moveTo(p.x, p.y);
            else ctx.lineTo(p.x, p.y);
          });
          ctx.strokeStyle = '#33ff99';
          ctx.lineWidth = 2;
          ctx.shadowColor = '#33ff99';
          ctx.shadowBlur = 8;
          ctx.stroke();
          ctx.shadowBlur = 0;
          
          // Highlight landing zones
          this.terrain.forEach((p, i) => {
            if (p.isLanding && i > 0) {
              ctx.beginPath();
              ctx.moveTo(this.terrain[i-1].x, this.terrain[i-1].y);
              ctx.lineTo(p.x, p.y);
              ctx.strokeStyle = '#ffb347';
              ctx.lineWidth = 3;
              ctx.stroke();
            }
          });
          
          // Draw ship
          const ship = this.ship;
          ctx.save();
          ctx.translate(ship.x, ship.y);
          
          if (ship.crashed) {
            // Explosion particles
            const crashColor = tickerColors[SpriteCache.selectedPlayerShip] || '#ff6b6b';
            ctx.fillStyle = crashColor;
            for (let i = 0; i < 12; i++) {
              const angle = (i / 12) * Math.PI * 2;
              const dist = 10 + Math.random() * 20;
              ctx.fillRect(
                Math.cos(angle) * dist - 2,
                Math.sin(angle) * dist - 2,
                4, 4
              );
            }
          } else {
            // Draw selected player ship using sprite
            const landerTicker = SpriteCache.selectedPlayerShip || 'LUNR';
            const landerColor = tickerColors[landerTicker] || '#33ff99';
            SpriteCache.drawOnCanvas(ctx, landerTicker, 0, 0, 0.8, { 
              glow: true, 
              glowBlur: 12, 
              glowColor: landerColor,
              width: 50,
              height: 38
            });
            
            // Thrust flame
            if (this.keys['ArrowUp'] && ship.fuel > 0) {
              ctx.fillStyle = '#ffb347';
              ctx.shadowColor = '#ffb347';
              ctx.shadowBlur = 10;
              ctx.fillRect(-5, 18, 10, 6 + Math.random() * 8);
              ctx.fillStyle = '#ff6b6b';
              ctx.fillRect(-3, 24, 6, 4 + Math.random() * 6);
              ctx.shadowBlur = 0;
            }
          }
          
          ctx.restore();
          
          // HUD overlay
          ctx.fillStyle = 'rgba(51, 255, 153, 0.6)';
          ctx.font = '10px "IBM Plex Mono", monospace';
          ctx.fillText('LANDING ZONES', 10, 20);
          ctx.fillStyle = '#ffb347';
          ctx.fillRect(100, 14, 30, 3);
        }
      };
      
      window.LandingGame = LandingGame;

      // =========================================================================
      // ENHANCED EVENTS TIMELINE RENDERING
      // =========================================================================
      function initEnhancedCatalysts() {
        const originalRenderCatalysts = window.renderCatalysts;
        
        window.renderCatalysts = function() {
          const container = document.getElementById('catalyst-list');
          if (!container) return;

          // Gather all catalysts from ticker profiles
          const allCatalysts = [];
          const TICKER_PROFILES = window.TICKER_PROFILES || {};
          
          Object.entries(TICKER_PROFILES).forEach(([ticker, profile]) => {
            if (profile.catalysts) {
              profile.catalysts.forEach(cat => {
                allCatalysts.push({
                  ticker,
                  date: cat.date,
                  event: cat.event,
                  impact: cat.impact || 'medium'
                });
              });
            }
          });

          // Sort by date
          allCatalysts.sort((a, b) => new Date(a.date) - new Date(b.date));

          // Render as timeline
          if (allCatalysts.length > 0) {
            container.innerHTML = '<div class="events-timeline">' + 
              allCatalysts.slice(0, 12).map(cat => {
                const impactClass = cat.impact.toLowerCase() + '-impact';
                const daysUntil = Math.ceil((new Date(cat.date) - new Date()) / (1000 * 60 * 60 * 24));
                const countdownText = daysUntil > 0 ? `T-${daysUntil} DAYS` : daysUntil === 0 ? 'TODAY' : `T+${Math.abs(daysUntil)} DAYS`;
                
                return `
                  <div class="timeline-event ${impactClass}" onclick="if(window.openTickerDossier) openTickerDossier('${cat.ticker}')">
                    <div class="timeline-header">
                      <span class="timeline-ticker">${cat.ticker}</span>
                      <span class="timeline-date">${cat.date}</span>
                    </div>
                    <div class="timeline-title">${cat.event}</div>
                    <div class="timeline-meta">
                      <span class="timeline-countdown">${countdownText}</span>
                      <span class="catalyst-impact ${cat.impact.toLowerCase()}">${cat.impact.toUpperCase()}</span>
                    </div>
                  </div>
                `;
              }).join('') + 
            '</div>';
          } else if (typeof originalRenderCatalysts === 'function') {
            originalRenderCatalysts();
          }
        };
      }

      // =========================================================================
      // BUTTON RIPPLE EFFECT
      // =========================================================================
      function initRippleEffects() {
        document.addEventListener('click', (e) => {
          const button = e.target.closest('.push-btn, .sim-btn, .nav-tab, .chart-tab, .cargo-item');
          if (!button) return;

          const rect = button.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          const ripple = document.createElement('span');
          ripple.className = 'ripple';
          ripple.style.left = x + 'px';
          ripple.style.top = y + 'px';

          button.style.position = 'relative';
          button.style.overflow = 'hidden';
          button.appendChild(ripple);

          setTimeout(() => ripple.remove(), 600);
        });
      }

      // Run initializations immediately
      initInvaderArmy();
      initColorProfileControl();
      initAmbientParticles();
      initKonamiCode();
      initRippleEffects();
      
      // Expose SignalInvaders to window for console access
      window.SignalInvaders = SignalInvaders;
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initArcade);
        document.addEventListener('DOMContentLoaded', initTubeOverload);
        document.addEventListener('DOMContentLoaded', initEncountersBoard);
        document.addEventListener('DOMContentLoaded', initCargoBay);
        document.addEventListener('DOMContentLoaded', initTrajectoryCanvas);
        document.addEventListener('DOMContentLoaded', initLoreEngine);
        document.addEventListener('DOMContentLoaded', initEnhancedCatalysts);
        document.addEventListener('DOMContentLoaded', () => SignalInvaders.init());
        document.addEventListener('DOMContentLoaded', () => AdminConsole.init());
        document.addEventListener('DOMContentLoaded', () => LandingGame.init());
      } else {
        initArcade();
        initTubeOverload();
        initEncountersBoard();
        initCargoBay();
        initTrajectoryCanvas();
        initLoreEngine();
        initEnhancedCatalysts();
        SignalInvaders.init();
        AdminConsole.init();
        LandingGame.init();
      }
    })();
  </script>
</body>
</html>
