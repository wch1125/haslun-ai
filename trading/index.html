<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trading Dashboard ‚Äì Haslun</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <style>
    :root {
      --bg: #131722; --bg-panel: #1E222D; --bg-input: #2A2E39; --border: #363A45;
      --text: #D1D4DC; --text-muted: #787B86; --text-dim: #5D606B;
      --green: #26A69A; --green-dim: rgba(38,166,154,0.2);
      --red: #EF5350; --red-dim: rgba(239,83,80,0.2);
      --blue: #2962FF; --orange: #FF9800; --purple: #9C27B0; --terracotta: #C4846C;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow: hidden; }
    body.loaded { overflow: auto; }
    
    /* UFO Loading Screen */
    .loading-screen {
      position: fixed; inset: 0; z-index: 9999;
      background: linear-gradient(180deg, #05050a 0%, #0a0e17 30%, #131722 60%, #1a1a2e 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.6s, visibility 0.6s;
    }
    .loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    
    .stars { position: absolute; inset: 0; overflow: hidden; }
    .star {
      position: absolute; background: #fff; border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    .star.large { width: 3px; height: 3px; box-shadow: 0 0 6px 1px rgba(255,255,255,0.5); }
    @keyframes twinkle { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
    
    /* Shooting star */
    .shooting-star {
      position: absolute; width: 100px; height: 2px;
      background: linear-gradient(90deg, rgba(255,255,255,0.8), transparent);
      animation: shoot 4s linear infinite;
      opacity: 0;
    }
    @keyframes shoot {
      0% { transform: translateX(0) translateY(0); opacity: 0; }
      5% { opacity: 1; }
      20% { transform: translateX(300px) translateY(150px); opacity: 0; }
      100% { opacity: 0; }
    }
    
    .ufo-scene { position: relative; width: 320px; height: 300px; }
    
    .ufo {
      position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
      animation: ufoHover 3s ease-in-out infinite;
      filter: drop-shadow(0 20px 40px rgba(72,187,120,0.3));
    }
    @keyframes ufoHover { 
      0%, 100% { transform: translateX(-50%) translateY(0) rotate(-1deg); } 
      50% { transform: translateX(-50%) translateY(-12px) rotate(1deg); } 
    }
    
    /* UFO Top Dome - Glass cockpit */
    .ufo-dome {
      position: absolute; top: 0; left: 50%; transform: translateX(-50%);
      width: 60px; height: 35px;
      background: linear-gradient(180deg, 
        rgba(120,200,255,0.9) 0%, 
        rgba(80,160,220,0.7) 40%,
        rgba(60,140,200,0.5) 100%);
      border-radius: 50% 50% 45% 45%;
      border: 2px solid rgba(150,220,255,0.8);
      box-shadow: 
        inset 0 -10px 20px rgba(0,50,100,0.3),
        inset 0 5px 15px rgba(255,255,255,0.4),
        0 0 20px rgba(100,180,255,0.5);
    }
    .ufo-dome::before {
      content: ''; position: absolute; top: 8px; left: 12px;
      width: 15px; height: 8px; background: rgba(255,255,255,0.5);
      border-radius: 50%; transform: rotate(-20deg);
    }
    /* Alien silhouette */
    .ufo-alien {
      position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
      width: 20px; height: 16px;
      background: rgba(0,40,60,0.6);
      border-radius: 50% 50% 40% 40%;
    }
    .ufo-alien::before, .ufo-alien::after {
      content: ''; position: absolute; top: 5px;
      width: 5px; height: 3px; background: rgba(100,255,150,0.8);
      border-radius: 50%; box-shadow: 0 0 5px rgba(100,255,150,0.8);
    }
    .ufo-alien::before { left: 3px; }
    .ufo-alien::after { right: 3px; }
    
    /* UFO Main Body - Saucer */
    .ufo-body {
      position: relative; top: 30px;
      width: 160px; height: 45px;
      background: linear-gradient(180deg, 
        #7a8599 0%, #5a6577 20%, #4a5568 50%, #3d4556 80%, #2d3545 100%);
      border-radius: 50%;
      box-shadow: 
        inset 0 -8px 15px rgba(0,0,0,0.4),
        inset 0 8px 15px rgba(255,255,255,0.1),
        0 8px 30px rgba(0,0,0,0.5);
    }
    /* Metallic ring detail */
    .ufo-ring {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 140px; height: 35px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.15);
      box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
    }
    
    /* UFO Bottom section */
    .ufo-bottom {
      position: absolute; top: 35px; left: 50%; transform: translateX(-50%);
      width: 80px; height: 25px;
      background: linear-gradient(180deg, #3d4556 0%, #2a303d 100%);
      border-radius: 0 0 50% 50% / 0 0 100% 100%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    }
    
    /* Rotating lights ring */
    .ufo-lights-ring {
      position: absolute; top: 18px; left: 50%; transform: translateX(-50%);
      width: 130px; height: 130px;
      animation: rotateLights 4s linear infinite;
    }
    @keyframes rotateLights { from { transform: translateX(-50%) rotate(0deg); } to { transform: translateX(-50%) rotate(360deg); } }
    
    .ufo-light {
      position: absolute; width: 10px; height: 10px; border-radius: 50%;
      box-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
      animation: lightPulse 0.8s ease-in-out infinite;
    }
    .ufo-light:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); background: #ff6b6b; color: #ff6b6b; }
    .ufo-light:nth-child(2) { top: 15%; right: 10%; background: #ffd93d; color: #ffd93d; animation-delay: 0.1s; }
    .ufo-light:nth-child(3) { top: 50%; right: 0; transform: translateY(-50%); background: #6bcb77; color: #6bcb77; animation-delay: 0.2s; }
    .ufo-light:nth-child(4) { bottom: 15%; right: 10%; background: #4d96ff; color: #4d96ff; animation-delay: 0.3s; }
    .ufo-light:nth-child(5) { bottom: 0; left: 50%; transform: translateX(-50%); background: #9b59b6; color: #9b59b6; animation-delay: 0.4s; }
    .ufo-light:nth-child(6) { bottom: 15%; left: 10%; background: #ff6b6b; color: #ff6b6b; animation-delay: 0.5s; }
    .ufo-light:nth-child(7) { top: 50%; left: 0; transform: translateY(-50%); background: #ffd93d; color: #ffd93d; animation-delay: 0.6s; }
    .ufo-light:nth-child(8) { top: 15%; left: 10%; background: #6bcb77; color: #6bcb77; animation-delay: 0.7s; }
    @keyframes lightPulse { 0%, 100% { opacity: 0.5; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.1); } }
    
    /* Center beam emitter */
    .beam-emitter {
      position: absolute; top: 55px; left: 50%; transform: translateX(-50%);
      width: 30px; height: 12px;
      background: linear-gradient(180deg, #2a303d 0%, #1a1f2a 100%);
      border-radius: 0 0 50% 50%;
      box-shadow: 0 0 20px rgba(72,187,120,0.8), inset 0 -3px 8px rgba(72,187,120,0.5);
    }
    .beam-emitter::after {
      content: ''; position: absolute; top: 4px; left: 50%; transform: translateX(-50%);
      width: 14px; height: 6px; background: rgba(72,187,120,0.9);
      border-radius: 50%; box-shadow: 0 0 15px rgba(72,187,120,1);
      animation: emitterGlow 1s ease-in-out infinite;
    }
    @keyframes emitterGlow { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
    
    /* Tractor Beam */
    .beam {
      position: absolute; top: 65px; left: 50%; transform: translateX(-50%);
      width: 30px; height: 200px;
      background: linear-gradient(180deg, 
        rgba(72,187,120,0.8) 0%, 
        rgba(72,187,120,0.4) 30%,
        rgba(72,187,120,0.2) 60%,
        rgba(72,187,120,0.05) 100%);
      clip-path: polygon(10% 0%, 90% 0%, 100% 100%, 0% 100%);
      animation: beamPulse 2s ease-in-out infinite;
    }
    .beam::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(180deg, 
        rgba(150,255,180,0.3) 0%, 
        transparent 50%);
      clip-path: polygon(10% 0%, 90% 0%, 100% 100%, 0% 100%);
    }
    @keyframes beamPulse { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; } }
    
    .beam-particles {
      position: absolute; inset: 0;
      background: repeating-linear-gradient(0deg, 
        transparent 0px, transparent 8px, 
        rgba(255,255,255,0.15) 8px, rgba(255,255,255,0.15) 10px);
      animation: particlesUp 0.8s linear infinite;
      clip-path: polygon(10% 0%, 90% 0%, 100% 100%, 0% 100%);
    }
    @keyframes particlesUp { from { transform: translateY(0); } to { transform: translateY(-18px); } }
    
    /* Ground glow */
    .ground-glow {
      position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
      width: 120px; height: 40px;
      background: radial-gradient(ellipse, rgba(72,187,120,0.4) 0%, transparent 70%);
      animation: groundPulse 2s ease-in-out infinite;
    }
    @keyframes groundPulse { 0%, 100% { opacity: 0.5; transform: translateX(-50%) scale(1); } 50% { opacity: 0.8; transform: translateX(-50%) scale(1.1); } }
    
    .abductee {
      position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%);
      font-size: 2.8rem; 
      animation: float 2.5s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(72,187,120,0.5));
    }
    @keyframes float { 
      0%, 100% { transform: translateX(-50%) translateY(0) rotate(-5deg); } 
      50% { transform: translateX(-50%) translateY(-25px) rotate(5deg); } 
    }
    .abductee.abducting { animation: abduct 1.8s ease-in forwards; }
    @keyframes abduct { 
      0% { transform: translateX(-50%) translateY(0) scale(1) rotate(0deg); opacity: 1; filter: drop-shadow(0 0 10px rgba(72,187,120,0.5)); }
      50% { transform: translateX(-50%) translateY(-100px) scale(0.7) rotate(180deg); opacity: 0.8; filter: drop-shadow(0 0 20px rgba(72,187,120,0.8)); }
      100% { transform: translateX(-50%) translateY(-190px) scale(0.2) rotate(360deg); opacity: 0; filter: drop-shadow(0 0 30px rgba(72,187,120,1)); }
    }
    
    .loading-text {
      margin-top: 2rem; text-align: center;
    }
    .loading-brand { font-size: 1.5rem; font-weight: 600; color: var(--text); margin-bottom: 0.5rem; }
    .loading-status { font-size: 0.9rem; color: var(--text-muted); }
    .loading-status span { color: var(--green); font-family: 'JetBrains Mono', monospace; }
    
    .countdown-display {
      font-family: 'JetBrains Mono', monospace; font-size: 3rem; font-weight: 600;
      color: var(--green); margin-top: 1rem;
      text-shadow: 0 0 20px rgba(38,166,154,0.5);
    }
    .countdown-display.go { color: var(--orange); animation: pulse 0.3s; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
    .header { display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; height: 48px; background: var(--bg-panel); border-bottom: 1px solid var(--border); }
    .header-left { display: flex; align-items: center; gap: 1.5rem; }
    .logo { font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
    .logo-icon { width: 24px; height: 24px; background: var(--green); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; }
    .nav-tabs { display: flex; gap: 0.25rem; }
    .nav-tab { padding: 0.5rem 1rem; background: transparent; border: none; border-radius: 4px; color: var(--text-muted); font-size: 0.8rem; font-weight: 500; cursor: pointer; }
    .nav-tab:hover, .nav-tab.active { color: var(--text); background: var(--bg-input); }
    .header-right { display: flex; align-items: center; gap: 1rem; }
    .demo-badge { padding: 0.25rem 0.5rem; background: var(--orange); border-radius: 4px; font-size: 0.65rem; font-weight: 600; color: #000; }
    .status-badge { display: flex; align-items: center; gap: 0.4rem; padding: 0.3rem 0.6rem; background: var(--bg-input); border-radius: 4px; font-size: 0.7rem; color: var(--text-muted); }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--orange); }
    .time-display { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); }
    
    .main { display: flex; height: calc(100vh - 48px); }
    .sidebar { width: 260px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
    .sidebar-section { padding: 1rem; border-bottom: 1px solid var(--border); }
    .sidebar-title { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.75rem; }
    .stats-mini { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
    .stat-mini { padding: 0.5rem; background: var(--bg-input); border-radius: 6px; }
    .stat-mini-label { font-size: 0.55rem; color: var(--text-muted); margin-bottom: 0.2rem; text-transform: uppercase; }
    .stat-mini-value { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: 600; }
    .stat-mini-value.positive { color: var(--green); }
    .stat-mini-value.negative { color: var(--red); }
    .macd-row { display: flex; justify-content: space-between; padding: 0.3rem 0; }
    .macd-label { font-size: 0.75rem; color: var(--text-muted); }
    .macd-value { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; }
    .macd-value.positive { color: var(--green); }
    .macd-value.negative { color: var(--red); }
    
    .watchlist { flex: 1; overflow-y: auto; }
    .watchlist-item { display: flex; justify-content: space-between; padding: 0.5rem 1rem; cursor: pointer; border-bottom: 1px solid var(--border); }
    .watchlist-item:hover { background: var(--bg-input); }
    .watchlist-item.active { background: var(--bg-input); border-left: 2px solid var(--blue); }
    .watchlist-ticker { font-family: 'JetBrains Mono', monospace; font-weight: 600; font-size: 0.8rem; }
    .watchlist-meta { font-size: 0.6rem; color: var(--text-muted); }
    .watchlist-price { text-align: right; }
    .watchlist-current { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; }
    .watchlist-change { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; }
    .watchlist-change.positive { color: var(--green); }
    .watchlist-change.negative { color: var(--red); }
    
    .content { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    .tab-panel { display: none; flex: 1; flex-direction: column; overflow: hidden; }
    .tab-panel.active { display: flex; }
    
    .chart-header { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 1rem; background: var(--bg-panel); border-bottom: 1px solid var(--border); }
    .chart-header-left { display: flex; align-items: center; gap: 1rem; }
    .ticker-display { display: flex; align-items: baseline; gap: 0.5rem; }
    .ticker-symbol { font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 600; }
    .ticker-price { font-family: 'JetBrains Mono', monospace; font-size: 1rem; }
    .ticker-change { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; }
    .ticker-change.positive { color: var(--green); }
    .ticker-change.negative { color: var(--red); }
    .btn-group { display: flex; gap: 0.2rem; }
    .btn-sm { padding: 0.3rem 0.5rem; background: transparent; border: none; border-radius: 4px; color: var(--text-muted); font-size: 0.7rem; cursor: pointer; }
    .btn-sm:hover, .btn-sm.active { color: var(--text); background: var(--bg-input); }
    
    .chart-container { flex: 1; display: flex; flex-direction: column; padding: 0.5rem; min-height: 0; }
    .price-chart-wrapper { flex: 3; position: relative; min-height: 250px; }
    .macd-chart-wrapper { flex: 1; position: relative; min-height: 100px; border-top: 1px solid var(--border); margin-top: 0.5rem; padding-top: 0.5rem; }
    
    .positions-content { flex: 1; overflow-y: auto; padding: 1rem; }
    .positions-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
    .stat-card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; }
    .stat-card-value { font-family: 'JetBrains Mono', monospace; font-size: 1.4rem; font-weight: 600; }
    .stat-card-value.positive { color: var(--green); }
    .stat-card-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; margin-top: 0.25rem; }
    
    .card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 1rem; }
    .card-header { padding: 0.75rem 1rem; border-bottom: 1px solid var(--border); }
    .card-label { font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); }
    .card-title { font-size: 0.9rem; font-weight: 500; }
    .card-body { padding: 1rem; }
    
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 0.5rem; font-size: 0.6rem; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); }
    .data-table td { padding: 0.5rem; font-size: 0.8rem; border-bottom: 1px solid var(--border); }
    .data-table tr:hover { background: var(--bg-input); }
    .ticker-badge { display: inline-block; padding: 0.15rem 0.4rem; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; font-weight: 600; color: #fff; }
    .structure-badge { padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.6rem; background: var(--bg-input); color: var(--text-muted); }
    .pnl-positive { color: var(--green); font-family: 'JetBrains Mono', monospace; }
    .pnl-negative { color: var(--red); font-family: 'JetBrains Mono', monospace; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .chart-tabs { display: flex; gap: 0.25rem; margin-bottom: 1rem; }
    .chart-tab { padding: 0.4rem 0.75rem; background: transparent; border: none; border-radius: 4px; color: var(--text-muted); font-size: 0.75rem; cursor: pointer; }
    .chart-tab:hover, .chart-tab.active { color: var(--text); background: var(--bg-input); }
    .chart-panel { display: none; }
    .chart-panel.active { display: block; }
    
    .bar-row { display: grid; grid-template-columns: 50px 1fr 65px; align-items: center; gap: 0.5rem; margin-bottom: 0.4rem; }
    .bar-ticker { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; }
    .bar-container { height: 22px; background: var(--bg-input); border-radius: 4px; overflow: hidden; }
    .bar-fill { height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 0.5rem; font-size: 0.6rem; color: #fff; }
    .bar-value { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-align: right; }
    
    .catalyst-item { display: flex; align-items: center; gap: 1rem; padding: 0.6rem 0; border-bottom: 1px solid var(--border); }
    .catalyst-date { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: var(--text-muted); min-width: 75px; }
    .catalyst-ticker { font-family: 'JetBrains Mono', monospace; font-weight: 600; font-size: 0.75rem; min-width: 45px; }
    .catalyst-event { flex: 1; font-size: 0.75rem; }
    .catalyst-impact { padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.6rem; font-weight: 600; text-transform: uppercase; }
    .catalyst-impact.high { background: var(--red-dim); color: var(--red); }
    .catalyst-impact.medium { background: rgba(255,152,0,0.2); color: var(--orange); }
    
    /* Interactive Controls */
    .controls-section { background: var(--bg-input); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .controls-title { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .controls-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
    .control-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; }
    .control-value { font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 600; }
    .control-value.positive { color: var(--green); }
    .control-value.negative { color: var(--red); }
    input[type="range"] { width: 100%; height: 6px; -webkit-appearance: none; background: var(--border); border-radius: 3px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: var(--blue); border-radius: 50%; cursor: pointer; }
    .slider-labels { display: flex; justify-content: space-between; font-size: 0.6rem; color: var(--text-dim); margin-top: 0.25rem; }
    
    /* Scenario Cards */
    .scenario-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-top: 1rem; }
    .scenario-card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem; text-align: center; cursor: pointer; transition: all 0.15s; }
    .scenario-card:hover { border-color: var(--blue); }
    .scenario-card.active { border-color: var(--blue); background: rgba(41,98,255,0.1); }
    .scenario-label { font-size: 0.6rem; color: var(--text-muted); margin-bottom: 0.25rem; }
    .scenario-value { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: 600; }
    
    /* P&L Projection */
    .projection-chart { height: 200px; margin-top: 1rem; }
    
    .summary-row { display: flex; justify-content: space-around; padding: 0.75rem; background: var(--bg-input); border-radius: 6px; margin-top: 1rem; }
    .summary-item { text-align: center; }
    .summary-value { font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 600; }
    .summary-value.positive { color: var(--green); }
    .summary-value.negative { color: var(--red); }
    .summary-label { font-size: 0.55rem; color: var(--text-muted); text-transform: uppercase; }
    
    .right-sidebar { width: 220px; background: var(--bg-panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
    .kill-switch-btn { width: 100%; padding: 0.75rem; border: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; cursor: pointer; background: var(--red); color: #fff; }
    .kill-switch-btn.resume { background: var(--green); }
    .kill-switch-status { text-align: center; font-size: 0.65rem; color: var(--text-muted); margin-top: 0.5rem; }
    .safety-item { display: flex; justify-content: space-between; padding: 0.4rem 0; font-size: 0.7rem; }
    .safety-label { color: var(--text-muted); }
    .safety-value { font-family: 'JetBrains Mono', monospace; }
    .safety-value.ok { color: var(--green); }
    .safety-value.warning { color: var(--orange); }
    .activity-feed { flex: 1; overflow-y: auto; }
    .activity-item { display: flex; gap: 0.5rem; padding: 0.5rem; }
    .activity-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; }
    .activity-icon.trade { background: var(--green-dim); }
    .activity-icon.alert { background: rgba(255,152,0,0.2); }
    .activity-content { flex: 1; }
    .activity-title { font-size: 0.7rem; font-weight: 500; }
    .activity-subtitle { font-size: 0.6rem; color: var(--text-muted); }
    .activity-time { font-size: 0.55rem; color: var(--text-dim); }
    
    .demo-watermark { position: fixed; bottom: 1rem; left: 1rem; display: flex; gap: 0.5rem; padding: 0.4rem 0.6rem; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 6px; font-size: 0.7rem; color: var(--text-muted); }
    .demo-watermark a { color: var(--terracotta); text-decoration: none; }
    
    @media (max-width: 1200px) { .right-sidebar { display: none; } }
    @media (max-width: 900px) { .sidebar { width: 200px; } .positions-grid { grid-template-columns: 1fr 1fr; } .controls-grid { grid-template-columns: 1fr 1fr; } .scenario-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { .sidebar { display: none; } }
  </style>
</head>
<body>
  <!-- UFO Abduction Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="stars" id="stars"></div>
    <div class="shooting-star" style="top: 10%; left: 20%;"></div>
    <div class="shooting-star" style="top: 30%; left: 60%; animation-delay: 2s;"></div>
    <div class="ufo-scene">
      <div class="ufo">
        <!-- Glass Dome with Alien -->
        <div class="ufo-dome">
          <div class="ufo-alien"></div>
        </div>
        <!-- Main Saucer Body -->
        <div class="ufo-body">
          <div class="ufo-ring"></div>
        </div>
        <!-- Bottom Section -->
        <div class="ufo-bottom"></div>
        <!-- Rotating Lights Ring -->
        <div class="ufo-lights-ring">
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
          <div class="ufo-light"></div>
        </div>
        <!-- Beam Emitter -->
        <div class="beam-emitter"></div>
      </div>
      <div class="beam">
        <div class="beam-particles"></div>
      </div>
      <div class="ground-glow"></div>
      <div class="abductee" id="abductee">üêÑ</div>
    </div>
    <div class="loading-text">
      <div class="loading-brand">Haslun Trading</div>
      <div class="loading-status" id="loading-status">Initiating tractor beam...</div>
    </div>
    <div class="countdown-display" id="countdown">3</div>
  </div>
  <header class="header">
    <div class="header-left">
      <div class="logo"><div class="logo-icon">üìà</div>Haslun Trading</div>
      <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="chart" onclick="switchTab('chart')">Chart</button>
        <button class="nav-tab" data-tab="positions" onclick="switchTab('positions')">Positions</button>
        <button class="nav-tab" data-tab="options" onclick="switchTab('options')">Options</button>
        <button class="nav-tab" data-tab="catalysts" onclick="switchTab('catalysts')">Catalysts</button>
      </nav>
    </div>
    <div class="header-right">
      <span class="demo-badge">Demo</span>
      <div class="status-badge"><span class="status-dot"></span>Market Closed</div>
      <span class="time-display" id="time-display">--:--</span>
    </div>
  </header>
  
  <main class="main">
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Portfolio Summary</div>
        <div class="stats-mini">
          <div class="stat-mini"><div class="stat-mini-label">Today</div><div class="stat-mini-value positive">+$1,172</div></div>
          <div class="stat-mini"><div class="stat-mini-label">Total P&L</div><div class="stat-mini-value positive">+$34,015</div></div>
          <div class="stat-mini"><div class="stat-mini-label">Positions</div><div class="stat-mini-value">10</div></div>
          <div class="stat-mini"><div class="stat-mini-label">Win Rate</div><div class="stat-mini-value positive">90%</div></div>
        </div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">MACD Signal</div>
        <div class="macd-row"><span class="macd-label">MACD</span><span class="macd-value positive" id="macd-val">0.3642</span></div>
        <div class="macd-row"><span class="macd-label">Signal</span><span class="macd-value" id="signal-val">0.2570</span></div>
        <div class="macd-row"><span class="macd-label">Histogram</span><span class="macd-value positive" id="hist-val">0.1073</span></div>
      </div>
      <div class="sidebar-section" style="padding-bottom:0.5rem"><div class="sidebar-title">Watchlist</div></div>
      <div class="watchlist" id="watchlist"></div>
    </aside>
    
    <div class="content">
      <!-- Chart Tab -->
      <div class="tab-panel active" id="chart-panel">
        <div class="chart-header">
          <div class="chart-header-left">
            <div class="ticker-display">
              <span class="ticker-symbol" id="chart-ticker">RKLB</span>
              <span class="ticker-price" id="chart-price">$72.43</span>
              <span class="ticker-change positive" id="chart-change">+2.16%</span>
            </div>
            <div class="btn-group">
              <button class="btn-sm active" data-tf="1D" onclick="setTimeframe('1D')">1D</button>
              <button class="btn-sm" data-tf="45" onclick="setTimeframe('45')">45m</button>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn-sm active" id="ma-toggle" onclick="toggleMA()">MA</button>
            <span style="color:var(--border);margin:0 0.25rem">|</span>
            <button class="btn-sm" data-range="1W" onclick="setRange('1W')">1W</button>
            <button class="btn-sm" data-range="1M" onclick="setRange('1M')">1M</button>
            <button class="btn-sm active" data-range="3M" onclick="setRange('3M')">3M</button>
            <button class="btn-sm" data-range="6M" onclick="setRange('6M')">6M</button>
            <button class="btn-sm" data-range="1Y" onclick="setRange('1Y')">1Y</button>
            <button class="btn-sm" data-range="ALL" onclick="setRange('ALL')">All</button>
          </div>
        </div>
        <div class="chart-container">
          <div class="price-chart-wrapper"><canvas id="price-chart"></canvas></div>
          <div class="macd-chart-wrapper"><canvas id="macd-chart"></canvas></div>
        </div>
      </div>
      
      <!-- Positions Tab -->
      <div class="tab-panel" id="positions-panel">
        <div class="positions-content">
          <div class="positions-grid">
            <div class="stat-card"><div class="stat-card-value positive">+$1,172</div><div class="stat-card-label">Today's P&L</div></div>
            <div class="stat-card"><div class="stat-card-value">3</div><div class="stat-card-label">Trades Today</div></div>
            <div class="stat-card"><div class="stat-card-value">$17,536</div><div class="stat-card-label">Market Value</div></div>
            <div class="stat-card"><div class="stat-card-value">10</div><div class="stat-card-label">Open Positions</div></div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-label">Active</div><div class="card-title">Stock Positions</div></div>
            <div class="card-body" style="padding:0"><table class="data-table"><thead><tr><th>Ticker</th><th>Sector</th><th>Shares</th><th>Entry</th><th>Current</th><th>Value</th><th>P&L</th></tr></thead><tbody id="stock-tbody"></tbody></table></div>
          </div>
        </div>
      </div>
      
      <!-- Options Tab - Now Interactive! -->
      <div class="tab-panel" id="options-panel">
        <div class="positions-content">
          <div class="positions-grid">
            <div class="stat-card"><div class="stat-card-value" id="opt-portfolio-val">$39,315</div><div class="stat-card-label">Portfolio Value</div></div>
            <div class="stat-card"><div class="stat-card-value positive" id="opt-total-pnl">+$34,015</div><div class="stat-card-label">Total P&L</div></div>
            <div class="stat-card"><div class="stat-card-value" id="opt-total-delta">23.55</div><div class="stat-card-label">Total Delta</div></div>
            <div class="stat-card"><div class="stat-card-value">12</div><div class="stat-card-label">Days to Expiry</div></div>
          </div>
          
          <!-- Interactive Scenario Analyzer -->
          <div class="card">
            <div class="card-header"><div class="card-label">Interactive</div><div class="card-title">What-If Scenario Analyzer</div></div>
            <div class="card-body">
              <div class="controls-section">
                <div class="controls-title">üìä Adjust Market Conditions</div>
                <div class="controls-grid">
                  <div class="control-group">
                    <div class="control-label">Price Change</div>
                    <div class="control-value" id="price-change-val">0%</div>
                    <input type="range" id="price-slider" min="-50" max="100" value="0" oninput="updateScenario()">
                    <div class="slider-labels"><span>-50%</span><span>0%</span><span>+100%</span></div>
                  </div>
                  <div class="control-group">
                    <div class="control-label">Days Forward</div>
                    <div class="control-value" id="days-val">0 days</div>
                    <input type="range" id="days-slider" min="0" max="12" value="0" oninput="updateScenario()">
                    <div class="slider-labels"><span>Today</span><span>Expiry</span></div>
                  </div>
                  <div class="control-group">
                    <div class="control-label">IV Change</div>
                    <div class="control-value" id="iv-change-val">0%</div>
                    <input type="range" id="iv-slider" min="-50" max="100" value="0" oninput="updateScenario()">
                    <div class="slider-labels"><span>-50%</span><span>0%</span><span>+100%</span></div>
                  </div>
                </div>
                
                <div class="scenario-grid">
                  <div class="scenario-card" onclick="setScenario(-20, 0, 0)"><div class="scenario-label">Bear Case</div><div class="scenario-value" style="color:var(--red)">-20%</div></div>
                  <div class="scenario-card" onclick="setScenario(-10, 0, 0)"><div class="scenario-label">Pullback</div><div class="scenario-value" style="color:var(--red)">-10%</div></div>
                  <div class="scenario-card active" onclick="setScenario(0, 0, 0)"><div class="scenario-label">Current</div><div class="scenario-value">0%</div></div>
                  <div class="scenario-card" onclick="setScenario(20, 0, 0)"><div class="scenario-label">Rally</div><div class="scenario-value" style="color:var(--green)">+20%</div></div>
                  <div class="scenario-card" onclick="setScenario(50, 0, 0)"><div class="scenario-label">Moon</div><div class="scenario-value" style="color:var(--green)">+50%</div></div>
                </div>
              </div>
              
              <div class="summary-row" id="scenario-summary">
                <div class="summary-item"><div class="summary-value positive" id="proj-value">$39,315</div><div class="summary-label">Projected Value</div></div>
                <div class="summary-item"><div class="summary-value positive" id="proj-pnl">+$0</div><div class="summary-label">Scenario P&L</div></div>
                <div class="summary-item"><div class="summary-value" id="proj-delta">23.55</div><div class="summary-label">New Delta</div></div>
                <div class="summary-item"><div class="summary-value" id="proj-return">0%</div><div class="summary-label">Scenario Return</div></div>
              </div>
              
              <div class="projection-chart"><canvas id="projection-chart"></canvas></div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header"><div class="card-label">Analytics</div><div class="card-title">Position Breakdown</div></div>
            <div class="card-body">
              <div class="chart-tabs">
                <button class="chart-tab active" data-chart="sizes" onclick="switchChartTab('sizes')">Position Sizes</button>
                <button class="chart-tab" data-chart="pnl" onclick="switchChartTab('pnl')">P&L by Position</button>
                <button class="chart-tab" data-chart="greeks" onclick="switchChartTab('greeks')">Greeks Exposure</button>
              </div>
              <div class="chart-panel active" id="chart-sizes"></div>
              <div class="chart-panel" id="chart-pnl"></div>
              <div class="chart-panel" id="chart-greeks"></div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header"><div class="card-label">LEAPs & Spreads</div><div class="card-title">Options Positions</div></div>
            <div class="card-body" style="padding:0"><table class="data-table"><thead><tr><th>Ticker</th><th>Structure</th><th>Strikes</th><th>Entry</th><th>Current</th><th>P&L</th><th>Delta</th></tr></thead><tbody id="options-tbody"></tbody></table></div>
          </div>
        </div>
      </div>
      
      <!-- Catalysts Tab -->
      <div class="tab-panel" id="catalysts-panel">
        <div class="positions-content">
          <div class="card">
            <div class="card-header"><div class="card-label">Upcoming</div><div class="card-title">Market Catalysts</div></div>
            <div class="card-body" id="catalyst-list"></div>
          </div>
        </div>
      </div>
    </div>
    
    <aside class="right-sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Emergency Control</div>
        <button class="kill-switch-btn" onclick="toggleKillSwitch()">Stop All Trading</button>
        <div class="kill-switch-status">System active</div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Risk Management</div>
        <div class="safety-item"><span class="safety-label">Daily Loss Limit</span><span class="safety-value ok">$200 left</span></div>
        <div class="safety-item"><span class="safety-label">Trades Left</span><span class="safety-value">2 of 5</span></div>
        <div class="safety-item"><span class="safety-label">Market</span><span class="safety-value warning">Closed</span></div>
      </div>
      <div class="sidebar-section" style="padding-bottom:0.5rem"><div class="sidebar-title">Recent Activity</div></div>
      <div class="activity-feed" id="activity-feed"></div>
    </aside>
  </main>
  
  <div class="demo-watermark"><span>Demo Mode</span><a href="https://haslun.ai">‚Üê haslun.ai</a></div>

  <script>
    // ===== STATE =====
    let currentTicker = 'RKLB', currentTimeframe = '1D', currentRange = '3M', showMA = true;
    let priceChart = null, macdChart = null, projectionChart = null;
    
    // ===== EMBEDDED DATA (works offline) =====
    const TICKERS = {
      'RKLB': { price: 72.43, change: 2.16, theme: 'Space', color: '#C4846C' },
      'LUNR': { price: 17.13, change: 5.32, theme: 'Space', color: '#D4A08A' },
      'ASTS': { price: 83.47, change: 6.7, theme: 'Space', color: '#B8986B' },
      'ACHR': { price: 7.87, change: 4.64, theme: 'eVTOL', color: '#CEBA95' },
      'JOBY': { price: 13.85, change: 4.97, theme: 'eVTOL', color: '#8B9A7D' },
      'BKSY': { price: 4.20, change: 9.1, theme: 'Space', color: '#6B7B8A' },
      'RDW': { price: 15.00, change: 10.3, theme: 'Space', color: '#5C9A6B' },
      'PL': { price: 4.00, change: 7.5, theme: 'Space', color: '#8AB89A' },
      'EVEX': { price: 2.80, change: -9.7, theme: 'eVTOL', color: '#C45C5C' },
      'GME': { price: 27.50, change: 6.6, theme: 'Meme', color: '#5A7247' },
      'KTOS': { price: 77.48, change: 1.75, theme: 'Defense', color: '#6B8B7D' },
      'MP': { price: 53.15, change: 5.05, theme: 'Materials', color: '#9C7C6C' }
    };
    
    // Generate synthetic chart data
    function generateChartData(ticker, days = 90) {
      const base = TICKERS[ticker]?.price || 50;
      const volatility = base * 0.02;
      const data = [];
      const now = Date.now();
      let price = base * 0.6; // Start lower for uptrend
      
      for (let i = days; i >= 0; i--) {
        const trend = (days - i) / days * (base - price);
        price += trend * 0.03 + (Math.random() - 0.45) * volatility;
        price = Math.max(price, base * 0.3);
        
        const t = now - i * 86400000;
        const macd = (Math.random() - 0.4) * 0.5;
        const signal = macd * 0.8 + (Math.random() - 0.5) * 0.1;
        
        data.push({
          t, c: price, 
          macd: macd, signal: signal, hist: macd - signal,
          g100: price * (0.95 + Math.random() * 0.02),
          g150: price * (0.92 + Math.random() * 0.02),
          g200: price * (0.88 + Math.random() * 0.02)
        });
      }
      // Ensure last price matches
      data[data.length - 1].c = base;
      return data;
    }
    
    const STOCK_POSITIONS = [
      { ticker: 'RKLB', shares: 75, entry: 68.45 },
      { ticker: 'ASTS', shares: 50, entry: 78.20 },
      { ticker: 'LUNR', shares: 100, entry: 15.20 },
      { ticker: 'BKSY', shares: 200, entry: 3.85 },
      { ticker: 'RDW', shares: 80, entry: 13.60 },
      { ticker: 'PL', shares: 150, entry: 3.72 },
      { ticker: 'ACHR', shares: 100, entry: 7.85 },
      { ticker: 'JOBY', shares: 60, entry: 13.20 },
      { ticker: 'EVEX', shares: 250, entry: 3.10 },
      { ticker: 'GME', shares: 40, entry: 25.80 }
    ];
    
    const OPTIONS_POSITIONS = [
      { ticker: 'RKLB', structure: 'Naked LEAP', strikes: '$5', entry: 1.85, current: 68.50, delta: 0.95, contracts: 3 },
      { ticker: 'ASTS', structure: 'Bull Spread', strikes: '$5/$15', entry: 2.40, current: 9.85, delta: 0.48, contracts: 4 },
      { ticker: 'LUNR', structure: 'Naked LEAP', strikes: '$5', entry: 1.20, current: 13.50, delta: 0.92, contracts: 5 },
      { ticker: 'BKSY', structure: 'Bull Spread', strikes: '$2/$5', entry: 0.95, current: 2.80, delta: 0.55, contracts: 5 },
      { ticker: 'RDW', structure: 'Bull Spread', strikes: '$4/$8', entry: 1.40, current: 3.90, delta: 0.62, contracts: 3 },
      { ticker: 'PL', structure: 'Bull Spread', strikes: '$2/$4', entry: 0.55, current: 1.85, delta: 0.58, contracts: 5 },
      { ticker: 'ACHR', structure: 'Naked LEAP', strikes: '$5', entry: 1.65, current: 4.20, delta: 0.72, contracts: 3 },
      { ticker: 'JOBY', structure: 'Bull Spread', strikes: '$5/$10', entry: 1.80, current: 5.40, delta: 0.65, contracts: 3 },
      { ticker: 'EVEX', structure: 'Bull Spread', strikes: '$3/$6', entry: 0.85, current: 0.35, delta: 0.28, contracts: 4 },
      { ticker: 'GME', structure: 'Bull Spread', strikes: '$12/$20', entry: 3.20, current: 7.80, delta: 0.72, contracts: 2 }
    ];
    
    const CATALYSTS = [
      { date: 'Jan 16', ticker: 'ALL', event: 'January Options Expiration', impact: 'high' },
      { date: 'Jan 21', ticker: 'RKLB', event: 'Q4 Earnings Report', impact: 'high' },
      { date: 'Jan 28', ticker: 'ASTS', event: 'Q4 Earnings Report', impact: 'high' },
      { date: 'Feb 10', ticker: 'LUNR', event: 'Q4 Earnings Report', impact: 'medium' },
      { date: 'Feb 15', ticker: 'LUNR', event: 'IM-2 Lunar Landing Mission', impact: 'high' },
      { date: 'Q1 2026', ticker: 'ACHR', event: 'FAA Type Certification', impact: 'high' },
      { date: 'Q1 2026', ticker: 'JOBY', event: 'FAA Type Certification', impact: 'high' },
      { date: 'Q2 2026', ticker: 'RKLB', event: 'Neutron First Flight', impact: 'high' }
    ];
    
    const ACTIVITY = [
      { type: 'trade', title: 'BUY LUNR', subtitle: '100 @ $15.20', time: '09:45' },
      { type: 'alert', title: 'MACD Cross', subtitle: 'LUNR bullish', time: '09:44' },
      { type: 'trade', title: 'BUY ASTS', subtitle: '50 @ $78.20', time: 'Yest.' },
      { type: 'trade', title: 'BUY RKLB', subtitle: '75 @ $68.45', time: 'Yest.' }
    ];
    
    const rangeDays = { '1W': 7, '1M': 30, '3M': 90, '6M': 180, '1Y': 365, 'ALL': 500 };
    
    // ===== LOADING SCREEN =====
    function createStars() {
      const container = document.getElementById('stars');
      // Regular stars
      for (let i = 0; i < 80; i++) {
        const star = document.createElement('div');
        const isLarge = Math.random() > 0.85;
        star.className = 'star' + (isLarge ? ' large' : '');
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        star.style.animationDuration = (2 + Math.random() * 2) + 's';
        if (!isLarge) {
          const size = Math.random() * 2 + 1;
          star.style.width = star.style.height = size + 'px';
        }
        container.appendChild(star);
      }
    }
    
    function runLoadingSequence() {
      createStars();
      const countdown = document.getElementById('countdown');
      const status = document.getElementById('loading-status');
      const abductee = document.getElementById('abductee');
      const messages = [
        'Initiating tractor beam...',
        'Scanning for data...',
        'Acquiring target...',
        'LOCK ON!'
      ];
      
      let count = 3;
      countdown.textContent = count;
      
      const interval = setInterval(() => {
        count--;
        if (count > 0) {
          countdown.textContent = count;
          status.innerHTML = messages[3 - count];
        } else if (count === 0) {
          countdown.textContent = 'üõ∏';
          countdown.classList.add('go');
          status.innerHTML = '<span>ABDUCTING...</span>';
          abductee.classList.add('abducting');
        } else {
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('loading-screen').classList.add('hidden');
            document.body.classList.add('loaded');
          }, 800);
        }
      }, 700);
    }
    
    // ===== INIT =====
    function init() {
      runLoadingSequence();
      setTimeout(() => {
        updateTime(); setInterval(updateTime, 1000);
        buildWatchlist();
        loadTicker('RKLB');
        renderStockPositions();
        renderOptionsPositions();
        renderCatalysts();
        renderActivity();
        renderPositionCharts();
        updateScenario();
      }, 100);
    }
    
    function updateTime() { 
      document.getElementById('time-display').textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }); 
    }
    
    function buildWatchlist() {
      document.getElementById('watchlist').innerHTML = Object.entries(TICKERS).map(([t, d]) => 
        `<div class="watchlist-item ${t === currentTicker ? 'active' : ''}" onclick="loadTicker('${t}')">
          <div><div class="watchlist-ticker">${t}</div><div class="watchlist-meta">${d.theme}</div></div>
          <div class="watchlist-price"><div class="watchlist-current">$${d.price.toFixed(2)}</div>
          <div class="watchlist-change ${d.change >= 0 ? 'positive' : 'negative'}">${d.change >= 0 ? '+' : ''}${d.change.toFixed(2)}%</div></div>
        </div>`
      ).join('');
    }
    
    function loadTicker(ticker) {
      currentTicker = ticker;
      const d = TICKERS[ticker];
      document.getElementById('chart-ticker').textContent = ticker;
      document.getElementById('chart-price').textContent = `$${d.price.toFixed(2)}`;
      const chgEl = document.getElementById('chart-change');
      chgEl.textContent = `${d.change >= 0 ? '+' : ''}${d.change.toFixed(2)}%`;
      chgEl.className = `ticker-change ${d.change >= 0 ? 'positive' : 'negative'}`;
      
      document.querySelectorAll('.watchlist-item').forEach(el => {
        el.classList.toggle('active', el.querySelector('.watchlist-ticker')?.textContent === ticker);
      });
      
      updateCharts();
      updateMACDDisplay();
    }
    
    function updateMACDDisplay() {
      // Simulated MACD values
      const macd = (Math.random() * 0.5 + 0.1).toFixed(4);
      const signal = (macd * 0.7).toFixed(4);
      const hist = (macd - signal).toFixed(4);
      document.getElementById('macd-val').textContent = macd;
      document.getElementById('signal-val').textContent = signal;
      document.getElementById('hist-val').textContent = hist;
    }
    
    // ===== CHART FUNCTIONS =====
    function setTimeframe(tf) { 
      currentTimeframe = tf; 
      document.querySelectorAll('[data-tf]').forEach(b => b.classList.toggle('active', b.dataset.tf === tf)); 
      updateCharts(); 
    }
    
    function setRange(range) { 
      currentRange = range; 
      document.querySelectorAll('[data-range]').forEach(b => b.classList.toggle('active', b.dataset.range === range)); 
      updateCharts(); 
    }
    
    function toggleMA() { 
      showMA = !showMA; 
      document.getElementById('ma-toggle').classList.toggle('active', showMA); 
      updateCharts(); 
    }
    
    function updateCharts() {
      const days = rangeDays[currentRange];
      const data = generateChartData(currentTicker, days);
      const labels = data.map(d => new Date(d.t));
      const closes = data.map(d => d.c);
      
      if (priceChart) priceChart.destroy();
      const datasets = [{ label: currentTicker, data: closes, borderColor: '#2962FF', backgroundColor: 'rgba(41,98,255,0.1)', borderWidth: 2, fill: true, tension: 0.1, pointRadius: 0 }];
      
      if (showMA) {
        datasets.push({ label: 'MA 100', data: data.map(d => d.g100), borderColor: '#FF9800', borderWidth: 1, fill: false, pointRadius: 0 });
        datasets.push({ label: 'MA 150', data: data.map(d => d.g150), borderColor: '#9C27B0', borderWidth: 1, fill: false, pointRadius: 0 });
        datasets.push({ label: 'MA 200', data: data.map(d => d.g200), borderColor: '#26A69A', borderWidth: 1, fill: false, pointRadius: 0 });
      }
      
      priceChart = new Chart(document.getElementById('price-chart'), {
        type: 'line', data: { labels, datasets },
        options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
          plugins: { legend: { display: showMA, position: 'top', labels: { boxWidth: 10, font: { size: 10 } } } },
          scales: { x: { type: 'time', grid: { color: '#1E222D' }, ticks: { color: '#787B86', maxTicksLimit: 8 } },
            y: { position: 'right', grid: { color: '#1E222D' }, ticks: { color: '#787B86', callback: v => '$' + v.toFixed(2) } } }
        }
      });
      
      if (macdChart) macdChart.destroy();
      const histData = data.map(d => d.hist);
      macdChart = new Chart(document.getElementById('macd-chart'), {
        type: 'bar', data: { labels, datasets: [
          { label: 'Hist', data: histData, backgroundColor: histData.map(v => v >= 0 ? 'rgba(38,166,154,0.5)' : 'rgba(239,83,80,0.5)'), borderWidth: 0 },
          { label: 'MACD', data: data.map(d => d.macd), type: 'line', borderColor: '#2962FF', borderWidth: 1.5, fill: false, pointRadius: 0 },
          { label: 'Signal', data: data.map(d => d.signal), type: 'line', borderColor: '#FF9800', borderWidth: 1.5, fill: false, pointRadius: 0 }
        ]},
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } },
          scales: { x: { type: 'time', display: false }, y: { position: 'right', grid: { color: '#1E222D' }, ticks: { color: '#787B86' } } }
        }
      });
    }
    
    // ===== INTERACTIVE SCENARIO ANALYZER =====
    function setScenario(price, days, iv) {
      document.getElementById('price-slider').value = price;
      document.getElementById('days-slider').value = days;
      document.getElementById('iv-slider').value = iv;
      document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
      event?.target?.closest('.scenario-card')?.classList.add('active');
      updateScenario();
    }
    
    function updateScenario() {
      const priceChange = parseInt(document.getElementById('price-slider').value);
      const daysForward = parseInt(document.getElementById('days-slider').value);
      const ivChange = parseInt(document.getElementById('iv-slider').value);
      
      // Update display values
      document.getElementById('price-change-val').textContent = `${priceChange >= 0 ? '+' : ''}${priceChange}%`;
      document.getElementById('price-change-val').className = `control-value ${priceChange >= 0 ? 'positive' : 'negative'}`;
      document.getElementById('days-val').textContent = `${daysForward} days`;
      document.getElementById('iv-change-val').textContent = `${ivChange >= 0 ? '+' : ''}${ivChange}%`;
      
      // Calculate projected portfolio value
      let baseValue = 0, projValue = 0, baseDelta = 0, projDelta = 0;
      
      OPTIONS_POSITIONS.forEach(pos => {
        const basePos = pos.current * pos.contracts * 100;
        baseValue += basePos;
        baseDelta += pos.delta * pos.contracts;
        
        // Simplified option pricing model
        const priceMult = 1 + priceChange / 100;
        const timeDecay = Math.max(0, 1 - (daysForward / 12) * 0.3); // Theta decay
        const ivMult = 1 + ivChange / 200; // IV impact
        
        // Delta approximation for price change
        const deltaImpact = pos.delta * priceChange / 100 * pos.current * 1.5;
        let newPrice = (pos.current + deltaImpact) * timeDecay * ivMult;
        newPrice = Math.max(0.01, newPrice);
        
        projValue += newPrice * pos.contracts * 100;
        
        // Delta changes with price
        let newDelta = pos.delta;
        if (priceChange > 0) newDelta = Math.min(1, pos.delta + priceChange / 200);
        else newDelta = Math.max(0, pos.delta + priceChange / 150);
        projDelta += newDelta * pos.contracts;
      });
      
      const scenarioPnl = projValue - baseValue;
      const scenarioReturn = (scenarioPnl / baseValue) * 100;
      
      // Update summary
      document.getElementById('proj-value').textContent = `$${projValue.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('proj-value').className = `summary-value ${projValue >= baseValue ? 'positive' : 'negative'}`;
      
      document.getElementById('proj-pnl').textContent = `${scenarioPnl >= 0 ? '+' : ''}$${scenarioPnl.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('proj-pnl').className = `summary-value ${scenarioPnl >= 0 ? 'positive' : 'negative'}`;
      
      document.getElementById('proj-delta').textContent = projDelta.toFixed(2);
      
      document.getElementById('proj-return').textContent = `${scenarioReturn >= 0 ? '+' : ''}${scenarioReturn.toFixed(1)}%`;
      document.getElementById('proj-return').className = `summary-value ${scenarioReturn >= 0 ? 'positive' : 'negative'}`;
      
      // Update projection chart
      updateProjectionChart(priceChange);
    }
    
    function updateProjectionChart(centerChange) {
      if (projectionChart) projectionChart.destroy();
      
      const priceChanges = [];
      const portfolioValues = [];
      
      for (let pc = -50; pc <= 100; pc += 5) {
        priceChanges.push(pc);
        let pv = 0;
        OPTIONS_POSITIONS.forEach(pos => {
          const deltaImpact = pos.delta * pc / 100 * pos.current * 1.5;
          let newPrice = Math.max(0.01, pos.current + deltaImpact);
          pv += newPrice * pos.contracts * 100;
        });
        portfolioValues.push(pv);
      }
      
      const baseValue = portfolioValues[10]; // 0% change
      const pnlValues = portfolioValues.map(v => v - baseValue);
      
      projectionChart = new Chart(document.getElementById('projection-chart'), {
        type: 'line',
        data: {
          labels: priceChanges.map(p => `${p >= 0 ? '+' : ''}${p}%`),
          datasets: [{
            label: 'P&L',
            data: pnlValues,
            borderColor: '#2962FF',
            backgroundColor: pnlValues.map(v => v >= 0 ? 'rgba(38,166,154,0.3)' : 'rgba(239,83,80,0.3)'),
            fill: true,
            tension: 0.3,
            pointRadius: priceChanges.map(p => p === centerChange ? 6 : 0),
            pointBackgroundColor: '#fff'
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { 
            legend: { display: false },
            tooltip: { callbacks: { label: ctx => `P&L: ${ctx.parsed.y >= 0 ? '+' : ''}$${ctx.parsed.y.toLocaleString(undefined, {maximumFractionDigits: 0})}` } }
          },
          scales: {
            x: { grid: { color: '#1E222D' }, ticks: { color: '#787B86', maxTicksLimit: 7 } },
            y: { grid: { color: '#1E222D' }, ticks: { color: '#787B86', callback: v => `${v >= 0 ? '+' : ''}$${(v/1000).toFixed(0)}k` } }
          }
        }
      });
    }
    
    // ===== RENDER FUNCTIONS =====
    function switchTab(tabName) {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === `${tabName}-panel`));
    }
    
    function switchChartTab(chartName) {
      document.querySelectorAll('.chart-tab').forEach(t => t.classList.toggle('active', t.dataset.chart === chartName));
      document.querySelectorAll('.chart-panel').forEach(p => p.classList.toggle('active', p.id === `chart-${chartName}`));
    }
    
    function renderStockPositions() {
      document.getElementById('stock-tbody').innerHTML = STOCK_POSITIONS.map(pos => {
        const current = TICKERS[pos.ticker]?.price || pos.entry;
        const value = pos.shares * current;
        const pnl = (current - pos.entry) * pos.shares;
        const pnlPct = ((current - pos.entry) / pos.entry * 100);
        const color = TICKERS[pos.ticker]?.color || '#787B86';
        return `<tr><td><span class="ticker-badge" style="background:${color}">${pos.ticker}</span></td>
          <td style="color:var(--text-muted);font-size:0.7rem">${TICKERS[pos.ticker]?.theme || ''}</td>
          <td class="mono">${pos.shares}</td><td class="mono">$${pos.entry.toFixed(2)}</td>
          <td class="mono">$${current.toFixed(2)}</td><td class="mono">$${value.toLocaleString()}</td>
          <td class="${pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(0)} (${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(1)}%)</td></tr>`;
      }).join('');
    }
    
    function renderOptionsPositions() {
      document.getElementById('options-tbody').innerHTML = OPTIONS_POSITIONS.map(pos => {
        const pnl = (pos.current - pos.entry) * pos.contracts * 100;
        const pnlPct = ((pos.current - pos.entry) / pos.entry * 100);
        const color = TICKERS[pos.ticker]?.color || '#787B86';
        return `<tr><td><span class="ticker-badge" style="background:${color}">${pos.ticker}</span></td>
          <td><span class="structure-badge">${pos.structure}</span></td>
          <td class="mono">${pos.strikes}</td><td class="mono">$${pos.entry.toFixed(2)}</td>
          <td class="mono">$${pos.current.toFixed(2)}</td>
          <td class="${pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(0)} (${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(0)}%)</td>
          <td class="mono">${pos.delta.toFixed(2)}</td></tr>`;
      }).join('');
    }
    
    function renderPositionCharts() {
      // Position Sizes
      const positions = OPTIONS_POSITIONS.map(pos => ({ ticker: pos.ticker, value: pos.current * pos.contracts * 100, color: TICKERS[pos.ticker]?.color })).sort((a, b) => b.value - a.value);
      const maxVal = Math.max(...positions.map(p => p.value)), totalVal = positions.reduce((s, p) => s + p.value, 0);
      document.getElementById('chart-sizes').innerHTML = positions.map(p => 
        `<div class="bar-row"><span class="bar-ticker">${p.ticker}</span><div class="bar-container"><div class="bar-fill" style="width:${p.value/maxVal*100}%;background:${p.color}">${Math.round(p.value/totalVal*100)}%</div></div><span class="bar-value">$${p.value.toLocaleString()}</span></div>`
      ).join('');
      
      // P&L
      const pnlData = OPTIONS_POSITIONS.map(pos => ({ ticker: pos.ticker, pnl: (pos.current - pos.entry) * pos.contracts * 100, pct: ((pos.current - pos.entry) / pos.entry * 100) })).sort((a, b) => b.pnl - a.pnl);
      const maxPnl = Math.max(...pnlData.map(p => Math.abs(p.pnl)));
      let winners = 0, losers = 0, totalPnl = 0;
      pnlData.forEach(p => { if (p.pnl >= 0) winners++; else losers++; totalPnl += p.pnl; });
      document.getElementById('chart-pnl').innerHTML = pnlData.map(p => 
        `<div class="bar-row"><span class="bar-ticker">${p.ticker}</span><div class="bar-container"><div class="bar-fill" style="width:${Math.abs(p.pnl)/maxPnl*100}%;background:${p.pnl >= 0 ? 'var(--green)' : 'var(--red)'}">${p.pnl >= 0 ? '+' : ''}${p.pct.toFixed(0)}%</div></div><span class="bar-value ${p.pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${p.pnl >= 0 ? '+' : ''}$${Math.abs(p.pnl).toLocaleString()}</span></div>`
      ).join('') + `<div class="summary-row"><div class="summary-item"><div class="summary-value positive">${winners}</div><div class="summary-label">Winners</div></div><div class="summary-item"><div class="summary-value positive">+$${totalPnl.toLocaleString()}</div><div class="summary-label">Total</div></div><div class="summary-item"><div class="summary-value negative">${losers}</div><div class="summary-label">Losers</div></div></div>`;
      
      // Greeks
      const greeksData = OPTIONS_POSITIONS.map(pos => ({ ticker: pos.ticker, delta: pos.delta * pos.contracts, color: TICKERS[pos.ticker]?.color })).sort((a, b) => b.delta - a.delta);
      const maxDelta = Math.max(...greeksData.map(g => g.delta));
      document.getElementById('chart-greeks').innerHTML = `<div style="margin-bottom:0.5rem;font-size:0.7rem;color:var(--text-muted)">Delta Exposure by Position</div>` + greeksData.map(g => 
        `<div class="bar-row"><span class="bar-ticker">${g.ticker}</span><div class="bar-container"><div class="bar-fill" style="width:${g.delta/maxDelta*100}%;background:${g.color}">${g.delta.toFixed(1)}Œî</div></div><span class="bar-value">${(g.delta * 100).toFixed(0)} shares eq.</span></div>`
      ).join('');
    }
    
    function renderCatalysts() {
      document.getElementById('catalyst-list').innerHTML = CATALYSTS.map(cat => 
        `<div class="catalyst-item"><span class="catalyst-date">${cat.date}</span><span class="catalyst-ticker" style="color:${TICKERS[cat.ticker]?.color || '#787B86'}">${cat.ticker}</span><span class="catalyst-event">${cat.event}</span><span class="catalyst-impact ${cat.impact}">${cat.impact}</span></div>`
      ).join('');
    }
    
    function renderActivity() {
      document.getElementById('activity-feed').innerHTML = ACTIVITY.map(a => 
        `<div class="activity-item"><div class="activity-icon ${a.type}">${a.type === 'trade' ? 'üí∞' : '‚ö°'}</div><div class="activity-content"><div class="activity-title">${a.title}</div><div class="activity-subtitle">${a.subtitle}</div></div><div class="activity-time">${a.time}</div></div>`
      ).join('');
    }
    
    function toggleKillSwitch() {
      const btn = document.querySelector('.kill-switch-btn');
      if (btn.classList.contains('resume')) { btn.classList.remove('resume'); btn.textContent = 'Stop All Trading'; }
      else { btn.classList.add('resume'); btn.textContent = 'Resume Trading'; }
    }
    
    init();
  </script>
</body>
</html>
 0, projDelta = 0;
      
      OPTIONS_POSITIONS.forEach(pos => {
        const basePos = pos.current * pos.contracts * 100;
        baseValue += basePos;
        baseDelta += pos.delta * pos.contracts;
        
        const priceMult = 1 + priceChange / 100;
        const timeDecay = Math.max(0, 1 - (daysForward / 12) * 0.3);
        const ivMult = 1 + ivChange / 200;
        const deltaImpact = pos.delta * priceChange / 100 * pos.current * 1.5;
        let newPrice = (pos.current + deltaImpact) * timeDecay * ivMult;
        newPrice = Math.max(0.01, newPrice);
        projValue += newPrice * pos.contracts * 100;
        
        let newDelta = pos.delta;
        if (priceChange > 0) newDelta = Math.min(1, pos.delta + priceChange / 200);
        else newDelta = Math.max(0, pos.delta + priceChange / 150);
        projDelta += newDelta * pos.contracts;
      });
      
      const scenarioPnl = projValue - baseValue;
      const scenarioReturn = (scenarioPnl / baseValue) * 100;
      
      document.getElementById('proj-value').textContent = `$${projValue.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('proj-value').className = `summary-value ${projValue >= baseValue ? 'positive' : 'negative'}`;
      document.getElementById('proj-pnl').textContent = `${scenarioPnl >= 0 ? '+' : ''}$${scenarioPnl.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('proj-pnl').className = `summary-value ${scenarioPnl >= 0 ? 'positive' : 'negative'}`;
      document.getElementById('proj-delta').textContent = projDelta.toFixed(2);
      document.getElementById('proj-return').textContent = `${scenarioReturn >= 0 ? '+' : ''}${scenarioReturn.toFixed(1)}%`;
      document.getElementById('proj-return').className = `summary-value ${scenarioReturn >= 0 ? 'positive' : 'negative'}`;
      
      updateProjectionChart(priceChange);
    }
    
    function updateProjectionChart(centerChange) {
      if (projectionChart) projectionChart.destroy();
      
      const priceChanges = [], portfolioValues = [];
      for (let pc = -50; pc <= 100; pc += 5) {
        priceChanges.push(pc);
        let pv = 0;
        OPTIONS_POSITIONS.forEach(pos => {
          const deltaImpact = pos.delta * pc / 100 * pos.current * 1.5;
          let newPrice = Math.max(0.01, pos.current + deltaImpact);
          pv += newPrice * pos.contracts * 100;
        });
        portfolioValues.push(pv);
      }
      
      const baseValue = portfolioValues[10];
      const pnlValues = portfolioValues.map(v => v - baseValue);
      
      projectionChart = new Chart(document.getElementById('projection-chart'), {
        type: 'line',
        data: {
          labels: priceChanges.map(p => `${p >= 0 ? '+' : ''}${p}%`),
          datasets: [{
            label: 'P&L',
            data: pnlValues,
            borderColor: '#00d4ff',
            backgroundColor: ctx => {
              const gradient = ctx.chart.ctx.createLinearGradient(0, 0, 0, ctx.chart.height);
              gradient.addColorStop(0, 'rgba(57,255,20,0.3)');
              gradient.addColorStop(0.5, 'rgba(0,212,255,0.1)');
              gradient.addColorStop(1, 'rgba(255,49,49,0.3)');
              return gradient;
            },
            fill: true,
            tension: 0.3,
            pointRadius: priceChanges.map(p => p === centerChange ? 8 : 0),
            pointBackgroundColor: '#ffb347',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            x: { grid: { color: '#1a2028' }, ticks: { color: '#5a6370', maxTicksLimit: 7, font: { family: 'JetBrains Mono' } } },
            y: { grid: { color: '#1a2028' }, ticks: { color: '#5a6370', callback: v => `${v >= 0 ? '+' : ''}$${(v/1000).toFixed(0)}k`, font: { family: 'JetBrains Mono' } } }
          }
        }
      });
    }
    
    // ===== TAB & CHART SWITCHING =====
    function switchTab(tabName) {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === `${tabName}-panel`));
    }
    
    function switchChartTab(chartName) {
      document.querySelectorAll('.chart-tab').forEach(t => t.classList.toggle('active', t.dataset.chart === chartName));
      document.querySelectorAll('.chart-panel').forEach(p => p.classList.toggle('active', p.id === `chart-${chartName}`));
    }
    
    // ===== RENDER FUNCTIONS =====
    function renderStockPositions() {
      document.getElementById('stock-tbody').innerHTML = STOCK_POSITIONS.map(pos => {
        const current = TICKERS[pos.ticker]?.price || pos.entry;
        const value = pos.shares * current;
        const pnl = (current - pos.entry) * pos.shares;
        const pnlPct = ((current - pos.entry) / pos.entry * 100);
        const color = TICKERS[pos.ticker]?.color || '#6B7B8A';
        return `<tr>
          <td><span class="ticker-badge" style="background:${color}">${pos.ticker}</span></td>
          <td style="color:var(--text-muted);font-size:0.75rem">${TICKERS[pos.ticker]?.theme || ''}</td>
          <td class="mono">${pos.shares}</td>
          <td class="mono">$${pos.entry.toFixed(2)}</td>
          <td class="mono">$${current.toFixed(2)}</td>
          <td class="mono">$${value.toLocaleString()}</td>
          <td class="${pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(0)} (${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(1)}%)</td>
        </tr>`;
      }).join('');
    }
    
    function renderOptionsPositions() {
      document.getElementById('options-tbody').innerHTML = OPTIONS_POSITIONS.map(pos => {
        const pnl = (pos.current - pos.entry) * pos.contracts * 100;
        const pnlPct = ((pos.current - pos.entry) / pos.entry * 100);
        const color = TICKERS[pos.ticker]?.color || '#6B7B8A';
        return `<tr>
          <td><span class="ticker-badge" style="background:${color}">${pos.ticker}</span></td>
          <td><span class="structure-badge">${pos.structure}</span></td>
          <td class="mono">${pos.strikes}</td>
          <td class="mono">$${pos.entry.toFixed(2)}</td>
          <td class="mono">$${pos.current.toFixed(2)}</td>
          <td class="${pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${pnl >= 0 ? '+' : ''}$${pnl.toFixed(0)} (${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(0)}%)</td>
          <td class="mono">${pos.delta.toFixed(2)}</td>
        </tr>`;
      }).join('');
    }
    
    function renderPositionCharts() {
      // Position Sizes
      const positions = OPTIONS_POSITIONS.map(pos => ({ ticker: pos.ticker, value: pos.current * pos.contracts * 100, color: TICKERS[pos.ticker]?.color })).sort((a, b) => b.value - a.value);
      const maxVal = Math.max(...positions.map(p => p.value)), totalVal = positions.reduce((s, p) => s + p.value, 0);
      document.getElementById('chart-sizes').innerHTML = positions.map(p => 
        `<div class="bar-row"><span class="bar-ticker">${p.ticker}</span><div class="bar-container"><div class="bar-fill" style="width:${p.value/maxVal*100}%;background:${p.color}">${Math.round(p.value/totalVal*100)}%</div></div><span class="bar-value">$${p.value.toLocaleString()}</span></div>`
      ).join('');
      
      // P&L
      const pnlData = OPTIONS_POSITIONS.map(pos => ({ ticker: pos.ticker, pnl: (pos.current - pos.entry) * pos.contracts * 100, pct: ((pos.current - pos.entry) / pos.entry * 100) })).sort((a, b) => b.pnl - a.pnl);
      const maxPnl = Math.max(...pnlData.map(p => Math.abs(p.pnl)));
      let winners = 0, losers = 0, totalPnl = 0;
      pnlData.forEach(p => { if (p.pnl >= 0) winners++; else losers++; totalPnl += p.pnl; });
      document.getElementById('chart-pnl').innerHTML = pnlData.map(p => 
        `<div class="bar-row"><span class="bar-ticker">${p.ticker}</span><div class="bar-container"><div class="bar-fill" style="width:${Math.abs(p.pnl)/maxPnl*100}%;background:${p.pnl >= 0 ? 'var(--green)' : 'var(--red)'}">${p.pnl >= 0 ? '+' : ''}${p.pct.toFixed(0)}%</div></div><span class="bar-value ${p.pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">${p.pnl >= 0 ? '+' : ''}$${Math.abs(p.pnl).toLocaleString()}</span></div>`
      ).join('') + `<div class="summary-row"><div class="summary-item"><div class="summary-value positive">${winners}</div><div class="summary-label">Winners</div></div><div class="summary-item"><div class="summary-value positive">+$${totalPnl.toLocaleString()}</div><div class="summary-label">Total</div></div><div class="summary-item"><div class="summary-value negative">${losers}</div><div class="summary-label">Losers</div></div></div>`;
      
      // Greeks
      const greeksData = OPTIONS_POSITIONS.map(pos => ({ ticker: pos.ticker, delta: pos.delta * pos.contracts, color: TICKERS[pos.ticker]?.color })).sort((a, b) => b.delta - a.delta);
      const maxDelta = Math.max(...greeksData.map(g => g.delta));
      document.getElementById('chart-greeks').innerHTML = `<div style="margin-bottom:0.75rem;font-size:0.75rem;color:var(--text-muted)">Delta Exposure by Position</div>` + greeksData.map(g => 
        `<div class="bar-row"><span class="bar-ticker">${g.ticker}</span><div class="bar-container"><div class="bar-fill" style="width:${g.delta/maxDelta*100}%;background:${g.color}">${g.delta.toFixed(1)}Œî</div></div><span class="bar-value">${(g.delta * 100).toFixed(0)} shares</span></div>`
      ).join('');
    }
    
    function renderCatalysts() {
      document.getElementById('catalyst-list').innerHTML = CATALYSTS.map(cat => 
        `<div class="catalyst-item">
          <span class="catalyst-date">${cat.date}</span>
          <span class="catalyst-ticker" style="color:${TICKERS[cat.ticker]?.color || 'var(--amber)'}">${cat.ticker}</span>
          <span class="catalyst-event">${cat.event}</span>
          <span class="catalyst-impact ${cat.impact}">${cat.impact}</span>
        </div>`
      ).join('');
    }
    
    function renderActivity() {
      document.getElementById('activity-feed').innerHTML = ACTIVITY.map(a => 
        `<div class="activity-item">
          <div class="activity-icon ${a.type}">${a.type === 'trade' ? 'üí∞' : '‚ö°'}</div>
          <div class="activity-content">
            <div class="activity-title">${a.title}</div>
            <div class="activity-subtitle">${a.subtitle}</div>
          </div>
          <div class="activity-time">${a.time}</div>
        </div>`
      ).join('');
    }
    
    function toggleKillSwitch() {
      const btn = document.querySelector('.kill-switch-btn');
      if (btn.classList.contains('resume')) {
        btn.classList.remove('resume');
        btn.innerHTML = '‚ö° Stop All Trading';
      } else {
        btn.classList.add('resume');
        btn.innerHTML = '‚ñ∂ Resume Trading';
      }
    }
    
    init();
  </script>
</body>
</html>
