<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0c0f">
  <title>HASLUN-BOT \\ PILOT'S COCKPIT</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%230a0c0f' width='100' height='100'/%3E%3Ccircle cx='50' cy='50' r='35' fill='none' stroke='%2333ff99' stroke-width='2'/%3E%3Ccircle cx='50' cy='50' r='25' fill='none' stroke='%2333ff99' stroke-width='1' opacity='0.5'/%3E%3Ccircle cx='50' cy='50' r='4' fill='%23ffb347'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Orbitron:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <style>
    :root {
      --bg-void: #050608;
      --bg-deep: #0a0c0f;
      --bg-panel: #0d1117;
      --bg-card: #151b23;
      --bg-input: #1a222c;
      --border: #1e2832;
      --border-glow: #2a3a4a;
      --grid-line: rgba(51, 255, 153, 0.08);
      --text-bright: #f0f8f4;
      --text: #b8d0c8;
      --text-muted: #6a8078;
      --text-dim: #4a5a54;
      --text-soft: #8aa098;
      /* HSL-based phosphor for color profile control */
      --accent-hue: 150;
      --phosphor: hsl(var(--accent-hue), 100%, 60%);
      --phosphor-dim: hsla(var(--accent-hue), 100%, 60%, 0.6);
      --phosphor-glow: hsla(var(--accent-hue), 100%, 60%, 0.15);
      --phosphor-ghost: hsla(var(--accent-hue), 100%, 60%, 0.08);
      --accent-glow: hsla(var(--accent-hue), 100%, 65%, 0.7);
      --amber: #ffb347;
      --amber-dim: rgba(255, 179, 71, 0.6);
      --amber-glow: rgba(255, 179, 71, 0.15);
      --signal-up: hsl(var(--accent-hue), 100%, 60%);
      --signal-down: #ff6b6b;
      --signal-warn: #ffb347;
      --font-display: 'Orbitron', sans-serif;
      --font-body: 'IBM Plex Mono', monospace;
      --font-mono: 'IBM Plex Mono', monospace;
    }
    
    @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100vh); } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(51, 255, 153, 0.1); } 50% { box-shadow: 0 0 30px rgba(51, 255, 153, 0.2); } }
    @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
    @keyframes crt-flicker { 0%, 100% { opacity: 0.12; } 40% { opacity: 0.18; } 60% { opacity: 0.10; } }
    @keyframes hover-ship { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    @keyframes beam-pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @keyframes radar-sweep { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes data-glow { from { box-shadow: 0 0 20px rgba(255, 179, 71, 0.5); } to { box-shadow: none; } }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: var(--font-body);
      background: var(--bg-void);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* CRT scanlines */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.15) 2px, rgba(0, 0, 0, 0.15) 4px);
      pointer-events: none;
      z-index: 10000;
      animation: crt-flicker 3.5s infinite alternate;
    }
    
    /* Moving scanline + vignette */
    body::after {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(ellipse at 50% 50%, transparent 0%, transparent 60%, rgba(0,0,0,0.4) 100%);
      pointer-events: none;
      z-index: 9999;
    }
    
    .scan-line {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(180deg, transparent, rgba(51, 255, 153, 0.08), transparent);
      animation: scanline 8s linear infinite;
      pointer-events: none;
      z-index: 10001;
    }
    
    .grid-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: linear-gradient(var(--grid-line) 1px, transparent 1px), linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: -1;
    }
    
    /* LOADING SCREEN */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(ellipse at 50% 30%, rgba(10, 20, 25, 1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 100%, rgba(51, 255, 153, 0.03) 0%, transparent 40%),
        var(--bg-void);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20000;
      transition: opacity 0.8s ease, visibility 0.8s ease;
      overflow: hidden;
    }
    
    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    /* INVADER ARMY BACKDROP */
    .invader-army {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
      opacity: 0.45;
    }

    .invader-row {
      position: absolute;
      display: flex;
      gap: 18px;
      left: 50%;
      transform: translateX(-50%);
    }

    .invader-row .invader-sprite-small {
      width: 28px;
      height: 20px;
      fill: var(--phosphor);
      image-rendering: pixelated;
      shape-rendering: crispEdges;
      filter:
        drop-shadow(0 0 6px var(--accent-glow))
        drop-shadow(0 0 12px hsla(var(--accent-hue), 100%, 60%, 0.4));
    }

    @keyframes invader-army-march {
      0%   { transform: translateX(-50%) translateX(-10vw); }
      50%  { transform: translateX(-50%) translateX(10vw); }
      100% { transform: translateX(-50%) translateX(-10vw); }
    }

    @keyframes invader-drop {
      0%   { transform: translateY(0); }
      20%  { transform: translateY(20px); }
      40%  { transform: translateY(40px); }
      60%  { transform: translateY(60px); }
      80%  { transform: translateY(80px); }
      100% { transform: translateY(100px); }
    }

    .loading-screen.hidden .invader-army {
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    
    .loading-inner {
      position: relative;
      z-index: 1;
    }
    
    .stars {
      position: absolute;
      inset: 0;
      background:
        /* Distant nebula glow */
        radial-gradient(ellipse at 30% 20%, rgba(51, 255, 153, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(255, 179, 71, 0.05) 0%, transparent 40%),
        /* Star layers - varying sizes and colors */
        radial-gradient(1px 1px at 5% 8%, rgba(255, 255, 255, 0.9), transparent),
        radial-gradient(1px 1px at 12% 25%, rgba(51, 255, 153, 0.8), transparent),
        radial-gradient(1.5px 1.5px at 18% 12%, rgba(255, 255, 255, 0.95), transparent),
        radial-gradient(1px 1px at 25% 45%, rgba(255, 255, 255, 0.7), transparent),
        radial-gradient(1px 1px at 32% 18%, rgba(255, 179, 71, 0.6), transparent),
        radial-gradient(1px 1px at 40% 65%, rgba(51, 255, 153, 0.7), transparent),
        radial-gradient(1.5px 1.5px at 48% 35%, rgba(255, 255, 255, 0.85), transparent),
        radial-gradient(1px 1px at 55% 8%, rgba(255, 255, 255, 0.6), transparent),
        radial-gradient(1px 1px at 62% 52%, rgba(51, 255, 153, 0.5), transparent),
        radial-gradient(1px 1px at 70% 22%, rgba(255, 255, 255, 0.8), transparent),
        radial-gradient(1px 1px at 78% 68%, rgba(255, 179, 71, 0.5), transparent),
        radial-gradient(1.5px 1.5px at 85% 15%, rgba(255, 255, 255, 0.9), transparent),
        radial-gradient(1px 1px at 92% 42%, rgba(51, 255, 153, 0.6), transparent),
        radial-gradient(1px 1px at 8% 72%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 22% 88%, rgba(255, 179, 71, 0.4), transparent),
        radial-gradient(1px 1px at 45% 78%, rgba(255, 255, 255, 0.6), transparent),
        radial-gradient(1px 1px at 68% 92%, rgba(51, 255, 153, 0.5), transparent),
        radial-gradient(1px 1px at 88% 85%, rgba(255, 255, 255, 0.4), transparent),
        radial-gradient(1px 1px at 95% 5%, rgba(255, 255, 255, 0.5), transparent),
        radial-gradient(1px 1px at 3% 55%, rgba(51, 255, 153, 0.4), transparent);
      animation: star-drift 20s ease-in-out infinite alternate;
    }
    
    @keyframes star-drift {
      0% { transform: translate3d(0, 0, 0); opacity: 0.85; }
      50% { transform: translate3d(-2px, -1px, 0); opacity: 1; }
      100% { transform: translate3d(1px, 2px, 0); opacity: 0.8; }
    }
    
    .horizon {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 250px;
      background: 
        linear-gradient(to top, 
          rgba(5, 6, 8, 1) 0%,
          rgba(5, 6, 8, 0.95) 20%,
          rgba(51, 255, 153, 0.08) 60%,
          transparent 100%
        );
      pointer-events: none;
    }
    
    /* Subtle ground reflection */
    .horizon::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 3px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(51, 255, 153, 0.3) 30%,
        rgba(51, 255, 153, 0.5) 50%,
        rgba(51, 255, 153, 0.3) 70%,
        transparent 100%
      );
      filter: blur(2px);
    }
    
    .launch-scene {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
    }
    
    /* =========================================================================
       8-BIT PIXEL INVADER — Retro Arcade Aesthetic
       ========================================================================= */
    
    /* Step-based arcade animations */
    @keyframes invader-bob { 
      0%, 100% { transform: translateY(0); } 
      50% { transform: translateY(-8px); } 
    }
    
    @keyframes invader-march {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(12px); }
    }
    
    @keyframes crt-pixel-flicker { 
      0%, 90%, 100% { opacity: 1; } 
      92% { opacity: 0.85; } 
      94% { opacity: 1; }
      96% { opacity: 0.9; }
    }
    
    @keyframes invader-glow {
      0%, 100% { 
        filter: drop-shadow(0 0 8px var(--phosphor)) drop-shadow(0 0 20px rgba(51, 255, 153, 0.4)); 
      }
      50% { 
        filter: drop-shadow(0 0 12px var(--phosphor)) drop-shadow(0 0 30px rgba(51, 255, 153, 0.6)); 
      }
    }
    
    @keyframes march-row {
      0% { transform: translateX(0); }
      50% { transform: translateX(20px); }
      100% { transform: translateX(0); }
    }
    
    @keyframes pixel-beam-pulse {
      0%, 100% { opacity: 0.3; height: 80px; }
      50% { opacity: 0.6; height: 100px; }
    }
    
    /* Main invader container */
    .pixel-invader-scene {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 40px;
    }
    
    /* Background marching invaders row */
    .invader-fleet {
      position: absolute;
      top: -60px;
      display: flex;
      gap: 40px;
      opacity: 0.15;
      animation: march-row 2s steps(2) infinite;
    }
    
    .fleet-invader {
      width: 24px;
      height: 18px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    /* Main pixel invader */
    .pixel-invader {
      width: 96px;
      height: 72px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      animation: 
        invader-bob 1.2s steps(2) infinite,
        crt-pixel-flicker 4s linear infinite,
        invader-glow 2s ease-in-out infinite;
      position: relative;
      z-index: 2;
    }
    
    /* Pixel beam beneath invader */
    .pixel-beam {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 80px;
      background: linear-gradient(180deg, 
        var(--phosphor) 0%, 
        rgba(51, 255, 153, 0.6) 30%,
        rgba(51, 255, 153, 0.2) 70%,
        transparent 100%
      );
      opacity: 0;
      transition: opacity 0.5s ease;
      animation: pixel-beam-pulse 1.5s steps(3) infinite;
    }
    
    .pixel-beam.active {
      opacity: 1;
    }
    
    /* Pixel scan line effect */
    .pixel-beam::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(180deg,
        transparent 0px,
        transparent 4px,
        rgba(0, 0, 0, 0.3) 4px,
        rgba(0, 0, 0, 0.3) 8px
      );
    }
    
    /* Ground reflection */
    .pixel-ground {
      width: 120px;
      height: 4px;
      margin-top: 100px;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(51, 255, 153, 0.3) 30%,
        var(--phosphor-dim) 50%,
        rgba(51, 255, 153, 0.3) 70%,
        transparent 100%
      );
      opacity: 0;
      transition: opacity 0.5s ease;
      filter: blur(2px);
    }
    
    .pixel-ground.active {
      opacity: 1;
    }
    
    /* Legacy support - hidden but keeps JS from breaking */
    .mothership {
      display: none;
      position: relative;
      width: 320px;
      height: 160px;
      margin-bottom: 40px;
      animation: ufo-hover 5s ease-in-out infinite;
      filter: drop-shadow(0 40px 60px rgba(0,0,0,0.9));
    }
    
    .loading-content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 60px;
    }
    
    .loading-brand {
      font-family: var(--font-display);
      font-size: 2.5rem;
      font-weight: 600;
      letter-spacing: 0.3em;
      color: var(--phosphor);
      text-shadow: 
        0 0 30px var(--phosphor-glow), 
        0 0 60px rgba(51, 255, 153, 0.3),
        0 0 100px rgba(51, 255, 153, 0.15);
      margin-bottom: 0.5rem;
      animation: brand-glow 3s ease-in-out infinite;
    }
    
    @keyframes brand-glow {
      0%, 100% { opacity: 0.9; text-shadow: 0 0 30px var(--phosphor-glow), 0 0 60px rgba(51, 255, 153, 0.3); }
      50% { opacity: 1; text-shadow: 0 0 40px var(--phosphor-glow), 0 0 80px rgba(51, 255, 153, 0.4), 0 0 120px rgba(51, 255, 153, 0.2); }
    }
    
    .loading-sub {
      font-size: 0.75rem;
      letter-spacing: 0.4em;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 2.5rem;
      opacity: 0.8;
    }
    
    .countdown {
      font-family: var(--font-display);
      font-size: 4rem;
      font-weight: 700;
      color: var(--amber);
      text-shadow: 
        0 0 30px var(--amber-glow), 
        0 0 60px rgba(255, 179, 71, 0.5),
        0 0 100px rgba(255, 179, 71, 0.25);
      margin-bottom: 1.5rem;
      min-width: 80px;
      text-align: center;
    }
    
    .countdown.go {
      color: var(--phosphor);
      text-shadow: 
        0 0 40px var(--phosphor-glow),
        0 0 80px rgba(51, 255, 153, 0.6);
      animation: countdown-flash 0.4s ease-out 3;
    }
    
    @keyframes countdown-flash {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.15); opacity: 1; }
      100% { transform: scale(1); opacity: 0.9; }
    }
    
    .loading-status {
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      color: var(--text-muted);
      text-transform: uppercase;
      position: relative;
      padding-left: 1rem;
    }
    
    /* Terminal cursor effect */
    .loading-status::before {
      content: '▸';
      position: absolute;
      left: 0;
      color: var(--phosphor);
      animation: cursor-blink 1s step-end infinite;
    }
    
    @keyframes cursor-blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* APP CONTAINER */
    .app {
      display: none;
    }
    
    .app.visible {
      display: block;
    }
    
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      height: 56px;
      background: 
        radial-gradient(ellipse at 0% 0%, rgba(51, 255, 153, 0.15), transparent 50%),
        linear-gradient(180deg, var(--bg-panel) 0%, var(--bg-deep) 100%);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 0 30px rgba(51, 255, 153, 0.05);
    }
    
    .header::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--phosphor-dim), transparent);
    }
    
    .header-left { display: flex; align-items: center; gap: 2rem; }
    .logo { display: flex; align-items: center; gap: 0.75rem; }
    .logo-mark { width: 32px; height: 32px; }
    .logo-mark svg { width: 100%; height: 100%; }
    .logo-text { font-family: var(--font-display); font-size: 0.8rem; font-weight: 600; letter-spacing: 0.2em; color: var(--phosphor); text-shadow: 0 0 20px var(--phosphor-glow); }
    .logo-sub { font-size: 0.5rem; color: var(--text-muted); letter-spacing: 0.15em; margin-top: 2px; font-family: var(--font-body); }
    
    .nav-tabs { display: flex; gap: 0.5rem; }
    .nav-tab {
      padding: 0.6rem 1.1rem;
      background: linear-gradient(to bottom, rgba(51, 255, 153, 0.06), transparent);
      border: 1px solid var(--border);
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 0.7rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .nav-tab:hover { color: var(--text); background: linear-gradient(to bottom, rgba(51, 255, 153, 0.1), transparent); }
    .nav-tab.active { 
      color: var(--phosphor); 
      background: linear-gradient(to bottom, rgba(51, 255, 153, 0.15), var(--phosphor-ghost)); 
      border-color: var(--phosphor-dim);
      text-shadow: 0 0 10px var(--phosphor-glow);
      box-shadow: inset 0 2px 0 var(--phosphor), 0 0 20px rgba(51, 255, 153, 0.15);
    }
    .nav-tab.active::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: var(--bg-deep); }
    
    .header-right { display: flex; align-items: center; gap: 1.5rem; }
    .status-indicator { display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--amber); box-shadow: 0 0 10px var(--amber-glow); animation: pulse-glow 2s ease-in-out infinite; }
    .status-dot.live { background: var(--phosphor); box-shadow: 0 0 10px var(--phosphor-glow); }
    .status-text { font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-muted); }
    .demo-badge { padding: 0.3rem 0.6rem; background: var(--amber); font-size: 0.6rem; font-weight: 600; letter-spacing: 0.15em; color: var(--bg-void); text-transform: uppercase; }
    .time-display { font-size: 0.8rem; color: var(--phosphor); letter-spacing: 0.05em; text-shadow: 0 0 10px var(--phosphor-glow); }
    .time-display .blink { animation: blink 1s step-end infinite; }
    
    .main { display: flex; height: calc(100vh - 56px); }
    
    .sidebar { width: 280px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
    .sidebar-section { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); }
    .sidebar-title { display: flex; align-items: center; gap: 0.5rem; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-dim); margin-bottom: 0.85rem; }
    .sidebar-title::before { content: '//'; color: var(--phosphor-dim); }
    
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
    .stat-box { 
      padding: 0.75rem; 
      background: 
        radial-gradient(ellipse at 50% -20%, rgba(51, 255, 153, 0.08), transparent 70%),
        var(--bg-card); 
      border: 1px solid var(--border); 
      position: relative; 
      overflow: hidden;
      cursor: help;
    }
    .stat-box::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--phosphor-dim); opacity: 0.5; }
    .stat-box.highlight::before { background: var(--amber); }
    .stat-label { font-size: 0.55rem; color: var(--text-dim); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.35rem; }
    .stat-value { font-size: 1rem; font-weight: 600; color: var(--text-bright); }
    .stat-value.positive { color: var(--signal-up); text-shadow: 0 0 15px var(--phosphor-glow); }
    .stat-value.negative { color: var(--signal-down); }
    
    /* Portfolio Mood Indicator */
    .portfolio-mood {
      margin-top: 0.6rem;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 2px solid var(--phosphor-dim);
      font-size: 0.58rem;
      line-height: 1.4;
    }
    .portfolio-mood.boost { border-left-color: var(--signal-up); }
    .portfolio-mood.climb { border-left-color: var(--phosphor-dim); }
    .portfolio-mood.turbulence { border-left-color: var(--amber); }
    .portfolio-mood.rattle { border-left-color: var(--signal-down); }
    .mood-label {
      display: block;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text);
      margin-bottom: 0.15rem;
    }
    .portfolio-mood.boost .mood-label { color: var(--signal-up); }
    .portfolio-mood.turbulence .mood-label { color: var(--amber); }
    .portfolio-mood.rattle .mood-label { color: var(--signal-down); }
    .mood-copy {
      color: var(--text-muted);
      font-style: italic;
    }
    
    .macd-display { display: flex; flex-direction: column; gap: 0.6rem; }
    .macd-row { display: flex; justify-content: space-between; align-items: center; padding: 0.4rem 0; border-bottom: 1px solid var(--border); }
    .macd-row:last-child { border-bottom: none; }
    .macd-label { font-size: 0.7rem; color: var(--text-muted); letter-spacing: 0.05em; }
    .macd-value { font-size: 0.8rem; font-weight: 500; }
    .macd-value.positive { color: var(--signal-up); }
    .macd-value.negative { color: var(--signal-down); }
    
    /* MACD Status Line */
    .macd-status {
      margin-top: 0.5rem;
      padding: 0.5rem 0.6rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 2px solid var(--text-dim);
      font-size: 0.6rem;
      line-height: 1.4;
    }
    .macd-status.bullish { border-left-color: var(--signal-up); }
    .macd-status.bearish { border-left-color: var(--signal-down); }
    .macd-status-label {
      display: block;
      color: var(--text);
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 0.15rem;
    }
    .macd-status.bullish .macd-status-label { color: var(--signal-up); }
    .macd-status.bearish .macd-status-label { color: var(--signal-down); }
    .macd-status-copy {
      color: var(--text-muted);
      font-style: italic;
    }
    
    /* Trend Status Styles */
    .trend-display { display: flex; flex-direction: column; gap: 0.75rem; }
    .trend-status-badge { display: flex; align-items: center; gap: 0.5rem; padding: 0.6rem 0.8rem; background: var(--bg-card); border: 1px solid var(--border); transition: all 0.3s; cursor: help; }
    .trend-status-badge.trend-bull { border-color: rgba(51, 255, 153, 0.5); background: rgba(51, 255, 153, 0.08); }
    .trend-status-badge.trend-bear { border-color: rgba(255, 107, 107, 0.5); background: rgba(255, 107, 107, 0.08); }
    .trend-status-badge.trend-neutral { border-color: rgba(255, 179, 71, 0.5); background: rgba(255, 179, 71, 0.08); }
    .trend-status-badge.trend-volatile { border-color: rgba(179, 136, 255, 0.5); background: rgba(179, 136, 255, 0.08); }
    .trend-icon { font-size: 1rem; transition: color 0.3s; }
    .trend-status-badge.trend-bull .trend-icon { color: var(--signal-up); text-shadow: 0 0 10px var(--signal-up); }
    .trend-status-badge.trend-bear .trend-icon { color: var(--signal-down); text-shadow: 0 0 10px var(--signal-down); }
    .trend-status-badge.trend-neutral .trend-icon { color: var(--amber); text-shadow: 0 0 10px var(--amber); }
    .trend-status-badge.trend-volatile .trend-icon { color: #b388ff; text-shadow: 0 0 10px #b388ff; }
    .trend-label { font-size: 0.7rem; font-weight: 600; letter-spacing: 0.1em; color: var(--text-bright); }
    .trend-detail { font-size: 0.65rem; color: var(--text-muted); line-height: 1.4; padding: 0 0.2rem; }
    .trend-subtitle { color: var(--text); font-weight: 500; display: block; margin-bottom: 0.2rem; }
    .trend-metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.25rem; }
    .trend-metric { display: flex; flex-direction: column; align-items: center; padding: 0.4rem; background: var(--bg-card); border: 1px solid var(--border); }
    .trend-metric-label { font-size: 0.5rem; letter-spacing: 0.08em; color: var(--text-dim); text-transform: uppercase; }
    .trend-metric-value { font-size: 0.7rem; font-weight: 600; color: var(--text); margin-top: 0.15rem; }
    
    /* Volume Badge Styles */
    .volume-badge { padding: 0.2rem 0.5rem; border-radius: 2px; font-size: 0.6rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; border: 1px solid var(--border); color: var(--text-muted); background: var(--bg-card); transition: all 0.3s; margin-left: 0.75rem; }
    .volume-badge.vol-high { border-color: rgba(255, 107, 107, 0.7); color: var(--signal-down); background: rgba(255, 107, 107, 0.12); animation: pulse 2s infinite; }
    .volume-badge.vol-elevated { border-color: rgba(255, 179, 71, 0.7); color: var(--amber); background: rgba(255, 179, 71, 0.1); }
    .volume-badge.vol-normal { border-color: rgba(51, 255, 153, 0.4); color: var(--phosphor-dim); }
    .volume-badge.vol-quiet { border-color: var(--border); color: var(--text-dim); opacity: 0.7; }
    
    /* P&L Simulation Styles */
    .simulation-section { background: linear-gradient(135deg, rgba(255, 179, 71, 0.03) 0%, transparent 50%); }
    .sim-form { display: flex; flex-direction: column; gap: 0.75rem; }
    .sim-field { display: flex; flex-direction: column; gap: 0.25rem; }
    .sim-label { font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); }
    .sim-input { width: 100%; padding: 0.5rem 0.6rem; background: var(--bg-input); border: 1px solid var(--border); color: var(--text); font-family: var(--font-body); font-size: 0.75rem; transition: all 0.15s; }
    .sim-input:focus { outline: none; border-color: var(--amber-dim); box-shadow: 0 0 10px rgba(255, 179, 71, 0.15); }
    .sim-btn { width: 100%; padding: 0.6rem; margin-top: 0.25rem; background: var(--bg-card); border: 1px solid var(--amber-dim); color: var(--amber); font-family: var(--font-body); font-size: 0.65rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
    .sim-btn:hover { background: rgba(255, 179, 71, 0.1); border-color: var(--amber); box-shadow: 0 0 15px rgba(255, 179, 71, 0.2); }
    .sim-btn-icon { font-size: 0.5rem; }
    .sim-result { padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); text-align: center; transition: all 0.3s; }
    .sim-result.positive { border-color: rgba(51, 255, 153, 0.5); background: rgba(51, 255, 153, 0.08); }
    .sim-result.negative { border-color: rgba(255, 107, 107, 0.5); background: rgba(255, 107, 107, 0.08); }
    .sim-result-label { font-size: 0.55rem; letter-spacing: 0.08em; color: var(--text-dim); text-transform: uppercase; }
    .sim-result-value { font-family: var(--font-display); font-size: 1.1rem; font-weight: 600; margin-top: 0.25rem; letter-spacing: 0.05em; }
    .sim-result-value.positive { color: var(--signal-up); text-shadow: 0 0 15px var(--phosphor-glow); }
    .sim-result-value.negative { color: var(--signal-down); }
    .sim-result-pct { font-size: 0.7rem; color: var(--text-muted); margin-top: 0.15rem; }
    .sim-result-meta { font-size: 0.55rem; color: var(--text-dim); margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border); }
    
    .watchlist { flex: 1; overflow-y: auto; }
    .watchlist::-webkit-scrollbar { width: 4px; }
    .watchlist::-webkit-scrollbar-track { background: var(--bg-deep); }
    .watchlist::-webkit-scrollbar-thumb { background: var(--border-glow); }
    
    .watchlist-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1.25rem; cursor: pointer; border-bottom: 1px solid var(--border); transition: all 0.15s; position: relative; }
    .watchlist-item::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: transparent; transition: background 0.15s; }
    .watchlist-item:hover { background: var(--phosphor-ghost); }
    .watchlist-item:hover::before { background: var(--phosphor-dim); }
    .watchlist-item.active { background: var(--phosphor-ghost); }
    .watchlist-item.active::before { background: var(--phosphor); box-shadow: 0 0 10px var(--phosphor-glow); }
    .watchlist-info { display: flex; flex-direction: column; gap: 0.2rem; }
    .watchlist-ticker { font-size: 0.85rem; font-weight: 600; color: var(--text-bright); letter-spacing: 0.05em; }
    .watchlist-meta { font-size: 0.6rem; color: var(--text-dim); letter-spacing: 0.08em; text-transform: uppercase; }
    .watchlist-data { text-align: right; }
    .watchlist-price { font-size: 0.85rem; color: var(--text); }
    .watchlist-change { font-size: 0.7rem; margin-top: 0.15rem; }
    .watchlist-change.positive { color: var(--signal-up); }
    .watchlist-change.negative { color: var(--signal-down); }
    .watchlist-info-btn { 
      position: absolute;
      left: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      padding: 0;
      border: none;
      background: transparent;
      color: var(--text-dim);
      font-size: 0.6rem;
      cursor: pointer;
      opacity: 0;
      transition: all 0.15s;
      z-index: 5;
    }
    .watchlist-item:hover .watchlist-info-btn { opacity: 0.6; }
    .watchlist-info-btn:hover { opacity: 1 !important; color: var(--phosphor); transform: translateY(-50%) scale(1.2); }
    .watchlist-item { padding-left: 1.75rem; }
    
    .content { flex: 1; display: flex; flex-direction: column; min-width: 0; overflow: hidden; background: var(--bg-deep); }
    .tab-panel { display: none; flex: 1; flex-direction: column; overflow: hidden; }
    .tab-panel.active { display: flex; }
    
    .chart-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1.25rem; background: var(--bg-panel); border-bottom: 1px solid var(--border); flex-wrap: wrap; gap: 0.75rem; }
    .chart-header-left { display: flex; align-items: center; gap: 1.5rem; }
    .ticker-display { display: flex; align-items: baseline; gap: 1rem; }
    .ticker-symbol { font-family: var(--font-display); font-size: 1.3rem; font-weight: 600; color: var(--phosphor); letter-spacing: 0.1em; text-shadow: 0 0 20px var(--phosphor-glow); }
    .ticker-price { font-size: 1.1rem; color: var(--text-bright); }
    .ticker-change { font-size: 0.85rem; }
    .ticker-change.positive { color: var(--signal-up); }
    .ticker-change.negative { color: var(--signal-down); }
    
    .control-group { display: flex; gap: 0.25rem; }
    .ctrl-btn { padding: 0.45rem 0.7rem; background: transparent; border: 1px solid var(--border); color: var(--text-muted); font-family: var(--font-body); font-size: 0.65rem; letter-spacing: 0.08em; cursor: pointer; transition: all 0.15s; }
    .ctrl-btn:hover { color: var(--text); border-color: var(--border-glow); background: var(--phosphor-ghost); }
    .ctrl-btn.active { color: var(--phosphor); border-color: var(--phosphor-dim); background: var(--phosphor-ghost); }
    .chart-tools { display: flex; gap: 1rem; align-items: center; }
    .tool-divider { width: 1px; height: 20px; background: var(--border); }
    
    .chart-container { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      padding: 1rem; 
      min-height: 0; 
      position: relative;
    }
    .chart-container::before {
      content: '';
      position: absolute;
      inset: 1rem;
      pointer-events: none;
      background:
        radial-gradient(circle at center, transparent 0%, transparent 20%, rgba(51, 255, 153, 0.02) 20.5%, transparent 21%),
        radial-gradient(circle at center, transparent 0%, transparent 40%, rgba(51, 255, 153, 0.02) 40.5%, transparent 41%),
        radial-gradient(circle at center, transparent 0%, transparent 60%, rgba(51, 255, 153, 0.02) 60.5%, transparent 61%),
        radial-gradient(circle at center, transparent 0%, transparent 80%, rgba(51, 255, 153, 0.015) 80.5%, transparent 81%);
      opacity: 0.6;
      z-index: 1;
    }
    .chart-container::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 150%;
      height: 4px;
      background: linear-gradient(90deg, transparent 0%, rgba(51, 255, 153, 0.08) 30%, rgba(255, 179, 71, 0.12) 50%, rgba(51, 255, 153, 0.08) 70%, transparent 100%);
      transform-origin: left center;
      transform: translateX(-33%) translateY(-50%);
      animation: radar-sweep 12s linear infinite;
      pointer-events: none;
      z-index: 2;
      mix-blend-mode: screen;
    }
    .price-chart-wrapper { flex: 3; position: relative; min-height: 200px; background: radial-gradient(ellipse at 50% 50%, rgba(51, 255, 153, 0.04), transparent 70%) var(--bg-panel); border: 1px solid var(--border); padding: 0.5rem; z-index: 3; }
    .macd-chart-wrapper { flex: 1; position: relative; min-height: 100px; background: var(--bg-panel); border: 1px solid var(--border); border-top: none; padding: 0.5rem; z-index: 3; }
    
    .positions-content { flex: 1; overflow-y: auto; padding: 1.25rem; }
    .positions-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
    .metric-card { 
      background: 
        radial-gradient(ellipse at 50% -30%, rgba(51, 255, 153, 0.1), transparent 70%),
        var(--bg-panel); 
      border: 1px solid var(--border); 
      padding: 1.25rem; 
      position: relative; 
    }
    .metric-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--phosphor), transparent); }
    .metric-value { font-family: var(--font-display); font-size: 1.4rem; font-weight: 600; color: var(--text-bright); margin-bottom: 0.35rem; letter-spacing: 0.05em; }
    .metric-value.positive { color: var(--signal-up); text-shadow: 0 0 20px var(--phosphor-glow); }
    .metric-label { font-size: 0.6rem; color: var(--text-dim); letter-spacing: 0.12em; text-transform: uppercase; }
    
    .card { 
      background: 
        radial-gradient(ellipse at 50% -20%, rgba(51, 255, 153, 0.06), transparent 60%),
        var(--bg-panel); 
      border: 1px solid var(--border); 
      margin-bottom: 1.25rem; 
      box-shadow: 0 0 30px rgba(0,0,0,0.3);
    }
    .card-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); background: var(--bg-card); }
    .card-label { font-size: 0.55rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--phosphor-dim); margin-bottom: 0.25rem; }
    .card-title { font-family: var(--font-display); font-size: 0.9rem; font-weight: 500; color: var(--text-bright); letter-spacing: 0.1em; text-shadow: 0 0 15px rgba(51, 255, 153, 0.2); }
    .card-body { padding: 1.25rem; }
    
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th { text-align: left; padding: 0.75rem 1rem; font-size: 0.6rem; font-weight: 500; letter-spacing: 0.12em; text-transform: uppercase; color: var(--text-dim); border-bottom: 1px solid var(--border); background: var(--bg-card); }
    .data-table td { padding: 0.85rem 1rem; font-size: 0.8rem; border-bottom: 1px solid var(--border); color: var(--text); }
    .data-table tr:hover { background: var(--phosphor-ghost); }
    
    .ticker-tag { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.3rem 0.6rem; background: var(--bg-input); border: 1px solid var(--border); font-size: 0.75rem; font-weight: 600; color: var(--text-bright); letter-spacing: 0.05em; }
    .ticker-dot { width: 6px; height: 6px; border-radius: 50%; }
    .dossier-btn {
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-size: 0.6rem;
      cursor: pointer;
      padding: 0;
      margin-right: 0.25rem;
      opacity: 0.4;
      transition: all 0.15s;
    }
    .ticker-tag:hover .dossier-btn,
    .position-row:hover .dossier-btn { opacity: 0.8; }
    .dossier-btn:hover { opacity: 1 !important; color: var(--phosphor); transform: scale(1.3); }
    .structure-tag { display: inline-block; padding: 0.25rem 0.5rem; background: var(--bg-input); border: 1px solid var(--border); font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); }
    .pnl-positive { color: var(--signal-up); }
    .pnl-negative { color: var(--signal-down); }
    
    .chart-tabs { display: flex; gap: 0.25rem; margin-bottom: 1.25rem; }
    .chart-tab { padding: 0.5rem 0.85rem; background: transparent; border: 1px solid var(--border); color: var(--text-muted); font-family: var(--font-body); font-size: 0.65rem; letter-spacing: 0.08em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; }
    .chart-tab:hover, .chart-tab.active { color: var(--phosphor); border-color: var(--phosphor-dim); background: var(--phosphor-ghost); box-shadow: 0 4px 15px rgba(51, 255, 153, 0.1); }
    .chart-panel { display: none; }
    .chart-panel.active { display: block; }
    
    .bar-chart { display: flex; flex-direction: column; gap: 0.6rem; }
    .bar-row { display: grid; grid-template-columns: 55px 1fr 70px; align-items: center; gap: 1rem; }
    .bar-ticker { font-size: 0.75rem; font-weight: 600; color: var(--text); letter-spacing: 0.05em; }
    .bar-container { height: 24px; background: var(--bg-input); border: 1px solid var(--border); overflow: hidden; }
    .bar-fill { height: 100%; display: flex; align-items: center; padding-left: 0.6rem; font-size: 0.6rem; font-weight: 600; color: var(--bg-void); background: var(--phosphor); }
    .bar-value { font-size: 0.75rem; text-align: right; color: var(--text); }
    
    .pnl-row { display: grid; grid-template-columns: 55px 1fr 80px; align-items: center; gap: 1rem; margin-bottom: 0.6rem; }
    .pnl-bar-container { height: 22px; display: flex; align-items: center; position: relative; background: var(--bg-input); border: 1px solid var(--border); }
    .pnl-center-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 1px; background: var(--border-glow); }
    .pnl-bar { position: absolute; height: calc(100% - 4px); top: 2px; display: flex; align-items: center; font-size: 0.55rem; font-weight: 600; padding: 0 0.4rem; min-width: fit-content; }
    .pnl-bar.positive { left: 50%; background: var(--signal-up); color: var(--bg-void); }
    .pnl-bar.negative { right: 50%; background: var(--signal-down); color: #fff; justify-content: flex-end; }
    .pnl-amount { font-size: 0.75rem; text-align: right; }
    .pnl-amount.positive { color: var(--signal-up); }
    .pnl-amount.negative { color: var(--signal-down); }
    
    .summary-row { display: flex; justify-content: space-around; padding: 1rem; background: var(--bg-card); border: 1px solid var(--border); margin-top: 1.25rem; }
    .summary-item { text-align: center; }
    .summary-value { font-family: var(--font-display); font-size: 1rem; font-weight: 600; color: var(--text-bright); letter-spacing: 0.05em; }
    .summary-value.positive { color: var(--signal-up); }
    .summary-value.negative { color: var(--signal-down); }
    .summary-label { font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim); margin-top: 0.25rem; }
    
    .catalyst-list { display: flex; flex-direction: column; gap: 0.5rem; }
    .catalyst-item { display: flex; align-items: center; gap: 1.25rem; padding: 1rem 1.25rem; background: var(--bg-card); border: 1px solid var(--border); transition: all 0.15s; }
    .catalyst-item:hover { border-color: var(--phosphor-dim); background: var(--phosphor-ghost); }
    .catalyst-date { font-size: 0.75rem; color: var(--text-muted); min-width: 85px; letter-spacing: 0.02em; }
    .catalyst-ticker { font-size: 0.8rem; font-weight: 600; min-width: 55px; letter-spacing: 0.05em; }
    .catalyst-event { flex: 1; font-size: 0.8rem; color: var(--text); }
    .catalyst-impact { padding: 0.3rem 0.6rem; font-size: 0.6rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; border: 1px solid; }
    .catalyst-impact.high { border-color: var(--signal-down); color: var(--signal-down); background: rgba(255, 107, 107, 0.1); }
    .catalyst-impact.medium { border-color: var(--amber); color: var(--amber); background: rgba(255, 179, 71, 0.1); }
    .catalyst-impact.low { border-color: var(--signal-up); color: var(--signal-up); background: var(--phosphor-ghost); }

    /* Enhanced Events Timeline */
    .events-timeline {
      position: relative;
      padding-left: 30px;
    }

    .events-timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--phosphor) 0%, var(--amber) 50%, var(--signal-down) 100%);
      opacity: 0.4;
    }

    .timeline-event {
      position: relative;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .timeline-event::before {
      content: '';
      position: absolute;
      left: -26px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--bg-card);
      border: 2px solid var(--phosphor);
      transition: all 0.2s ease;
    }

    .timeline-event:hover {
      border-color: var(--phosphor-dim);
      background: var(--phosphor-ghost);
      transform: translateX(4px);
    }

    .timeline-event:hover::before {
      background: var(--phosphor);
      box-shadow: 0 0 12px var(--phosphor);
    }

    .timeline-event.high-impact::before {
      border-color: var(--signal-down);
    }
    .timeline-event.high-impact:hover::before {
      background: var(--signal-down);
      box-shadow: 0 0 12px var(--signal-down);
    }

    .timeline-event.medium-impact::before {
      border-color: var(--amber);
    }
    .timeline-event.medium-impact:hover::before {
      background: var(--amber);
      box-shadow: 0 0 12px var(--amber);
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .timeline-ticker {
      font-family: var(--font-display);
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      color: var(--text-bright);
    }

    .timeline-date {
      font-size: 0.65rem;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .timeline-title {
      font-size: 0.8rem;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .timeline-meta {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .timeline-countdown {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--phosphor);
      letter-spacing: 0.1em;
    }

    /* Konami Code Easter Egg - Invader Attack */
    .invader-attack-overlay {
      position: fixed;
      inset: 0;
      z-index: 30000;
      pointer-events: none;
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .invader-attack-overlay.active {
      opacity: 1;
    }

    .attack-invader {
      position: absolute;
      width: 40px;
      height: 32px;
      fill: var(--phosphor);
      filter: drop-shadow(0 0 8px var(--phosphor)) drop-shadow(0 0 16px var(--accent-glow));
      animation: invader-descend 3s ease-in forwards;
    }

    @keyframes invader-descend {
      0% { transform: translateY(-100px); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(calc(100vh + 100px)); opacity: 0; }
    }

    .attack-flash {
      position: fixed;
      inset: 0;
      background: var(--phosphor);
      opacity: 0;
      pointer-events: none;
      z-index: 29999;
    }

    .attack-flash.flash {
      animation: screen-flash 0.15s ease-out;
    }

    @keyframes screen-flash {
      0% { opacity: 0.3; }
      100% { opacity: 0; }
    }

    /* =========================================================================
       SIGNAL INVADERS ARCADE GAME
       ========================================================================= */
    .arcade-game-overlay {
      position: fixed;
      inset: 0;
      z-index: 25000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .arcade-game-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .arcade-game-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(8px);
    }

    .arcade-game-container {
      position: relative;
      background: radial-gradient(ellipse at 50% 0%, rgba(51, 255, 153, 0.08), transparent 50%), var(--bg-void);
      border: 2px solid var(--phosphor);
      box-shadow: 
        0 0 40px var(--phosphor-glow),
        inset 0 0 60px rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      max-width: 700px;
      width: 95%;
    }

    .arcade-game-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--phosphor), transparent);
    }

    .arcade-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-mono);
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
      cursor: pointer;
      transition: all 0.15s;
      z-index: 10;
    }

    .arcade-close:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }

    .arcade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .arcade-title {
      font-family: var(--font-display);
      font-size: 1.2rem;
      letter-spacing: 0.15em;
      color: var(--phosphor);
      text-shadow: 0 0 20px var(--phosphor-glow);
    }

    .arcade-stats {
      display: flex;
      gap: 1.5rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      color: var(--text);
    }

    .arcade-stats span {
      display: flex;
      gap: 0.3rem;
    }

    #invaders-canvas {
      display: block;
      width: 100%;
      height: auto;
      background: radial-gradient(ellipse at 50% 50%, #041a22 0%, #01060a 70%);
      border: 1px solid var(--phosphor-dim);
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
      image-rendering: pixelated;
    }

    .arcade-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
      font-family: var(--font-mono);
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      color: var(--text-dim);
    }

    .arcade-message {
      text-align: center;
      margin-top: 0.75rem;
      font-family: var(--font-display);
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      color: var(--amber);
      min-height: 1.2em;
    }

    /* Scanline effect on game canvas */
    #invaders-canvas {
      position: relative;
    }

    .arcade-game-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.1) 2px,
        rgba(0, 0, 0, 0.1) 4px
      );
      pointer-events: none;
      z-index: 5;
    }

    /* Button interaction glow effects */
    .push-btn:active,
    .sim-btn:active,
    .kill-switch-btn:active {
      transform: scale(0.98);
      box-shadow: 0 0 20px var(--phosphor), inset 0 0 10px rgba(255,255,255,0.1);
    }

    .push-btn.primary:active {
      box-shadow: 0 0 25px var(--phosphor), 0 0 50px var(--phosphor-glow);
    }

    /* Interaction ripple effect */
    .ripple-container {
      position: relative;
      overflow: hidden;
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(51, 255, 153, 0.4);
      transform: scale(0);
      animation: ripple-expand 0.6s ease-out;
      pointer-events: none;
    }

    @keyframes ripple-expand {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    
    .right-sidebar { width: 260px; background: var(--bg-panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
    .kill-switch-section { padding: 1.25rem; border-bottom: 1px solid var(--border); }
    .kill-switch-btn { width: 100%; padding: 0.85rem; border: none; font-family: var(--font-body); font-size: 0.75rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; }
    .kill-switch-btn.stop { background: var(--signal-down); color: #fff; }
    .kill-switch-btn.stop:hover { filter: brightness(1.1); }
    .kill-switch-btn.resume { background: var(--signal-up); color: var(--bg-void); }
    .kill-switch-status { text-align: center; font-size: 0.65rem; letter-spacing: 0.08em; color: var(--text-muted); margin-top: 0.6rem; }
    
    .safety-list { padding: 0.5rem 0; }
    .safety-item { display: flex; justify-content: space-between; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid var(--border); }
    .safety-item:last-child { border-bottom: none; }
    .safety-label { font-size: 0.7rem; color: var(--text-muted); }
    .safety-value { font-size: 0.7rem; }
    .safety-value.ok { color: var(--signal-up); }
    .safety-value.warning { color: var(--amber); }
    
    .activity-feed { flex: 1; overflow-y: auto; padding: 0.75rem; }
    .activity-item { display: flex; gap: 0.85rem; padding: 0.75rem; border-bottom: 1px solid var(--border); transition: background 0.15s; }
    .activity-item:hover { background: var(--phosphor-ghost); }
    .activity-icon { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid var(--border); }
    .activity-icon.trade { border-color: var(--phosphor-dim); color: var(--phosphor); }
    .activity-icon.alert { border-color: var(--amber-dim); color: var(--amber); }
    .activity-icon.invader { border-color: #ff6b6b; color: #ff6b6b; }
    .activity-icon.scenario { border-color: #47d4ff; color: #47d4ff; }
    .activity-icon.bonus { border-color: var(--phosphor); color: var(--phosphor); animation: icon-pulse 1s ease-out; }
    .activity-icon svg { width: 14px; height: 14px; }
    .activity-content { flex: 1; min-width: 0; }
    .activity-title { font-size: 0.75rem; font-weight: 500; color: var(--text); }
    .activity-title.arcade { font-family: var(--font-display); letter-spacing: 0.1em; text-transform: uppercase; }
    .activity-subtitle { font-size: 0.65rem; color: var(--text-muted); margin-top: 0.15rem; }
    .activity-time { font-size: 0.55rem; color: var(--text-dim); letter-spacing: 0.05em; }
    @keyframes icon-pulse { 0% { transform: scale(1.3); opacity: 1; } 100% { transform: scale(1); opacity: 0.9; } }
    
    .watermark { position: fixed; bottom: 2.5rem; left: 1.25rem; display: flex; align-items: center; gap: 0.85rem; padding: 0.6rem 1rem; background: var(--bg-panel); border: 1px solid var(--border); font-size: 0.7rem; color: var(--text-muted); z-index: 50; }
    .watermark a { color: var(--amber); text-decoration: none; letter-spacing: 0.05em; }
    .watermark a:hover { text-shadow: 0 0 10px var(--amber-glow); }
    
    .status-strip { position: fixed; bottom: 0; left: 0; right: 0; height: 28px; background: var(--bg-panel); border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: flex-end; padding: 0 1.5rem; gap: 2rem; z-index: 100; font-size: 0.6rem; letter-spacing: 0.1em; text-transform: uppercase; }
    .status-item { display: flex; align-items: center; gap: 0.5rem; color: var(--text-dim); }
    .status-item .dot { width: 6px; height: 6px; border-radius: 50%; }
    .status-item .dot.green { background: var(--phosphor); box-shadow: 0 0 8px var(--phosphor-glow); }
    .status-item .dot.amber { background: var(--amber); box-shadow: 0 0 8px var(--amber-glow); }
    .status-item .value { color: var(--text-muted); }
    
    .data-updated { animation: data-glow 0.6s ease-out; }
    
    /* ============================================
       SPIELBERGIAN CONTROL PANEL
       ============================================ */
    @keyframes led-blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0.3; } }
    @keyframes led-pulse { 0%, 100% { opacity: 0.5; box-shadow: 0 0 3px currentColor; } 50% { opacity: 1; box-shadow: 0 0 8px currentColor, 0 0 15px currentColor; } }
    @keyframes gauge-sweep { 0% { transform: rotate(-45deg); } 100% { transform: rotate(225deg); } }
    @keyframes scanner-line { 0% { left: 5%; } 100% { left: 85%; } }
    @keyframes data-stream { 0% { background-position: 0 0; } 100% { background-position: 0 20px; } }
    
    .control-panel {
      background: 
        linear-gradient(180deg, rgba(20, 25, 35, 0.95) 0%, rgba(15, 18, 25, 0.98) 100%);
      border: 1px solid var(--border);
      border-top: 2px solid var(--phosphor-dim);
      margin: 0.75rem;
      margin-top: 0;
      padding: 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .control-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--phosphor) 50%, transparent 100%);
      opacity: 0.5;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    
    .panel-title {
      font-family: var(--font-display);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      color: var(--phosphor);
      text-shadow: 0 0 10px var(--phosphor-glow);
    }
    
    .panel-status {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    .status-led {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.55rem;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      text-transform: uppercase;
    }
    
    .led {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--phosphor);
      box-shadow: 0 0 6px var(--phosphor), 0 0 12px var(--phosphor-glow);
    }
    
    .led.amber { background: var(--amber); box-shadow: 0 0 6px var(--amber), 0 0 12px var(--amber-glow); animation: led-blink 1s infinite; }
    .led.red { background: #ff4444; box-shadow: 0 0 6px #ff4444; }
    .led.pulse { animation: led-pulse 2s ease-in-out infinite; }
    
    .control-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
    
    /* Control Module Base */
    .control-module {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 0.75rem;
      position: relative;
    }
    
    .control-module::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--phosphor-dim), transparent);
    }
    
    .module-label {
      font-size: 0.5rem;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .module-label .led { width: 4px; height: 4px; }
    
    /* Rotary Knob */
    .knob-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    
    .knob {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: 
        radial-gradient(circle at 30% 30%, #4a5060 0%, #2a2f3d 50%, #1a1d26 100%);
      border: 2px solid #3a4050;
      position: relative;
      cursor: pointer;
      box-shadow: 
        0 4px 8px rgba(0,0,0,0.5),
        inset 0 2px 4px rgba(255,255,255,0.1);
      transition: transform 0.1s;
    }
    
    .knob:hover {
      border-color: var(--phosphor-dim);
      box-shadow: 
        0 4px 8px rgba(0,0,0,0.5),
        0 0 15px var(--phosphor-ghost),
        inset 0 2px 4px rgba(255,255,255,0.1);
    }
    
    .knob::before {
      content: '';
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 12px;
      background: var(--phosphor);
      border-radius: 2px;
      box-shadow: 0 0 6px var(--phosphor);
    }
    
    .knob::after {
      content: '';
      position: absolute;
      inset: 4px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .knob-marks {
      position: absolute;
      inset: -8px;
      border-radius: 50%;
    }
    
    .knob-value {
      font-family: var(--font-display);
      font-size: 0.8rem;
      color: var(--text-bright);
      text-shadow: 0 0 10px var(--phosphor-ghost);
    }
    
    .knob-band-label {
      font-family: var(--font-body);
      font-size: 0.55rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-top: 0.25rem;
      transition: color 0.2s ease;
    }
    
    .knob-band-label.raw { color: var(--signal-down); }
    .knob-band-label.balanced { color: var(--phosphor-dim); }
    .knob-band-label.deep { color: #47d4ff; }
    
    /* Toggle Switch */
    .toggle-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.3rem 0;
    }
    
    .toggle-label {
      font-size: 0.6rem;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }
    
    .toggle-switch {
      width: 36px;
      height: 18px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 9px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .toggle-switch::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 12px;
      height: 12px;
      background: #666;
      border-radius: 50%;
      transition: all 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
    
    .toggle-switch.active {
      background: var(--phosphor-ghost);
      border-color: var(--phosphor-dim);
    }
    
    .toggle-switch.active::before {
      left: 20px;
      background: var(--phosphor);
      box-shadow: 0 0 8px var(--phosphor);
    }
    
    /* Mini Gauge */
    .gauge-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.4rem;
    }
    
    .mini-gauge {
      width: 60px;
      height: 35px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 30px 30px 0 0;
      position: relative;
      overflow: hidden;
    }
    
    .gauge-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(0deg, var(--phosphor) 0%, var(--phosphor-dim) 100%);
      transition: height 0.5s ease;
      opacity: 0.8;
    }
    
    .gauge-needle {
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 2px;
      height: 28px;
      background: #fff;
      transform-origin: bottom center;
      transform: rotate(-45deg);
      transition: transform 0.5s ease;
      box-shadow: 0 0 4px #fff;
    }
    
    .gauge-marks {
      position: absolute;
      inset: 0;
      border-bottom: 1px solid var(--border);
    }
    
    .gauge-value {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text);
    }
    
    /* Slider Control */
    .slider-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .slider-track {
      height: 6px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 3px;
      position: relative;
      cursor: pointer;
    }
    
    .slider-fill {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      background: linear-gradient(90deg, var(--phosphor) 0%, var(--amber) 100%);
      border-radius: 3px;
      transition: width 0.1s;
    }
    
    .slider-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      background: radial-gradient(circle at 30% 30%, #5a6070 0%, #3a4050 100%);
      border: 2px solid var(--phosphor-dim);
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    
    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.5rem;
      color: var(--text-dim);
      letter-spacing: 0.08em;
    }
    
    /* Scanner Display */
    .scanner-display {
      height: 40px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    
    .scanner-grid {
      position: absolute;
      inset: 0;
      background: 
        repeating-linear-gradient(0deg, transparent, transparent 9px, rgba(51, 255, 153, 0.1) 9px, rgba(51, 255, 153, 0.1) 10px),
        repeating-linear-gradient(90deg, transparent, transparent 9px, rgba(51, 255, 153, 0.1) 9px, rgba(51, 255, 153, 0.1) 10px);
    }
    
    .scanner-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--phosphor);
      box-shadow: 0 0 10px var(--phosphor), 0 0 20px var(--phosphor);
      animation: scanner-line 2s linear infinite;
    }
    
    .scanner-blips {
      position: absolute;
      inset: 0;
    }
    
    .blip {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--amber);
      border-radius: 50%;
      box-shadow: 0 0 6px var(--amber);
      animation: led-pulse 1.5s ease-in-out infinite;
    }
    
    /* LED Array */
    .led-array {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 4px;
    }
    
    .array-led {
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: #333;
      border: 1px solid #444;
    }
    
    .array-led.on { 
      background: var(--phosphor); 
      box-shadow: 0 0 6px var(--phosphor);
    }
    
    .array-led.amber { 
      background: var(--amber); 
      box-shadow: 0 0 6px var(--amber);
    }
    
    .array-led.red { 
      background: #ff4444; 
      box-shadow: 0 0 6px #ff4444;
    }
    
    /* Numeric Display */
    .numeric-display {
      background: #0a0c0f;
      border: 1px solid var(--border);
      padding: 0.4rem 0.6rem;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.25rem;
    }
    
    .display-digit {
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--phosphor);
      text-shadow: 0 0 8px var(--phosphor);
      letter-spacing: 0.05em;
    }
    
    .display-unit {
      font-size: 0.5rem;
      color: var(--text-dim);
      margin-left: 0.25rem;
    }
    
    /* Push Button */
    .push-btn {
      width: 100%;
      padding: 0.5rem;
      background: linear-gradient(180deg, #4a5060 0%, #2a2f3d 100%);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--font-body);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.1s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .push-btn:hover {
      border-color: var(--phosphor-dim);
      color: var(--phosphor);
    }
    
    .push-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    .push-btn.primary {
      background: linear-gradient(180deg, rgba(51, 255, 153, 0.3) 0%, rgba(51, 255, 153, 0.1) 100%);
      border-color: var(--phosphor-dim);
      color: var(--phosphor);
    }
    
    @media (max-width: 1000px) {
      .control-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 600px) {
      .control-grid { grid-template-columns: 1fr; }
      .control-panel { padding: 0.75rem; }
    }
    
    .dev-console { display: none; position: fixed; top: 70px; left: 50%; transform: translateX(-50%); width: 500px; max-width: 90vw; background: var(--bg-panel); border: 1px solid var(--amber-dim); z-index: 200; box-shadow: 0 0 40px rgba(255, 179, 71, 0.2); }
    .dev-console.visible { display: block; }
    .dev-console-header { padding: 0.75rem 1rem; background: var(--bg-card); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .dev-console-title { font-size: 0.65rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--amber); }
    .dev-console-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1rem; }
    .dev-console-body { padding: 1rem; max-height: 300px; overflow-y: auto; font-size: 0.7rem; line-height: 1.6; }
    .log-entry { padding: 0.4rem 0; border-bottom: 1px solid var(--border); color: var(--text-muted); }
    .log-entry .timestamp { color: var(--text-dim); margin-right: 0.75rem; }
    .log-entry .level { margin-right: 0.5rem; }
    .log-entry .level.info { color: var(--phosphor); }
    .log-entry .level.warn { color: var(--amber); }
    .log-entry .level.error { color: var(--signal-down); }
    
    /* =====================================================================
       ARCADE EXTRAS – HUD, toggles, terminal, toasts, themes
       ===================================================================== */
    
    /* Mini toggle in status bar */
    .toggle-mini {
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      margin-left: 0.35rem;
    }
    .toggle-mini input { display: none; }
    .toggle-mini-track {
      width: 32px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #11161b;
      padding: 1px;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.7);
      display: inline-flex;
      align-items: center;
    }
    .toggle-mini-knob {
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: var(--text-dim);
      transition: transform 0.18s ease, background 0.18s ease;
    }
    .toggle-mini input:checked + .toggle-mini-track .toggle-mini-knob {
      transform: translateX(16px);
      background: var(--phosphor);
    }
    
    /* Theme select in status bar */
    .theme-select {
      background: #0b1016;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 0.65rem;
      padding: 0.1rem 0.35rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .theme-select:hover { border-color: var(--phosphor-dim); }
    
    /* Arcade HUD */
    .arcade-hud {
      position: fixed;
      top: 80px;
      right: 18px;
      width: 220px;
      background: rgba(7, 11, 17, 0.95);
      border-radius: 10px;
      border: 1px solid #1e2832;
      box-shadow: 0 0 20px rgba(51,255,153,0.15);
      padding: 0.65rem 0.75rem;
      font-family: var(--font-body);
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      z-index: 15000;
      backdrop-filter: blur(8px);
    }
    .arcade-hud.hidden { display: none; }
    .arcade-hud .hud-title {
      color: var(--phosphor);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    .arcade-hud ul { list-style: none; margin: 0; padding: 0; }
    .arcade-mission {
      padding: 0.2rem 0;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .arcade-mission::before {
      content: '○';
      color: var(--text-dim);
      font-size: 0.5rem;
    }
    .arcade-mission.completed {
      text-decoration: line-through;
      opacity: 0.55;
    }
    .arcade-mission.completed::before {
      content: '●';
      color: var(--phosphor);
    }
    
    .arcade-launch-btn {
      width: 100%;
      margin-top: 0.6rem;
      padding: 0.5rem;
      background: transparent;
      border: 1px solid var(--phosphor-dim);
      color: var(--phosphor);
      font-family: var(--font-mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      transition: all 0.15s;
    }
    
    .arcade-launch-btn:hover {
      background: var(--phosphor-ghost);
      border-color: var(--phosphor);
      box-shadow: 0 0 15px var(--phosphor-glow);
    }
    
    /* Terminal-style uplink log */
    .terminal-log {
      position: fixed;
      left: 18px;
      bottom: 54px;
      width: 280px;
      height: 130px;
      background: rgba(5, 8, 12, 0.92);
      border-radius: 8px;
      border: 1px solid #182228;
      padding: 0.4rem 0.55rem;
      font-family: var(--font-body);
      font-size: 0.6rem;
      line-height: 1.4;
      color: #76a58e;
      overflow-y: auto;
      z-index: 14000;
      backdrop-filter: blur(6px);
    }
    .terminal-log-line {
      white-space: nowrap;
      padding: 0.1rem 0;
    }
    .terminal-log-line span.time {
      color: #4e6b5f;
      margin-right: 0.35rem;
    }
    
    /* Toast popups */
    .toast-container {
      position: fixed;
      right: 20px;
      bottom: 70px;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      z-index: 16000;
    }
    .toast {
      background: rgba(12, 16, 21, 0.95);
      border-radius: 8px;
      border: 1px solid rgba(51,255,153,0.4);
      padding: 0.5rem 0.75rem;
      font-family: var(--font-body);
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--phosphor);
      box-shadow: 0 0 20px rgba(51,255,153,0.25);
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      backdrop-filter: blur(8px);
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast.warn {
      border-color: var(--amber);
      color: var(--amber);
      box-shadow: 0 0 20px rgba(255,179,71,0.2);
    }
    .toast.alert {
      border-color: #ff6666;
      color: #ff8080;
      box-shadow: 0 0 20px rgba(255,102,102,0.2);
    }
    
    /* ABOUT OVERLAY */
    .about-trigger {
      position: fixed;
      bottom: 16px;
      right: 18px;
      z-index: 12000;
      font-family: var(--font-body);
      font-size: 0.65rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(5, 10, 16, 0.92);
      color: var(--text-muted);
      cursor: pointer;
      backdrop-filter: blur(6px);
      transition: all 0.2s ease;
    }
    .about-trigger:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
      box-shadow: 0 0 15px var(--phosphor-glow);
    }

    .about-overlay {
      position: fixed;
      inset: 0;
      z-index: 25000;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.26s ease;
    }
    .about-overlay.visible {
      pointer-events: auto;
      opacity: 1;
    }
    .about-overlay.hidden {
      display: none;
    }

    .about-backdrop {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 0%, rgba(0,0,0,0.3), rgba(0,0,0,0.92));
      backdrop-filter: blur(4px);
    }

    .about-panel {
      position: relative;
      width: min(620px, 92vw);
      max-height: 80vh;
      background: var(--bg-void);
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: 0 0 60px rgba(0,0,0,0.9), 0 0 40px var(--phosphor-glow);
      padding: 1.5rem 1.6rem 1.3rem;
      z-index: 1;
      overflow: hidden;
    }

    .about-panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background-image: linear-gradient(to bottom, rgba(51, 255, 153, 0.06), rgba(51, 255, 153, 0.02));
      mix-blend-mode: soft-light;
      opacity: 0.6;
      pointer-events: none;
    }

    .about-close {
      position: absolute;
      top: 0.9rem;
      right: 1rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.85rem;
      transition: color 0.2s;
    }
    .about-close:hover {
      color: var(--phosphor);
    }

    .about-header {
      position: relative;
      margin-bottom: 0.75rem;
    }

    .about-label {
      font-family: var(--font-body);
      font-size: 0.6rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.35rem;
    }

    .about-title {
      margin: 0;
      font-family: var(--font-display);
      font-size: 1.3rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--phosphor);
      text-shadow: 0 0 20px var(--phosphor-glow);
    }

    .about-body {
      position: relative;
      margin-top: 0.4rem;
      max-height: 60vh;
      overflow-y: auto;
      font-size: 0.82rem;
      line-height: 1.55;
      color: var(--text);
    }

    .about-body p {
      margin: 0.5rem 0;
    }

    .about-body ul {
      margin: 0.4rem 0 0.6rem 1.1rem;
      padding: 0;
    }
    .about-body li {
      margin: 0.25rem 0;
    }
    .about-body strong {
      color: var(--text-bright);
    }

    .about-footnote {
      margin-top: 0.8rem;
      padding-top: 0.6rem;
      border-top: 1px solid var(--border);
      font-size: 0.65rem;
      color: var(--text-dim);
      font-style: italic;
    }
    
    /* =========================================================================
       PIP-BOY TICKER DOSSIER — Retro terminal style popup
       ========================================================================= */
    .pipboy-overlay {
      position: fixed;
      inset: 0;
      z-index: 26000;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .pipboy-overlay.visible {
      pointer-events: auto;
      opacity: 1;
    }
    .pipboy-overlay.hidden {
      display: none;
    }

    .pipboy-backdrop {
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.7), rgba(0,0,0,0.95));
      backdrop-filter: blur(6px);
    }

    .pipboy-container {
      position: relative;
      width: min(800px, 95vw);
      max-height: 85vh;
      background: 
        linear-gradient(180deg, rgba(8, 12, 18, 0.98) 0%, rgba(5, 8, 12, 0.99) 100%);
      border-radius: 12px;
      border: 2px solid var(--phosphor-dim);
      box-shadow: 
        0 0 60px rgba(0,0,0,0.9),
        0 0 40px var(--phosphor-glow),
        inset 0 0 100px rgba(51, 255, 153, 0.03);
      overflow: hidden;
      z-index: 1;
    }

    /* CRT scanlines overlay */
    .pipboy-container::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.15) 2px,
        rgba(0, 0, 0, 0.15) 4px
      );
      pointer-events: none;
      z-index: 100;
    }

    /* Phosphor glow effect */
    .pipboy-container::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 50% 0%, rgba(51, 255, 153, 0.08), transparent 60%);
      pointer-events: none;
      z-index: 99;
    }

    .pipboy-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(51, 255, 153, 0.08), transparent);
    }

    .pipboy-title-block {
      flex: 1;
    }

    .pipboy-codename {
      font-family: var(--font-display);
      font-size: 0.6rem;
      letter-spacing: 0.25em;
      color: var(--text-dim);
      margin-bottom: 0.25rem;
    }

    .pipboy-ticker-name {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      margin: 0;
      text-shadow: 0 0 20px var(--phosphor-glow);
    }

    .pipboy-sector {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
      letter-spacing: 0.08em;
    }

    .pipboy-threat {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.35rem;
    }

    .pipboy-threat-label {
      font-size: 0.55rem;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    .pipboy-threat-level {
      font-family: var(--font-display);
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      padding: 0.3rem 0.6rem;
      border: 1px solid;
      border-radius: 4px;
    }
    .pipboy-threat-level.low { color: var(--phosphor); border-color: var(--phosphor-dim); background: var(--phosphor-ghost); }
    .pipboy-threat-level.moderate { color: var(--amber); border-color: var(--amber-dim); background: rgba(255, 179, 71, 0.1); }
    .pipboy-threat-level.high { color: #ff6b6b; border-color: rgba(255, 107, 107, 0.5); background: rgba(255, 107, 107, 0.1); }
    .pipboy-threat-level.extreme { color: #ff4444; border-color: #ff4444; background: rgba(255, 68, 68, 0.15); animation: pulse 1.5s ease-in-out infinite; }
    .pipboy-threat-level.chaotic { color: #b388ff; border-color: #b388ff; background: rgba(179, 136, 255, 0.1); animation: pulse 1s ease-in-out infinite; }

    .pipboy-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.75rem;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      z-index: 101;
    }
    .pipboy-close:hover {
      color: var(--phosphor);
      border-color: var(--phosphor-dim);
    }

    /* Dial Navigation */
    .pipboy-nav {
      display: flex;
      border-bottom: 1px solid var(--border);
      background: var(--bg-card);
    }

    .pipboy-dial {
      flex: 1;
      padding: 0.65rem 0.5rem;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-body);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.15s;
      position: relative;
    }
    .pipboy-dial:last-child { border-right: none; }
    .pipboy-dial:hover {
      color: var(--phosphor);
      background: var(--phosphor-ghost);
    }
    .pipboy-dial.active {
      color: var(--phosphor);
      background: rgba(51, 255, 153, 0.1);
    }
    .pipboy-dial.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--phosphor);
      box-shadow: 0 0 8px var(--phosphor);
    }

    /* Content Panels */
    .pipboy-body {
      padding: 1rem 1.25rem;
      max-height: calc(85vh - 180px);
      overflow-y: auto;
    }

    .pipboy-panel {
      display: none;
    }
    .pipboy-panel.active {
      display: block;
      animation: pipboy-fade 0.2s ease;
    }

    @keyframes pipboy-fade {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pipboy-section {
      margin-bottom: 1.25rem;
    }

    .pipboy-section-title {
      font-family: var(--font-display);
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      color: var(--phosphor);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
      padding-bottom: 0.35rem;
      border-bottom: 1px solid var(--border);
    }

    .pipboy-text {
      font-size: 0.8rem;
      line-height: 1.55;
      color: var(--text);
    }

    .pipboy-lore {
      font-size: 0.75rem;
      line-height: 1.5;
      color: var(--text-muted);
      font-style: italic;
      padding: 0.75rem;
      background: var(--bg-card);
      border-left: 2px solid var(--phosphor-dim);
      margin-top: 0.75rem;
    }

    /* Vitals Grid */
    .pipboy-vitals {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
    }

    .pipboy-vital {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 0.6rem;
      text-align: center;
    }

    .pipboy-vital-value {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--text-bright);
      margin-bottom: 0.25rem;
    }

    .pipboy-vital-label {
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      text-transform: uppercase;
    }

    /* Catalyst List */
    .pipboy-catalyst {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
    }
    .pipboy-catalyst:last-child { border-bottom: none; }

    .pipboy-catalyst-date {
      font-size: 0.7rem;
      color: var(--text-muted);
      min-width: 80px;
    }

    .pipboy-catalyst-event {
      flex: 1;
      font-size: 0.75rem;
      color: var(--text);
    }

    .pipboy-catalyst-impact {
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      padding: 0.2rem 0.5rem;
      border: 1px solid;
      text-transform: uppercase;
    }
    .pipboy-catalyst-impact.high { color: #ff6b6b; border-color: rgba(255, 107, 107, 0.5); }
    .pipboy-catalyst-impact.medium { color: var(--amber); border-color: var(--amber-dim); }
    .pipboy-catalyst-impact.low { color: var(--phosphor); border-color: var(--phosphor-dim); }

    /* Risk List */
    .pipboy-risk {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.4rem 0;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .pipboy-risk::before {
      content: '⚠';
      color: var(--amber);
      font-size: 0.65rem;
    }

    /* Stats Bar */
    .pipboy-stats-bar {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 1.25rem;
      background: var(--bg-card);
      border-top: 1px solid var(--border);
    }

    .pipboy-stat {
      text-align: center;
    }

    .pipboy-stat-value {
      font-family: var(--font-display);
      font-size: 0.9rem;
      color: var(--text-bright);
    }
    .pipboy-stat-value.positive { color: var(--phosphor); }
    .pipboy-stat-value.negative { color: #ff6b6b; }

    .pipboy-stat-label {
      font-size: 0.5rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-top: 0.15rem;
    }

    /* VACUUM TUBES CLUSTER */
    .tube-cluster {
      display: flex;
      gap: 8px;
      padding-bottom: 0.5rem;
    }

    .vacuum-tube {
      position: relative;
      width: 18px;
      height: 40px;
      border-radius: 10px 10px 4px 4px;
      background: linear-gradient(to bottom, #05080c, #020305);
      border: 1px solid #28333f;
      box-shadow: 0 0 8px rgba(0,0,0,0.7);
      overflow: hidden;
    }

    .tube-glass {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 10%, rgba(255,255,255,0.18), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.8;
    }

    .tube-filament {
      position: absolute;
      bottom: 6px;
      left: 50%;
      width: 8px;
      height: 14px;
      transform: translateX(-50%);
      background: radial-gradient(circle at 50% 30%, #ffb347, rgba(255,179,71,0.15));
      border-radius: 999px;
      box-shadow:
        0 0 6px rgba(255,179,71,0.8),
        0 0 18px rgba(255,179,71,0.6);
      animation: tube-flicker 1.4s infinite steps(2, end);
    }

    @keyframes tube-flicker {
      0% { opacity: 0.9; }
      50% { opacity: 1; }
      100% { opacity: 0.85; }
    }

    .tube-cluster.overload .tube-filament {
      animation: tube-overload 0.12s infinite steps(2, end);
      box-shadow:
        0 0 10px rgba(255,255,200,1),
        0 0 28px rgba(255,179,71,0.9);
    }

    @keyframes tube-overload {
      0% { opacity: 0.7; transform: translateX(-50%) scaleY(0.9); }
      50% { opacity: 1;   transform: translateX(-50%) scaleY(1.1); }
      100%{ opacity: 0.6; transform: translateX(-50%) scaleY(0.9); }
    }

    /* HOLOGRAPHIC SHIP PANEL */
    .holo-card {
      margin-top: 0.75rem;
    }

    .holo-body {
      position: relative;
      height: 110px;
      background: radial-gradient(circle at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.16), #05080c);
      border-radius: 10px;
      overflow: hidden;
    }

    .holo-ship {
      width: 100%;
      height: 100%;
    }

    .holo-line {
      stroke: var(--phosphor);
      stroke-width: 1.4;
      fill: transparent;
      stroke-linejoin: round;
      opacity: 0.85;
      filter: drop-shadow(0 0 6px var(--accent-glow));
    }

    .holo-scan-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--phosphor), transparent);
      opacity: 0.8;
      animation: holo-scan 2.4s linear infinite;
    }

    @keyframes holo-scan {
      0% { top: 0%; }
      100% { top: 100%; }
    }

    /* Radar sweep overlay for ship panel */
    .holo-radar-sweep {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 150%;
      height: 150%;
      transform: translate(-50%, -50%);
      background: conic-gradient(
        from 0deg,
        transparent 0deg,
        transparent 350deg,
        hsla(var(--accent-hue), 100%, 60%, 0.15) 355deg,
        hsla(var(--accent-hue), 100%, 60%, 0.4) 360deg
      );
      border-radius: 50%;
      animation: holo-radar-spin 4s linear infinite;
      pointer-events: none;
      opacity: 0.7;
      mix-blend-mode: screen;
    }

    @keyframes holo-radar-spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .holo-grid-overlay {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(0deg, hsla(var(--accent-hue), 100%, 60%, 0.04) 1px, transparent 1px),
        linear-gradient(90deg, hsla(var(--accent-hue), 100%, 60%, 0.04) 1px, transparent 1px);
      background-size: 10px 10px;
      pointer-events: none;
    }

    .holo-body::before {
      content: '';
      position: absolute;
      inset: 0;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.2);
      border-radius: 10px;
      pointer-events: none;
    }

    /* Enhanced target lock animation for active tickers */
    .holo-target-lock {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 40px;
      height: 40px;
      border: 1px solid var(--phosphor);
      transform: translate(-50%, -50%);
      opacity: 0.5;
      animation: target-lock-pulse 2s ease-in-out infinite;
    }

    .holo-target-lock::before,
    .holo-target-lock::after {
      content: '';
      position: absolute;
      background: var(--phosphor);
    }

    .holo-target-lock::before {
      width: 8px;
      height: 1px;
      top: 50%;
      left: -4px;
      transform: translateY(-50%);
      box-shadow: 36px 0 0 var(--phosphor);
    }

    .holo-target-lock::after {
      width: 1px;
      height: 8px;
      left: 50%;
      top: -4px;
      transform: translateX(-50%);
      box-shadow: 0 36px 0 var(--phosphor);
    }

    @keyframes target-lock-pulse {
      0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
    }

    /* =========================================================================
       CLOSE ENCOUNTERS SIGNAL BOARD
       ========================================================================= */
    #encounters-console {
      margin-top: 1rem;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.15);
      background: radial-gradient(circle at center, hsla(var(--accent-hue), 100%, 60%, 0.05), transparent 70%);
    }

    .console-title {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.25em;
      color: var(--phosphor);
      text-align: center;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .encounters-board {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .board-row {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .enc-light {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      background: hsla(var(--accent-hue), 100%, 60%, 0.12);
      box-shadow: 0 0 4px hsla(var(--accent-hue), 100%, 60%, 0.4);
      transition: background 0.12s, transform 0.12s, box-shadow 0.12s;
    }

    .enc-light.active {
      background: var(--phosphor);
      transform: scale(1.5);
      box-shadow:
        0 0 8px var(--phosphor),
        0 0 16px var(--accent-glow),
        inset 0 0 4px hsla(var(--accent-hue), 80%, 85%, 0.8);
    }

    .signal-status {
      margin-top: 12px;
      text-align: center;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      letter-spacing: 0.25em;
      color: var(--phosphor);
      text-transform: uppercase;
    }

    .signal-status.noise {
      color: #ff6b6b;
    }

    .signal-status.locked {
      color: var(--phosphor);
      text-shadow: 0 0 10px var(--accent-glow);
      animation: status-pulse 0.8s ease-in-out infinite;
    }

    @keyframes status-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* =========================================================================
       CARGO BAY MANIFEST
       ========================================================================= */
    .cargo-bay {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      padding: 12px;
      margin-bottom: 1rem;
      background: radial-gradient(ellipse at 50% 0%, hsla(var(--accent-hue), 100%, 60%, 0.05), transparent 60%);
      border: 1px solid var(--border);
      border-radius: 10px;
    }

    .cargo-item {
      text-align: center;
      border-radius: 8px;
      padding: 10px 8px;
      background: linear-gradient(180deg, #0a0f14, #050810);
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.15);
      transition: all 0.2s;
    }

    .cargo-item:hover {
      border-color: var(--phosphor-dim);
      transform: translateY(-2px);
    }

    .cargo-icon {
      width: 36px;
      height: 28px;
      margin: 0 auto 6px;
      border: 1px solid var(--phosphor-dim);
      border-radius: 4px;
      background: linear-gradient(180deg, hsla(var(--accent-hue), 100%, 60%, 0.1), transparent);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cargo-icon svg {
      width: 20px;
      height: 16px;
      fill: var(--phosphor);
      opacity: 0.8;
    }

    .cargo-name {
      font-family: var(--font-mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .cargo-ticker {
      font-family: var(--font-display);
      font-size: 0.7rem;
      color: var(--phosphor);
      margin-bottom: 4px;
    }

    .cargo-health {
      font-family: var(--font-mono);
      font-size: 0.55rem;
      letter-spacing: 0.12em;
      padding: 2px 6px;
      border-radius: 3px;
      background: hsla(var(--accent-hue), 100%, 60%, 0.1);
      color: var(--phosphor);
      display: inline-block;
    }

    .cargo-item.damaged {
      border-color: rgba(255, 107, 107, 0.4);
    }

    .cargo-item.damaged .cargo-icon {
      border-color: rgba(255, 107, 107, 0.5);
    }

    .cargo-item.damaged .cargo-icon svg {
      fill: #ff6b6b;
    }

    .cargo-item.damaged .cargo-health {
      background: rgba(255, 107, 107, 0.15);
      color: #ff6b6b;
    }

    .cargo-item.optimal {
      border-color: hsla(var(--accent-hue), 100%, 60%, 0.4);
      box-shadow: 0 0 15px hsla(var(--accent-hue), 100%, 60%, 0.1);
    }

    .cargo-item.optimal .cargo-health {
      background: hsla(var(--accent-hue), 100%, 60%, 0.2);
    }

    /* =========================================================================
       TRAJECTORY NAVIGATOR (Derivatives)
       ========================================================================= */
    .trajectory-section {
      margin-bottom: 1rem;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: radial-gradient(ellipse at 50% 100%, hsla(var(--accent-hue), 100%, 60%, 0.05), transparent 50%);
    }

    .trajectory-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .trajectory-title {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .trajectory-legend {
      display: flex;
      gap: 12px;
      font-size: 0.6rem;
      color: var(--text-dim);
    }

    .trajectory-legend span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .trajectory-legend .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .trajectory-legend .dot.bullish { background: var(--phosphor); }
    .trajectory-legend .dot.neutral { background: var(--amber); }
    .trajectory-legend .dot.bearish { background: #ff6b6b; }

    #trajectory-canvas {
      width: 100%;
      height: 140px;
      background: radial-gradient(ellipse at 50% 50%, #020509, #000);
      border-radius: 8px;
      border: 1px solid hsla(var(--accent-hue), 100%, 60%, 0.2);
    }

    .trajectory-readout {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
    }

    .trajectory-stat {
      text-align: center;
    }

    .trajectory-stat-value {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--phosphor);
    }

    .trajectory-stat-label {
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      text-transform: uppercase;
      margin-top: 2px;
    }

    /* =========================================================================
       AMBIENT PANEL FLICKER
       ========================================================================= */
    @keyframes panel-flicker {
      0%, 100% { opacity: 1; }
      92% { opacity: 1; }
      93% { opacity: 0.8; }
      94% { opacity: 1; }
      96% { opacity: 0.9; }
      97% { opacity: 1; }
    }

    .card-header,
    .panel-header {
      animation: panel-flicker 8s linear infinite;
    }

    /* =========================================================================
       AMBIENT PARTICLES (subtle background life)
       ========================================================================= */
    .ambient-particles {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--phosphor);
      border-radius: 50%;
      opacity: 0.3;
      animation: float-up 15s linear infinite;
    }

    @keyframes float-up {
      0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 0.3;
      }
      90% {
        opacity: 0.3;
      }
      100% {
        transform: translateY(-10vh) translateX(20px);
        opacity: 0;
      }
    }

    /* COLOR PROFILE CONTROL */
    .color-profile-control {
      margin-top: 0.4rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 0.5rem 0;
      border-top: 1px solid var(--border);
    }

    .color-label {
      margin-bottom: 0.35rem;
    }

    .color-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    #color-hue-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg,
        hsl(90,100%,60%),
        hsl(140,100%,60%),
        hsl(190,100%,60%),
        hsl(220,100%,60%)
      );
      outline: none;
    }
    #color-hue-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #0b0f14;
      border: 2px solid var(--phosphor);
      box-shadow: 0 0 8px var(--accent-glow);
      cursor: pointer;
    }
    #color-hue-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #0b0f14;
      border: 2px solid var(--phosphor);
      box-shadow: 0 0 8px var(--accent-glow);
      cursor: pointer;
    }

    .color-preview {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid var(--border);
      box-shadow: 0 0 12px var(--accent-glow);
      background: var(--phosphor);
    }

    .color-preset-row {
      margin-top: 0.3rem;
      display: flex;
      gap: 0.25rem;
    }
    .color-preset-row button {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #050a10;
      color: var(--text-soft);
      font-family: var(--font-mono);
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.2rem 0.3rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .color-preset-row button:hover {
      border-color: var(--phosphor);
      color: var(--phosphor);
    }
    .color-preset-row button.active {
      border-color: var(--phosphor);
      color: var(--phosphor);
      background: hsla(var(--accent-hue), 100%, 60%, 0.1);
    }

    /* Mobile responsive */
    @media (max-width: 600px) {
      .pipboy-vitals { grid-template-columns: repeat(2, 1fr); }
      .pipboy-dial { font-size: 0.5rem; padding: 0.5rem 0.25rem; }
      .pipboy-ticker-name { font-size: 1.1rem; }
    }
    
    @media (max-width: 1200px) { .right-sidebar { display: none; } }
    @media (max-width: 900px) { .sidebar { width: 240px; } .positions-grid { grid-template-columns: repeat(2, 1fr); } .arcade-hud { display: none; } }
    @media (max-width: 768px) { .sidebar { display: none; } .positions-grid { grid-template-columns: 1fr 1fr; } .nav-tab { padding: 0.4rem 0.6rem; font-size: 0.6rem; } .terminal-log { display: none; } }
  </style>
</head>
<body>
  <div class="scan-line"></div>
  <div class="grid-bg"></div>
  <div class="ambient-particles" id="ambient-particles"></div>
  
  <!-- LOADING SCREEN -->
  <div class="loading-screen" id="loading-screen">
    <!-- Background marching army -->
    <div class="invader-army" id="invader-army" aria-hidden="true">
      <!-- Rows will be filled via JS -->
    </div>
    
    <div class="stars"></div>
    <div class="horizon"></div>
    
    <div class="loading-inner">
      <div class="launch-scene">
        <!-- Pixel Invader Scene -->
        <div class="pixel-invader-scene">
          <!-- Background fleet -->
          <div class="invader-fleet">
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
            <svg class="fleet-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
              <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
              <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
              <rect x="2" y="2" width="7" height="1"/>
              <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
              <rect x="0" y="4" width="11" height="1"/>
              <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
              <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
              <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
            </svg>
          </div>
          
          <!-- Main invader sprite (classic Space Invaders crab) -->
          <svg class="pixel-invader" viewBox="0 0 11 8" fill="var(--phosphor)">
            <!-- Row 0 - antennae -->
            <rect x="2" y="0" width="1" height="1"/>
            <rect x="8" y="0" width="1" height="1"/>
            <!-- Row 1 -->
            <rect x="3" y="1" width="1" height="1"/>
            <rect x="7" y="1" width="1" height="1"/>
            <!-- Row 2 - top of head -->
            <rect x="2" y="2" width="7" height="1"/>
            <!-- Row 3 - eyes row -->
            <rect x="1" y="3" width="2" height="1"/>
            <rect x="4" y="3" width="3" height="1"/>
            <rect x="8" y="3" width="2" height="1"/>
            <!-- Row 4 - full body -->
            <rect x="0" y="4" width="11" height="1"/>
            <!-- Row 5 - body with gaps -->
            <rect x="0" y="5" width="1" height="1"/>
            <rect x="2" y="5" width="7" height="1"/>
            <rect x="10" y="5" width="1" height="1"/>
            <!-- Row 6 - legs upper -->
            <rect x="0" y="6" width="1" height="1"/>
            <rect x="2" y="6" width="1" height="1"/>
            <rect x="8" y="6" width="1" height="1"/>
            <rect x="10" y="6" width="1" height="1"/>
            <!-- Row 7 - feet -->
            <rect x="3" y="7" width="2" height="1"/>
            <rect x="6" y="7" width="2" height="1"/>
          </svg>
          
          <!-- Pixel beam -->
          <div class="pixel-beam" id="pixel-beam"></div>
          
          <!-- Ground reflection -->
          <div class="pixel-ground" id="pixel-ground"></div>
        </div>
      </div>
      <div class="loading-content">
        <div class="loading-brand">HASLUN-BOT</div>
        <div class="loading-sub">Pilot's Cockpit</div>
        <div class="countdown" id="countdown">3</div>
        <div class="loading-status" id="loading-status">ESTABLISHING UPLINK...</div>
      </div>
    </div>
  </div>
  
  <!-- APP -->
  <div class="app" id="app">
    <header class="header">
      <div class="header-left">
        <div class="logo" onclick="toggleDevConsole()" style="cursor: pointer;" title="Click for systems log">
          <div class="logo-mark">
            <svg viewBox="0 0 32 32" fill="none">
              <circle cx="16" cy="16" r="14" stroke="var(--phosphor)" stroke-width="1.5" opacity="0.4"/>
              <circle cx="16" cy="16" r="10" stroke="var(--phosphor)" stroke-width="1" opacity="0.6"/>
              <circle cx="16" cy="16" r="6" stroke="var(--phosphor)" stroke-width="1.5"/>
              <circle cx="16" cy="16" r="2" fill="var(--amber)"/>
              <line x1="16" y1="2" x2="16" y2="6" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
              <line x1="16" y1="26" x2="16" y2="30" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
              <line x1="2" y1="16" x2="6" y2="16" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
              <line x1="26" y1="16" x2="30" y2="16" stroke="var(--phosphor)" stroke-width="1" opacity="0.5"/>
            </svg>
          </div>
          <div>
            <div class="logo-text">HASLUN-BOT</div>
            <div class="logo-sub">PILOT'S COCKPIT</div>
          </div>
        </div>
        <nav class="nav-tabs">
          <button class="nav-tab active" data-tab="chart" onclick="switchTab('chart')">TELEMETRY</button>
          <button class="nav-tab" data-tab="positions" onclick="switchTab('positions')">HOLDINGS</button>
          <button class="nav-tab" data-tab="options" data-glossary-id="derivatives_tab" onclick="switchTab('options')">DERIVATIVES</button>
          <button class="nav-tab" data-tab="catalysts" onclick="switchTab('catalysts')">EVENTS</button>
        </nav>
      </div>
      <div class="header-right">
        <span class="demo-badge" data-glossary-id="mode_simulation">SIMULATION</span>
        <div class="status-indicator" data-glossary-id="status_mkt_closed">
          <span class="status-dot"></span>
          <span class="status-text">Market Closed</span>
        </div>
        <span class="time-display" id="time-display">--<span class="blink">:</span>--</span>
      </div>
    </header>
    
    <main class="main">
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">Portfolio Status</div>
          <div class="stats-grid">
            <div class="stat-box highlight" data-glossary-id="today_pnl"><div class="stat-label">Today P&L</div><div class="stat-value positive">+$1,172</div></div>
            <div class="stat-box" data-glossary-id="total_pnl"><div class="stat-label">Total P&L</div><div class="stat-value positive">+$34,015</div></div>
            <div class="stat-box" data-glossary-id="positions_count"><div class="stat-label">Positions</div><div class="stat-value">10</div></div>
            <div class="stat-box" data-glossary-id="win_rate"><div class="stat-label">Win Rate</div><div class="stat-value positive">90%</div></div>
          </div>
          <div class="portfolio-mood" id="portfolio-mood">
            <span class="mood-label">STEADY CLIMB</span>
            <span class="mood-copy">Green enough to feel smug, not enough to tweet about.</span>
          </div>
        </div>
        <div class="sidebar-section">
          <div class="sidebar-title" data-glossary-id="macd">MACD Signal</div>
          <div class="macd-display">
            <div class="macd-row"><span class="macd-label" data-glossary-id="macd">MACD</span><span class="macd-value positive" id="macd-val">0.3642</span></div>
            <div class="macd-row"><span class="macd-label" data-glossary-id="macd_signal">Signal</span><span class="macd-value" id="signal-val">0.2570</span></div>
            <div class="macd-row"><span class="macd-label" data-glossary-id="macd_histogram">Histogram</span><span class="macd-value positive" id="hist-val">0.1073</span></div>
          </div>
          <div class="macd-status" id="macd-status">
            <span class="macd-status-label">Momentum quiet</span>
            <span class="macd-status-copy">Coasting on inertia.</span>
          </div>
        </div>
        <div class="sidebar-section" id="trend-card">
          <div class="sidebar-title">Trend Status</div>
          <div class="trend-display">
            <div class="trend-status-badge" id="trend-status-badge">
              <span class="trend-icon" id="trend-icon">◈</span>
              <span class="trend-label" id="trend-status-label">ANALYZING...</span>
            </div>
            <div class="trend-detail" id="trend-status-detail">Awaiting data...</div>
            <div class="trend-metrics">
              <div class="trend-metric"><span class="trend-metric-label">MA-100</span><span class="trend-metric-value" id="ma100-val">--</span></div>
              <div class="trend-metric"><span class="trend-metric-label">MA-150</span><span class="trend-metric-value" id="ma150-val">--</span></div>
              <div class="trend-metric"><span class="trend-metric-label">MA-200</span><span class="trend-metric-value" id="ma200-val">--</span></div>
            </div>
          </div>
        </div>
        
        <!-- HOLOGRAPHIC SHIP PANEL -->
        <div class="sidebar-section holo-card">
          <div class="sidebar-title">
            <span>// SHIP PROFILE</span>
            <span id="holo-ticker-label" style="font-size: 0.6rem; color: var(--text-muted); margin-left: 0.5rem;">RKLB · ORBITAL</span>
          </div>
          <div class="holo-body">
            <div class="holo-grid-overlay"></div>
            <div class="holo-radar-sweep"></div>
            <svg id="holo-ship-svg" class="holo-ship" viewBox="0 0 100 60" aria-hidden="true">
              <!-- default wireframe -->
              <polyline points="10,30 30,10 70,10 90,30 70,50 30,50 10,30" class="holo-line"/>
              <polyline points="30,10 40,5 60,5 70,10" class="holo-line"/>
              <line x1="25" y1="30" x2="75" y2="30" class="holo-line"/>
              <line x1="40" y1="50" x2="40" y2="55" class="holo-line"/>
              <line x1="60" y1="50" x2="60" y2="55" class="holo-line"/>
            </svg>
            <div class="holo-target-lock"></div>
            <div class="holo-scan-line"></div>
          </div>
        </div>
        <div class="sidebar-section" style="padding-bottom: 0.5rem;"><div class="sidebar-title">Tracking</div></div>
        <div class="watchlist" id="watchlist"></div>
      </aside>
      
      <div class="content">
        <div class="tab-panel active" id="chart-panel">
          <div class="chart-header">
            <div class="chart-header-left">
              <div class="ticker-display">
                <span class="ticker-symbol" id="chart-ticker">RKLB</span>
                <span class="ticker-price" id="chart-price">$72.43</span>
                <span class="ticker-change positive" id="chart-change">+2.16%</span>
                <span class="volume-badge" id="volume-status">LOADING</span>
              </div>
              <div class="control-group">
                <button class="ctrl-btn active" data-tf="1D" onclick="setTimeframe('1D')">1D</button>
                <button class="ctrl-btn" data-tf="45" onclick="setTimeframe('45')">45M</button>
              </div>
            </div>
            <div class="chart-tools">
              <button class="ctrl-btn active" id="ma-toggle" onclick="toggleMA()">MA</button>
              <div class="tool-divider"></div>
              <div class="control-group">
                <button class="ctrl-btn" data-range="1W" onclick="setRange('1W')">1W</button>
                <button class="ctrl-btn" data-range="1M" onclick="setRange('1M')">1M</button>
                <button class="ctrl-btn active" data-range="3M" onclick="setRange('3M')">3M</button>
                <button class="ctrl-btn" data-range="6M" onclick="setRange('6M')">6M</button>
                <button class="ctrl-btn" data-range="1Y" onclick="setRange('1Y')">1Y</button>
                <button class="ctrl-btn" data-range="ALL" onclick="setRange('ALL')">ALL</button>
              </div>
            </div>
          </div>
          <div class="chart-container">
            <div class="price-chart-wrapper"><canvas id="price-chart"></canvas></div>
            <div class="macd-chart-wrapper"><canvas id="macd-chart"></canvas></div>
          </div>
          
          <!-- SPIELBERGIAN CONTROL PANEL -->
          <div class="control-panel">
            <div class="panel-header">
              <div class="tube-cluster" id="tube-cluster">
                <div class="vacuum-tube">
                  <div class="tube-glass"></div>
                  <div class="tube-filament"></div>
                </div>
                <div class="vacuum-tube">
                  <div class="tube-glass"></div>
                  <div class="tube-filament"></div>
                </div>
                <div class="vacuum-tube">
                  <div class="tube-glass"></div>
                  <div class="tube-filament"></div>
                </div>
              </div>
              <div class="panel-title">▸ SIGNAL PROCESSING ARRAY</div>
              <div class="panel-status">
                <div class="status-led"><div class="led pulse"></div> SYNC</div>
                <div class="status-led"><div class="led amber"></div> DATA</div>
                <div class="status-led"><div class="led"></div> LINK</div>
              </div>
            </div>
            
            <div class="control-grid">
              <!-- Smoothing Knob -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_smoothing"><div class="led pulse"></div> Signal Smoothing</div>
                <div class="knob-container">
                  <div class="knob" id="knob-smoothing" data-value="50" onclick="cycleKnob('smoothing')">
                    <div class="knob-marks"></div>
                  </div>
                  <div class="knob-value" id="smoothing-value">50%</div>
                  <div class="knob-band-label" id="smoothing-band-label">BALANCED</div>
                </div>
              </div>
              
              <!-- Forecast Range Knob -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_forecast_range"><div class="led amber"></div> Forecast Range</div>
                <div class="knob-container">
                  <div class="knob" id="knob-forecast" data-value="30" onclick="cycleKnob('forecast')">
                    <div class="knob-marks"></div>
                  </div>
                  <div class="knob-value" id="forecast-value">30 DAYS</div>
                </div>
              </div>
              
              <!-- Risk Profile Gauge -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_risk_exposure"><div class="led"></div> Risk Exposure</div>
                <div class="gauge-container">
                  <div class="mini-gauge">
                    <div class="gauge-fill" id="risk-fill" style="height: 60%;"></div>
                    <div class="gauge-needle" id="risk-needle" style="transform: rotate(65deg);"></div>
                    <div class="gauge-marks"></div>
                  </div>
                  <div class="gauge-value" id="risk-value">MODERATE</div>
                </div>
              </div>
              
              <!-- Volatility Display -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_vol_index"><div class="led pulse amber"></div> Volatility Index</div>
                <div class="numeric-display">
                  <span class="display-digit" id="vol-display">24.7</span>
                  <span class="display-unit">σ</span>
                </div>
                <div class="led-array" style="margin-top: 0.5rem;">
                  <div class="array-led on"></div>
                  <div class="array-led on"></div>
                  <div class="array-led on"></div>
                  <div class="array-led on"></div>
                  <div class="array-led amber"></div>
                  <div class="array-led"></div>
                  <div class="array-led"></div>
                  <div class="array-led"></div>
                </div>
              </div>
              
              <!-- Toggle Switches -->
              <div class="control-module">
                <div class="module-label"><div class="led"></div> Display Filters</div>
                <div class="toggle-container">
                  <div class="toggle-row">
                    <span class="toggle-label" data-glossary-id="sig_display_momentum">Momentum Overlay</span>
                    <div class="toggle-switch active" id="toggle-momentum" onclick="toggleSwitch('momentum')"></div>
                  </div>
                  <div class="toggle-row">
                    <span class="toggle-label" data-glossary-id="sig_display_heatmap">Volume Heatmap</span>
                    <div class="toggle-switch" id="toggle-heatmap" onclick="toggleSwitch('heatmap')"></div>
                  </div>
                  <div class="toggle-row">
                    <span class="toggle-label" data-glossary-id="sig_display_alerts">Alert Markers</span>
                    <div class="toggle-switch active" id="toggle-alerts" onclick="toggleSwitch('alerts')"></div>
                  </div>
                </div>
              </div>
              
              <!-- Sensitivity Slider -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_alert_sensitivity"><div class="led amber"></div> Alert Sensitivity</div>
                <div class="slider-container">
                  <div class="slider-track" id="sensitivity-track" onclick="handleSliderClick(event, 'sensitivity')">
                    <div class="slider-fill" id="sensitivity-fill" style="width: 65%;"></div>
                    <div class="slider-thumb" id="sensitivity-thumb" style="left: 65%;"></div>
                  </div>
                  <div class="slider-labels">
                    <span>LOW</span>
                    <span>MED</span>
                    <span>HIGH</span>
                  </div>
                </div>
              </div>
              
              <!-- Scanner Display -->
              <div class="control-module">
                <div class="module-label" data-glossary-id="sig_market_scanner"><div class="led pulse"></div> Market Scanner</div>
                <div class="scanner-display">
                  <div class="scanner-grid"></div>
                  <div class="scanner-line"></div>
                  <div class="scanner-blips">
                    <div class="blip" style="top: 25%; left: 20%;"></div>
                    <div class="blip" style="top: 60%; left: 45%;"></div>
                    <div class="blip" style="top: 35%; left: 70%;"></div>
                  </div>
                </div>
              </div>
              
              <!-- Action Buttons -->
              <div class="control-module">
                <div class="module-label"><div class="led"></div> Quick Actions</div>
                <div style="display: flex; flex-direction: column; gap: 0.4rem;">
                  <button class="push-btn primary" id="run-analysis-btn" onclick="runAnalysis(event)">▸ RUN ANALYSIS</button>
                  <button class="push-btn" onclick="resetControls()">↺ RESET DEFAULTS</button>
                </div>
              </div>
            </div>
            
            <!-- CLOSE ENCOUNTERS SIGNAL BOARD -->
            <div id="encounters-console">
              <div class="console-title">👽 ENCOUNTERS SIGNAL ARRAY</div>
              <div class="encounters-board">
                <div class="board-row">
                  <div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div>
                </div>
                <div class="board-row">
                  <div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div>
                </div>
                <div class="board-row">
                  <div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div><div class="enc-light"></div>
                </div>
              </div>
              <div class="signal-status" id="signal-status">LISTENING…</div>
            </div>
          </div>
        </div>
        
        <div class="tab-panel" id="positions-panel">
          <div class="positions-content">
            <div class="positions-grid">
              <div class="metric-card"><div class="metric-value positive">+$1,172</div><div class="metric-label">Today's P&L</div></div>
              <div class="metric-card"><div class="metric-value">3</div><div class="metric-label">Trades Today</div></div>
              <div class="metric-card"><div class="metric-value">$17,536</div><div class="metric-label">Market Value</div></div>
              <div class="metric-card"><div class="metric-value">10</div><div class="metric-label">Open Positions</div></div>
            </div>
            <div class="card">
              <div class="card-header"><div><div class="card-label">// Active</div><div class="card-title">Stock Positions</div></div></div>
              <div class="card-body">
                <!-- CARGO BAY MANIFEST -->
                <div class="cargo-bay" id="cargo-bay">
                  <div class="cargo-item" data-ticker="RKLB">
                    <div class="cargo-icon">
                      <svg viewBox="0 0 20 16"><path d="M10 0L18 6V14L10 16L2 14V6L10 0Z M10 4L14 6.5V11L10 12.5L6 11V6.5L10 4Z"/></svg>
                    </div>
                    <div class="cargo-ticker">RKLB</div>
                    <div class="cargo-name">NAV THRUSTERS</div>
                    <div class="cargo-health">OPTIMAL</div>
                  </div>
                  <div class="cargo-item" data-ticker="LUNR">
                    <div class="cargo-icon">
                      <svg viewBox="0 0 20 16"><rect x="2" y="6" width="16" height="4" rx="1"/><rect x="0" y="4" width="4" height="8" rx="1"/><rect x="16" y="4" width="4" height="8" rx="1"/></svg>
                    </div>
                    <div class="cargo-ticker">LUNR</div>
                    <div class="cargo-name">SOLAR ARRAY</div>
                    <div class="cargo-health">OPTIMAL</div>
                  </div>
                  <div class="cargo-item" data-ticker="JOBY">
                    <div class="cargo-icon">
                      <svg viewBox="0 0 20 16"><ellipse cx="10" cy="8" rx="8" ry="4"/><circle cx="4" cy="4" r="2"/><circle cx="16" cy="4" r="2"/></svg>
                    </div>
                    <div class="cargo-ticker">JOBY</div>
                    <div class="cargo-name">EVTOL DECK</div>
                    <div class="cargo-health">OPTIMAL</div>
                  </div>
                  <div class="cargo-item" data-ticker="ASTS">
                    <div class="cargo-icon">
                      <svg viewBox="0 0 20 16"><rect x="6" y="4" width="8" height="8" rx="1"/><line x1="2" y1="8" x2="6" y2="8" stroke="currentColor" stroke-width="1.5"/><line x1="14" y1="8" x2="18" y2="8" stroke="currentColor" stroke-width="1.5"/></svg>
                    </div>
                    <div class="cargo-ticker">ASTS</div>
                    <div class="cargo-name">COMMS RELAY</div>
                    <div class="cargo-health">OPTIMAL</div>
                  </div>
                  <div class="cargo-item" data-ticker="ACHR">
                    <div class="cargo-icon">
                      <svg viewBox="0 0 20 16"><polygon points="10,2 16,8 10,14 4,8"/><circle cx="10" cy="8" r="2"/></svg>
                    </div>
                    <div class="cargo-ticker">ACHR</div>
                    <div class="cargo-name">LIFT JETS</div>
                    <div class="cargo-health">OPTIMAL</div>
                  </div>
                  <div class="cargo-item" data-ticker="EVEX">
                    <div class="cargo-icon">
                      <svg viewBox="0 0 20 16"><rect x="4" y="2" width="12" height="12" rx="2"/><circle cx="10" cy="8" r="3"/></svg>
                    </div>
                    <div class="cargo-ticker">EVEX</div>
                    <div class="cargo-name">SUPPORT DRONE</div>
                    <div class="cargo-health">FAULT</div>
                  </div>
                </div>
                <table class="data-table"><thead><tr><th>Ticker</th><th>Sector</th><th>Shares</th><th>Entry</th><th>Current</th><th>Value</th><th>P&L</th></tr></thead><tbody id="stock-tbody"></tbody></table>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-panel" id="options-panel">
          <div class="positions-content">
            <div class="positions-grid">
              <div class="metric-card" data-glossary-id="portfolio_value"><div class="metric-value">$39,315</div><div class="metric-label">Portfolio Value</div></div>
              <div class="metric-card" data-glossary-id="total_pnl"><div class="metric-value positive">+$34,015</div><div class="metric-label">Total P&L</div></div>
              <div class="metric-card" data-glossary-id="total_delta"><div class="metric-value">23.55</div><div class="metric-label">Total Delta</div></div>
              <div class="metric-card" data-glossary-id="days_to_expiry"><div class="metric-value">12</div><div class="metric-label">Days to Expiry</div></div>
            </div>
            <div class="card">
              <div class="card-header"><div><div class="card-label">// Analytics</div><div class="card-title">Portfolio Insights</div></div></div>
              <div class="card-body">
                <div class="chart-tabs">
                  <button class="chart-tab active" data-chart="sizes" onclick="switchChartTab('sizes')">Position Sizes</button>
                  <button class="chart-tab" data-chart="pnl" onclick="switchChartTab('pnl')">P&L Distribution</button>
                </div>
                <div class="chart-panel active" id="chart-sizes"></div>
                <div class="chart-panel" id="chart-pnl"></div>
              </div>
            </div>
            <div class="card">
              <div class="card-header"><div><div class="card-label">// LEAPs & Spreads</div><div class="card-title">Options Positions</div></div></div>
              <div class="card-body">
                <!-- TRAJECTORY NAVIGATOR -->
                <div class="trajectory-section">
                  <div class="trajectory-header">
                    <div class="trajectory-title">🛰 NAVIGATION PATH SIMULATOR</div>
                    <div class="trajectory-legend">
                      <span><div class="dot bullish"></div> Bullish</span>
                      <span><div class="dot neutral"></div> Neutral</span>
                      <span><div class="dot bearish"></div> Risk</span>
                    </div>
                  </div>
                  <canvas id="trajectory-canvas"></canvas>
                  <div class="trajectory-readout">
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-delta">23.55</div>
                      <div class="trajectory-stat-label">Net Delta</div>
                    </div>
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-theta">-12.40</div>
                      <div class="trajectory-stat-label">Daily Theta</div>
                    </div>
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-risk">MODERATE</div>
                      <div class="trajectory-stat-label">Risk Level</div>
                    </div>
                    <div class="trajectory-stat">
                      <div class="trajectory-stat-value" id="traj-horizon">45D</div>
                      <div class="trajectory-stat-label">Horizon</div>
                    </div>
                  </div>
                </div>
                <table class="data-table"><thead><tr><th>Ticker</th><th>Structure</th><th>Strikes</th><th>Entry</th><th>Current</th><th>P&L</th><th>Delta</th></tr></thead><tbody id="options-tbody"></tbody></table>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-panel" id="catalysts-panel">
          <div class="positions-content">
            <div class="card">
              <div class="card-header"><div><div class="card-label">// Upcoming</div><div class="card-title">Market Catalysts</div></div></div>
              <div class="card-body"><div class="catalyst-list" id="catalyst-list"></div></div>
            </div>
          </div>
        </div>
      </div>
      
      <aside class="right-sidebar">
        <div class="kill-switch-section">
          <div class="sidebar-title">Emergency Control</div>
          <button class="kill-switch-btn stop" data-glossary-id="abort_all_trades" onclick="toggleKillSwitch()">ABORT ALL TRADES</button>
          <div class="kill-switch-status">System operational</div>
        </div>
        <div class="sidebar-section">
          <div class="sidebar-title">Risk Parameters</div>
          <div class="safety-list">
            <div class="safety-item"><span class="safety-label">Daily Loss Limit</span><span class="safety-value ok">$200 remaining</span></div>
            <div class="safety-item"><span class="safety-label">Trades Remaining</span><span class="safety-value">2 of 5</span></div>
            <div class="safety-item"><span class="safety-label">Market Status</span><span class="safety-value warning">CLOSED</span></div>
          </div>
        </div>
        <div class="sidebar-section simulation-section">
          <div class="sidebar-title">P&L Simulator</div>
          <div class="sim-form">
            <div class="sim-field">
              <label class="sim-label">Entry Date</label>
              <input type="date" id="sim-entry-date" class="sim-input">
            </div>
            <div class="sim-field">
              <label class="sim-label">Capital ($)</label>
              <input type="number" id="sim-capital" class="sim-input" value="10000" min="100" step="100">
            </div>
            <button class="sim-btn" onclick="runPnLSimulation()">
              <span class="sim-btn-icon">▶</span> RUN SIMULATION
            </button>
            <div class="sim-result" id="sim-result">
              <div class="sim-result-label">Select parameters above</div>
            </div>
          </div>
        </div>
        <div class="sidebar-section" style="padding-bottom: 0.5rem;"><div class="sidebar-title">Activity Log</div></div>
        <div class="activity-feed" id="activity-feed"></div>
      </aside>
    </main>
    
    <div class="watermark"><span title="Play money. Real feelings.">SIMULATION MODE</span><a href="https://haslun.ai">← haslun.ai</a></div>
    
    <div class="status-strip">
      <div class="status-item" title="Everything is fine, which is statistically suspicious."><span class="dot green"></span><span class="value">SYSTEM NOMINAL</span></div>
      <div class="status-item" title="Someone, somewhere, is still sending numbers."><span class="dot green"></span><span class="value">UPLINK ACTIVE</span></div>
      <div class="status-item" title="The casino lights are off, but the spreadsheets are still awake."><span class="dot amber"></span><span class="value">MKT CLOSED</span></div>
      <div class="status-item"><span class="value" id="uptime">UPTIME: 00:00:00</span></div>
      
      <!-- SFX toggle -->
      <div class="status-item">
        <span class="value">SFX</span>
        <label class="toggle-mini">
          <input id="sfx-toggle" type="checkbox" checked />
          <span class="toggle-mini-track"><span class="toggle-mini-knob"></span></span>
        </label>
      </div>
      
      <!-- Theme selector -->
      <div class="status-item">
        <select id="theme-select" class="theme-select">
          <option value="Terminal">Terminal</option>
          <option value="Arcade">Arcade</option>
          <option value="NeonNoir">Neon Noir</option>
        </select>
      </div>
      
      <!-- Color Profile Control -->
      <div class="status-item" style="min-width: 180px;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span class="value" style="font-size: 0.6rem;">HUE</span>
          <input id="color-hue-slider" type="range" min="80" max="220" value="150" style="flex: 1; height: 4px;" />
          <div id="color-hue-preview" style="width: 12px; height: 12px; border-radius: 50%; background: hsl(150, 100%, 60%); border: 1px solid var(--border);"></div>
        </div>
      </div>
    </div>
    
    <div class="dev-console" id="dev-console">
      <div class="dev-console-header">
        <span class="dev-console-title">// Restricted Systems Log</span>
        <button class="dev-console-close" onclick="toggleDevConsole()">×</button>
      </div>
      <div class="dev-console-body">
        <div class="log-entry"><span class="timestamp">T-00:03:42</span><span class="level info">[INFO]</span> Quantum entanglement link established with LUNR-SAT-07</div>
        <div class="log-entry"><span class="timestamp">T-00:02:18</span><span class="level info">[INFO]</span> MACD crossover detected: RKLB entering bullish phase</div>
        <div class="log-entry"><span class="timestamp">T-00:01:55</span><span class="level warn">[WARN]</span> Unusual volume spike detected in ASTS pre-market</div>
        <div class="log-entry"><span class="timestamp">T-00:01:12</span><span class="level info">[INFO]</span> Portfolio delta exposure within acceptable parameters</div>
        <div class="log-entry"><span class="timestamp">T-00:00:47</span><span class="level info">[INFO]</span> Neutron telemetry nominal, launch window confirmed</div>
        <div class="log-entry"><span class="timestamp">T-00:00:23</span><span class="level warn">[WARN]</span> Gamma exposure elevated on RKLB position</div>
        <div class="log-entry"><span class="timestamp">T-00:00:00</span><span class="level info">[INFO]</span> Mission Control systems initialized</div>
      </div>
    </div>
    
    <!-- ARCADE HUD – mini mission list -->
    <div id="arcade-hud" class="arcade-hud hidden">
      <div class="hud-title">👾 ARCADE MODE</div>
      <ul id="mission-list"></ul>
      <button class="arcade-launch-btn" onclick="window.SignalInvaders && SignalInvaders.start()">
        ▶ LAUNCH SIGNAL INVADERS
      </button>
    </div>
    
    <!-- Tiny uplink terminal -->
    <div id="terminal-log" class="terminal-log"></div>
    
    <!-- Toast container for pop-up notifications -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- KONAMI CODE EASTER EGG - INVADER ATTACK -->
    <div id="invader-attack-overlay" class="invader-attack-overlay"></div>
    <div id="attack-flash" class="attack-flash"></div>
    
    <!-- SIGNAL INVADERS ARCADE GAME -->
    <div id="signal-invaders-overlay" class="arcade-game-overlay hidden">
      <div class="arcade-game-backdrop"></div>
      <div class="arcade-game-container">
        <button class="arcade-close" id="invaders-close-btn">✕ ESC</button>
        <div class="arcade-header">
          <div class="arcade-title">👾 SIGNAL INVADERS</div>
          <div class="arcade-stats">
            <span class="arcade-score">SCORE: <span id="invaders-score">0</span></span>
            <span class="arcade-lives">LIVES: <span id="invaders-lives">♥♥♥</span></span>
            <span class="arcade-wave">WAVE: <span id="invaders-wave">1</span></span>
          </div>
        </div>
        <canvas id="invaders-canvas" width="600" height="400"></canvas>
        <div class="arcade-controls">
          <span>← → MOVE</span>
          <span>SPACE FIRE</span>
          <span>ESC EXIT</span>
        </div>
        <div class="arcade-message" id="invaders-message"></div>
      </div>
    </div>
    
    <!-- ABOUT / STORY OVERLAY -->
    <div id="about-overlay" class="about-overlay hidden">
      <div class="about-backdrop"></div>
      <div class="about-panel">
        <button class="about-close" id="about-close-btn">✕</button>

        <div class="about-header">
          <div class="about-label">SIMULATION DOSSIER</div>
          <h2 class="about-title">What is Haslun-Bot Pilot's Cockpit?</h2>
        </div>

        <div class="about-body">
          <p>
            Haslun-Bot Pilot's Cockpit is a <strong>simulated trading deck</strong> for a fictional research fund.
            It's part data room, part arcade cabinet, and part mood board for how we think about risk,
            storytelling, and markets.
          </p>
          <p>
            All of the panels you see — portfolio status, trend diagnostics, scenario sliders, derivatives console —
            are wired to <strong>sandbox data</strong>. Nothing here is a live brokerage account, and nothing on this
            screen is investment advice. It's closer to a flight simulator than an airplane.
          </p>
          <p>
            The idea is simple:
          </p>
          <ul>
            <li>Treat a portfolio like a <strong>spaceship</strong>: engines, shields, navigation, and unknown signals.</li>
            <li>Let visitors <strong>twist the knobs</strong> — smoothing, volatility, forecast range — and watch telemetry respond.</li>
            <li>Use playful language and retro graphics to make quantitative ideas feel <strong>legible and human</strong>.</li>
          </ul>
          <p>
            You're invited to wander: click into positions, stress-test scenarios, and trigger the mission log. Follow curiosity,
            not performance.
          </p>
          <p>
            In short: this is a <strong>toy control room for serious topics</strong> — a place where corporate structure, 
            creative practice, and market structure overlap on one weird, glowing screen.
          </p>
          <p class="about-footnote">
            Note: All values and scenarios here are for illustrative and educational purposes only, not a recommendation to buy or sell any security.
          </p>
        </div>
      </div>
    </div>

    <!-- PIP-BOY TICKER DOSSIER OVERLAY -->
    <div id="pipboy-overlay" class="pipboy-overlay hidden">
      <div class="pipboy-backdrop"></div>
      <div class="pipboy-container">
        <button class="pipboy-close" id="pipboy-close-btn">✕</button>
        
        <div class="pipboy-header">
          <div class="pipboy-title-block">
            <div class="pipboy-codename" id="pipboy-codename">CODENAME: ELECTRON</div>
            <h2 class="pipboy-ticker-name" id="pipboy-ticker-name">RKLB</h2>
            <div class="pipboy-sector" id="pipboy-sector">Space Launch & Satellites</div>
          </div>
          <div class="pipboy-threat">
            <div class="pipboy-threat-label">VOLATILITY THREAT</div>
            <div class="pipboy-threat-level moderate" id="pipboy-threat">MODERATE</div>
          </div>
        </div>

        <nav class="pipboy-nav">
          <button class="pipboy-dial active" data-panel="overview">◈ OVERVIEW</button>
          <button class="pipboy-dial" data-panel="thesis">◉ THESIS</button>
          <button class="pipboy-dial" data-panel="catalysts">▲ CATALYSTS</button>
          <button class="pipboy-dial" data-panel="risks">⚠ RISKS</button>
          <button class="pipboy-dial" data-panel="vitals">◐ VITALS</button>
        </nav>

        <div class="pipboy-body">
          <!-- OVERVIEW PANEL -->
          <div class="pipboy-panel active" id="panel-overview">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Mission Brief</div>
              <p class="pipboy-text" id="pipboy-summary">Loading...</p>
            </div>
            <div class="pipboy-lore" id="pipboy-lore">
              "Loading tactical assessment..."
            </div>
          </div>

          <!-- THESIS PANEL -->
          <div class="pipboy-panel" id="panel-thesis">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Investment Thesis</div>
              <p class="pipboy-text" id="pipboy-thesis">Loading...</p>
            </div>
          </div>

          <!-- CATALYSTS PANEL -->
          <div class="pipboy-panel" id="panel-catalysts">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Upcoming Catalysts</div>
              <div id="pipboy-catalysts-list">
                <!-- Catalysts inserted here -->
              </div>
            </div>
          </div>

          <!-- RISKS PANEL -->
          <div class="pipboy-panel" id="panel-risks">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Risk Factors</div>
              <div id="pipboy-risks-list">
                <!-- Risks inserted here -->
              </div>
            </div>
          </div>

          <!-- VITALS PANEL -->
          <div class="pipboy-panel" id="panel-vitals">
            <div class="pipboy-section">
              <div class="pipboy-section-title">Company Vitals</div>
              <div class="pipboy-vitals" id="pipboy-vitals-grid">
                <!-- Vitals inserted here -->
              </div>
            </div>
          </div>
        </div>

        <div class="pipboy-stats-bar" id="pipboy-stats-bar">
          <!-- Live stats from current data inserted here -->
        </div>
      </div>
    </div>

    <!-- About trigger button -->
    <button class="about-trigger" id="about-trigger-btn">? ABOUT THIS SIMULATION</button>
  </div>

  <script>
    // Loading screen countdown
    function runCountdown() {
      const countdown = document.getElementById('countdown');
      const status = document.getElementById('loading-status');
      const beam = document.getElementById('pixel-beam');
      const ground = document.getElementById('pixel-ground');
      const loadingScreen = document.getElementById('loading-screen');
      const app = document.getElementById('app');
      
      let count = 3;
      
      const arcadeMessages = [
        'ESTABLISHING UPLINK...',
        'DEFENSIVE GRID ONLINE...',
        'SIGNAL LOCK ACQUIRED...'
      ];
      
      const interval = setInterval(() => {
        count--;
        if (count > 0) {
          countdown.textContent = count;
          status.textContent = arcadeMessages[3 - count - 1] || 'INITIALIZING...';
        } else if (count === 0) {
          countdown.textContent = 'GO';
          countdown.classList.add('go');
          if (beam) beam.classList.add('active');
          if (ground) ground.classList.add('active');
          status.textContent = 'READY — PRESS ANY KEY';
        } else {
          clearInterval(interval);
          loadingScreen.classList.add('hidden');
          app.classList.add('visible');
          init();
        }
      }, 1000);
    }
    
    // Start countdown on load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(runCountdown, 500);
    });
    
    let currentTicker = 'RKLB', currentTimeframe = '1D', currentRange = '3M', showMA = true;
    let priceChart = null, macdChart = null, tickerData = {}, statsData = {};
    
    const tickerColors = {
      'RKLB': '#33ff99', 'LUNR': '#47d4ff', 'ASTS': '#ffb347', 'ACHR': '#ff6b9d',
      'JOBY': '#b388ff', 'GME': '#ff6b6b', 'BKSY': '#47d4ff', 'RDW': '#33ff99',
      'PL': '#b388ff', 'EVEX': '#ff6b9d', 'MP': '#ffb347', 'KTOS': '#47d4ff',
      'IRDM': '#33ff99', 'HON': '#b388ff', 'ATI': '#ffb347', 'CACI': '#47d4ff', 'LOAR': '#ff6b9d'
    };
    
    const tickerThemes = {
      'RKLB': 'SPACE', 'LUNR': 'SPACE', 'ASTS': 'SPACE', 'BKSY': 'SPACE',
      'RDW': 'SPACE', 'PL': 'SPACE', 'IRDM': 'SPACE', 'KTOS': 'DEFENSE',
      'ACHR': 'eVTOL', 'JOBY': 'eVTOL', 'EVEX': 'eVTOL', 'GME': 'MEME',
      'MP': 'MATERIALS', 'HON': 'INDUSTRIAL', 'ATI': 'MATERIALS',
      'CACI': 'DEFENSE', 'LOAR': 'AEROSPACE'
    };
    
    const rangeDays = { '1W': 7, '1M': 30, '3M': 90, '6M': 180, '1Y': 365, 'ALL': 9999 };
    
    // =========================================================================
    // TICKER PROFILES — Pip-Boy style dossiers for each position
    // =========================================================================
    const TICKER_PROFILES = {
      RKLB: {
        name: "Rocket Lab USA",
        codename: "ELECTRON",
        sector: "Space Launch & Satellites",
        threat_level: "MODERATE",
        summary: "Small-launch pioneer now building medium-lift Neutron rocket. Vertically integrated: they make the rocket, the satellite bus, and increasingly the payload itself.",
        thesis: "Rocket Lab is betting that owning the entire stack — from launch to spacecraft to ground systems — creates compounding margin advantages as the space economy scales.",
        catalysts: [
          { date: "Q1 2026", event: "Neutron First Flight", impact: "HIGH" },
          { date: "Ongoing", event: "Electron Launch Cadence", impact: "MEDIUM" },
          { date: "2026", event: "Space Systems Revenue Growth", impact: "HIGH" }
        ],
        risks: [
          "Neutron development delays or cost overruns",
          "SpaceX pricing pressure on rideshare market",
          "Customer concentration in government contracts"
        ],
        vitals: {
          founded: 2006,
          hq: "Long Beach, CA",
          employees: "~1,800",
          launches: "50+"
        },
        lore: "In the orbital logistics game, Electron is the reliable shuttle bus — small, frequent, precise. Neutron is the freight train they're building next. If it works, they'll own both lanes of the highway to space."
      },
      LUNR: {
        name: "Intuitive Machines",
        codename: "MOONSHOT",
        sector: "Lunar Services",
        threat_level: "HIGH",
        summary: "Commercial lunar lander company. First private US company to soft-land on the Moon (IM-1, Feb 2024). NASA CLPS contractor building recurring lunar delivery business.",
        thesis: "The Moon is becoming infrastructure. Intuitive Machines is positioning as the FedEx of cislunar space — delivering payloads, building navigation networks, and eventually operating surface systems.",
        catalysts: [
          { date: "Feb 2026", event: "IM-2 Lunar Landing", impact: "HIGH" },
          { date: "2026", event: "Lunar Data Network Contracts", impact: "MEDIUM" },
          { date: "2027", event: "IM-3 Mission", impact: "HIGH" }
        ],
        risks: [
          "Mission failure risk (space is hard)",
          "NASA budget dependency",
          "Long timeline to profitability"
        ],
        vitals: {
          founded: 2013,
          hq: "Houston, TX",
          employees: "~500",
          landings: "1 (IM-1)"
        },
        lore: "They tipped over on landing and still counted it as a win. That's not copium — that's the reality of lunar exploration. Every data point is gold. They're learning faster than anyone else in the West."
      },
      ASTS: {
        name: "AST SpaceMobile",
        codename: "BLUEBIRD",
        sector: "Space-Based Cellular",
        threat_level: "EXTREME",
        summary: "Building the first space-based cellular broadband network. Giant satellites (64m² arrays) connect directly to unmodified smartphones. If it works, it's the biggest addressable market in telecom history.",
        thesis: "5 billion people have phones. 90% of Earth has no cellular coverage. AST is building orbital cell towers to close that gap — no new hardware required on the ground.",
        catalysts: [
          { date: "Q1 2026", event: "Commercial Service Launch", impact: "HIGH" },
          { date: "2026", event: "Block 2 Satellite Deployment", impact: "HIGH" },
          { date: "Ongoing", event: "MNO Partnership Expansion", impact: "MEDIUM" }
        ],
        risks: [
          "Unproven technology at scale",
          "Regulatory complexity across jurisdictions",
          "Capital-intensive deployment phase",
          "Competition from Starlink Direct-to-Cell"
        ],
        vitals: {
          founded: 2017,
          hq: "Midland, TX",
          employees: "~500",
          satellites: "5 (BlueBird test constellation)"
        },
        lore: "The satellites are the size of basketball courts. The engineering is borderline absurd. But if they pull it off, every phone on Earth becomes a satellite phone. That's not a product — that's a paradigm shift."
      },
      ACHR: {
        name: "Archer Aviation",
        codename: "MIDNIGHT",
        sector: "eVTOL / Urban Air Mobility",
        threat_level: "MODERATE",
        summary: "Electric vertical takeoff and landing aircraft for urban air taxi service. Partnership with United Airlines. Manufacturing facility in Georgia.",
        thesis: "Traffic is broken. Archer is betting that electric flight becomes cheap and quiet enough to create a new transportation layer above cities.",
        catalysts: [
          { date: "Q1 2026", event: "FAA Type Certification", impact: "HIGH" },
          { date: "2026", event: "Commercial Launch (UAE)", impact: "HIGH" },
          { date: "2027", event: "US Commercial Operations", impact: "HIGH" }
        ],
        risks: [
          "FAA certification timeline uncertainty",
          "Battery energy density limitations",
          "Infrastructure buildout costs",
          "Public acceptance of urban air traffic"
        ],
        vitals: {
          founded: 2018,
          hq: "San Jose, CA",
          employees: "~900",
          aircraft: "Midnight (4+1 passenger)"
        },
        lore: "The Jetsons promised us flying cars. Archer is delivering electric helicopters that don't sound like helicopters. Close enough."
      },
      JOBY: {
        name: "Joby Aviation",
        codename: "S4",
        sector: "eVTOL / Urban Air Mobility",
        threat_level: "MODERATE",
        summary: "Furthest along in eVTOL certification. Toyota-backed. Building manufacturing at scale. Air taxi service planned for 2025.",
        thesis: "First mover advantage in a winner-take-most market. Joby has more flight hours, more capital, and more regulatory progress than any competitor.",
        catalysts: [
          { date: "2025-2026", event: "FAA Type Certification", impact: "HIGH" },
          { date: "2025", event: "Initial Commercial Ops (Dubai)", impact: "HIGH" },
          { date: "2026", event: "US Market Launch", impact: "HIGH" }
        ],
        risks: [
          "Certification delays",
          "High cash burn pre-revenue",
          "Competitive pressure from Archer, Lilium",
          "Noise and safety perception issues"
        ],
        vitals: {
          founded: 2009,
          hq: "Santa Cruz, CA",
          employees: "~1,500",
          aircraft: "S4 (4+1 passenger)"
        },
        lore: "They've been at this longer than anyone. The Toyota money helps. But the real moat is the million+ miles of flight test data. That's not something you can buy."
      },
      GME: {
        name: "GameStop Corp",
        codename: "DIAMOND HANDS",
        sector: "Retail / Meme",
        threat_level: "CHAOTIC",
        summary: "Video game retailer turned meme stock phenomenon. Now pivoting toward... something. Cash-rich balance sheet. Ryan Cohen steering the ship into uncharted waters.",
        thesis: "This isn't a thesis. This is volatility exposure with a side of cultural commentary. The balance sheet is real; the business model is TBD.",
        catalysts: [
          { date: "Ongoing", event: "Social Media Sentiment Spikes", impact: "HIGH" },
          { date: "Unknown", event: "Strategic Pivot Announcements", impact: "MEDIUM" },
          { date: "Quarterly", event: "Earnings Surprises", impact: "MEDIUM" }
        ],
        risks: [
          "Fundamental business decline in physical games",
          "Meme momentum can reverse violently",
          "No clear path to sustainable growth",
          "Regulatory scrutiny on retail trading"
        ],
        vitals: {
          founded: 1984,
          hq: "Grapevine, TX",
          employees: "~8,000",
          stores: "~4,000"
        },
        lore: "The stock that broke the internet in 2021. Whether it's a movement, a trade, or a cautionary tale depends on your entry price and your exit strategy. We hold it because the volatility is useful. Not financial advice."
      },
      BKSY: {
        name: "BlackSky Technology",
        codename: "SPECTRA",
        sector: "Geospatial Intelligence",
        threat_level: "LOW",
        summary: "Real-time Earth observation satellite constellation. AI-powered analytics platform. Defense and intelligence community customers.",
        thesis: "Imagery is becoming a utility. BlackSky is building the always-on, AI-analyzed feed of what's happening on Earth — updated hourly, not daily.",
        catalysts: [
          { date: "Ongoing", event: "Constellation Expansion", impact: "MEDIUM" },
          { date: "2026", event: "Gen-3 Satellite Deployment", impact: "MEDIUM" },
          { date: "Ongoing", event: "Government Contract Wins", impact: "MEDIUM" }
        ],
        risks: [
          "Competition from Planet, Maxar",
          "Government budget cycles",
          "Small constellation limits revisit rates"
        ],
        vitals: {
          founded: 2014,
          hq: "Herndon, VA",
          employees: "~350",
          satellites: "18"
        },
        lore: "They photograph the same spot on Earth multiple times per day. The value isn't in any single image — it's in the delta. What changed? When? That's intelligence."
      },
      RDW: {
        name: "Redwire Corporation",
        codename: "FORGE",
        sector: "Space Infrastructure",
        threat_level: "LOW",
        summary: "Space infrastructure company. On-orbit manufacturing, solar arrays, sensors. Rolls up smaller space tech companies. Supplies components across the industry.",
        thesis: "Every satellite needs stuff — solar panels, antennas, sensors, structures. Redwire is the Home Depot of space hardware.",
        catalysts: [
          { date: "Ongoing", event: "M&A Integration", impact: "MEDIUM" },
          { date: "2026", event: "In-Space Manufacturing Demos", impact: "MEDIUM" },
          { date: "Ongoing", event: "NASA/DoD Contracts", impact: "MEDIUM" }
        ],
        risks: [
          "Integration risk from acquisitions",
          "Customer concentration",
          "Supply chain dependencies"
        ],
        vitals: {
          founded: 2020,
          hq: "Jacksonville, FL",
          employees: "~700",
          facilities: "20+"
        },
        lore: "While everyone argues about who gets to launch the rockets, Redwire quietly sells picks and shovels to all of them. Boring but effective."
      },
      PL: {
        name: "Planet Labs",
        codename: "DOVE",
        sector: "Earth Observation",
        threat_level: "LOW",
        summary: "Largest Earth observation satellite constellation. Daily imaging of the entire planet. Commercial, government, and NGO customers.",
        thesis: "A daily photo of every spot on Earth creates unprecedented visibility into human activity. Agriculture, supply chains, climate — it's all visible from orbit.",
        catalysts: [
          { date: "Ongoing", event: "Data Services Revenue Growth", impact: "MEDIUM" },
          { date: "2026", event: "Pelican Constellation Launch", impact: "MEDIUM" },
          { date: "Ongoing", event: "Government Contract Expansion", impact: "MEDIUM" }
        ],
        risks: [
          "Path to profitability unclear",
          "Competition from free/low-cost imagery",
          "Data commoditization pressure"
        ],
        vitals: {
          founded: 2010,
          hq: "San Francisco, CA",
          employees: "~800",
          satellites: "200+"
        },
        lore: "They image the entire Earth every single day. Every field, every port, every construction site. The value is in what you can see changing over time."
      },
      EVEX: {
        name: "Eve Holding",
        codename: "VECTOR",
        sector: "eVTOL / Urban Air Mobility",
        threat_level: "MODERATE",
        summary: "Embraer-backed eVTOL company. Leveraging decades of aerospace manufacturing experience. Urban air mobility focus with global ambitions.",
        thesis: "Embraer knows how to build and certify aircraft at scale. Eve inherits that DNA for the electric age.",
        catalysts: [
          { date: "2026", event: "Prototype Flight Testing", impact: "MEDIUM" },
          { date: "2027", event: "Certification Progress", impact: "HIGH" },
          { date: "Ongoing", event: "Pre-order Conversions", impact: "MEDIUM" }
        ],
        risks: [
          "Later to market than Joby/Archer",
          "Brazil HQ complicates US certification",
          "Competitive pressure in crowded market"
        ],
        vitals: {
          founded: 2020,
          hq: "Melbourne, FL / São Paulo",
          employees: "~600",
          aircraft: "eVTOL (4+1 passenger)"
        },
        lore: "The Embraer connection is the whole story. These are the people who built the E-Jets. They know certification, they know manufacturing, they know airlines."
      },
      KTOS: {
        name: "Kratos Defense",
        codename: "VALKYRIE",
        sector: "Defense Technology",
        threat_level: "LOW",
        summary: "Unmanned systems and hypersonic tech. Affordable attritable drones for the DoD. Satellite ground systems. The affordable end of the defense contractor spectrum.",
        thesis: "Future warfare is drone warfare. Kratos builds the cheap, expendable, AI-piloted aircraft that will fly alongside manned fighters.",
        catalysts: [
          { date: "Ongoing", event: "CCA Program Contracts", impact: "HIGH" },
          { date: "2026", event: "Hypersonic Testing", impact: "MEDIUM" },
          { date: "Ongoing", event: "DoD Budget Allocations", impact: "MEDIUM" }
        ],
        risks: [
          "Defense budget politics",
          "Program cancellation risk",
          "Competition from larger primes"
        ],
        vitals: {
          founded: 1994,
          hq: "Colorado Springs, CO",
          employees: "~3,500",
          focus: "Drones, Missiles, Space"
        },
        lore: "While Lockheed builds the $100M jets, Kratos builds the $2M wingmen. In an era of attrition warfare, cheap and many beats expensive and few."
      },
      IRDM: {
        name: "Iridium Communications",
        codename: "CONSTELLATION",
        sector: "Satellite Communications",
        threat_level: "LOW",
        summary: "Global satellite phone and IoT network. 66-satellite constellation provides pole-to-pole coverage. Government, maritime, aviation customers.",
        thesis: "The original satellite phone network, now focused on IoT and specialty markets where Starlink can't compete on coverage or reliability.",
        catalysts: [
          { date: "Ongoing", event: "IoT Revenue Growth", impact: "MEDIUM" },
          { date: "Ongoing", event: "Government Contract Renewals", impact: "MEDIUM" },
          { date: "Long-term", event: "Next-Gen Constellation Planning", impact: "LOW" }
        ],
        risks: [
          "Technology disruption from LEO constellations",
          "Limited growth runway",
          "Commodity pricing pressure"
        ],
        vitals: {
          founded: 2000,
          hq: "McLean, VA",
          employees: "~600",
          satellites: "66 active"
        },
        lore: "They went bankrupt once and came back. The constellation is paid for. The cash flows. It's not sexy, but it's the only network that works everywhere on Earth."
      },
      MP: {
        name: "MP Materials",
        codename: "RARE EARTH",
        sector: "Critical Minerals",
        threat_level: "LOW",
        summary: "Largest rare earth mining and processing company in the Western Hemisphere. Mountain Pass mine in California. Essential materials for EVs, wind turbines, defense systems.",
        thesis: "China controls 60%+ of rare earth processing. MP is the US answer to that dependency. National security meets clean energy transition.",
        catalysts: [
          { date: "Ongoing", event: "Magnetics Facility Ramp", impact: "HIGH" },
          { date: "2026", event: "Downstream Processing Expansion", impact: "MEDIUM" },
          { date: "Ongoing", event: "Auto OEM Supply Deals", impact: "MEDIUM" }
        ],
        risks: [
          "Commodity price volatility",
          "China supply chain disruption",
          "Environmental/permitting challenges"
        ],
        vitals: {
          founded: 2017,
          hq: "Las Vegas, NV",
          employees: "~800",
          facility: "Mountain Pass Mine"
        },
        lore: "Every EV motor, every wind turbine, every F-35 needs rare earths. China has the market cornered. MP is the insurance policy."
      },
      HON: {
        name: "Honeywell International",
        codename: "INDUSTRIAL",
        sector: "Aerospace & Industrial",
        threat_level: "LOW",
        summary: "Diversified industrial conglomerate. Aerospace systems, building technologies, performance materials. The boring backbone of global infrastructure.",
        thesis: "When everyone else is chasing moonshots, sometimes you want the company that makes the avionics, the thermostats, and the jet engines.",
        catalysts: [
          { date: "Ongoing", event: "Aerospace Aftermarket Growth", impact: "MEDIUM" },
          { date: "Ongoing", event: "Energy Transition Products", impact: "MEDIUM" },
          { date: "Quarterly", event: "Earnings & Guidance", impact: "LOW" }
        ],
        risks: [
          "Industrial cyclicality",
          "Conglomerate discount",
          "Spin-off execution risk"
        ],
        vitals: {
          founded: 1906,
          hq: "Charlotte, NC",
          employees: "~95,000",
          segments: "Aerospace, Building Tech, PMT, SPS"
        },
        lore: "Not every position needs to be a moonshot. Sometimes you hold the company that makes parts for everyone else's moonshots."
      },
      ATI: {
        name: "ATI Inc",
        codename: "ALLOY",
        sector: "Specialty Materials",
        threat_level: "LOW",
        summary: "Specialty materials company. Titanium, nickel alloys, specialty steels. Aerospace, defense, energy markets. When you need metal that doesn't melt, bend, or corrode.",
        thesis: "Next-gen aircraft and turbines require exotic alloys. ATI is one of the few Western suppliers who can make them at scale.",
        catalysts: [
          { date: "Ongoing", event: "Aerospace Production Ramp", impact: "MEDIUM" },
          { date: "Ongoing", event: "Defense Spending Tailwinds", impact: "MEDIUM" },
          { date: "Ongoing", event: "Titanium Supply Constraints", impact: "LOW" }
        ],
        risks: [
          "Aerospace cycle sensitivity",
          "Raw material cost volatility",
          "Labor and energy costs"
        ],
        vitals: {
          founded: 1996,
          hq: "Dallas, TX",
          employees: "~6,000",
          materials: "Titanium, Nickel, Steel"
        },
        lore: "The materials science behind every jet engine. Unglamorous, essential, and very hard to replicate."
      },
      CACI: {
        name: "CACI International",
        codename: "INTEL",
        sector: "Defense & Intelligence",
        threat_level: "LOW",
        summary: "Defense and intelligence IT services. Cybersecurity, signals intelligence, mission support. The quiet contractor that does the classified work.",
        thesis: "Government never stops needing IT and intelligence services. CACI has the clearances and the contracts.",
        catalysts: [
          { date: "Ongoing", event: "Contract Wins", impact: "MEDIUM" },
          { date: "Ongoing", event: "M&A Activity", impact: "MEDIUM" },
          { date: "Ongoing", event: "Defense Budget Stability", impact: "LOW" }
        ],
        risks: [
          "Contract recompete risk",
          "Clearance/talent constraints",
          "Budget uncertainty"
        ],
        vitals: {
          founded: 1962,
          hq: "Reston, VA",
          employees: "~23,000",
          clearances: "High"
        },
        lore: "When you need something done in the classified world, CACI picks up the phone. Boring to everyone except the people who need them."
      },
      LOAR: {
        name: "Loar Holdings",
        codename: "COMPONENT",
        sector: "Aerospace Components",
        threat_level: "LOW",
        summary: "Aerospace and defense component manufacturer. Actuators, valves, and precision systems. The small parts that make the big machines work.",
        thesis: "Aerospace OEMs are ramping production. Every aircraft needs thousands of precision components. Loar makes them.",
        catalysts: [
          { date: "Ongoing", event: "Aircraft Production Ramp", impact: "MEDIUM" },
          { date: "Ongoing", event: "Aftermarket Growth", impact: "MEDIUM" },
          { date: "Ongoing", event: "M&A Integration", impact: "LOW" }
        ],
        risks: [
          "Customer concentration",
          "Supply chain disruptions",
          "Integration execution"
        ],
        vitals: {
          founded: 2012,
          hq: "White Plains, NY",
          employees: "~2,500",
          products: "Aerospace Components"
        },
        lore: "Another picks-and-shovels play. While everyone argues about which plane is best, Loar sells parts to all of them."
      }
    };
    
    // =========================================================================
    // HASLUN GLOSSARY — Tooltips, flavor text, and lore system
    // =========================================================================
    const HASLUN_GLOSSARY = {
      // ---------- CORE PORTFOLIO METRICS ----------
      today_pnl: {
        label: "Today's P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Profit or loss generated since the start of the current trading day.",
        flavor: "How much the market liked you today, before feelings reset at the open."
      },
      total_pnl: {
        label: "Total P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Cumulative profit or loss for this simulation since inception.",
        flavor: "Lifetime score since the moment you pressed START on this universe."
      },
      positions_count: {
        label: "Positions",
        category: "metric",
        tooltip: "Number of tickers currently held in the portfolio.",
        flavor: "How many plates you're spinning in zero gravity."
      },
      win_rate: {
        label: "Win Rate",
        category: "metric",
        unit: "%",
        tooltip: "Percentage of closed trades that ended with positive P&L.",
        flavor: "Hit rate. Accuracy stat. Bragging-rights fuel."
      },
      portfolio_value: {
        label: "Portfolio Value",
        category: "metric",
        unit: "USD",
        tooltip: "Current market value of all open positions plus cash.",
        flavor: "What your empire is worth if you slammed the SELL ALL button."
      },
      total_delta: {
        label: "Total Delta",
        category: "metric",
        tooltip: "Sensitivity of the options book to a $1 move in the underlying basket.",
        flavor: "How violently the cockpit shakes when prices nudge."
      },
      days_to_expiry: {
        label: "Days to Expiry",
        category: "metric",
        tooltip: "Time remaining until the primary options cycle expires.",
        flavor: "How long until the clock runs out on this particular boss fight."
      },
      
      // ---------- MACD & MOMENTUM ----------
      macd: {
        label: "MACD",
        category: "metric",
        tooltip: "Moving Average Convergence Divergence: fast EMA minus slow EMA of price.",
        flavor: "Momentum gauge. Shows when rockets are over-fuelled or stalling out."
      },
      macd_signal: {
        label: "Signal",
        category: "metric",
        tooltip: "EMA of the MACD line. Crossovers often signal trend shifts.",
        flavor: "The grown-up in the room telling MACD to calm down (or speed up)."
      },
      macd_histogram: {
        label: "Histogram",
        category: "metric",
        tooltip: "MACD minus Signal. Bars above/below zero show relative momentum.",
        flavor: "The heartbeat monitor for trend strength. Flatline not recommended."
      },
      
      // ---------- TREND STATUS STATES ----------
      trend_analyzing: {
        label: "ANALYZING…",
        category: "state",
        icon: "◌",
        color: "var(--text-muted)",
        tooltip: "System is ingesting data and calculating trend classification.",
        flavor: "Coffee being poured into the machine. Please stand by.",
        subtitle: "Awaiting data…",
        body: "Scanning telemetry feed for recognizable patterns."
      },
      trend_full_thrust: {
        label: "FULL THRUST",
        category: "state",
        icon: "▲",
        color: "var(--phosphor)",
        tooltip: "Price above long-term averages with bullish momentum.",
        flavor: "Engines lit, nose up, telemetry green. Strap in.",
        subtitle: "All systems green.",
        body: "Price above 200-day line with positive momentum. Trend uptrend confirmed until proven otherwise."
      },
      trend_reversal_attempt: {
        label: "REVERSAL ATTEMPT",
        category: "state",
        icon: "◈",
        color: "var(--amber)",
        tooltip: "Price recovering above short/mid MAs but below long-term baseline.",
        flavor: "Ship has stopped crashing. Jury still out on actual flying.",
        subtitle: "Course correction underway.",
        body: "Price has climbed back above the short-term baseline but hasn't cleared the long-term ceiling. Reversal in progress; turbulence expected."
      },
      trend_drifting: {
        label: "DRIFTING",
        category: "state",
        icon: "◇",
        color: "#47d4ff",
        tooltip: "Price oscillating around key averages with weak directional bias.",
        flavor: "Coasting in orbit. Safe, but nothing cinematic.",
        subtitle: "Stable orbit.",
        body: "Price hugging moving averages with low momentum. No clear directional bias; good time for coffee or long emails."
      },
      trend_reentry_risk: {
        label: "REENTRY RISK",
        category: "state",
        icon: "▼",
        color: "#ff6b6b",
        tooltip: "Price below major moving averages with bearish momentum.",
        flavor: "Heat shield glowing. Consider which side of the planet you want to land on.",
        subtitle: "Altitude loss detected.",
        body: "Price below long-term trend with negative momentum. Downside pressure present; check heat shield and position sizing."
      },
      trend_nebula: {
        label: "NEBULOUS",
        category: "state",
        icon: "※",
        color: "#b388ff",
        tooltip: "High volatility and conflicting signals; no clear trend.",
        flavor: "In a cosmic dust cloud. Instruments insist everything is 'fine'.",
        subtitle: "Signal degraded.",
        body: "Choppy, sideways, mean-reverting mess. Indicators argue with each other; system recommends humility."
      },
      
      // ---------- SIGNAL PROCESSING ARRAY ----------
      sig_smoothing: {
        label: "Signal Smoothing",
        category: "control",
        tooltip: "Adjusts how much short-term noise is filtered from price and MACD.",
        flavor: "Turn right to make charts look wise and slow. Turn left for chaos TV."
      },
      sig_forecast_range: {
        label: "Forecast Range",
        category: "control",
        tooltip: "How far into the future the simulation projects price paths.",
        flavor: "How many days ahead you want to pretend you can see."
      },
      sig_risk_exposure: {
        label: "Risk Exposure",
        category: "control",
        tooltip: "Scenario profile from defensive to aggressive. Scales drift and leverage in simulations.",
        flavor: "How spicy you want the universe to feel right now."
      },
      sig_vol_index: {
        label: "Volatility Index",
        category: "metric",
        tooltip: "Synthetic volatility score derived from recent price swings.",
        flavor: "How much the market is wiggling while you try to act composed."
      },
      sig_display_momentum: {
        label: "Momentum Overlay",
        category: "control",
        tooltip: "Toggle MACD / trend overlays on the main chart.",
        flavor: "Draws the invisible wind the rockets are flying through."
      },
      sig_display_heatmap: {
        label: "Volume Heatmap",
        category: "control",
        tooltip: "Show volume intensity as background shading on the chart.",
        flavor: "Where the crowd actually showed up versus where they just talked big."
      },
      sig_display_alerts: {
        label: "Alert Markers",
        category: "control",
        tooltip: "Display crossover events and custom triggers as icons on the chart.",
        flavor: "Little neon post-its on the timeline saying 'something weird happened here'."
      },
      sig_alert_sensitivity: {
        label: "Alert Sensitivity",
        category: "control",
        tooltip: "Controls how easily the system raises visual alerts.",
        flavor: "Slide right to let the system panic for you. Slide left if you enjoy surprises."
      },
      sig_market_scanner: {
        label: "Market Scanner",
        category: "metric",
        tooltip: "Compressed view of recent signals across the watchlist.",
        flavor: "Radar sweep. Blips mean 'look here', not 'buy here'. Probably."
      },
      
      // ---------- CORE PORTFOLIO METRICS ----------
      today_pnl: {
        label: "Today's P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Profit or loss generated since the start of the current trading day.",
        flavor: "How much the market liked you today, before feelings reset at the open."
      },
      total_pnl: {
        label: "Total P&L",
        category: "metric",
        unit: "USD",
        tooltip: "Cumulative profit or loss for this simulation since inception.",
        flavor: "Lifetime score since the moment you pressed START on this universe."
      },
      positions_count: {
        label: "Positions",
        category: "metric",
        tooltip: "Number of tickers currently held in the portfolio.",
        flavor: "How many plates you're spinning in zero gravity."
      },
      win_rate: {
        label: "Win Rate",
        category: "metric",
        unit: "%",
        tooltip: "Percentage of closed trades that ended with positive P&L.",
        flavor: "Hit rate. Accuracy stat. Bragging-rights fuel."
      },
      portfolio_value: {
        label: "Portfolio Value",
        category: "metric",
        unit: "USD",
        tooltip: "Current market value of all open positions plus cash.",
        flavor: "What your empire is worth if you slammed the SELL ALL button."
      },
      total_delta: {
        label: "Total Delta",
        category: "metric",
        tooltip: "Sensitivity of the options book to a $1 move in the underlying basket.",
        flavor: "How violently the cockpit shakes when prices nudge."
      },
      days_to_expiry: {
        label: "Days to Expiry",
        category: "metric",
        tooltip: "Time remaining until the primary options cycle expires.",
        flavor: "How long until the clock runs out on this particular boss fight."
      },
      
      // ---------- MACD & MOMENTUM ----------
      macd: {
        label: "MACD",
        category: "metric",
        tooltip: "Moving Average Convergence Divergence: fast EMA minus slow EMA of price.",
        flavor: "Momentum gauge. Shows when rockets are over-fuelled or stalling out."
      },
      macd_signal: {
        label: "Signal",
        category: "metric",
        tooltip: "EMA of the MACD line. Crossovers often signal trend shifts.",
        flavor: "The grown-up in the room telling MACD to calm down (or speed up)."
      },
      macd_histogram: {
        label: "Histogram",
        category: "metric",
        tooltip: "MACD minus Signal. Bars above/below zero show relative momentum.",
        flavor: "The heartbeat monitor for trend strength. Flatline not recommended."
      },
      
      // ---------- DERIVATIVES / OPTIONS ----------
      strat_naked_leap: {
        label: "Naked LEAP",
        category: "strategy",
        tooltip: "Long-dated call with no offsetting hedge.",
        flavor: "Maximum optimism. Minimum adult supervision."
      },
      strat_bull_spread: {
        label: "Bull Spread",
        category: "strategy",
        tooltip: "Call spread benefitting from moderate price appreciation.",
        flavor: "Not trying to reach Mars. Just happy to clear the atmosphere."
      },
      strat_bear_spread: {
        label: "Bear Spread",
        category: "strategy",
        tooltip: "Put or call spread positioned for a controlled downside move.",
        flavor: "You don't need a crash, just a dignified stumble."
      },
      derivatives_tab: {
        label: "Derivatives",
        category: "navigation",
        tooltip: "Options and structured positions with defined risk profiles.",
        flavor: "Levers, pulleys, and very opinionated probability curves."
      },
      greek_delta: {
        label: "Delta",
        category: "metric",
        tooltip: "First derivative of option price with respect to underlying price.",
        flavor: "How loudly this option screams when the stock twitches."
      },
      greek_theta: {
        label: "Theta",
        category: "metric",
        tooltip: "Daily time decay of the option's value.",
        flavor: "Rent you pay for living in the future."
      },
      greek_gamma: {
        label: "Gamma",
        category: "metric",
        tooltip: "Rate of change of delta as the underlying moves.",
        flavor: "How quickly a calm trade turns dramatic when price gets ideas."
      },
      greek_vega: {
        label: "Vega",
        category: "metric",
        tooltip: "Sensitivity of option price to changes in volatility.",
        flavor: "Mood swing multiplier. When volatility sulks, these feel it first."
      },
      
      // ---------- GLOBAL STATES ----------
      mode_simulation: {
        label: "Simulation Mode",
        category: "state",
        tooltip: "All data and trades are running in sandbox mode.",
        flavor: "Play money. Real feelings."
      },
      status_uplink_active: {
        label: "Uplink Active",
        category: "state",
        tooltip: "Connection to data stream is healthy.",
        flavor: "Someone, somewhere, is still sending numbers."
      },
      status_system_nominal: {
        label: "System Nominal",
        category: "state",
        tooltip: "No major errors or warnings detected.",
        flavor: "Everything is fine, which is statistically suspicious."
      },
      status_mkt_closed: {
        label: "Market Closed",
        category: "state",
        tooltip: "Exchange session has ended; prices are static.",
        flavor: "The casino lights are off, but the spreadsheets are still awake."
      },
      abort_all_trades: {
        label: "Abort All Trades",
        category: "control",
        tooltip: "Emergency liquidation of all open positions.",
        flavor: "Emergency exit. Does not apply to your feelings."
      }
    };
    
    // Portfolio mood states based on daily P&L percentage
    const PORTFOLIO_MOODS = {
      thruster_boost: { threshold: 2, label: "THRUSTER BOOST", color: "var(--phosphor)", copy: "Portfolio making energetic upward noises." },
      steady_climb: { threshold: 0, label: "STEADY CLIMB", color: "var(--phosphor-dim)", copy: "Green enough to feel smug, not enough to tweet about." },
      minor_turbulence: { threshold: -1, label: "MINOR TURBULENCE", color: "var(--amber)", copy: "Seatbelts on, beverage carts still operational." },
      hull_rattle: { threshold: -999, label: "HULL RATTLE", color: "#ff6b6b", copy: "Today's lesson: gravity always wins eventually." }
    };
    
    // MACD status messages
    const MACD_STATES = {
      bullish_cross: { label: "Bullish crossover", copy: "Engines pushing above baseline." },
      bearish_cross: { label: "Bearish crossover", copy: "Thrust vector pointing down." },
      weak_signal: { label: "Momentum quiet", copy: "Coasting on inertia." },
      divergence: { label: "Divergence watch", copy: "Price and momentum disagree." }
    };
    
    // Glossary helper functions
    function getGlossary(id) {
      return HASLUN_GLOSSARY[id] || null;
    }
    
    function getTooltip(id) {
      const entry = HASLUN_GLOSSARY[id];
      return entry ? entry.tooltip : '';
    }
    
    function getFlavor(id) {
      const entry = HASLUN_GLOSSARY[id];
      return entry ? entry.flavor : '';
    }
    
    // Get trend state based on price, MACD data, and volatility
    function getTrendState(price, ma100, ma150, ma200, macdVal, volScore) {
      if (!price || !ma200) return HASLUN_GLOSSARY.trend_analyzing;
      
      const aboveMa100 = price > ma100;
      const aboveMa150 = price > ma150;
      const aboveMa200 = price > ma200;
      const macdPositive = macdVal > 0;
      const nearMa100 = Math.abs(price - ma100) / price < 0.015;
      const volHigh = (volScore || 0) > 30;
      
      // FULL THRUST: Above all MAs with positive momentum and calm vol
      if (aboveMa200 && aboveMa150 && macdPositive && !volHigh) {
        return HASLUN_GLOSSARY.trend_full_thrust;
      }
      
      // REVERSAL ATTEMPT: Above short-term but below long-term, calm vol
      if (aboveMa100 && !aboveMa200 && macdPositive && !volHigh) {
        return HASLUN_GLOSSARY.trend_reversal_attempt;
      }
      
      // DRIFTING: Near MAs with weak momentum and tame vol
      if (nearMa100 && Math.abs(macdVal) < 0.1 && !volHigh) {
        return HASLUN_GLOSSARY.trend_drifting;
      }
      
      // REENTRY RISK: Below long-term with negative momentum
      if (!aboveMa200 && !macdPositive && !volHigh) {
        return HASLUN_GLOSSARY.trend_reentry_risk;
      }
      
      // NEBULOUS: High volatility OR mixed signals
      return HASLUN_GLOSSARY.trend_nebula;
    }
    
    // Get MACD status
    function getMacdStatus(macd, signal, hist) {
      if (Math.abs(hist) < 0.05) return MACD_STATES.weak_signal;
      if (macd > signal && hist > 0) return MACD_STATES.bullish_cross;
      if (macd < signal && hist < 0) return MACD_STATES.bearish_cross;
      return MACD_STATES.weak_signal;
    }
    
    // Get portfolio mood
    function getPortfolioMood(dailyPnlPercent) {
      if (dailyPnlPercent >= 2) return PORTFOLIO_MOODS.thruster_boost;
      if (dailyPnlPercent >= 0) return PORTFOLIO_MOODS.steady_climb;
      if (dailyPnlPercent >= -1) return PORTFOLIO_MOODS.minor_turbulence;
      return PORTFOLIO_MOODS.hull_rattle;
    }
    
    // Update portfolio mood display dynamically
    function updatePortfolioMood(dailyPnlPercent) {
      const mood = getPortfolioMood(dailyPnlPercent);
      const moodEl = document.getElementById('portfolio-mood');
      if (!moodEl) return;
      
      const labelEl = moodEl.querySelector('.mood-label');
      const copyEl = moodEl.querySelector('.mood-copy');
      
      if (labelEl) labelEl.textContent = mood.label;
      if (copyEl) copyEl.textContent = mood.copy;
      
      // Update mood class
      moodEl.className = 'portfolio-mood';
      if (dailyPnlPercent >= 2) moodEl.classList.add('boost');
      else if (dailyPnlPercent >= 0) moodEl.classList.add('climb');
      else if (dailyPnlPercent >= -1) moodEl.classList.add('turbulence');
      else moodEl.classList.add('rattle');
    }
    
    // Attach glossary tooltips to all elements with data-glossary-id
    function attachGlossaryTooltips() {
      document.querySelectorAll('[data-glossary-id]').forEach(el => {
        const id = el.getAttribute('data-glossary-id');
        const entry = HASLUN_GLOSSARY[id];
        if (!entry) return;
        
        // Build tooltip with both serious and flavor text
        const tooltip = entry.tooltip + (entry.flavor ? '\n\n"' + entry.flavor + '"' : '');
        el.setAttribute('title', tooltip);
        el.style.cursor = 'help';
      });
    }
    
    // Scenario Engine: Update smoothing band label
    function updateSmoothingBandLabel(value) {
      const el = document.getElementById('smoothing-band-label');
      if (!el) return;
      let text = 'BALANCED';
      if (value < 30) text = 'RAW FEED';
      else if (value > 70) text = 'DEEP FILTER';
      el.textContent = text;
    }
    
    // Scenario Engine: Update forecast display
    function updateForecastDisplay(days) {
      const el = document.getElementById('forecast-value');
      if (el) el.textContent = days + ' DAYS';
      logTerminal('forecast range → ' + days + ' days');
    }
    
    // Scenario Engine: Update risk profile
    function updateRiskProfile(level) {
      const fill = document.getElementById('risk-fill');
      const needle = document.getElementById('risk-needle');
      const value = document.getElementById('risk-value');
      
      const profiles = {
        conservative: { height: 30, angle: 25, label: 'CONSERVATIVE' },
        moderate: { height: 50, angle: 65, label: 'MODERATE' },
        aggressive: { height: 75, angle: 105, label: 'AGGRESSIVE' },
        maximum: { height: 95, angle: 145, label: 'MAXIMUM' }
      };
      
      const profile = profiles[level] || profiles.moderate;
      if (fill) fill.style.height = profile.height + '%';
      if (needle) needle.style.transform = 'rotate(' + profile.angle + 'deg)';
      if (value) value.textContent = profile.label;
      
      logTerminal('risk exposure → ' + profile.label.toLowerCase());
    }
    
    // Get current price series for a ticker based on timeframe
    function getCurrentSeriesForTicker(data) {
      if (!data) return [];
      return currentTimeframe === '1D' ? data.daily : data.intraday;
    }
    
    // Calculate volatility score from price data (returns 0-40 scaled value)
    function calculateVolatility(data) {
      if (!data || data.length < 10) return 0;
      const returns = [];
      for (let i = 1; i < data.length; i++) {
        const prev = data[i-1].c;
        const curr = data[i].c;
        if (!prev || !curr) continue;
        const ret = (curr - prev) / prev;
        returns.push(ret);
      }
      if (returns.length < 5) return 0;
      const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
      const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
      const stdev = Math.sqrt(variance);
      // Scale roughly into a 0-40 range for LED bar (annualized %)
      const scaled = stdev * Math.sqrt(252) * 100;
      return Math.max(0, Math.min(40, scaled));
    }
    
    // Get volatility score for a specific ticker
    function getVolScoreForTicker(ticker) {
      const data = tickerData[ticker];
      const series = getCurrentSeriesForTicker(data);
      return calculateVolatility(series);
    }
    
    // Update volatility display
    function updateVolatilityDisplay(vol) {
      const display = document.getElementById('vol-display');
      if (display) display.textContent = vol.toFixed(1);
      
      // Update LED array based on volatility
      const leds = document.querySelectorAll('.led-array .array-led');
      const numLit = Math.min(8, Math.floor(vol / 10));
      leds.forEach((led, i) => {
        led.className = 'array-led';
        if (i < numLit) {
          if (i >= 6) led.classList.add('red');
          else if (i >= 4) led.classList.add('amber');
          else led.classList.add('on');
        }
      });
    }
    
    const DEMO_STOCK_POSITIONS = [
      { ticker: 'RKLB', shares: 75, entry_price: 68.45, current_price: 72.80 },
      { ticker: 'ASTS', shares: 50, entry_price: 78.20, current_price: 83.47 },
      { ticker: 'LUNR', shares: 100, entry_price: 15.20, current_price: 17.88 },
      { ticker: 'BKSY', shares: 200, entry_price: 3.85, current_price: 4.20 },
      { ticker: 'RDW', shares: 80, entry_price: 13.60, current_price: 15.00 },
      { ticker: 'PL', shares: 150, entry_price: 3.72, current_price: 4.00 },
      { ticker: 'ACHR', shares: 100, entry_price: 7.85, current_price: 8.13 },
      { ticker: 'JOBY', shares: 60, entry_price: 13.20, current_price: 14.36 },
      { ticker: 'EVEX', shares: 250, entry_price: 3.10, current_price: 2.80 },
      { ticker: 'GME', shares: 40, entry_price: 25.80, current_price: 27.50 }
    ];
    
    const DEMO_OPTIONS = [
      { ticker: 'RKLB', structure: 'Naked LEAP', strikes: '$5', entry: 1.85, current: 68.50, delta: 0.95, contracts: 3 },
      { ticker: 'ASTS', structure: 'Bull Spread', strikes: '$5/$15', entry: 2.40, current: 9.85, delta: 0.48, contracts: 4 },
      { ticker: 'LUNR', structure: 'Naked LEAP', strikes: '$5', entry: 1.20, current: 13.50, delta: 0.92, contracts: 5 },
      { ticker: 'BKSY', structure: 'Bull Spread', strikes: '$2/$5', entry: 0.95, current: 2.80, delta: 0.55, contracts: 5 },
      { ticker: 'RDW', structure: 'Bull Spread', strikes: '$4/$8', entry: 1.40, current: 3.90, delta: 0.62, contracts: 3 },
      { ticker: 'PL', structure: 'Bull Spread', strikes: '$2/$4', entry: 0.55, current: 1.85, delta: 0.58, contracts: 5 },
      { ticker: 'ACHR', structure: 'Naked LEAP', strikes: '$5', entry: 1.65, current: 4.20, delta: 0.72, contracts: 3 },
      { ticker: 'JOBY', structure: 'Bull Spread', strikes: '$5/$10', entry: 1.80, current: 5.40, delta: 0.65, contracts: 3 },
      { ticker: 'EVEX', structure: 'Bull Spread', strikes: '$3/$6', entry: 0.85, current: 0.35, delta: 0.28, contracts: 4 },
      { ticker: 'GME', structure: 'Bull Spread', strikes: '$12/$20', entry: 3.20, current: 7.80, delta: 0.72, contracts: 2 }
    ];
    
    const DEMO_CATALYSTS = [
      { date: '2026-01-16', ticker: 'ALL', event: 'January Options Expiration', impact: 'HIGH' },
      { date: '2026-01-21', ticker: 'RKLB', event: 'Q4 Earnings Report', impact: 'HIGH' },
      { date: '2026-01-28', ticker: 'ASTS', event: 'Q4 Earnings Report', impact: 'HIGH' },
      { date: '2026-02-10', ticker: 'LUNR', event: 'Q4 Earnings Report', impact: 'MEDIUM' },
      { date: '2026-02-15', ticker: 'LUNR', event: 'IM-2 Lunar Landing Mission', impact: 'HIGH' },
      { date: '2026-Q1', ticker: 'ACHR', event: 'FAA Type Certification Expected', impact: 'HIGH' },
      { date: '2026-Q1', ticker: 'JOBY', event: 'FAA Type Certification Expected', impact: 'HIGH' },
      { date: '2026-Q2', ticker: 'ASTS', event: 'BlueBird Commercial Service Launch', impact: 'HIGH' },
      { date: '2026-Q2', ticker: 'RKLB', event: 'Neutron Rocket First Flight', impact: 'HIGH' }
    ];
    
    const DEMO_ACTIVITY = [
      { type: 'trade', title: 'BUY LUNR', subtitle: '100 shares @ $15.20', time: '09:45' },
      { type: 'alert', title: 'MACD Crossover', subtitle: 'LUNR bullish signal', time: '09:44' },
      { type: 'trade', title: 'BUY ASTS', subtitle: '50 shares @ $78.20', time: 'PREV' },
      { type: 'trade', title: 'BUY RKLB', subtitle: '75 shares @ $68.45', time: 'PREV' },
      { type: 'alert', title: 'MACD Crossover', subtitle: 'ASTS bullish signal', time: 'JAN02' }
    ];
    
    // Arcade-style SVG icons
    const invaderSvg = '<svg viewBox="0 0 11 8" fill="currentColor"><rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/><rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/><rect x="2" y="2" width="7" height="1"/><rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/><rect x="0" y="4" width="11" height="1"/><rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/></svg>';
    const scenarioSvg = '<svg viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="7" cy="7" r="5"/><path d="M7 4v3l2 2"/></svg>';
    const bonusSvg = '<svg viewBox="0 0 14 14" fill="currentColor"><path d="M7 1l1.5 4.5H13l-3.5 3 1.5 4.5L7 10l-4 3 1.5-4.5L1 5.5h4.5z"/></svg>';
    
    // Mission log helper for scenario engine
    function pushMissionLog(entry) {
      const feed = document.getElementById('activity-feed');
      if (!feed) return;
      
      const icons = { trade: tradeSvg, alert: alertSvg, invader: invaderSvg, scenario: scenarioSvg, bonus: bonusSvg };
      const time = entry.time || new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const item = document.createElement('div');
      item.className = 'activity-item';
      item.innerHTML = 
        '<div class="activity-icon ' + (entry.type || 'alert') + '">' + (icons[entry.type] || alertSvg) + '</div>' +
        '<div class="activity-content"><div class="activity-title' + (entry.arcade ? ' arcade' : '') + '">' + entry.title + '</div>' +
        '<div class="activity-subtitle">' + entry.subtitle + '</div></div>' +
        '<div class="activity-time">' + time + '</div>';
      
      feed.insertBefore(item, feed.firstChild);
      
      // Keep max 25 entries
      while (feed.children.length > 25) {
        feed.removeChild(feed.lastChild);
      }
    }
    
    async function init() {
      updateTime();
      setInterval(updateTime, 1000);
      try {
        const res = await fetch('data/stats.json');
        const data = await res.json();
        statsData = data.stats;
        buildWatchlist(data.tickers);
      } catch (e) {
        buildWatchlist(['RKLB', 'LUNR', 'ASTS', 'ACHR', 'JOBY', 'BKSY', 'RDW', 'PL', 'EVEX', 'GME']);
      }
      await loadTicker(currentTicker);
      renderStockPositions();
      renderOptionsPositions();
      renderCatalysts();
      renderActivity();
      renderPositionCharts();
      
      // Initialize glossary tooltips
      attachGlossaryTooltips();
      
      // Calculate and update portfolio mood based on demo data
      const totalDailyPnl = DEMO_STOCK_POSITIONS.reduce((sum, pos) => {
        const dailyChange = (pos.current_price - pos.entry_price) / pos.entry_price * 100;
        return sum + dailyChange;
      }, 0) / DEMO_STOCK_POSITIONS.length;
      updatePortfolioMood(totalDailyPnl);
      
      // Initialize volatility display using data-driven score
      const vol = getVolScoreForTicker(currentTicker);
      if (vol > 0) {
        updateVolatilityDisplay(vol);
      }
      
      // Mission log startup message
      setTimeout(() => {
        pushMissionLog({ 
          type: 'scenario', 
          title: 'UPLINK ESTABLISHED', 
          subtitle: 'Mission Control systems online · defensive grid active',
          arcade: true
        });
      }, 500);
    }
    
    function updateTime() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('time-display').innerHTML = h + '<span class="blink">:</span>' + m;
    }
    
    function buildWatchlist(tickers) {
      document.getElementById('watchlist').innerHTML = tickers.map(t => {
        const stats = statsData[t] || {};
        const change = stats.return_1d || 0;
        const theme = tickerThemes[t] || '';
        const color = tickerColors[t] || '#33ff99';
        return '<div class="watchlist-item ' + (t === currentTicker ? 'active' : '') + '" onclick="selectTicker(\'' + t + '\')">' +
          '<div class="watchlist-info"><div class="watchlist-ticker" style="color: ' + color + '">' + t + '</div>' +
          '<div class="watchlist-meta">' + theme + '</div></div>' +
          '<div class="watchlist-data"><div class="watchlist-price">$' + (stats.current || 0).toFixed(2) + '</div>' +
          '<div class="watchlist-change ' + (change >= 0 ? 'positive' : 'negative') + '">' + (change >= 0 ? '+' : '') + change.toFixed(2) + '%</div></div></div>';
      }).join('');
    }
    
    async function loadTicker(ticker) {
      if (!tickerData[ticker]) {
        try { tickerData[ticker] = await (await fetch('data/' + ticker.toLowerCase() + '.json')).json(); } catch (e) { return; }
      }
      currentTicker = ticker;
      updateTickerDisplay();
      updateCharts();
      updateMACDDisplay();
      
      // Call new status functions
      const data = tickerData[ticker];
      if (data) {
        updateTrendStatus(data);
        updateVolumeStatus(data);
        resetSimulation();
        
        // Update volatility display for new ticker
        const vol = getVolScoreForTicker(ticker);
        if (vol > 0) {
          updateVolatilityDisplay(vol);
        }
      }
      
      document.querySelectorAll('.watchlist-item').forEach(el => {
        const tickerEl = el.querySelector('.watchlist-ticker');
        el.classList.toggle('active', tickerEl && tickerEl.textContent === ticker);
      });
    }
    
    function selectTicker(ticker) { loadTicker(ticker); }
    
    // P&L Simulation
    function resetSimulation() {
      const resultEl = document.getElementById('sim-result');
      resultEl.className = 'sim-result';
      resultEl.innerHTML = '<div class="sim-result-label">Select parameters above</div>';
    }
    
    function runPnLSimulation() {
      const data = tickerData[currentTicker];
      if (!data || !data.daily || !data.daily.length) {
        showSimError('No historical data available');
        return;
      }
      
      const dateInput = document.getElementById('sim-entry-date').value;
      const capital = parseFloat(document.getElementById('sim-capital').value) || 0;
      
      if (!dateInput) {
        showSimError('Please select an entry date');
        return;
      }
      
      if (capital < 100) {
        showSimError('Minimum capital: $100');
        return;
      }
      
      const daily = data.daily;
      const entryTs = new Date(dateInput).getTime();
      const dataStartTs = daily[0].t;
      const dataEndTs = daily[daily.length - 1].t;
      
      if (entryTs < dataStartTs) {
        showSimError('Date before available data range');
        return;
      }
      
      // Find entry candle (first candle on or after entry date)
      const entryCandle = daily.find(p => p.t >= entryTs);
      if (!entryCandle) {
        showSimError('No data for selected date');
        return;
      }
      
      const lastCandle = daily[daily.length - 1];
      const entryPrice = entryCandle.c;
      const lastPrice = lastCandle.c;
      
      const shares = Math.floor(capital / entryPrice);
      const actualInvested = shares * entryPrice;
      const currentValue = shares * lastPrice;
      const pnl = currentValue - actualInvested;
      const returnPct = ((lastPrice - entryPrice) / entryPrice) * 100;
      
      const entryDate = new Date(entryCandle.t).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const holdDays = Math.floor((lastCandle.t - entryCandle.t) / 86400000);
      
      const resultEl = document.getElementById('sim-result');
      const isPositive = pnl >= 0;
      
      resultEl.className = 'sim-result ' + (isPositive ? 'positive' : 'negative');
      resultEl.innerHTML = 
        '<div class="sim-result-label">Simulated P&L</div>' +
        '<div class="sim-result-value ' + (isPositive ? 'positive' : 'negative') + '">' +
          (isPositive ? '+' : '−') + '$' + Math.abs(pnl).toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}) +
        '</div>' +
        '<div class="sim-result-pct">' + (isPositive ? '+' : '') + returnPct.toFixed(1) + '% return</div>' +
        '<div class="sim-result-meta">' +
          shares + ' shares @ $' + entryPrice.toFixed(2) + ' → $' + lastPrice.toFixed(2) + '<br>' +
          'Entry: ' + entryDate + ' • ' + holdDays + ' days held' +
        '</div>';
    }
    
    function showSimError(msg) {
      const resultEl = document.getElementById('sim-result');
      resultEl.className = 'sim-result';
      resultEl.innerHTML = '<div class="sim-result-label" style="color: var(--signal-down);">' + msg + '</div>';
    }
    
    function updateTickerDisplay() {
      const stats = statsData[currentTicker] || {};
      const change = stats.return_1d || 0;
      const color = tickerColors[currentTicker] || '#33ff99';
      const tickerEl = document.getElementById('chart-ticker');
      tickerEl.textContent = currentTicker;
      tickerEl.style.color = color;
      tickerEl.style.textShadow = '0 0 20px ' + color + '40';
      document.getElementById('chart-price').textContent = '$' + (stats.current || 0).toFixed(2);
      const el = document.getElementById('chart-change');
      el.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
      el.className = 'ticker-change ' + (change >= 0 ? 'positive' : 'negative');
    }
    
    function updateMACDDisplay() {
      const data = tickerData[currentTicker];
      if (!data) return;
      const source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || !source.length) return;
      const latest = source[source.length - 1];
      
      const macdVal = latest.macd || 0;
      const signalVal = latest.signal || 0;
      const histVal = latest.hist || 0;
      
      if (latest.macd !== undefined) {
        const el = document.getElementById('macd-val');
        el.textContent = latest.macd.toFixed(4);
        el.className = 'macd-value ' + (latest.macd >= 0 ? 'positive' : 'negative');
      }
      if (latest.signal !== undefined) document.getElementById('signal-val').textContent = latest.signal.toFixed(4);
      if (latest.hist !== undefined) {
        const el = document.getElementById('hist-val');
        el.textContent = latest.hist.toFixed(4);
        el.className = 'macd-value ' + (latest.hist >= 0 ? 'positive' : 'negative');
      }
      
      // Update MACD status using glossary
      const macdStatus = getMacdStatus(macdVal, signalVal, histVal);
      const statusEl = document.getElementById('macd-status');
      if (statusEl) {
        const labelEl = statusEl.querySelector('.macd-status-label');
        const copyEl = statusEl.querySelector('.macd-status-copy');
        if (labelEl) labelEl.textContent = macdStatus.label;
        if (copyEl) copyEl.textContent = macdStatus.copy;
        
        // Color based on state
        statusEl.className = 'macd-status';
        if (macdStatus === MACD_STATES.bullish_cross) statusEl.classList.add('bullish');
        else if (macdStatus === MACD_STATES.bearish_cross) statusEl.classList.add('bearish');
      }
    }
    
    function updateTrendStatus(data) {
      const source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || !source.length) return;
      
      // Find the last candle with MA data
      let last = null;
      for (let i = source.length - 1; i >= 0; i--) {
        if (source[i].g100 !== undefined || source[i].g200 !== undefined) {
          last = source[i];
          break;
        }
      }
      
      if (!last) {
        document.getElementById('trend-status-label').textContent = 'NO MA DATA';
        document.getElementById('trend-status-detail').textContent = 'Moving average data unavailable for this range.';
        document.getElementById('trend-status-badge').className = 'trend-status-badge';
        return;
      }
      
      const price = last.c;
      const g100 = last.g100;
      const g150 = last.g150;
      const g200 = last.g200;
      const macdVal = last.macd || 0;
      
      // Compute volatility score for current ticker
      const volScore = getVolScoreForTicker(currentTicker);
      
      const badgeEl = document.getElementById('trend-status-badge');
      const labelEl = document.getElementById('trend-status-label');
      const detailEl = document.getElementById('trend-status-detail');
      const iconEl = document.getElementById('trend-icon');
      
      // Update MA metric values
      document.getElementById('ma100-val').textContent = g100 ? '$' + g100.toFixed(2) : '--';
      document.getElementById('ma150-val').textContent = g150 ? '$' + g150.toFixed(2) : '--';
      document.getElementById('ma200-val').textContent = g200 ? '$' + g200.toFixed(2) : '--';
      
      // Use glossary-based trend state calculation with volatility
      const trendState = getTrendState(price, g100, g150, g200, macdVal, volScore);
      
      // Determine CSS mode class
      let mode = 'neutral';
      if (trendState === HASLUN_GLOSSARY.trend_full_thrust) mode = 'bull';
      else if (trendState === HASLUN_GLOSSARY.trend_reentry_risk) mode = 'bear';
      else if (trendState === HASLUN_GLOSSARY.trend_nebula) mode = 'volatile';
      else if (trendState === HASLUN_GLOSSARY.trend_reversal_attempt) mode = 'neutral';
      else if (trendState === HASLUN_GLOSSARY.trend_drifting) mode = 'neutral';
      
      // Update UI with glossary content
      labelEl.textContent = trendState.label;
      iconEl.textContent = trendState.icon || '◈';
      
      // Build detail text with price context
      const priceContext = `Price $${price.toFixed(2)}`;
      detailEl.innerHTML = `<span class="trend-subtitle">${trendState.subtitle}</span> ${priceContext}. ${trendState.body.split('.')[0]}.`;
      
      badgeEl.className = 'trend-status-badge trend-' + mode;
      badgeEl.title = trendState.flavor; // Add flavor as hover tooltip
      
      // Apply dynamic border color from glossary
      if (trendState.color) {
        badgeEl.style.borderColor = trendState.color;
      }
    }
    
    function updateVolumeStatus(data) {
      const source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || source.length < 10) {
        document.getElementById('volume-status').textContent = '--';
        document.getElementById('volume-status').className = 'volume-badge';
        return;
      }
      
      // Get last 50 candles for average calculation
      const recent = source.slice(-50);
      const vols = recent.map(p => p.v).filter(v => v && v > 0);
      
      if (vols.length < 5) {
        document.getElementById('volume-status').textContent = 'N/A';
        return;
      }
      
      const avg = vols.reduce((a, b) => a + b, 0) / vols.length;
      const current = vols[vols.length - 1];
      const ratio = current / avg;
      
      const el = document.getElementById('volume-status');
      let label, cls;
      
      if (ratio >= 2) {
        label = 'VOL: HIGH (' + ratio.toFixed(1) + '×)';
        cls = 'vol-high';
      } else if (ratio >= 1.25) {
        label = 'VOL: ELEVATED';
        cls = 'vol-elevated';
      } else if (ratio <= 0.5) {
        label = 'VOL: QUIET';
        cls = 'vol-quiet';
      } else {
        label = 'VOL: NORMAL';
        cls = 'vol-normal';
      }
      
      el.textContent = label;
      el.className = 'volume-badge ' + cls;
    }
    
    function setTimeframe(tf) {
      currentTimeframe = tf;
      document.querySelectorAll('.ctrl-btn[data-tf]').forEach(btn => btn.classList.toggle('active', btn.dataset.tf === tf));
      updateCharts();
      updateMACDDisplay();
      // Also update trend and volume for new timeframe
      const data = tickerData[currentTicker];
      if (data) {
        updateTrendStatus(data);
        updateVolumeStatus(data);
      }
    }
    
    function setRange(range) {
      currentRange = range;
      document.querySelectorAll('.ctrl-btn[data-range]').forEach(btn => btn.classList.toggle('active', btn.dataset.range === range));
      updateCharts();
    }
    
    function toggleMA() {
      showMA = !showMA;
      document.getElementById('ma-toggle').classList.toggle('active', showMA);
      updateCharts();
    }
    
    function updateCharts() {
      const data = tickerData[currentTicker];
      if (!data) return;
      let source = currentTimeframe === '1D' ? data.daily : data.intraday;
      if (!source || !source.length) return;
      const cutoff = Date.now() - (rangeDays[currentRange] * 86400000);
      source = source.filter(d => d.t > cutoff);
      const labels = source.map(d => new Date(d.t));
      const closes = source.map(d => d.c);
      const color = tickerColors[currentTicker] || '#33ff99';
      
      if (priceChart) priceChart.destroy();
      const datasets = [{ label: currentTicker, data: closes, borderColor: color, backgroundColor: color + '15', borderWidth: 2, fill: true, tension: 0.1, pointRadius: 0, pointHoverRadius: 4 }];
      if (showMA) {
        if (source.some(d => d.g100)) datasets.push({ label: 'MA 100', data: source.map(d => d.g100), borderColor: '#ffb347', borderWidth: 1, fill: false, tension: 0.1, pointRadius: 0 });
        if (source.some(d => d.g150)) datasets.push({ label: 'MA 150', data: source.map(d => d.g150), borderColor: '#b388ff', borderWidth: 1, fill: false, tension: 0.1, pointRadius: 0 });
        if (source.some(d => d.g200)) datasets.push({ label: 'MA 200', data: source.map(d => d.g200), borderColor: '#47d4ff', borderWidth: 1, fill: false, tension: 0.1, pointRadius: 0 });
      }
      priceChart = new Chart(document.getElementById('price-chart'), {
        type: 'line', data: { labels, datasets },
        options: {
          responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { display: showMA, position: 'top', labels: { boxWidth: 12, font: { size: 10, family: "'IBM Plex Mono', monospace" }, color: '#5a7068' } },
            tooltip: { backgroundColor: 'rgba(10, 12, 15, 0.95)', titleColor: '#e8f4f0', bodyColor: '#a8c0b8', borderColor: '#1e2832', borderWidth: 1, titleFont: { family: "'IBM Plex Mono', monospace" }, bodyFont: { family: "'IBM Plex Mono', monospace" }, callbacks: { label: i => i.dataset.label + ': $' + i.parsed.y.toFixed(2) } }
          },
          scales: {
            x: { type: 'time', grid: { color: 'rgba(51, 255, 153, 0.05)' }, ticks: { color: '#3a4a44', font: { family: "'IBM Plex Mono', monospace", size: 10 }, maxTicksLimit: 8 } },
            y: { position: 'right', grid: { color: 'rgba(51, 255, 153, 0.05)' }, ticks: { color: '#5a7068', font: { family: "'IBM Plex Mono', monospace", size: 10 }, callback: v => '$' + v.toFixed(2) } }
          }
        }
      });
      
      if (macdChart) macdChart.destroy();
      const macdData = source.map(d => d.macd), signalData = source.map(d => d.signal), histData = source.map(d => d.hist);
      macdChart = new Chart(document.getElementById('macd-chart'), {
        type: 'bar', data: { labels, datasets: [
          { label: 'Histogram', data: histData, type: 'bar', order: 2, backgroundColor: histData.map(v => v >= 0 ? 'rgba(51, 255, 153, 0.5)' : 'rgba(255, 107, 107, 0.5)'), borderColor: histData.map(v => v >= 0 ? '#33ff99' : '#ff6b6b'), borderWidth: 1 },
          { label: 'MACD', data: macdData, type: 'line', order: 1, borderColor: '#47d4ff', borderWidth: 1.5, fill: false, tension: 0.1, pointRadius: 0 },
          { label: 'Signal', data: signalData, type: 'line', order: 0, borderColor: '#ffb347', borderWidth: 1.5, fill: false, tension: 0.1, pointRadius: 0 }
        ]},
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { type: 'time', display: false }, y: { position: 'right', grid: { color: 'rgba(51, 255, 153, 0.05)' }, ticks: { color: '#5a7068', font: { family: "'IBM Plex Mono', monospace", size: 9 } } } } }
      });
    }
    
    function switchTab(tabName) {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === tabName + '-panel'));
    }
    
    function switchChartTab(chartName) {
      document.querySelectorAll('.chart-tab').forEach(t => t.classList.toggle('active', t.dataset.chart === chartName));
      document.querySelectorAll('.chart-panel').forEach(p => p.classList.toggle('active', p.id === 'chart-' + chartName));
    }
    
    function renderStockPositions() {
      document.getElementById('stock-tbody').innerHTML = DEMO_STOCK_POSITIONS.map(pos => {
        const value = pos.shares * pos.current_price;
        const pnl = (pos.current_price - pos.entry_price) * pos.shares;
        const pnlPct = ((pos.current_price - pos.entry_price) / pos.entry_price * 100);
        const color = tickerColors[pos.ticker] || '#33ff99';
        const hasDossier = TICKER_PROFILES[pos.ticker] ? true : false;
        const dossierBtn = hasDossier ? '<button class="dossier-btn" onclick="openTickerDossier(\'' + pos.ticker + '\')">◉</button>' : '';
        return '<tr class="position-row" data-ticker="' + pos.ticker + '">' +
          '<td><span class="ticker-tag">' + dossierBtn + '<span class="ticker-dot" style="background: ' + color + '"></span>' + pos.ticker + '</span></td>' +
          '<td style="color: var(--text-dim); font-size: 0.65rem; letter-spacing: 0.05em;">' + (tickerThemes[pos.ticker] || '') + '</td>' +
          '<td>' + pos.shares + '</td><td>$' + pos.entry_price.toFixed(2) + '</td><td>$' + pos.current_price.toFixed(2) + '</td>' +
          '<td>$' + value.toLocaleString() + '</td>' +
          '<td class="' + (pnl >= 0 ? 'pnl-positive' : 'pnl-negative') + '">' + (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(0) + ' (' + (pnlPct >= 0 ? '+' : '') + pnlPct.toFixed(1) + '%)</td></tr>';
      }).join('');
    }
    
    function renderOptionsPositions() {
      document.getElementById('options-tbody').innerHTML = DEMO_OPTIONS.map(pos => {
        const pnl = (pos.current - pos.entry) * pos.contracts * 100;
        const pnlPct = ((pos.current - pos.entry) / pos.entry * 100);
        const color = tickerColors[pos.ticker] || '#33ff99';
        const hasDossier = TICKER_PROFILES[pos.ticker] ? true : false;
        const dossierBtn = hasDossier ? '<button class="dossier-btn" onclick="openTickerDossier(\'' + pos.ticker + '\')">◉</button>' : '';
        return '<tr class="position-row" data-ticker="' + pos.ticker + '">' +
          '<td><span class="ticker-tag">' + dossierBtn + '<span class="ticker-dot" style="background: ' + color + '"></span>' + pos.ticker + '</span></td>' +
          '<td><span class="structure-tag">' + pos.structure + '</span></td><td>' + pos.strikes + '</td>' +
          '<td>$' + pos.entry.toFixed(2) + '</td><td>$' + pos.current.toFixed(2) + '</td>' +
          '<td class="' + (pnl >= 0 ? 'pnl-positive' : 'pnl-negative') + '">' + (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(0) + ' (' + (pnlPct >= 0 ? '+' : '') + pnlPct.toFixed(0) + '%)</td>' +
          '<td>' + pos.delta.toFixed(2) + '</td></tr>';
      }).join('');
    }
    
    function renderPositionCharts() {
      const positions = DEMO_OPTIONS.map(pos => ({ ticker: pos.ticker, value: pos.current * pos.contracts * 100, color: tickerColors[pos.ticker] || '#33ff99' })).sort((a, b) => b.value - a.value);
      const maxValue = Math.max(...positions.map(p => p.value));
      const totalValue = positions.reduce((s, x) => s + x.value, 0);
      document.getElementById('chart-sizes').innerHTML = '<div class="bar-chart">' + positions.map(p =>
        '<div class="bar-row"><span class="bar-ticker" style="color: ' + p.color + '">' + p.ticker + '</span>' +
        '<div class="bar-container"><div class="bar-fill" style="width: ' + (p.value/maxValue*100) + '%; background: ' + p.color + '">' + Math.round(p.value/totalValue*100) + '%</div></div>' +
        '<span class="bar-value">$' + p.value.toLocaleString() + '</span></div>'
      ).join('') + '</div>';
      
      const pnlData = DEMO_OPTIONS.map(pos => ({ ticker: pos.ticker, pnl: (pos.current - pos.entry) * pos.contracts * 100, pct: ((pos.current - pos.entry) / pos.entry * 100), color: tickerColors[pos.ticker] || '#33ff99' })).sort((a, b) => b.pnl - a.pnl);
      const maxPnl = Math.max(...pnlData.map(p => Math.abs(p.pnl)));
      let winners = 0, losers = 0, totalPnl = 0;
      pnlData.forEach(p => { if (p.pnl >= 0) winners++; else losers++; totalPnl += p.pnl; });
      document.getElementById('chart-pnl').innerHTML = '<div class="bar-chart">' + pnlData.map(p =>
        '<div class="pnl-row"><span class="bar-ticker" style="color: ' + p.color + '">' + p.ticker + '</span>' +
        '<div class="pnl-bar-container"><div class="pnl-center-line"></div>' +
        '<div class="pnl-bar ' + (p.pnl >= 0 ? 'positive' : 'negative') + '" style="width: ' + (Math.abs(p.pnl)/maxPnl*50) + '%">' + (p.pnl >= 0 ? '+' : '') + p.pct.toFixed(0) + '%</div></div>' +
        '<span class="pnl-amount ' + (p.pnl >= 0 ? 'positive' : 'negative') + '">' + (p.pnl >= 0 ? '+' : '') + '$' + Math.abs(p.pnl).toLocaleString() + '</span></div>'
      ).join('') + '</div>' +
      '<div class="summary-row"><div class="summary-item"><div class="summary-value positive">' + winners + '</div><div class="summary-label">Winners</div></div>' +
      '<div class="summary-item"><div class="summary-value positive">+$' + totalPnl.toLocaleString() + '</div><div class="summary-label">Total P&L</div></div>' +
      '<div class="summary-item"><div class="summary-value negative">' + losers + '</div><div class="summary-label">Losers</div></div></div>';
    }
    
    function renderCatalysts() {
      document.getElementById('catalyst-list').innerHTML = DEMO_CATALYSTS.map(cat => {
        const color = tickerColors[cat.ticker] || '#5a7068';
        return '<div class="catalyst-item"><span class="catalyst-date">' + cat.date + '</span>' +
          '<span class="catalyst-ticker" style="color: ' + color + '">' + cat.ticker + '</span>' +
          '<span class="catalyst-event">' + cat.event + '</span>' +
          '<span class="catalyst-impact ' + cat.impact.toLowerCase() + '">' + cat.impact + '</span></div>';
      }).join('');
    }
    
    function renderActivity() {
      const tradeSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>';
      const alertSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';
      document.getElementById('activity-feed').innerHTML = DEMO_ACTIVITY.map(act =>
        '<div class="activity-item"><div class="activity-icon ' + act.type + '">' + (act.type === 'trade' ? tradeSvg : alertSvg) + '</div>' +
        '<div class="activity-content"><div class="activity-title">' + act.title + '</div><div class="activity-subtitle">' + act.subtitle + '</div></div>' +
        '<div class="activity-time">' + act.time + '</div></div>'
      ).join('');
    }
    
    function toggleKillSwitch() {
      const btn = document.querySelector('.kill-switch-btn');
      const status = document.querySelector('.kill-switch-status');
      if (btn.classList.contains('stop')) {
        btn.classList.replace('stop', 'resume');
        btn.textContent = 'RESUME OPERATIONS';
        status.textContent = 'Trading halted';
      } else {
        btn.classList.replace('resume', 'stop');
        btn.textContent = 'ABORT ALL TRADES';
        status.textContent = 'System operational';
      }
    }
    
    function toggleDevConsole() {
      const console = document.getElementById('dev-console');
      console.classList.toggle('visible');
    }
    
    // ============================================
    // CONTROL PANEL INTERACTIVITY
    // ============================================
    
    const controlState = {
      smoothing: 50,
      forecast: 30,
      sensitivity: 65,
      momentum: true,
      heatmap: false,
      alerts: true,
      risk: 60
    };
    
    // Knob rotation values
    const knobSettings = {
      smoothing: { values: [0, 25, 50, 75, 100], labels: ['0%', '25%', '50%', '75%', '100%'], current: 2 },
      forecast: { values: [7, 14, 30, 60, 90], labels: ['7 DAYS', '14 DAYS', '30 DAYS', '60 DAYS', '90 DAYS'], current: 2 }
    };
    
    function cycleKnob(knobId) {
      const settings = knobSettings[knobId];
      settings.current = (settings.current + 1) % settings.values.length;
      
      const knob = document.getElementById('knob-' + knobId);
      const valueEl = document.getElementById(knobId + '-value');
      
      // Rotate knob (each step is ~60 degrees)
      const rotation = (settings.current - 2) * 60;
      knob.style.transform = 'rotate(' + rotation + 'deg)';
      
      // Update value display
      valueEl.textContent = settings.labels[settings.current];
      controlState[knobId] = settings.values[settings.current];
      
      // Visual feedback
      knob.style.boxShadow = '0 4px 8px rgba(0,0,0,0.5), 0 0 20px var(--phosphor-glow), inset 0 2px 4px rgba(255,255,255,0.1)';
      setTimeout(() => {
        knob.style.boxShadow = '';
      }, 200);
      
      // Update band label for smoothing knob
      if (knobId === 'smoothing') {
        updateSmoothingBandLabel(settings.values[settings.current]);
      }
      
      // Update forecast display for forecast knob
      if (knobId === 'forecast') {
        updateForecastDisplay(settings.values[settings.current]);
      }
      
      // Trigger chart update effect
      flashUpdate();
      logControlChange(knobId.toUpperCase() + ' set to ' + settings.labels[settings.current]);
    }
    
    function toggleSwitch(switchId) {
      const toggle = document.getElementById('toggle-' + switchId);
      const isActive = toggle.classList.toggle('active');
      controlState[switchId] = isActive;
      
      // Visual feedback in log
      logControlChange(switchId.toUpperCase() + ' ' + (isActive ? 'ENABLED' : 'DISABLED'));
      
      // Apply effects based on switch
      if (switchId === 'momentum' && priceChart) {
        // Toggle MA visibility
        showMA = isActive;
        document.getElementById('ma-toggle').classList.toggle('active', isActive);
        updateCharts();
      }
      
      flashUpdate();
    }
    
    function handleSliderClick(event, sliderId) {
      const track = document.getElementById(sliderId + '-track');
      const fill = document.getElementById(sliderId + '-fill');
      const thumb = document.getElementById(sliderId + '-thumb');
      
      const rect = track.getBoundingClientRect();
      const percent = Math.max(0, Math.min(100, ((event.clientX - rect.left) / rect.width) * 100));
      
      fill.style.width = percent + '%';
      thumb.style.left = percent + '%';
      controlState[sliderId] = Math.round(percent);
      
      // Update risk gauge based on sensitivity
      updateRiskGauge(percent);
      logControlChange('SENSITIVITY adjusted to ' + Math.round(percent) + '%');
      flashUpdate();
    }
    
    function updateRiskGauge(sensitivity) {
      // Risk inversely correlates with sensitivity (more sensitive = catches more risk)
      const riskLevel = 100 - (sensitivity * 0.4);
      const needle = document.getElementById('risk-needle');
      const fill = document.getElementById('risk-fill');
      const value = document.getElementById('risk-value');
      
      // Needle rotation: -45deg (low) to 225deg (high)
      const rotation = -45 + (riskLevel / 100 * 180);
      needle.style.transform = 'rotate(' + rotation + 'deg)';
      fill.style.height = riskLevel + '%';
      
      if (riskLevel < 33) {
        value.textContent = 'LOW';
        fill.style.background = 'var(--phosphor)';
      } else if (riskLevel < 66) {
        value.textContent = 'MODERATE';
        fill.style.background = 'linear-gradient(0deg, var(--amber) 0%, var(--phosphor) 100%)';
      } else {
        value.textContent = 'HIGH';
        fill.style.background = 'linear-gradient(0deg, #ff4444 0%, var(--amber) 100%)';
      }
      
      controlState.risk = riskLevel;
    }
    
    function runAnalysis(e) {
      const btn = e && e.currentTarget ? e.currentTarget : document.getElementById('run-analysis-btn');
      btn.textContent = '◌ ANALYZING...';
      btn.disabled = true;
      
      // Animate LED array
      const leds = document.querySelectorAll('.led-array .array-led');
      let ledIndex = 0;
      const ledInterval = setInterval(() => {
        leds.forEach((led, i) => {
          led.classList.remove('on', 'amber');
          if (i <= ledIndex) led.classList.add('on');
        });
        ledIndex++;
        if (ledIndex > leds.length) {
          clearInterval(ledInterval);
          
          // Compute data-driven volatility score
          const volScore = getVolScoreForTicker(currentTicker) || (15 + Math.random() * 20);
          const newVol = volScore.toFixed(1);
          document.getElementById('vol-display').textContent = newVol;
          
          // Update LED array based on volatility (0-40 mapped to 0-8 LEDs)
          const volLevel = Math.ceil((volScore / 40) * leds.length);
          leds.forEach((led, i) => {
            led.classList.remove('on', 'amber', 'red');
            if (i < volLevel) {
              if (i < 4) led.classList.add('on');
              else if (i < 6) led.classList.add('amber');
              else led.classList.add('red');
            }
          });
          
          btn.textContent = '▸ RUN ANALYSIS';
          btn.disabled = false;
          
          logControlChange('ANALYSIS COMPLETE — Vol: ' + newVol + 'σ');
        }
      }, 100);
      
      flashUpdate();
    }
    
    function resetControls() {
      // Reset knobs
      knobSettings.smoothing.current = 2;
      knobSettings.forecast.current = 2;
      document.getElementById('knob-smoothing').style.transform = 'rotate(0deg)';
      document.getElementById('knob-forecast').style.transform = 'rotate(0deg)';
      document.getElementById('smoothing-value').textContent = '50%';
      document.getElementById('forecast-value').textContent = '30 DAYS';
      
      // Reset toggles
      document.getElementById('toggle-momentum').classList.add('active');
      document.getElementById('toggle-heatmap').classList.remove('active');
      document.getElementById('toggle-alerts').classList.add('active');
      
      // Reset slider
      document.getElementById('sensitivity-fill').style.width = '65%';
      document.getElementById('sensitivity-thumb').style.left = '65%';
      
      // Reset gauge
      updateRiskGauge(65);
      
      // Reset state
      Object.assign(controlState, {
        smoothing: 50,
        forecast: 30,
        sensitivity: 65,
        momentum: true,
        heatmap: false,
        alerts: true
      });
      
      logControlChange('ALL CONTROLS RESET TO DEFAULTS');
      flashUpdate();
    }
    
    function flashUpdate() {
      // Flash the panel header to show update
      const header = document.querySelector('.panel-header');
      if (header) {
        header.style.background = 'rgba(51, 255, 153, 0.1)';
        setTimeout(() => {
          header.style.background = '';
        }, 150);
      }
    }
    
    function logControlChange(message) {
      // Add to activity feed
      const feed = document.getElementById('activity-feed');
      if (!feed) return;
      
      const now = new Date();
      const time = String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0');
      
      const alertSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
      
      const item = document.createElement('div');
      item.className = 'activity-item';
      item.innerHTML = '<div class="activity-icon alert">' + alertSvg + '</div>' +
        '<div class="activity-content"><div class="activity-title">Control Update</div><div class="activity-subtitle">' + message + '</div></div>' +
        '<div class="activity-time">' + time + '</div>';
      
      feed.insertBefore(item, feed.firstChild);
      
      // Keep only last 10 items
      while (feed.children.length > 10) {
        feed.removeChild(feed.lastChild);
      }
    }
    
    // Animate scanner blips periodically
    setInterval(() => {
      const blips = document.querySelectorAll('.scanner-blips .blip');
      blips.forEach(blip => {
        blip.style.top = (10 + Math.random() * 70) + '%';
        blip.style.left = (10 + Math.random() * 70) + '%';
      });
    }, 3000);
    
    let startTime = null;
    function updateUptime() {
      if (!startTime) startTime = Date.now();
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const h = String(Math.floor(elapsed / 3600)).padStart(2, '0');
      const m = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
      const s = String(elapsed % 60).padStart(2, '0');
      const el = document.getElementById('uptime');
      if (el) el.textContent = 'UPTIME: ' + h + ':' + m + ':' + s;
    }
    setInterval(updateUptime, 1000);
    
    // =========================================================================
    // ARCADE EXTRAS MODULE – HUD, SFX, themes, terminal, toasts, Konami code
    // =========================================================================
    (function() {
      // Config
      const ARCADE_MISSIONS = [
        { id:'tabs',      text:'Explore 3 panels', done:false },
        { id:'analysis',  text:'Run analysis once', done:false },
        { id:'simulation', text:'Run P&L simulation', done:false },
        { id:'find_invader', text:'Find the hidden invader', done:false },
        { id:'arcade_score', text:'Score 500+ in Signal Invaders', done:false }
      ];
      
      const THEMES = {
        Terminal: { '--phosphor': '#33ff99', '--amber': '#ffb347' },
        Arcade:   { '--phosphor': '#7cff00', '--amber': '#ffd93d' },
        NeonNoir: { '--phosphor': '#7afcff', '--amber': '#ff6fd8' }
      };
      
      // State
      let sfxEnabled = true;
      let tabsVisited = new Set();
      const root = document.documentElement;
      
      // Audio context (lazy init)
      let audioCtx = null;
      function getAudioContext() {
        if (!audioCtx) {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          audioCtx = AudioCtx ? new AudioCtx() : null;
        }
        return audioCtx;
      }
      
      // Tiny beep sound
      window.beep = function(freq = 520, duration = 0.08) {
        if (!sfxEnabled) return;
        const ctx = getAudioContext();
        if (!ctx) return;
        if (ctx.state === 'suspended') ctx.resume();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.frequency.value = freq;
        osc.type = 'square';
        osc.connect(gain);
        gain.connect(ctx.destination);
        gain.gain.setValueAtTime(0.12, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
        osc.start();
        osc.stop(ctx.currentTime + duration);
      };
      
      // Toast notifications
      window.showToast = function(message, level = 'info') {
        const container = document.getElementById('toast-container');
        if (!container) return;
        const div = document.createElement('div');
        div.className = 'toast' + (level !== 'info' ? ' ' + level : '');
        div.textContent = message;
        container.appendChild(div);
        requestAnimationFrame(() => div.classList.add('show'));
        setTimeout(() => {
          div.classList.remove('show');
          setTimeout(() => div.remove(), 300);
        }, 2300);
      };
      
      // Terminal log
      window.logTerminal = function(msg) {
        const el = document.getElementById('terminal-log');
        if (!el) return;
        const line = document.createElement('div');
        line.className = 'terminal-log-line';
        const now = new Date();
        const hh = String(now.getHours()).padStart(2,'0');
        const mm = String(now.getMinutes()).padStart(2,'0');
        const ss = String(now.getSeconds()).padStart(2,'0');
        line.innerHTML = '<span class="time">['+hh+':'+mm+':'+ss+']</span> ' + msg;
        el.appendChild(line);
        el.scrollTop = el.scrollHeight;
        // Keep max 50 lines
        while (el.children.length > 50) el.removeChild(el.firstChild);
      };
      
      // Periodic uplink messages
      const uplinkMessages = [
        'uplink stable · packet OK',
        'telemetry sync · nominal',
        'signal lock · holding',
        'data stream · active',
        'quantum link · stable'
      ];
      setInterval(() => {
        const msg = uplinkMessages[Math.floor(Math.random() * uplinkMessages.length)];
        logTerminal(msg);
      }, 7000);
      
      // Missions HUD
      function renderMissions() {
        const hud = document.getElementById('arcade-hud');
        const list = document.getElementById('mission-list');
        if (!hud || !list) return;
        hud.classList.remove('hidden');
        list.innerHTML = ARCADE_MISSIONS.map(m =>
          '<li class="arcade-mission'+(m.done?' completed':'')+'">'+m.text+'</li>'
        ).join('');
      }
      
      window.completeMission = function(id) {
        const mission = ARCADE_MISSIONS.find(m => m.id === id);
        if (!mission || mission.done) return;
        mission.done = true;
        renderMissions();
        showToast('Mission complete: ' + mission.text);
        logTerminal('mission complete · ' + mission.id);
        beep(800, 0.12);
        
        // Check if all missions complete
        if (ARCADE_MISSIONS.every(m => m.done)) {
          setTimeout(() => {
            showToast('🏆 ALL MISSIONS COMPLETE!', 'alert');
            beep(1000, 0.15);
          }, 500);
        }
      };
      
      // Theme switching
      function initThemeSelect() {
        const select = document.getElementById('theme-select');
        if (!select) return;
        select.addEventListener('change', () => {
          const theme = THEMES[select.value];
          if (!theme) return;
          Object.entries(theme).forEach(([k,v]) => root.style.setProperty(k, v));
          logTerminal('theme applied · ' + select.value);
          beep(600, 0.07);
        });
      }
      
      // SFX toggle
      function initSfxToggle() {
        const toggle = document.getElementById('sfx-toggle');
        if (!toggle) return;
        sfxEnabled = toggle.checked;
        toggle.addEventListener('change', () => {
          sfxEnabled = toggle.checked;
          logTerminal('sfx ' + (sfxEnabled ? 'enabled' : 'muted'));
          if (sfxEnabled) beep(700, 0.06);
        });
      }
      
      // Tab visit tracking
      function initTabTracking() {
        const tabs = document.querySelectorAll('.nav-tab');
        tabs.forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.getAttribute('data-tab') || btn.textContent.trim();
            tabsVisited.add(id);
            if (tabsVisited.size >= 3) completeMission('tabs');
            beep(500, 0.05);
          });
        });
      }
      
      // Wrap runPnLSimulation for mission tracking
      const originalSimulation = window.runPnLSimulation;
      if (typeof originalSimulation === 'function') {
        window.runPnLSimulation = function() {
          completeMission('simulation');
          logTerminal('P&L simulation executed');
          beep(520, 0.08);
          return originalSimulation.apply(this, arguments);
        };
      }
      
      // Wrap runAnalysis if it exists
      const originalRunAnalysis = window.runAnalysis;
      if (typeof originalRunAnalysis === 'function') {
        window.runAnalysis = function() {
          completeMission('analysis');
          logTerminal('scenario analysis · control panel executed');
          showToast('Analysis fired');
          beep(520, 0.08);
          return originalRunAnalysis.apply(this, arguments);
        };
      }
      
      // Konami code -> activate pixel beam easter egg
      const KONAMI = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
      let konamiIndex = 0;
      
      window.addEventListener('keydown', (e) => {
        const key = e.key.length === 1 ? e.key.toLowerCase() : e.key;
        const target = KONAMI[konamiIndex].toLowerCase();
        if (key === target) {
          konamiIndex++;
          if (konamiIndex === KONAMI.length) {
            konamiIndex = 0;
            // Activate the pixel beam
            const beam = document.getElementById('pixel-beam');
            const ground = document.getElementById('pixel-ground');
            if (beam) beam.classList.add('active');
            if (ground) ground.classList.add('active');
            completeMission('secret');
            showToast('👾 INVADER DEFENSE GRID UNLOCKED', 'alert');
            logTerminal('konami code accepted · easter egg revealed');
            beep(900, 0.15);
          }
        } else {
          konamiIndex = 0;
        }
      });
      
      // Initialize on DOM ready
      function initArcade() {
        initThemeSelect();
        initSfxToggle();
        initTabTracking();
        renderMissions();
        initAboutOverlay();
        initPipboyDossier();
        logTerminal('arcade module initialized');
        logTerminal('system ready · awaiting input');
      }
      
      // =========================================================================
      // PIP-BOY TICKER DOSSIER CONTROLLER
      // =========================================================================
      function initPipboyDossier() {
        const overlay = document.getElementById('pipboy-overlay');
        const closeBtn = document.getElementById('pipboy-close-btn');
        const dials = document.querySelectorAll('.pipboy-dial');
        
        if (!overlay || !closeBtn) return;
        
        let currentDossierTicker = null;
        
        // Open dossier for a specific ticker
        window.openTickerDossier = function(ticker) {
          const profile = TICKER_PROFILES[ticker];
          if (!profile) {
            logTerminal('ERROR: No dossier found for ' + ticker);
            return;
          }
          
          currentDossierTicker = ticker;
          const color = tickerColors[ticker] || 'var(--phosphor)';
          
          // Update header
          document.getElementById('pipboy-codename').textContent = 'CODENAME: ' + profile.codename;
          const tickerNameEl = document.getElementById('pipboy-ticker-name');
          tickerNameEl.textContent = ticker + ' — ' + profile.name;
          tickerNameEl.style.color = color;
          document.getElementById('pipboy-sector').textContent = profile.sector;
          
          // Update threat level
          const threatEl = document.getElementById('pipboy-threat');
          const threatClass = profile.threat_level.toLowerCase().replace(' ', '');
          threatEl.textContent = profile.threat_level;
          threatEl.className = 'pipboy-threat-level ' + threatClass;
          
          // Update overview panel
          document.getElementById('pipboy-summary').textContent = profile.summary;
          document.getElementById('pipboy-lore').textContent = '"' + profile.lore + '"';
          
          // Update thesis panel
          document.getElementById('pipboy-thesis').textContent = profile.thesis;
          
          // Update catalysts panel
          const catalystsEl = document.getElementById('pipboy-catalysts-list');
          catalystsEl.innerHTML = profile.catalysts.map(cat => `
            <div class="pipboy-catalyst">
              <div class="pipboy-catalyst-date">${cat.date}</div>
              <div class="pipboy-catalyst-event">${cat.event}</div>
              <div class="pipboy-catalyst-impact ${cat.impact.toLowerCase()}">${cat.impact}</div>
            </div>
          `).join('');
          
          // Update risks panel
          const risksEl = document.getElementById('pipboy-risks-list');
          risksEl.innerHTML = profile.risks.map(risk => `
            <div class="pipboy-risk">${risk}</div>
          `).join('');
          
          // Update vitals panel
          const vitalsEl = document.getElementById('pipboy-vitals-grid');
          vitalsEl.innerHTML = Object.entries(profile.vitals).map(([key, val]) => `
            <div class="pipboy-vital">
              <div class="pipboy-vital-value">${val}</div>
              <div class="pipboy-vital-label">${key.replace(/_/g, ' ')}</div>
            </div>
          `).join('');
          
          // Update stats bar with live data if available
          updatePipboyStats(ticker);
          
          // Reset to overview panel
          dials.forEach(d => d.classList.remove('active'));
          dials[0].classList.add('active');
          document.querySelectorAll('.pipboy-panel').forEach(p => p.classList.remove('active'));
          document.getElementById('panel-overview').classList.add('active');
          
          // Show overlay
          overlay.classList.remove('hidden');
          requestAnimationFrame(() => {
            overlay.classList.add('visible');
          });
          
          logTerminal('DOSSIER ACCESSED: ' + ticker + ' [' + profile.codename + ']');
          beep(523, 0.06);
          setTimeout(() => beep(659, 0.06), 80);
        };
        
        // Update live stats in the stats bar
        function updatePipboyStats(ticker) {
          const statsBar = document.getElementById('pipboy-stats-bar');
          const data = tickerData[ticker];
          
          if (!data) {
            statsBar.innerHTML = `
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Price</div>
              </div>
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Change</div>
              </div>
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Volume</div>
              </div>
              <div class="pipboy-stat">
                <div class="pipboy-stat-value">--</div>
                <div class="pipboy-stat-label">Volatility</div>
              </div>
            `;
            return;
          }
          
          const series = data.daily || data.intraday || [];
          const last = series[series.length - 1] || {};
          const prev = series[series.length - 2] || {};
          
          const price = last.c || 0;
          const change = prev.c ? ((last.c - prev.c) / prev.c * 100) : 0;
          const volume = last.v || 0;
          const vol = getVolScoreForTicker(ticker) || 0;
          
          const changeClass = change >= 0 ? 'positive' : 'negative';
          const changeSign = change >= 0 ? '+' : '';
          
          statsBar.innerHTML = `
            <div class="pipboy-stat">
              <div class="pipboy-stat-value">$${price.toFixed(2)}</div>
              <div class="pipboy-stat-label">Price</div>
            </div>
            <div class="pipboy-stat">
              <div class="pipboy-stat-value ${changeClass}">${changeSign}${change.toFixed(2)}%</div>
              <div class="pipboy-stat-label">Change</div>
            </div>
            <div class="pipboy-stat">
              <div class="pipboy-stat-value">${formatVolume(volume)}</div>
              <div class="pipboy-stat-label">Volume</div>
            </div>
            <div class="pipboy-stat">
              <div class="pipboy-stat-value">${vol.toFixed(1)}σ</div>
              <div class="pipboy-stat-label">Volatility</div>
            </div>
          `;
        }
        
        function formatVolume(v) {
          if (v >= 1e9) return (v / 1e9).toFixed(1) + 'B';
          if (v >= 1e6) return (v / 1e6).toFixed(1) + 'M';
          if (v >= 1e3) return (v / 1e3).toFixed(1) + 'K';
          return v.toString();
        }
        
        // Close dossier
        function closeDossier() {
          overlay.classList.remove('visible');
          setTimeout(() => overlay.classList.add('hidden'), 200);
          beep(330, 0.05);
          logTerminal('dossier closed');
        }
        
        closeBtn.addEventListener('click', closeDossier);
        
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay || e.target.classList.contains('pipboy-backdrop')) {
            closeDossier();
          }
        });
        
        window.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && overlay.classList.contains('visible')) {
            closeDossier();
          }
        });
        
        // Dial navigation
        dials.forEach(dial => {
          dial.addEventListener('click', () => {
            const panel = dial.dataset.panel;
            
            dials.forEach(d => d.classList.remove('active'));
            dial.classList.add('active');
            
            document.querySelectorAll('.pipboy-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('panel-' + panel).classList.add('active');
            
            beep(440, 0.04);
          });
        });
        
        // Keyboard navigation with left/right arrows
        window.addEventListener('keydown', (e) => {
          if (!overlay.classList.contains('visible')) return;
          
          const dialArr = Array.from(dials);
          const activeIdx = dialArr.findIndex(d => d.classList.contains('active'));
          
          if (e.key === 'ArrowRight' && activeIdx < dialArr.length - 1) {
            dialArr[activeIdx + 1].click();
          } else if (e.key === 'ArrowLeft' && activeIdx > 0) {
            dialArr[activeIdx - 1].click();
          }
        });
        
        // Wire up watchlist items to open dossier on double-click or info button
        document.querySelectorAll('.watchlist-item').forEach(item => {
          const tickerEl = item.querySelector('.watchlist-ticker');
          if (!tickerEl) return;
          
          const ticker = tickerEl.textContent.trim();
          
          // Add info button
          const infoBtn = document.createElement('button');
          infoBtn.className = 'watchlist-info-btn';
          infoBtn.innerHTML = '◉';
          infoBtn.title = 'Open Dossier';
          infoBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            openTickerDossier(ticker);
          });
          
          // Insert before the ticker name or at the start
          const wrapper = item.querySelector('.watchlist-info') || item;
          wrapper.style.position = 'relative';
          item.insertBefore(infoBtn, item.firstChild);
        });
        
        logTerminal('pip-boy dossier system initialized');
      }
      
      // About Overlay Controller
      function initAboutOverlay() {
        const overlay = document.getElementById('about-overlay');
        const trigger = document.getElementById('about-trigger-btn');
        const closeBtn = document.getElementById('about-close-btn');

        if (!overlay || !trigger || !closeBtn) return;

        function openAbout() {
          overlay.classList.remove('hidden');
          requestAnimationFrame(() => {
            overlay.classList.add('visible');
          });
          logTerminal('about overlay opened · simulation dossier viewed');
          beep(440, 0.08);
        }

        function closeAbout() {
          overlay.classList.remove('visible');
          setTimeout(() => overlay.classList.add('hidden'), 260);
          beep(330, 0.06);
        }

        trigger.addEventListener('click', openAbout);
        closeBtn.addEventListener('click', closeAbout);

        overlay.addEventListener('click', (e) => {
          if (e.target === overlay || e.target.classList.contains('about-backdrop')) {
            closeAbout();
          }
        });

        window.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && overlay.classList.contains('visible')) {
            closeAbout();
          }
        });
      }
      
      // =========================================================================
      // INVADER ARMY INITIALIZATION
      // =========================================================================
      function initInvaderArmy() {
        const army = document.getElementById('invader-army');
        if (!army) return;

        const spriteSvg = `
          <svg class="invader-sprite-small" viewBox="0 0 11 8">
            <rect x="3" y="0" width="1" height="1" />
            <rect x="7" y="0" width="1" height="1" />
            <rect x="2" y="1" width="1" height="1" />
            <rect x="3" y="1" width="1" height="1" />
            <rect x="4" y="1" width="1" height="1" />
            <rect x="6" y="1" width="1" height="1" />
            <rect x="7" y="1" width="1" height="1" />
            <rect x="8" y="1" width="1" height="1" />
            <rect x="1" y="2" width="1" height="1" />
            <rect x="2" y="2" width="1" height="1" />
            <rect x="3" y="2" width="1" height="1" />
            <rect x="4" y="2" width="1" height="1" />
            <rect x="5" y="2" width="1" height="1" />
            <rect x="6" y="2" width="1" height="1" />
            <rect x="7" y="2" width="1" height="1" />
            <rect x="8" y="2" width="1" height="1" />
            <rect x="9" y="2" width="1" height="1" />
            <rect x="0" y="3" width="1" height="1" />
            <rect x="2" y="3" width="1" height="1" />
            <rect x="3" y="3" width="1" height="1" />
            <rect x="4" y="3" width="1" height="1" />
            <rect x="5" y="3" width="1" height="1" />
            <rect x="6" y="3" width="1" height="1" />
            <rect x="7" y="3" width="1" height="1" />
            <rect x="8" y="3" width="1" height="1" />
            <rect x="10" y="3" width="1" height="1" />
            <rect x="0" y="4" width="1" height="1" />
            <rect x="3" y="4" width="1" height="1" />
            <rect x="7" y="4" width="1" height="1" />
            <rect x="10" y="4" width="1" height="1" />
            <rect x="1" y="5" width="1" height="1" />
            <rect x="2" y="5" width="1" height="1" />
            <rect x="3" y="5" width="1" height="1" />
            <rect x="7" y="5" width="1" height="1" />
            <rect x="8" y="5" width="1" height="1" />
            <rect x="9" y="5" width="1" height="1" />
            <rect x="4" y="6" width="1" height="1" />
            <rect x="5" y="6" width="1" height="1" />
            <rect x="6" y="6" width="1" height="1" />
            <rect x="2" y="7" width="1" height="1" />
            <rect x="3" y="7" width="1" height="1" />
            <rect x="7" y="7" width="1" height="1" />
            <rect x="8" y="7" width="1" height="1" />
          </svg>
        `;

        const rows = 5;
        const invadersPerRow = 10;
        const topOffset = 80;
        const rowSpacing = 45;

        for (let r = 0; r < rows; r++) {
          const row = document.createElement('div');
          row.className = 'invader-row';
          row.style.top = (topOffset + r * rowSpacing) + 'px';

          const marchDuration = 8 + r * 1.2;
          const marchDelay = r * 0.4;
          row.style.animation = `invader-army-march ${marchDuration}s linear ${marchDelay}s infinite alternate`;

          row.innerHTML = new Array(invadersPerRow).fill(spriteSvg).join('');
          army.appendChild(row);
        }
      }

      // =========================================================================
      // COLOR PROFILE CONTROL (Pip-Boy Style)
      // =========================================================================
      function initColorProfileControl() {
        const slider = document.getElementById('color-hue-slider');
        const preview = document.getElementById('color-hue-preview');
        if (!slider || !preview) return;

        const root = document.documentElement;

        function setHue(h) {
          root.style.setProperty('--accent-hue', h);
          preview.style.background = `hsl(${h},100%,60%)`;
          if (typeof logTerminal === 'function') {
            logTerminal(`color profile set · hue ${h}`);
          }
        }

        slider.addEventListener('input', (e) => {
          setHue(e.target.value);
        });

        // Initialize
        setHue(slider.value);
      }

      // =========================================================================
      // HOLOGRAPHIC SHIP PANEL
      // =========================================================================
      const HOLO_SHIPS = {
        RKLB: {
          label: "RKLB · ORBITAL BUS",
          path: `
            <polyline points="10,30 30,10 70,10 90,30 70,50 30,50 10,30" class="holo-line"/>
            <polyline points="30,10 40,5 60,5 70,10" class="holo-line"/>
            <line x1="25" y1="30" x2="75" y2="30" class="holo-line"/>
            <line x1="40" y1="50" x2="40" y2="55" class="holo-line"/>
            <line x1="60" y1="50" x2="60" y2="55" class="holo-line"/>
          `
        },
        LUNR: {
          label: "LUNR · LUNAR SCOUT",
          path: `
            <polyline points="10,35 25,20 40,25 60,25 75,20 90,35 60,45 40,45 10,35" class="holo-line"/>
            <circle cx="50" cy="23" r="6" class="holo-line"/>
            <line x1="40" y1="45" x2="35" y2="55" class="holo-line"/>
            <line x1="60" y1="45" x2="65" y2="55" class="holo-line"/>
          `
        },
        JOBY: {
          label: "JOBY · EVTOL FRAME",
          path: `
            <polyline points="15,35 30,25 70,25 85,35 70,45 30,45 15,35" class="holo-line"/>
            <circle cx="30" cy="20" r="7" class="holo-line"/>
            <circle cx="70" cy="20" r="7" class="holo-line"/>
            <line x1="30" y1="27" x2="30" y2="35" class="holo-line"/>
            <line x1="70" y1="27" x2="70" y2="35" class="holo-line"/>
          `
        },
        ACHR: {
          label: "ACHR · ARCHER VTOL",
          path: `
            <polyline points="20,30 35,15 65,15 80,30 65,45 35,45 20,30" class="holo-line"/>
            <circle cx="35" cy="18" r="5" class="holo-line"/>
            <circle cx="65" cy="18" r="5" class="holo-line"/>
            <line x1="50" y1="15" x2="50" y2="45" class="holo-line"/>
          `
        },
        ASTS: {
          label: "ASTS · BLUEBIRD SAT",
          path: `
            <rect x="35" y="20" width="30" height="20" rx="2" class="holo-line"/>
            <line x1="20" y1="30" x2="35" y2="30" class="holo-line"/>
            <line x1="65" y1="30" x2="80" y2="30" class="holo-line"/>
            <rect x="10" y="22" width="12" height="16" rx="1" class="holo-line"/>
            <rect x="78" y="22" width="12" height="16" rx="1" class="holo-line"/>
          `
        },
        BKSY: {
          label: "BKSY · BLACKSKY SAT",
          path: `
            <circle cx="50" cy="30" r="12" class="holo-line"/>
            <line x1="15" y1="30" x2="38" y2="30" class="holo-line"/>
            <line x1="62" y1="30" x2="85" y2="30" class="holo-line"/>
            <rect x="8" y="24" width="10" height="12" rx="1" class="holo-line"/>
            <rect x="82" y="24" width="10" height="12" rx="1" class="holo-line"/>
          `
        },
        GME: {
          label: "GME · POWER CORE",
          path: `
            <polygon points="50,10 70,25 70,40 50,55 30,40 30,25" class="holo-line"/>
            <line x1="50" y1="10" x2="50" y2="55" class="holo-line"/>
            <line x1="30" y1="25" x2="70" y2="25" class="holo-line"/>
            <line x1="30" y1="40" x2="70" y2="40" class="holo-line"/>
          `
        },
        ATI: {
          label: "ATI · FORGE MATRIX",
          path: `
            <rect x="20" y="15" width="60" height="30" rx="3" class="holo-line"/>
            <line x1="20" y1="25" x2="80" y2="25" class="holo-line"/>
            <line x1="20" y1="35" x2="80" y2="35" class="holo-line"/>
            <circle cx="35" cy="30" r="4" class="holo-line"/>
            <circle cx="65" cy="30" r="4" class="holo-line"/>
            <line x1="50" y1="45" x2="50" y2="55" class="holo-line"/>
          `
        },
        CACI: {
          label: "CACI · INTEL NODE",
          path: `
            <polygon points="50,8 80,20 80,40 50,52 20,40 20,20" class="holo-line"/>
            <circle cx="50" cy="30" r="8" class="holo-line"/>
            <line x1="50" y1="22" x2="50" y2="8" class="holo-line"/>
            <line x1="58" y1="30" x2="80" y2="30" class="holo-line"/>
            <line x1="42" y1="30" x2="20" y2="30" class="holo-line"/>
          `
        },
        EVEX: {
          label: "EVEX · DRONE SWARM",
          path: `
            <circle cx="50" cy="30" r="6" class="holo-line"/>
            <circle cx="30" cy="20" r="4" class="holo-line"/>
            <circle cx="70" cy="20" r="4" class="holo-line"/>
            <circle cx="30" cy="40" r="4" class="holo-line"/>
            <circle cx="70" cy="40" r="4" class="holo-line"/>
            <line x1="36" y1="24" x2="44" y2="28" class="holo-line"/>
            <line x1="64" y1="24" x2="56" y2="28" class="holo-line"/>
            <line x1="36" y1="36" x2="44" y2="32" class="holo-line"/>
            <line x1="64" y1="36" x2="56" y2="32" class="holo-line"/>
          `
        },
        HON: {
          label: "HON · AEGIS CRUISER",
          path: `
            <polyline points="15,30 25,15 75,15 85,30 75,45 25,45 15,30" class="holo-line"/>
            <rect x="35" y="20" width="30" height="20" rx="2" class="holo-line"/>
            <line x1="15" y1="30" x2="35" y2="30" class="holo-line"/>
            <line x1="65" y1="30" x2="85" y2="30" class="holo-line"/>
            <circle cx="50" cy="30" r="5" class="holo-line"/>
          `
        },
        IRDM: {
          label: "IRDM · COMM ARRAY",
          path: `
            <circle cx="50" cy="30" r="15" class="holo-line"/>
            <circle cx="50" cy="30" r="8" class="holo-line"/>
            <circle cx="50" cy="30" r="2" class="holo-line"/>
            <line x1="50" y1="10" x2="50" y2="5" class="holo-line"/>
            <line x1="35" y1="20" x2="28" y2="13" class="holo-line"/>
            <line x1="65" y1="20" x2="72" y2="13" class="holo-line"/>
          `
        },
        KTOS: {
          label: "KTOS · STRIKE DRONE",
          path: `
            <polyline points="10,30 40,15 50,20 60,15 90,30 60,45 50,40 40,45 10,30" class="holo-line"/>
            <circle cx="50" cy="30" r="5" class="holo-line"/>
            <line x1="50" y1="25" x2="50" y2="15" class="holo-line"/>
            <line x1="10" y1="30" x2="25" y2="30" class="holo-line"/>
            <line x1="75" y1="30" x2="90" y2="30" class="holo-line"/>
          `
        },
        LOAR: {
          label: "LOAR · CARGO HAULER",
          path: `
            <rect x="20" y="18" width="60" height="24" rx="4" class="holo-line"/>
            <line x1="35" y1="18" x2="35" y2="42" class="holo-line"/>
            <line x1="50" y1="18" x2="50" y2="42" class="holo-line"/>
            <line x1="65" y1="18" x2="65" y2="42" class="holo-line"/>
            <circle cx="30" cy="50" r="4" class="holo-line"/>
            <circle cx="70" cy="50" r="4" class="holo-line"/>
          `
        },
        MP: {
          label: "MP · RARE ELEMENT",
          path: `
            <polygon points="50,5 65,15 65,35 50,45 35,35 35,15" class="holo-line"/>
            <polygon points="50,15 58,20 58,30 50,35 42,30 42,20" class="holo-line"/>
            <line x1="35" y1="25" x2="20" y2="25" class="holo-line"/>
            <line x1="65" y1="25" x2="80" y2="25" class="holo-line"/>
            <line x1="50" y1="45" x2="50" y2="55" class="holo-line"/>
          `
        },
        RDW: {
          label: "RDW · RECON SAT",
          path: `
            <ellipse cx="50" cy="30" rx="20" ry="12" class="holo-line"/>
            <line x1="30" y1="30" x2="15" y2="20" class="holo-line"/>
            <line x1="70" y1="30" x2="85" y2="20" class="holo-line"/>
            <rect x="12" y="15" width="8" height="12" rx="1" class="holo-line"/>
            <rect x="80" y="15" width="8" height="12" rx="1" class="holo-line"/>
            <circle cx="50" cy="30" r="4" class="holo-line"/>
          `
        },
        PL: {
          label: "PL · PLANET LABS",
          path: `
            <rect x="30" y="20" width="40" height="20" rx="3" class="holo-line"/>
            <line x1="25" y1="25" x2="10" y2="18" class="holo-line"/>
            <line x1="25" y1="35" x2="10" y2="42" class="holo-line"/>
            <line x1="75" y1="25" x2="90" y2="18" class="holo-line"/>
            <line x1="75" y1="35" x2="90" y2="42" class="holo-line"/>
            <circle cx="50" cy="30" r="6" class="holo-line"/>
          `
        }
      };

      function updateHoloForTicker(ticker) {
        const svg = document.getElementById('holo-ship-svg');
        const labelEl = document.getElementById('holo-ticker-label');
        if (!svg || !labelEl) return;

        const ship = HOLO_SHIPS[ticker] || HOLO_SHIPS['RKLB'];
        labelEl.textContent = ship.label;
        svg.innerHTML = ship.path;

        svg.style.opacity = '0.6';
        requestAnimationFrame(() => {
          svg.style.transition = 'opacity 0.3s ease';
          svg.style.opacity = '1';
        });
      }

      // Hook into ticker selection to update holo ship
      const originalSelectTicker = window.selectTicker;
      if (typeof originalSelectTicker === 'function') {
        window.selectTicker = function(ticker) {
          updateHoloForTicker(ticker);
          return originalSelectTicker.apply(this, arguments);
        };
      }

      // =========================================================================
      // TUBE OVERLOAD ON RUN ANALYSIS
      // =========================================================================
      function initTubeOverload() {
        const originalRunAnalysis = window.runAnalysis;
        if (typeof originalRunAnalysis === 'function') {
          window.runAnalysis = function(e) {
            const tubes = document.getElementById('tube-cluster');
            if (tubes) {
              tubes.classList.add('overload');
              setTimeout(() => tubes.classList.remove('overload'), 900);
            }
            return originalRunAnalysis.apply(this, arguments);
          };
        }
      }

      // =========================================================================
      // CLOSE ENCOUNTERS SIGNAL BOARD
      // =========================================================================
      function initEncountersBoard() {
        const lights = [...document.querySelectorAll('.encounters-board .enc-light')];
        const status = document.getElementById('signal-status');
        if (!lights.length || !status) return;

        let userInteracting = false;
        let interactionTimeout;

        function setStatus(text, mode) {
          status.textContent = text;
          status.className = 'signal-status ' + mode;
        }

        function updateSignalLevel(value) {
          value = Number(value);
          const activeCount = Math.round((value / 100) * lights.length);

          lights.forEach((l, i) => l.classList.toggle('active', i < activeCount));

          if (value < 20) {
            setStatus("STATIC / NOISE", "noise");
          } else if (value < 80) {
            setStatus("LISTENING…", "");
          } else {
            setStatus("⚡ COMMS LOCKED ⚡", "locked");
            if (typeof beep === 'function') beep(660, 0.08);
          }
        }

        // Hook into sliders, knobs, etc.
        document.querySelectorAll('input[type="range"]').forEach(slider => {
          slider.addEventListener('input', () => {
            userInteracting = true;
            clearTimeout(interactionTimeout);
            updateSignalLevel(slider.value);
            interactionTimeout = setTimeout(() => { userInteracting = false; }, 3000);
          });
        });

        // Knob clicks also affect signal
        document.querySelectorAll('.knob').forEach(knob => {
          knob.addEventListener('click', () => {
            userInteracting = true;
            clearTimeout(interactionTimeout);
            const val = parseInt(knob.dataset.value) || 50;
            updateSignalLevel(val);
            interactionTimeout = setTimeout(() => { userInteracting = false; }, 3000);
          });
        });

        // Atmospheric idle animation - alien pulse when not interacting
        setInterval(() => {
          if (userInteracting) return;
          const random = Math.floor(Math.random() * 100);
          updateSignalLevel(random);
        }, 1200);

        logTerminal('encounters signal array online');
      }

      // =========================================================================
      // CARGO BAY HEALTH SYSTEM
      // =========================================================================
      const CARGO_SYSTEMS = {
        'RKLB': { name: 'NAV THRUSTERS', critical: true },
        'LUNR': { name: 'SOLAR ARRAY', critical: true },
        'JOBY': { name: 'EVTOL DECK', critical: false },
        'ASTS': { name: 'COMMS RELAY', critical: true },
        'ACHR': { name: 'LIFT JETS', critical: false },
        'EVEX': { name: 'SUPPORT DRONE', critical: false },
        'BKSY': { name: 'OPTICS BAY', critical: false },
        'GME': { name: 'POWER CORE', critical: true }
      };

      function updateCargoHealth(ticker, pnl) {
        const item = document.querySelector(`.cargo-item[data-ticker="${ticker}"]`);
        if (!item) return;

        const health = item.querySelector('.cargo-health');
        item.classList.remove('damaged', 'optimal');

        if (pnl < -5) {
          item.classList.add('damaged');
          health.textContent = "CRITICAL";
        } else if (pnl < 0) {
          item.classList.add('damaged');
          health.textContent = "FAULT";
        } else if (pnl > 10) {
          item.classList.add('optimal');
          health.textContent = "OPTIMAL+";
        } else if (pnl > 0) {
          item.classList.add('optimal');
          health.textContent = "OPTIMAL";
        } else {
          health.textContent = "NOMINAL";
        }
      }

      function initCargoBay() {
        // Update cargo bay based on demo positions
        if (typeof DEMO_STOCK_POSITIONS !== 'undefined') {
          DEMO_STOCK_POSITIONS.forEach(pos => {
            const pnlPct = ((pos.current_price - pos.entry_price) / pos.entry_price) * 100;
            updateCargoHealth(pos.ticker, pnlPct);
          });
        }
        logTerminal('cargo bay manifest synchronized');
      }

      // =========================================================================
      // TRAJECTORY NAVIGATOR (Derivatives Path Simulator)
      // =========================================================================
      function initTrajectoryCanvas() {
        const canvas = document.getElementById('trajectory-canvas');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        
        // Set actual canvas size
        function resizeCanvas() {
          const rect = canvas.getBoundingClientRect();
          canvas.width = rect.width * window.devicePixelRatio;
          canvas.height = rect.height * window.devicePixelRatio;
          ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Star field
        const stars = [];
        for (let i = 0; i < 50; i++) {
          stars.push({
            x: Math.random() * 100,
            y: Math.random() * 100,
            size: Math.random() * 1.5 + 0.5,
            alpha: Math.random() * 0.5 + 0.2
          });
        }

        let volatility = 2;
        let horizon = 45;
        let phase = 0;

        function drawTrajectory() {
          const w = canvas.getBoundingClientRect().width;
          const h = canvas.getBoundingClientRect().height;
          
          ctx.clearRect(0, 0, w, h);
          
          // Draw stars
          stars.forEach(star => {
            ctx.beginPath();
            ctx.arc(star.x / 100 * w, star.y / 100 * h, star.size, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
            ctx.fill();
          });

          // Draw trajectory path
          ctx.beginPath();
          ctx.moveTo(0, h * 0.7);

          let y = h * 0.7;
          const hue = getComputedStyle(document.documentElement).getPropertyValue('--accent-hue') || 150;

          for (let x = 0; x < w; x += 4) {
            const noise = Math.sin((x + phase) / 25) * volatility;
            const trend = -0.15 * (horizon / 100);
            y += noise + trend;
            y = Math.max(10, Math.min(h - 10, y));
            ctx.lineTo(x, y);
          }

          ctx.strokeStyle = `hsla(${hue}, 100%, 60%, 0.9)`;
          ctx.lineWidth = 2;
          ctx.shadowColor = `hsla(${hue}, 100%, 60%, 0.8)`;
          ctx.shadowBlur = 8;
          ctx.stroke();
          ctx.shadowBlur = 0;

          // Draw current position dot
          ctx.beginPath();
          ctx.arc(w * 0.1, h * 0.65, 4, 0, Math.PI * 2);
          ctx.fillStyle = `hsl(${hue}, 100%, 60%)`;
          ctx.fill();

          // Draw target zone
          ctx.beginPath();
          ctx.arc(w * 0.85, y, 6, 0, Math.PI * 2);
          ctx.strokeStyle = `hsla(${hue}, 100%, 60%, 0.6)`;
          ctx.lineWidth = 1.5;
          ctx.stroke();

          phase += 0.5;
        }

        // Animate
        function animate() {
          drawTrajectory();
          requestAnimationFrame(animate);
        }
        animate();

        // Hook into controls
        document.querySelectorAll('input[type="range"]').forEach(slider => {
          slider.addEventListener('input', () => {
            volatility = 1 + (slider.value / 50);
          });
        });

        document.querySelectorAll('.knob').forEach(knob => {
          knob.addEventListener('click', () => {
            horizon = parseInt(knob.dataset.value) || 45;
          });
        });

        logTerminal('trajectory navigator online');
      }

      // =========================================================================
      // LORE ENGINE - Random In-World Events
      // =========================================================================
      const LORE_EVENTS = [
        "Unknown beacon pinged portside array.",
        "Telemetry drift corrected automatically.",
        "Cargo handlers report minor anomalies.",
        "Charts updated to reflect stellar winds.",
        "Crew reports strange vibrations in deck 3.",
        "AI suggests caution in derivatives bay.",
        "Solar flare activity detected — shields nominal.",
        "Quantum entanglement stable at 99.7%.",
        "Navigation computer recalibrating...",
        "Distant signal classified as potential artificial.",
        "Life support cycling — all systems green.",
        "Hull integrity scan complete. No breaches.",
        "Spectral analysis of nearby object complete.",
        "FTL drive cooling cycle initiated.",
        "Crew morale index: NOMINAL.",
        "Market anomaly detected in sector 7-G.",
        "Thermal signature identified — classifying...",
        "Backup power reserves at 94%.",
        "Long-range sensors detect movement.",
        "Docking bay pressure equalized.",
        "Encrypted transmission received. Decoding...",
        "Asteroid field mapped. Course adjusted.",
        "Bio-scanner reports all crew accounted for.",
        "Reactor output stable at 87%.",
        "External cameras detect debris field ahead."
      ];

      function initLoreEngine() {
        setInterval(() => {
          const event = LORE_EVENTS[Math.floor(Math.random() * LORE_EVENTS.length)];
          if (typeof logTerminal === 'function') {
            logTerminal(event);
          }
        }, 18000); // Every 18 seconds

        // Initial lore message
        setTimeout(() => {
          logTerminal('Lore engine initialized. Monitoring all frequencies.');
        }, 2000);
      }

      // =========================================================================
      // AMBIENT PARTICLES
      // =========================================================================
      function initAmbientParticles() {
        const container = document.getElementById('ambient-particles');
        if (!container) return;

        const particleCount = 15;
        
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 15 + 's';
          particle.style.animationDuration = (12 + Math.random() * 8) + 's';
          container.appendChild(particle);
        }
      }

      // =========================================================================
      // KONAMI CODE EASTER EGG - INVADER ATTACK
      // =========================================================================
      function initKonamiCode() {
        const KONAMI = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;
        let konamiUnlocked = false;

        document.addEventListener('keydown', (e) => {
          const key = e.key.length === 1 ? e.key.toLowerCase() : e.key;
          
          if (key === KONAMI[konamiIndex]) {
            konamiIndex++;
            
            if (konamiIndex === KONAMI.length) {
              konamiIndex = 0;
              if (!konamiUnlocked) {
                triggerInvaderAttack();
                konamiUnlocked = true;
                setTimeout(() => { konamiUnlocked = false; }, 10000);
              }
            }
          } else {
            konamiIndex = 0;
          }
        });
      }

      function triggerInvaderAttack() {
        const overlay = document.getElementById('invader-attack-overlay');
        const flash = document.getElementById('attack-flash');
        if (!overlay) return;

        // Play sound if available
        if (typeof beep === 'function') {
          beep(180, 0.3);
          setTimeout(() => beep(140, 0.3), 100);
          setTimeout(() => beep(100, 0.5), 200);
        }

        // Screen flash
        flash.classList.add('flash');
        setTimeout(() => flash.classList.remove('flash'), 150);

        // Toast notification
        if (typeof showToast === 'function') {
          showToast('🛸 INVADER ATTACK DETECTED!', 'alert');
        }

        // Log to terminal
        if (typeof logTerminal === 'function') {
          logTerminal('⚠ ALERT: Hostile formation detected! Shields up!');
        }

        // Create invader wave
        overlay.classList.add('active');
        overlay.innerHTML = '';

        const invaderCount = 15;
        const invaderSVG = `<svg viewBox="0 0 11 8" class="attack-invader">
          <rect x="2" y="0" width="1" height="1"/><rect x="8" y="0" width="1" height="1"/>
          <rect x="3" y="1" width="1" height="1"/><rect x="7" y="1" width="1" height="1"/>
          <rect x="2" y="2" width="7" height="1"/>
          <rect x="1" y="3" width="2" height="1"/><rect x="4" y="3" width="3" height="1"/><rect x="8" y="3" width="2" height="1"/>
          <rect x="0" y="4" width="11" height="1"/>
          <rect x="0" y="5" width="1" height="1"/><rect x="2" y="5" width="7" height="1"/><rect x="10" y="5" width="1" height="1"/>
          <rect x="0" y="6" width="1" height="1"/><rect x="2" y="6" width="1" height="1"/><rect x="8" y="6" width="1" height="1"/><rect x="10" y="6" width="1" height="1"/>
          <rect x="3" y="7" width="2" height="1"/><rect x="6" y="7" width="2" height="1"/>
        </svg>`;

        for (let i = 0; i < invaderCount; i++) {
          const wrapper = document.createElement('div');
          wrapper.innerHTML = invaderSVG;
          const invader = wrapper.firstChild;
          invader.style.left = (5 + Math.random() * 90) + '%';
          invader.style.animationDelay = (Math.random() * 2) + 's';
          invader.style.animationDuration = (2 + Math.random() * 2) + 's';
          overlay.appendChild(invader);
        }

        // Clear after animation
        setTimeout(() => {
          overlay.classList.remove('active');
          overlay.innerHTML = '';
          if (typeof logTerminal === 'function') {
            logTerminal('Invader threat neutralized. Shields nominal.');
          }
        }, 5000);

        // Complete arcade mission if available
        if (typeof completeMission === 'function') {
          completeMission('find_invader');
        }
      }

      // =========================================================================
      // SIGNAL INVADERS - PLAYABLE ARCADE GAME
      // =========================================================================
      const SignalInvaders = {
        canvas: null,
        ctx: null,
        active: false,
        animationId: null,
        
        // Game state
        score: 0,
        lives: 3,
        wave: 1,
        gameOver: false,
        paused: false,
        
        // Player
        player: { x: 270, y: 360, width: 26, height: 16, speed: 5 },
        
        // Game objects
        bullets: [],
        enemies: [],
        enemyBullets: [],
        particles: [],
        stars: [],
        
        // Timing
        lastEnemyShot: 0,
        enemyDirection: 1,
        enemyDropAmount: 0,
        
        // Keys
        keys: {},
        
        init() {
          this.canvas = document.getElementById('invaders-canvas');
          if (!this.canvas) return;
          this.ctx = this.canvas.getContext('2d');
          
          // Generate starfield
          this.stars = [];
          for (let i = 0; i < 50; i++) {
            this.stars.push({
              x: Math.random() * 600,
              y: Math.random() * 400,
              size: Math.random() * 1.5 + 0.5,
              alpha: Math.random() * 0.5 + 0.2
            });
          }
          
          // Event listeners
          this.handleKeyDown = (e) => {
            if (!this.active) return;
            this.keys[e.key] = true;
            if (e.key === ' ' && !this.gameOver) {
              e.preventDefault();
              this.shoot();
            }
            if (e.key === 'Escape') {
              this.close();
            }
          };
          
          this.handleKeyUp = (e) => {
            this.keys[e.key] = false;
          };
          
          document.addEventListener('keydown', this.handleKeyDown);
          document.addEventListener('keyup', this.handleKeyUp);
          
          // Close button
          const closeBtn = document.getElementById('invaders-close-btn');
          if (closeBtn) {
            closeBtn.onclick = () => this.close();
          }
        },
        
        start() {
          if (!this.canvas) this.init();
          
          // Reset game state
          this.score = 0;
          this.lives = 3;
          this.wave = 1;
          this.gameOver = false;
          this.player.x = 270;
          this.bullets = [];
          this.enemies = [];
          this.enemyBullets = [];
          this.particles = [];
          this.enemyDirection = 1;
          
          this.spawnWave();
          this.updateUI();
          
          // Show overlay
          const overlay = document.getElementById('signal-invaders-overlay');
          if (overlay) {
            overlay.classList.remove('hidden');
            overlay.classList.add('active');
          }
          
          this.active = true;
          this.gameLoop();
          
          if (typeof logTerminal === 'function') {
            logTerminal('SIGNAL INVADERS initialized. Defend the array!');
          }
          if (typeof beep === 'function') {
            beep(440, 0.1);
            setTimeout(() => beep(550, 0.1), 100);
            setTimeout(() => beep(660, 0.15), 200);
          }
        },
        
        close() {
          this.active = false;
          if (this.animationId) {
            cancelAnimationFrame(this.animationId);
          }
          
          const overlay = document.getElementById('signal-invaders-overlay');
          if (overlay) {
            overlay.classList.remove('active');
            setTimeout(() => overlay.classList.add('hidden'), 300);
          }
          
          // Log final score
          if (typeof logTerminal === 'function') {
            logTerminal(`SIGNAL INVADERS ended. Final score: ${this.score}`);
          }
        },
        
        spawnWave() {
          this.enemies = [];
          const rows = Math.min(4 + Math.floor(this.wave / 2), 6);
          const cols = Math.min(8 + this.wave, 10);
          
          for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
              this.enemies.push({
                x: 60 + col * 52,
                y: 40 + row * 36,
                width: 22,
                height: 16,
                type: row < 2 ? 'elite' : 'normal'
              });
            }
          }
          
          document.getElementById('invaders-message').textContent = `WAVE ${this.wave} - INCOMING!`;
          setTimeout(() => {
            document.getElementById('invaders-message').textContent = '';
          }, 2000);
        },
        
        shoot() {
          if (this.bullets.length < 3) { // Max 3 bullets at once
            this.bullets.push({
              x: this.player.x + this.player.width / 2 - 2,
              y: this.player.y - 8,
              width: 4,
              height: 8
            });
            if (typeof beep === 'function') {
              beep(880, 0.05);
            }
          }
        },
        
        updateUI() {
          document.getElementById('invaders-score').textContent = this.score;
          document.getElementById('invaders-lives').textContent = '♥'.repeat(Math.max(0, this.lives));
          document.getElementById('invaders-wave').textContent = this.wave;
        },
        
        gameLoop() {
          if (!this.active) return;
          
          this.update();
          this.render();
          
          this.animationId = requestAnimationFrame(() => this.gameLoop());
        },
        
        update() {
          if (this.gameOver) return;
          
          // Player movement
          if (this.keys['ArrowLeft'] || this.keys['a']) {
            this.player.x = Math.max(10, this.player.x - this.player.speed);
          }
          if (this.keys['ArrowRight'] || this.keys['d']) {
            this.player.x = Math.min(600 - this.player.width - 10, this.player.x + this.player.speed);
          }
          
          // Update bullets
          this.bullets = this.bullets.filter(b => {
            b.y -= 7;
            return b.y > -10;
          });
          
          // Update enemy bullets
          this.enemyBullets = this.enemyBullets.filter(b => {
            b.y += 4;
            return b.y < 420;
          });
          
          // Move enemies
          let hitEdge = false;
          this.enemies.forEach(e => {
            e.x += this.enemyDirection * (1 + this.wave * 0.3);
            if (e.x < 10 || e.x > 600 - e.width - 10) hitEdge = true;
          });
          
          if (hitEdge) {
            this.enemyDirection *= -1;
            this.enemies.forEach(e => e.y += 12);
          }
          
          // Enemy shooting
          if (Date.now() - this.lastEnemyShot > Math.max(500, 2000 - this.wave * 200)) {
            const shooters = this.enemies.filter(e => 
              !this.enemies.some(other => other.x === e.x && other.y > e.y)
            );
            if (shooters.length > 0) {
              const shooter = shooters[Math.floor(Math.random() * shooters.length)];
              this.enemyBullets.push({
                x: shooter.x + shooter.width / 2 - 2,
                y: shooter.y + shooter.height,
                width: 4,
                height: 6
              });
              this.lastEnemyShot = Date.now();
            }
          }
          
          // Collision: bullets vs enemies
          this.bullets.forEach((bullet, bi) => {
            this.enemies.forEach((enemy, ei) => {
              if (this.collides(bullet, enemy)) {
                // Create particles
                for (let i = 0; i < 8; i++) {
                  this.particles.push({
                    x: enemy.x + enemy.width / 2,
                    y: enemy.y + enemy.height / 2,
                    vx: (Math.random() - 0.5) * 6,
                    vy: (Math.random() - 0.5) * 6,
                    life: 30,
                    color: enemy.type === 'elite' ? '#ffb347' : '#33ff99'
                  });
                }
                
                this.bullets.splice(bi, 1);
                this.enemies.splice(ei, 1);
                this.score += enemy.type === 'elite' ? 20 : 10;
                this.updateUI();
                
                if (typeof beep === 'function') {
                  beep(200, 0.08);
                }
              }
            });
          });
          
          // Collision: enemy bullets vs player
          this.enemyBullets.forEach((bullet, bi) => {
            if (this.collides(bullet, this.player)) {
              this.enemyBullets.splice(bi, 1);
              this.lives--;
              this.updateUI();
              
              // Player hit particles
              for (let i = 0; i < 12; i++) {
                this.particles.push({
                  x: this.player.x + this.player.width / 2,
                  y: this.player.y + this.player.height / 2,
                  vx: (Math.random() - 0.5) * 8,
                  vy: (Math.random() - 0.5) * 8,
                  life: 40,
                  color: '#ff6b6b'
                });
              }
              
              if (typeof beep === 'function') {
                beep(150, 0.2);
              }
              
              if (this.lives <= 0) {
                this.endGame();
              }
            }
          });
          
          // Enemy reaches bottom
          if (this.enemies.some(e => e.y > 340)) {
            this.endGame();
          }
          
          // Wave cleared
          if (this.enemies.length === 0) {
            this.wave++;
            this.spawnWave();
            this.updateUI();
            if (typeof beep === 'function') {
              beep(660, 0.1);
              setTimeout(() => beep(880, 0.15), 100);
            }
          }
          
          // Update particles
          this.particles = this.particles.filter(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
            return p.life > 0;
          });
        },
        
        collides(a, b) {
          return a.x < b.x + b.width &&
                 a.x + a.width > b.x &&
                 a.y < b.y + b.height &&
                 a.y + a.height > b.y;
        },
        
        endGame() {
          this.gameOver = true;
          document.getElementById('invaders-message').textContent = `GAME OVER - SCORE: ${this.score}`;
          
          if (typeof showToast === 'function') {
            showToast(`Signal Invaders: ${this.score} points!`, 'info');
          }
          
          // Complete arcade mission for high score
          if (this.score >= 500 && typeof completeMission === 'function') {
            completeMission('arcade_score');
          }
          
          // Restart after delay
          setTimeout(() => {
            if (this.active) {
              this.start();
            }
          }, 3000);
        },
        
        render() {
          const ctx = this.ctx;
          ctx.clearRect(0, 0, 600, 400);
          
          // Draw starfield
          this.stars.forEach(star => {
            ctx.fillStyle = `rgba(51, 255, 153, ${star.alpha})`;
            ctx.fillRect(star.x, star.y, star.size, star.size);
          });
          
          // Draw player ship (pixel art style)
          ctx.fillStyle = '#33ff99';
          ctx.shadowColor = '#33ff99';
          ctx.shadowBlur = 8;
          // Ship body
          ctx.fillRect(this.player.x + 10, this.player.y, 6, 4);
          ctx.fillRect(this.player.x + 6, this.player.y + 4, 14, 4);
          ctx.fillRect(this.player.x + 2, this.player.y + 8, 22, 4);
          ctx.fillRect(this.player.x, this.player.y + 12, 26, 4);
          ctx.shadowBlur = 0;
          
          // Draw bullets
          ctx.fillStyle = '#33ff99';
          ctx.shadowColor = '#33ff99';
          ctx.shadowBlur = 6;
          this.bullets.forEach(b => {
            ctx.fillRect(b.x, b.y, b.width, b.height);
          });
          ctx.shadowBlur = 0;
          
          // Draw enemies
          this.enemies.forEach(e => {
            ctx.fillStyle = e.type === 'elite' ? '#ffb347' : '#33ff99';
            ctx.shadowColor = ctx.fillStyle;
            ctx.shadowBlur = 4;
            // Invader shape
            ctx.fillRect(e.x + 4, e.y, 4, 4);
            ctx.fillRect(e.x + 14, e.y, 4, 4);
            ctx.fillRect(e.x + 2, e.y + 4, 18, 4);
            ctx.fillRect(e.x, e.y + 8, 22, 4);
            ctx.fillRect(e.x + 2, e.y + 12, 4, 4);
            ctx.fillRect(e.x + 16, e.y + 12, 4, 4);
            ctx.shadowBlur = 0;
          });
          
          // Draw enemy bullets
          ctx.fillStyle = '#ff6b6b';
          ctx.shadowColor = '#ff6b6b';
          ctx.shadowBlur = 4;
          this.enemyBullets.forEach(b => {
            ctx.fillRect(b.x, b.y, b.width, b.height);
          });
          ctx.shadowBlur = 0;
          
          // Draw particles
          this.particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life / 40;
            ctx.fillRect(p.x, p.y, 3, 3);
          });
          ctx.globalAlpha = 1;
          
          // Game over overlay
          if (this.gameOver) {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, 600, 400);
            ctx.fillStyle = '#ff6b6b';
            ctx.font = '24px Orbitron';
            ctx.textAlign = 'center';
            ctx.fillText('SIGNAL LOST', 300, 180);
            ctx.fillStyle = '#33ff99';
            ctx.font = '16px "IBM Plex Mono"';
            ctx.fillText(`Final Score: ${this.score}`, 300, 220);
            ctx.fillStyle = '#888';
            ctx.font = '12px "IBM Plex Mono"';
            ctx.fillText('Restarting...', 300, 260);
          }
        }
      };

      // Cheat code listener for "INVADER" text
      let cheatBuffer = '';
      document.addEventListener('keydown', (e) => {
        if (e.key.length === 1) {
          cheatBuffer += e.key.toUpperCase();
          cheatBuffer = cheatBuffer.slice(-10);
          
          if (cheatBuffer.includes('INVADER')) {
            cheatBuffer = '';
            SignalInvaders.start();
          }
        }
      });

      // =========================================================================
      // ENHANCED EVENTS TIMELINE RENDERING
      // =========================================================================
      function initEnhancedCatalysts() {
        const originalRenderCatalysts = window.renderCatalysts;
        
        window.renderCatalysts = function() {
          const container = document.getElementById('catalyst-list');
          if (!container) return;

          // Gather all catalysts from ticker profiles
          const allCatalysts = [];
          const TICKER_PROFILES = window.TICKER_PROFILES || {};
          
          Object.entries(TICKER_PROFILES).forEach(([ticker, profile]) => {
            if (profile.catalysts) {
              profile.catalysts.forEach(cat => {
                allCatalysts.push({
                  ticker,
                  date: cat.date,
                  event: cat.event,
                  impact: cat.impact || 'medium'
                });
              });
            }
          });

          // Sort by date
          allCatalysts.sort((a, b) => new Date(a.date) - new Date(b.date));

          // Render as timeline
          if (allCatalysts.length > 0) {
            container.innerHTML = '<div class="events-timeline">' + 
              allCatalysts.slice(0, 12).map(cat => {
                const impactClass = cat.impact.toLowerCase() + '-impact';
                const daysUntil = Math.ceil((new Date(cat.date) - new Date()) / (1000 * 60 * 60 * 24));
                const countdownText = daysUntil > 0 ? `T-${daysUntil} DAYS` : daysUntil === 0 ? 'TODAY' : `T+${Math.abs(daysUntil)} DAYS`;
                
                return `
                  <div class="timeline-event ${impactClass}" onclick="if(window.openTickerDossier) openTickerDossier('${cat.ticker}')">
                    <div class="timeline-header">
                      <span class="timeline-ticker">${cat.ticker}</span>
                      <span class="timeline-date">${cat.date}</span>
                    </div>
                    <div class="timeline-title">${cat.event}</div>
                    <div class="timeline-meta">
                      <span class="timeline-countdown">${countdownText}</span>
                      <span class="catalyst-impact ${cat.impact.toLowerCase()}">${cat.impact.toUpperCase()}</span>
                    </div>
                  </div>
                `;
              }).join('') + 
            '</div>';
          } else if (typeof originalRenderCatalysts === 'function') {
            originalRenderCatalysts();
          }
        };
      }

      // =========================================================================
      // BUTTON RIPPLE EFFECT
      // =========================================================================
      function initRippleEffects() {
        document.addEventListener('click', (e) => {
          const button = e.target.closest('.push-btn, .sim-btn, .nav-tab, .chart-tab, .cargo-item');
          if (!button) return;

          const rect = button.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          const ripple = document.createElement('span');
          ripple.className = 'ripple';
          ripple.style.left = x + 'px';
          ripple.style.top = y + 'px';

          button.style.position = 'relative';
          button.style.overflow = 'hidden';
          button.appendChild(ripple);

          setTimeout(() => ripple.remove(), 600);
        });
      }

      // Run initializations immediately
      initInvaderArmy();
      initColorProfileControl();
      initAmbientParticles();
      initKonamiCode();
      initRippleEffects();
      
      // Expose SignalInvaders to window for console access
      window.SignalInvaders = SignalInvaders;
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initArcade);
        document.addEventListener('DOMContentLoaded', initTubeOverload);
        document.addEventListener('DOMContentLoaded', initEncountersBoard);
        document.addEventListener('DOMContentLoaded', initCargoBay);
        document.addEventListener('DOMContentLoaded', initTrajectoryCanvas);
        document.addEventListener('DOMContentLoaded', initLoreEngine);
        document.addEventListener('DOMContentLoaded', initEnhancedCatalysts);
        document.addEventListener('DOMContentLoaded', () => SignalInvaders.init());
      } else {
        initArcade();
        initTubeOverload();
        initEncountersBoard();
        initCargoBay();
        initTrajectoryCanvas();
        initLoreEngine();
        initEnhancedCatalysts();
        SignalInvaders.init();
      }
    })();
  </script>
</body>
</html>
